<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.43 in css mode. -->
<html>
  <head>
    <title>2016-11-30-hpp2plantuml_-_Convert_C++_header_files_to_PlantUML.org</title>
    <style type="text/css">
    <!--
      body {
        color: #000000;
        background-color: #ffffff;
      }
      .ATTRLIST {
      }
      .builtin {
        /* font-lock-builtin-face */
        color: #483d8b;
      }
      .comment {
        /* font-lock-comment-face */
        color: #b22222;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #b22222;
      }
      .constant {
        /* font-lock-constant-face */
        color: #008b8b;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #0000ff;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #a020f0;
      }
      .org-block {
        /* org-block */
        color: #7f7f7f;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #b22222;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #b22222;
      }
      .org-checkbox {
        /* org-checkbox */
        font-weight: bold;
      }
      .org-code {
        /* org-code */
        color: #7f7f7f;
      }
      .org-document-info {
        /* org-document-info */
        color: #191970;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #7f7f7f;
      }
      .org-document-title {
        /* org-document-title */
        color: #191970;
        font-weight: bold;
      }
      .org-done {
        /* org-done */
        color: #228b22;
        font-weight: bold;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #0000ff;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #a0522d;
      }
      .org-level-3 {
        /* org-level-3 */
        color: #a020f0;
      }
      .org-level-4 {
        /* org-level-4 */
        color: #b22222;
      }
      .org-link {
        /* org-link */
        color: #3a5fcd;
        text-decoration: underline;
      }
      .org-macro {
        /* org-macro */
        color: #8b4513;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #b22222;
      }
      .org-property-value {
      }
      .org-special-keyword {
        /* org-special-keyword */
        color: #a020f0;
      }
      .org-table {
        /* org-table */
        color: #0000ff;
      }
      .org-tag {
        /* org-tag */
        font-weight: bold;
      }
      .org-verbatim {
        /* org-verbatim */
        color: #7f7f7f;
      }
      .python-cell-cellbreak {
        /* python-cell-cellbreak-face */
        font-weight: bold;
        text-decoration: overline;
      }
      .regexp-grouping-backslash {
        /* font-lock-regexp-grouping-backslash */
        font-weight: bold;
      }
      .regexp-grouping-construct {
        /* font-lock-regexp-grouping-construct */
        font-weight: bold;
      }
      .rst-adornment {
        /* rst-adornment */
        color: #a020f0;
      }
      .rst-comment {
        /* rst-comment */
        color: #b22222;
      }
      .rst-directive {
        /* rst-directive */
        color: #483d8b;
      }
      .rst-external {
        /* rst-external */
        color: #228b22;
      }
      .rst-level-1 {
        /* rst-level-1 */
        background-color: #d9d9d9;
      }
      .rst-level-2 {
        /* rst-level-2 */
        background-color: #c7c7c7;
      }
      .string {
        /* font-lock-string-face */
        color: #8b2252;
      }
      .type {
        /* font-lock-type-face */
        color: #228b22;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #a0522d;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-meta-line">#+SETUPFILE: ../setup.org</span>
<span class="org-document-info-keyword">#+TITLE:</span> <span class="org-document-title">hpp2plantuml - Convert C++ header files to PlantUML
</span><span class="org-document-info-keyword">#+DATE:</span> <span class="org-document-info">&lt;2016-11-30 Wed&gt;
</span><span class="org-meta-line">#+OPTIONS: todo:nil ^:nil</span>
<span class="org-meta-line">#+TODO: TODO REVIEW | DONE DEFERRED ABANDONED</span>
<span class="org-meta-line">#+MACRO: tt \nbsp{}</span>
<span class="org-meta-line">#+PROPERTY: header-args+ :exports code :results silent</span>
<span class="org-meta-line">#+PROPERTY: header-args:python+ :tangle src/hpp2plantuml/hpp2plantuml.py :mkdirp yes :eval no</span>

This is the documentation for the <span class="org-verbatim">=hpp2plantuml=</span> package, fully contained within
this single org-file.

The current version of the code is:
<span class="org-meta-line">#+NAME: hpp2plantuml-version</span>
<span class="org-code">: 0.1
</span>
<span class="org-level-1">* </span><span class="org-done">DONE</span><span class="org-level-1"> Motivation</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-intro</span>
<span class="org-special-keyword">:END:</span>

The purpose of this tool is to convert C++ header files to a UML representation
in <span class="org-link"><a href="https://plantuml.com">PlantUML</a></span> syntax that can be used to generate diagrams with PlantUML.

<span class="org-link"><a href="https://plantuml.com">PlantUML</a></span> is a program rendering UML diagrams from plain text inputs using an
expressive language.

This module generates the text input to PlantUML from C++ header files.  Its
ambition is limited but it should produce reasonable conversion for simple class
hierarchies.  It aims at supporting:
- class members with properties (<span class="org-code">~private~</span>, <span class="org-code">~method~</span>, <span class="org-code">~protected~</span>), methods with
  basic qualifiers (<span class="org-code">~static~</span>, abstract),
- inheritance relationships,
- aggregation relationships (very basic support).


<span class="org-level-1">* </span><span class="org-done">DONE</span><span class="org-level-1"> License</span>

The license adopted for this project is the MIT license.

<span class="org-meta-line">#+NAME: license</span>
<span class="org-block-begin-line">#+BEGIN_SRC conf :tangle LICENSE
</span><span class="org-block">
</span><span class="variable-name"><span class="org-block">The</span></span><span class="org-block"> MIT License (MIT)

</span><span class="variable-name"><span class="org-block">Copyright</span></span><span class="org-block"> (c) 2016 T

</span><span class="variable-name"><span class="org-block">Permission</span></span><span class="org-block"> is hereby granted, free of charge, to any person obtaining a copy
</span><span class="variable-name"><span class="org-block">of</span></span><span class="org-block"> this software and associated documentation files (the </span><span class="string"><span class="org-block">"Software"</span></span><span class="org-block">), to deal
</span><span class="variable-name"><span class="org-block">in</span></span><span class="org-block"> the Software without restriction, including without limitation the rights
</span><span class="variable-name"><span class="org-block">to</span></span><span class="org-block"> use, copy, modify, merge, publish, distribute, sublicense, and/or sell
</span><span class="variable-name"><span class="org-block">copies</span></span><span class="org-block"> of the Software, and to permit persons to whom the Software is
</span><span class="variable-name"><span class="org-block">furnished</span></span><span class="org-block"> to do so, subject to the following conditions:

</span><span class="variable-name"><span class="org-block">The</span></span><span class="org-block"> above copyright notice and this permission notice shall be included in
</span><span class="variable-name"><span class="org-block">all</span></span><span class="org-block"> copies or substantial portions of the Software.

</span><span class="variable-name"><span class="org-block">THE</span></span><span class="org-block"> SOFTWARE IS PROVIDED </span><span class="string"><span class="org-block">"AS IS"</span></span><span class="org-block">, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</span><span class="variable-name"><span class="org-block">IMPLIED,</span></span><span class="org-block"> INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</span><span class="variable-name"><span class="org-block">FITNESS</span></span><span class="org-block"> FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
</span><span class="variable-name"><span class="org-block">AUTHORS</span></span><span class="org-block"> OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</span><span class="variable-name"><span class="org-block">LIABILITY,</span></span><span class="org-block"> WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
</span><span class="variable-name"><span class="org-block">OUT</span></span><span class="org-block"> OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
</span><span class="variable-name"><span class="org-block">THE</span></span><span class="org-block"> SOFTWARE.
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-1">* </span><span class="org-done">DONE</span><span class="org-level-1"> Requirements</span>

This module has mostly standard dependencies; the only exception is the
<span class="org-link"><a href="http://senexcanis.com/open-source/cppheaderparser/">CppHeaderParser</a></span> module used to parse header files.

<span class="org-meta-line">#+NAME: py-dependency-list</span>
<span class="org-table">| argparse        |</span>
<span class="org-table">| CppHeaderParser |</span>

The full list of non-standard dependencies is produced by the following source
block (returning either imports or a dependency list used in <span class="org-link"><a href="nil:nil">=setup.py=</a></span>):

<span class="org-meta-line">#+NAME: py-dependencies</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp :var output="import" :var dep-list=py-dependency-list :results value :eval no-export
</span><span class="org-block">(</span><span class="keyword"><span class="org-block">cond</span></span><span class="org-block">
 ((string= output </span><span class="string"><span class="org-block">"import"</span></span><span class="org-block">)
  (mapconcat
   (</span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> (el) (concat </span><span class="string"><span class="org-block">"import "</span></span><span class="org-block"> (car el))) dep-list </span><span class="string"><span class="org-block">"\n"</span></span><span class="org-block">))
 ((string= output </span><span class="string"><span class="org-block">"requirements"</span></span><span class="org-block">)
  (concat </span><span class="string"><span class="org-block">"["</span></span><span class="org-block">
          (mapconcat
           (</span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> (el) (concat </span><span class="string"><span class="org-block">"'"</span></span><span class="org-block"> (car el) </span><span class="string"><span class="org-block">"'"</span></span><span class="org-block">)) dep-list </span><span class="string"><span class="org-block">", "</span></span><span class="org-block">)
          </span><span class="string"><span class="org-block">"]"</span></span><span class="org-block">)))
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-meta-line">#+NAME: py-imports</span>
<span class="org-block-begin-line">#+BEGIN_SRC python :noweb yes
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Imports</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> re
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> glob
&lt;&lt;py-dependencies(</span><span class="string"><span class="org-block">"import"</span></span><span class="org-block">)&gt;&gt;
</span><span class="org-block-end-line">#+END_SRC
</span>
The tests rely on the <span class="org-link"><a href="http://nose.readthedocs.io/en/latest/">nosetest</a></span> framework and the package documentation is built
with <span class="org-link"><a href="http://sphinx-doc.org">Sphinx</a></span>.


<span class="org-level-1">* </span><span class="org-done">DONE</span><span class="org-level-1"> Module source code</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-module</span>
<span class="org-special-keyword">:END:</span>

The package relies on a layer of objects used as intermediate between the parsed
header files (parsed using <span class="org-code">~CppHeaderParser~</span>) and the text output for use with
PlantUML.

The main entry point (<span class="org-link"><a href="nil:nil">~CreatePlantUMLFile~</a></span>) takes as input a list of header
files and creates a <span class="org-link"><a href="nil:nil">~Diagram~</a></span> object from it, which contains the internal object
representation extracted jointly from the input files.

Objects for different types (e.g. class, struct, etc.) are initialized at
instantiation time from the parsed header via the <span class="org-code">~parse_members~</span> method.
Conversion to text input in PlantUML syntax is performed by the <span class="org-code">~render~</span> method.

Relationships between objects are extracted from a <span class="org-code">~Diagram~</span> object by listing
inheritance properties and parsing member types into <span class="org-link"><a href="nil:nil">relationship objects</a></span>.


<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> String representation constants</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-module-constants</span>
<span class="org-special-keyword">:END:</span>

Some constant variables are defined to store the PlantUML string representation
of elementary properties and links.
- The <span class="org-code">~MEMBER_PROP_MAP~</span> variable maps class member types to corresponding
  PlantUML characters.
- The <span class="org-code">~LINK_TYPE_MAP~</span> variable stores the PlantUML representation of inheritance
  and aggregation relationships.
- <span class="org-code">~CONTAINER_TYPE_MAP~</span> associates object types with internal classes used for
  their representation.

<span class="org-meta-line">#+NAME: py-constants</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Constants</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Association between member property and PlantUML symbol
</span></span><span class="variable-name"><span class="org-block">MEMBER_PROP_MAP</span></span><span class="org-block"> = {
    </span><span class="string"><span class="org-block">'private'</span></span><span class="org-block">: </span><span class="string"><span class="org-block">'-'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'public'</span></span><span class="org-block">: </span><span class="string"><span class="org-block">'+'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'protected'</span></span><span class="org-block">: </span><span class="string"><span class="org-block">'#'</span></span><span class="org-block">
}

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Links
</span></span><span class="variable-name"><span class="org-block">LINK_TYPE_MAP</span></span><span class="org-block"> = {
    </span><span class="string"><span class="org-block">'inherit'</span></span><span class="org-block">: </span><span class="string"><span class="org-block">'&lt;|--'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'aggregation'</span></span><span class="org-block">: </span><span class="string"><span class="org-block">'o--'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'composition'</span></span><span class="org-block">: </span><span class="string"><span class="org-block">'*--'</span></span><span class="org-block">
}

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Assiocation between object names and objects
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">- The first element is the object type name in the CppHeader object
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">- The second element is the iterator used to loop over objects
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">- The third element is a function returning the corresponding internal object
</span></span><span class="variable-name"><span class="org-block">CONTAINER_TYPE_MAP</span></span><span class="org-block"> = [
    [</span><span class="string"><span class="org-block">'classes'</span></span><span class="org-block">, </span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> objs: objs.items(), </span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> obj: Class(obj)],
    [</span><span class="string"><span class="org-block">'structs'</span></span><span class="org-block">, </span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> objs: objs.items(), </span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> obj: Struct(obj)],
    [</span><span class="string"><span class="org-block">'enums'</span></span><span class="org-block">, </span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> objs: objs, </span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> obj: Enum(obj)]
]
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Objects</span>

C++ objects parsed by the <span class="org-verbatim">=CppHeaderParser=</span> module are converted to internal
objects which perform two tasks:
1. extract properties supported by PlantUML,
2. generate text following the PlantUML syntax representing the object.

The module currently supports <span class="org-code">~class~</span> and <span class="org-code">~enum~</span> objects.  They are implemented
via the internal <span class="org-code">~Class~</span> and <span class="org-code">~Enum~</span> objects, which inherits from a common base
class.


<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Base class</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-module-container</span>
<span class="org-special-keyword">:END:</span>

C++ objects are represented by objects derived from the base <span class="org-code">~Container~</span> class.
The <span class="org-code">~Container~</span> class is abstract and contains:
- the container type (<span class="org-code">~class~</span>, <span class="org-code">~enum~</span>, <span class="org-code">~struct~</span>),
- the object name,
- a list of members (e.g. class variable or method for a class object),
- a <span class="org-code">~parse_members~</span> method which can build the list of members from a parsed
  header,
- a <span class="org-code">~render~</span> method with renders the object to text, including the object
  definition (e.g. "class TestClass") and its members (e.g. member variables and
  methods).

<span class="org-meta-line">#+NAME: py-obj-container</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Base classes</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Container</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">object</span></span><span class="org-block">):
    </span><span class="string"><span class="org-block">"""Base class for C++ objects

    This class defines the basic interface for parsed objects (e.g. class).
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, container_type, name):
        </span><span class="string"><span class="org-block">"""Class constructor

        Parameters
        ----------
        container_type : str
            String representation of container type (``class``, ``struct`` or
            ``enum``)
        name : str
            Object name
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._container_type = container_type
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name = name
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._member_list = []

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">get_name</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Name property accessor

        Returns
        -------
        str
            Object name
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">parse_members</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_container):
        </span><span class="string"><span class="org-block">"""Initialize object from header (abstract method)

        Extract object from CppHeaderParser dictionary representing a class, a
        struct or an enum object.

        Parameters
        ----------
        header_container : CppClass, CppStruct or CppEnum
            Parsed header for container
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">raise</span></span><span class="org-block"> </span><span class="type"><span class="org-block">NotImplementedError</span></span><span class="org-block">(
            </span><span class="string"><span class="org-block">'Derived class must implement :func:`parse_members`.'</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">render</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Render object to string

        Returns
        -------
        str
            String representation of object following the PlantUML syntax
        """</span></span><span class="org-block">
        </span><span class="variable-name"><span class="org-block">container_str</span></span><span class="org-block"> = </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._render_container_def() + </span><span class="string"><span class="org-block">' {\n'</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> member </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._member_list:
            </span><span class="variable-name"><span class="org-block">container_str</span></span><span class="org-block"> += </span><span class="string"><span class="org-block">'\t'</span></span><span class="org-block"> + member.render() + </span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">
        </span><span class="variable-name"><span class="org-block">container_str</span></span><span class="org-block"> += </span><span class="string"><span class="org-block">'}\n'</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> container_str

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">comparison_keys</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Order comparison key between `ClassRelationship` objects

        Use the parent name, the child name then the link type as successive
        keys.

        Returns
        -------
        list
            `operator.attrgetter` objects for successive fields used as keys
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._container_type, </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">sort_members</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Sort container members

        sort the list of members by type and name
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._member_list.sort(key=</span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> obj: obj.comparison_keys())

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_render_container_def</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""String representation of object definition

        Return the definition line of an object (e.g. "</span></span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">MyClass</span></span><span class="string"><span class="org-block">").

        Returns
        -------
        str
            Container type and name as string
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._container_type + </span><span class="string"><span class="org-block">' '</span></span><span class="org-block"> + </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name
</span><span class="org-block-end-line">#+END_SRC
</span>
Members of <span class="org-code">~Container~</span> objects (e.g. class member variable) are inherited from
the <span class="org-code">~ContainerMember~</span> class.  The interface only includes a <span class="org-code">~render~</span> method
returning a string representation of the member.  The base class
<span class="org-code">~ContainerMember~</span> defines this method abstract.

<span class="org-meta-line">#+NAME: py-obj-container-member</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Object member</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">ContainerMember</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">object</span></span><span class="org-block">):
    </span><span class="string"><span class="org-block">"""Base class for members of `Container` object

    This class defines the basic interface for object members (e.g. class
    variables, etc.)
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_member, **kwargs):
        </span><span class="string"><span class="org-block">"""Constructor

        Parameters
        ----------
        header_member : str
            Member name
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name = header_member
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type = </span><span class="constant"><span class="org-block">None</span></span><span class="org-block">

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">render</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Render object to string (abstract method)

        Returns
        -------
        str
            String representation of object member following the PlantUML
            syntax
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">raise</span></span><span class="org-block"> </span><span class="type"><span class="org-block">NotImplementedError</span></span><span class="org-block">(</span><span class="string"><span class="org-block">'Derived class must implement `render`.'</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">comparison_keys</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Order comparison key between `ClassRelationship` objects

        Use the parent name, the child name then the link type as successive
        keys.

        Returns
        -------
        list
            `operator.attrgetter` objects for successive fields used as keys
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type </span><span class="keyword"><span class="org-block">is</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">not</span></span><span class="org-block"> </span><span class="constant"><span class="org-block">None</span></span><span class="org-block">:
            </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type, </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name
        </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block">:
            </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Classes</span>

C++ class objects are represented using the <span class="org-code">~Class~</span> class.  It extends the
<span class="org-link"><a href="nil:nil">~Container~</a></span> class adding class properties (template, abstract) and a list of
parent classes.  It also offers a method to extract the types of its members,
which is used to determine aggregation relationships between classes.

<span class="org-meta-line">#+NAME: py-render-classes</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Class object</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Class</span></span><span class="org-block">(Container):
    </span><span class="string"><span class="org-block">"""Representation of C++ class

    This class derived from `Container` specializes the base class to handle
    class definition in C++ headers.

    It supports:

    ,* abstract and template classes
    ,* member variables and methods (abstract and static)
    ,* public, private, protected members (static)
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_class):
        </span><span class="string"><span class="org-block">"""Constructor

        Extract the class name and properties (template, abstract) and
        inheritance.  Then, extract the class members from the header using the
        :func:`parse_members` method.

        Parameters
        ----------
        header_class : list (str, CppClass)
            Parsed header for class object (two-element list where the first
            element is the class name and the second element is a CppClass
            object)
        """</span></span><span class="org-block">
        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">().__init__(</span><span class="string"><span class="org-block">'class'</span></span><span class="org-block">, header_class[0])
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._abstract = header_class[1][</span><span class="string"><span class="org-block">'abstract'</span></span><span class="org-block">]
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._template_type = </span><span class="constant"><span class="org-block">None</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="string"><span class="org-block">'template'</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> header_class[1]:
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._template_type = header_class[1][</span><span class="string"><span class="org-block">'template'</span></span><span class="org-block">]
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._inheritance_list = [re.sub(</span><span class="string"><span class="org-block">'&lt;.*&gt;'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">''</span></span><span class="org-block">, parent[</span><span class="string"><span class="org-block">'class'</span></span><span class="org-block">])
                                  </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> parent </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> header_class[1][</span><span class="string"><span class="org-block">'inherits'</span></span><span class="org-block">]]
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.parse_members(header_class[1])

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">parse_members</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_class):
        </span><span class="string"><span class="org-block">"""Initialize class object from header

        This method extracts class member variables and methods from header.

        Parameters
        ----------
        header_class : CppClass
            Parsed header for class
        """</span></span><span class="org-block">
        </span><span class="variable-name"><span class="org-block">member_type_map</span></span><span class="org-block"> = [
            [</span><span class="string"><span class="org-block">'properties'</span></span><span class="org-block">, ClassVariable],
            [</span><span class="string"><span class="org-block">'methods'</span></span><span class="org-block">, ClassMethod]
        ]
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> member_type, member_type_handler </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> member_type_map:
            </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> member_prop </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> MEMBER_PROP_MAP.keys():
                </span><span class="variable-name"><span class="org-block">member_list</span></span><span class="org-block"> = header_class[member_type][member_prop]
                </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> header_member </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> member_list:
                    </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._member_list.append(
                        member_type_handler(header_member, member_prop))

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">build_variable_type_list</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Get type of member variables

        This function extracts the type of each member variable.  This is used
        to list aggregation relationships between classes.

        Returns
        -------
        list(str)
            List of types (as string) for each member variable
        """</span></span><span class="org-block">
        </span><span class="variable-name"><span class="org-block">variable_type_list</span></span><span class="org-block"> = []
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> member </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._member_list:
            </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">isinstance</span></span><span class="org-block">(member, ClassVariable):
                variable_type_list.append(member.get_type())
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> variable_type_list

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">build_inheritance_list</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Get inheritance list

        Returns
        -------
        list(str)
            List of class names the current class inherits from
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._inheritance_list

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_render_container_def</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Create the string representation of the class

        Return the class name with template and abstract properties if
        present.  The output string follows the PlantUML syntax.

        Returns
        -------
        str
            String representation of class
        """</span></span><span class="org-block">
        </span><span class="variable-name"><span class="org-block">class_str</span></span><span class="org-block"> = </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._container_type + </span><span class="string"><span class="org-block">' '</span></span><span class="org-block"> + </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._abstract:
            </span><span class="variable-name"><span class="org-block">class_str</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'abstract '</span></span><span class="org-block"> + class_str
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._template_type </span><span class="keyword"><span class="org-block">is</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">not</span></span><span class="org-block"> </span><span class="constant"><span class="org-block">None</span></span><span class="org-block">:
            </span><span class="variable-name"><span class="org-block">class_str</span></span><span class="org-block"> += </span><span class="string"><span class="org-block">' &lt;{0}&gt;'</span></span><span class="org-block">.</span><span class="builtin"><span class="org-block">format</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._template_type)
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> class_str
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Class members</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-module-class-member</span>
<span class="org-special-keyword">:END:</span>

Members of C++ classes are represented by the <span class="org-code">~ClassMember~</span> object, which
inherits from the base <span class="org-link"><a href="nil:nil">~ContainerMember~</a></span> class.  The <span class="org-code">~ClassMember~</span> class is a
super-class for <span class="org-link"><a href="nil:nil">member variables</a></span> and <span class="org-link"><a href="nil:nil">class methods</a></span>.

In addition to the base representation, <span class="org-code">~ClassMember~</span> objects store the type of
the object, the scope (e.g. public or private) and a static flag.  The rendering
of the member is mostly common between variables and methods.  The <span class="org-code">~ClassMember~</span>
class provides the common rendering and relies on child classes implementing the
<span class="org-code">~_render_name~</span> method for specialization.

<span class="org-meta-line">#+NAME: py-obj-class_member</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Class member</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">ClassMember</span></span><span class="org-block">(ContainerMember):
    </span><span class="string"><span class="org-block">"""Class member (variable and method) representation

    This class is the base class for class members.  The representation
    includes the member type (variable or method), name, scope (``public``,
    ``private`` or ``protected``) and a static flag.

    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, class_member, member_scope=</span><span class="string"><span class="org-block">'private'</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Constructor

        Parameters
        ----------
        class_member : CppVariable or CppMethod
            Parsed member object (variable or method)
        member_scope : str
            Member scope property: ``public``, ``private`` or ``protected``
        """</span></span><span class="org-block">
        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">().__init__(class_member[</span><span class="string"><span class="org-block">'name'</span></span><span class="org-block">])
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type = </span><span class="constant"><span class="org-block">None</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._static = class_member[</span><span class="string"><span class="org-block">'static'</span></span><span class="org-block">]
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._scope = member_scope

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">render</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Get string representation of member

        The string representation is with the scope indicator and a static
        keyword when the member is static.  It is postfixed by the type (return
        type for class methods).  The inner part of the returned string
        contains the variable name and signature for methods.  This is obtained
        using the :func:`_render_name` method.

        Returns
        -------
        str
            String representation of member
        """</span></span><span class="org-block">
        </span><span class="variable-name"><span class="org-block">member_str</span></span><span class="org-block"> = MEMBER_PROP_MAP[</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._scope] + \
                      (</span><span class="string"><span class="org-block">'{static} '</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._static </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block"> </span><span class="string"><span class="org-block">''</span></span><span class="org-block">) + \
                      </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._render_name() + \
                      (</span><span class="string"><span class="org-block">' : '</span></span><span class="org-block"> + </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block"> </span><span class="string"><span class="org-block">''</span></span><span class="org-block">)
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> member_str

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_render_name</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Get member name

        By default (for member variables), this returns the member name.
        Derived classes can override this to control the name rendering
        (e.g. add the function prototype for member functions)
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-4">**** </span><span class="org-done">DONE</span><span class="org-level-4"> Properties</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec_class_properties</span>
<span class="org-special-keyword">:END:</span>

The specialization required for class member variables is minimal: the member
type is extracted from the parsed dictionary, and the rest of the setup is left
to the <span class="org-link"><a href="nil:nil">parent class</a></span>.

<span class="org-meta-line">#+NAME: py-obj-class_variable</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Class variable</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">ClassVariable</span></span><span class="org-block">(ClassMember):
    </span><span class="string"><span class="org-block">"""Object representation of class member variables

    This class specializes the `ClassMember` object for member variables.
    Additionally to the base class, it stores variable types as strings.  This
    is used to establish aggregation relationships between objects.
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, class_variable, member_scope=</span><span class="string"><span class="org-block">'private'</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Constructor

        Parameters
        ----------
        class_variable : CppVariable
            Parsed class variable object
        member_scope : str
            Scope property to member variable
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">assert</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">isinstance</span></span><span class="org-block">(class_variable,
                          CppHeaderParser.CppHeaderParser.CppVariable))

        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">().__init__(class_variable, member_scope)

        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type = _cleanup_type(class_variable[</span><span class="string"><span class="org-block">'type'</span></span><span class="org-block">])

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">get_type</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Variable type accessor

        Returns
        -------
        str
            Variable type as string
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-4">**** </span><span class="org-done">DONE</span><span class="org-level-4"> Methods</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec_class_methods</span>
<span class="org-special-keyword">:END:</span>

Member methods store additional information on the class members: an abstract
flag is used for purely virtual methods, the method name is modified to add a
tilde sign (<span class="org-verbatim">=~=</span>) prefix for destructor methods and a list of parameters is
stored.

The name rendering includes the method signature.  An option to shorten the list
of parameters by keeping only types or variable names or using ellipsis may be
implemented in the future.

<span class="org-meta-line">#+NAME: py-obj-class_method</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Class method</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">ClassMethod</span></span><span class="org-block">(ClassMember):
    </span><span class="string"><span class="org-block">"""Class member method representation

    This class extends `ClassMember` for member methods.  It stores additional
    method properties (abstract, destructor flag, input parameter types).
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, class_method, member_scope):
        </span><span class="string"><span class="org-block">"""Constructor

        The method name and additional properties are extracted from the parsed
        header.  A list of parameter types is also stored to retain the
        function signature.  The ``~`` character is also appended to destructor
        methods.

        Parameters
        ----------
        class_method : CppMethod
            Parsed class member method
        member_scope : str
            Scope of the member method
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">assert</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">isinstance</span></span><span class="org-block">(class_method,
                          CppHeaderParser.CppHeaderParser.CppMethod))

        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">().__init__(class_method, member_scope)

        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type = _cleanup_type(class_method[</span><span class="string"><span class="org-block">'returns'</span></span><span class="org-block">])
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> class_method[</span><span class="string"><span class="org-block">'returns_pointer'</span></span><span class="org-block">]:
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type += </span><span class="string"><span class="org-block">'*'</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">elif</span></span><span class="org-block"> class_method[</span><span class="string"><span class="org-block">'returns_reference'</span></span><span class="org-block">]:
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._type += </span><span class="string"><span class="org-block">'&amp;'</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._abstract = class_method[</span><span class="string"><span class="org-block">'pure_virtual'</span></span><span class="org-block">]
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> class_method[</span><span class="string"><span class="org-block">'destructor'</span></span><span class="org-block">]:
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name = </span><span class="string"><span class="org-block">'~'</span></span><span class="org-block"> + </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._param_list = []
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> param </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> class_method[</span><span class="string"><span class="org-block">'parameters'</span></span><span class="org-block">]:
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._param_list.append([_cleanup_type(param[</span><span class="string"><span class="org-block">'type'</span></span><span class="org-block">]),
                                     param[</span><span class="string"><span class="org-block">'name'</span></span><span class="org-block">]])

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_render_name</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Internal rendering of method name

        This method extends the base :func:`ClassMember._render_name` method by
        adding the method signature to the returned string.

        Returns
        -------
        str
            The method name (prefixed with the ``abstract`` keyword when
            appropriate) and signature
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">assert</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">not</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._static </span><span class="keyword"><span class="org-block">or</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">not</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._abstract)

        </span><span class="variable-name"><span class="org-block">method_str</span></span><span class="org-block"> = (</span><span class="string"><span class="org-block">'{abstract} '</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._abstract </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block"> </span><span class="string"><span class="org-block">''</span></span><span class="org-block">) + \
                     </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name + </span><span class="string"><span class="org-block">'('</span></span><span class="org-block"> + \
                     </span><span class="string"><span class="org-block">', '</span></span><span class="org-block">.join(</span><span class="string"><span class="org-block">' '</span></span><span class="org-block">.join(it).strip()
                               </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> it </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._param_list) + </span><span class="string"><span class="org-block">')'</span></span><span class="org-block">

        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> method_str
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Structures</span>

While <span class="org-code">~struct~</span> objects are currently not supported, their addition should be
relatively straightforward and the <span class="org-code">~Struct~</span> class may simply inherit from the
<span class="org-code">~Class~</span> class.  The following should give a starting point.

<span class="org-meta-line">#+NAME: py-render-structs</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Struct object</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Struct</span></span><span class="org-block">(Class):
    </span><span class="string"><span class="org-block">"""Representation of C++ struct objects

    This class derived is almost identical to `Class`, the only difference
    being the container type name ("</span></span><span class="org-block">struct</span><span class="string"><span class="org-block">" instead of "</span></span><span class="keyword"><span class="org-block">class</span></span><span class="string"><span class="org-block">").
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_struct):
        </span><span class="string"><span class="org-block">"""Class constructor

        Parameters
        ----------
        header_struct : list (str, CppStruct)
            Parsed header for struct object (two-element list where the first
            element is the structure name and the second element is a CppStruct
            object)
        """</span></span><span class="org-block">
        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">().__init__(header_struct[0])
        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">(Class).__init__(</span><span class="string"><span class="org-block">'struct'</span></span><span class="org-block">)
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Enumeration lists</span>

The <span class="org-code">~Enum~</span> class representing enumeration object is a trivial extension of the
base <span class="org-link"><a href="nil:nil">~Container~</a></span> class.  Note that the enumeration elements are rendered without
the actual values.

<span class="org-meta-line">#+NAME: py-render-enums</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Enum object</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Enum</span></span><span class="org-block">(Container):
    </span><span class="string"><span class="org-block">"""Class represnting enum objects

    This class defines a simple object inherited from the base `Container`
    class.  It simply lists enumerated values.
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_enum):
        </span><span class="string"><span class="org-block">"""Constructor

        Parameters
        ----------
        header_enum : CppEnum
            Parsed CppEnum object
        """</span></span><span class="org-block">
        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">().__init__(</span><span class="string"><span class="org-block">'enum'</span></span><span class="org-block">, header_enum[</span><span class="string"><span class="org-block">'name'</span></span><span class="org-block">])
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.parse_members(header_enum)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">parse_members</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_enum):
        </span><span class="string"><span class="org-block">"""Extract enum values from header

        Parameters
        ----------
        header_enum : CppEnum
            Parsed `CppEnum` object
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> value </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> header_enum[</span><span class="string"><span class="org-block">'values'</span></span><span class="org-block">]:
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._member_list.append(EnumValue(value[</span><span class="string"><span class="org-block">'name'</span></span><span class="org-block">]))


</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">EnumValue</span></span><span class="org-block">(ContainerMember):
    </span><span class="string"><span class="org-block">"""Class representing values in enum object

    This class only contains the name of the enum value (the actual integer
    value is ignored).
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_value, **kwargs):
        </span><span class="string"><span class="org-block">"""Constructor

        Parameters
        ----------
        header_value : str
            Name of enum member
        """</span></span><span class="org-block">
        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">().__init__(header_value)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">render</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Rendering to string

        This method simply returns the variable name

        Returns
        -------
        str
            The enumeration element name
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._name
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Class relationships</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-module-relationship</span>
<span class="org-special-keyword">:END:</span>

The current version only supports inheritance and aggregation relationships.  No
attempt is made to differentiate between composition and aggregation
relationships from the code; instead, an object having a member of a type
defined by another class is assumed to correspond to an aggregation
relationship.

The base <span class="org-code">~ClassRelationship~</span> class defines the common properties of class
relationships: a parent, a child and a connection type.  All are saved as
strings and the text representation of a connection link is obtained from the
<span class="org-link"><a href="nil:nil">~CONTAINER_TYPE_MAP~ constant</a></span>.

<span class="org-meta-line">#+NAME: py-class_relationship</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Class connections</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">ClassRelationship</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">object</span></span><span class="org-block">):
    </span><span class="string"><span class="org-block">"""Base object for class relationships

    This class defines the common structure of class relationship objects.
    This includes a parent/child pair and a relationship type (e.g. inheritance
    or aggregation).
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, link_type, c_parent, c_child):
        </span><span class="string"><span class="org-block">"""Constructor

        Parameters
        ----------
        link_type : str
            Relationship type: ``inherit`` or ``aggregation``
        c_parent : str
            Name of parent class
        c_child : str
            Name of child class
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._parent = c_parent
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._child = c_child
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._link_type = link_type

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">comparison_keys</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Order comparison key between `ClassRelationship` objects

        Compare alphabetically based on the parent name, the child name then
        the link type.

        Returns
        -------
        list
            `operator.attrgetter` objects for successive fields used as keys
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._parent, </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._child, </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._link_type

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">render</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Render class relationship to string

        This method generically appends the parent name, a rendering of the
        link type (obtained from the :func:`_render_link_type` method) and the
        child object name.

        Returns
        -------
        str
            The string representation of the class relationship following the
            PlantUML syntax
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._parent + </span><span class="string"><span class="org-block">' '</span></span><span class="org-block"> + </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._render_link_type() + \
            </span><span class="string"><span class="org-block">' '</span></span><span class="org-block"> + </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._child

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_render_link_type</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Internal representation of link

        The string representation is obtained from the `LINK_TYPE_MAP`
        constant.

        Returns
        -------
        str
            The link between parent and child following the PlantUML syntax
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> LINK_TYPE_MAP[</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._link_type]
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-4">**** </span><span class="org-done">DONE</span><span class="org-level-4"> Inheritance</span>

The inheritance relationship is a straightforward specialization of the base
<span class="org-code">~ClassRelationship~</span> class: it simply forces the link type to be the string
"inherit".

<span class="org-meta-line">#+NAME: py-class_inheritance</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Class inheritance</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">ClassInheritanceRelationship</span></span><span class="org-block">(ClassRelationship):
    </span><span class="string"><span class="org-block">"""Representation of inheritance relationships

    This module extends the base `ClassRelationship` class by setting the link
    type to ``inherit``.
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, c_parent, c_child):
        </span><span class="string"><span class="org-block">"""Constructor

        Parameters
        ----------
        c_parent : str
            Parent class
        c_child : str
            Derived class
        """</span></span><span class="org-block">
        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">().__init__(</span><span class="string"><span class="org-block">'inherit'</span></span><span class="org-block">, c_parent, c_child)
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-4">**** </span><span class="org-done">DONE</span><span class="org-level-4"> Aggregation</span>

The aggregation relationship specializes the base <span class="org-code">~ClassRelationship~</span> class by
using the "aggregation" link type and adding a <span class="org-code">~count~</span> field used to add a label
with the number of instances of the parent class in the PlantUML diagram (the
count is omitted when equal to one).

<span class="org-meta-line">#+NAME: py-class_aggregation</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Class aggregation</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">ClassAggregationRelationship</span></span><span class="org-block">(ClassRelationship):
    </span><span class="string"><span class="org-block">"""Representation of aggregation relationships

    This module extends the base `ClassRelationship` class by setting the link
    type to ``aggregation``.  It also keeps a count of aggregation, which is
    displayed near the arrow when using PlantUML.

    Aggregation relationships are simplified to represent the presence of a
    variable type (possibly within a container such as a list) in a class
    definition.
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, c_parent, c_child, c_count=1):
        </span><span class="string"><span class="org-block">"""Constructor

        Parameters
        ----------
        c_parent : str
            Class corresponding to the type of the member variable in the
            aggregation relationship
        c_child : str
            Child (or client) class of the aggregation relationship
        c_cout : int
            The number of members of ``c_child`` that are of type (possibly
            through containers) ``c_parent``
        """</span></span><span class="org-block">
        </span><span class="builtin"><span class="org-block">super</span></span><span class="org-block">().__init__(</span><span class="string"><span class="org-block">'aggregation'</span></span><span class="org-block">, c_parent, c_child)
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._count = c_count

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_render_link_type</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Internal link rendering

        This method overrides the default link rendering defined in
        :func:`ClassRelationship._render_link_type` to include a count near the
        end of the arrow.
        """</span></span><span class="org-block">
        </span><span class="variable-name"><span class="org-block">count_str</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">''</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._count == 1 </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block"> </span><span class="string"><span class="org-block">'"%d" '</span></span><span class="org-block"> % </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._count
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> count_str + LINK_TYPE_MAP[</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._link_type]
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Diagram object</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-module-diagram</span>
<span class="org-special-keyword">:END:</span>

The <span class="org-code">~Diagram~</span> object is the main interface between the C++ code and the PlantUML
program.  It contains a list of objects parsed from the header files, maintains
lists of relationships and provides rendering facilities to produce a string
ready to process by PlantUML.

An example use case for the <span class="org-code">~Diagram~</span> class could be:
<span class="org-meta-line">#+NAME: py-diag-example</span>
<span class="org-block-begin-line">#+BEGIN_SRC python :tangle no
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Create object
</span></span><span class="variable-name"><span class="org-block">diag</span></span><span class="org-block"> = Diagram()
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Initialize from filename
</span></span><span class="org-block">diag.create_from_file(filename)
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Get output string following PlantUML syntax
</span></span><span class="variable-name"><span class="org-block">output_string</span></span><span class="org-block"> = diag.render()
</span><span class="org-block-end-line">#+END_SRC
</span>
The interface methods and their behavior are summarized in
Table<span class="org-macro">{{{tt}}}</span><span class="org-link"><a href="nil:nil">tbl-diagram-interface</a></span>.

<span class="org-meta-line">#+NAME: tbl-diagram-interface</span>
<span class="org-meta-line">#+CAPTION:</span> <span class="org-block">Public interface for populating a ~Diagram~ object.</span>
<span class="org-table">| Method name             | input type | input list? | reset? | sort? | build lists? |</span>
<span class="org-table">|-------------------------+------------+-------------+--------+-------+--------------|</span>
<span class="org-table">| create_from_file        | file       | no          | yes    | yes   | yes          |</span>
<span class="org-table">| create_from_file_list   | file       | yes         | yes    | yes   | yes          |</span>
<span class="org-table">| add_from_file           | file       | no          | no     | no    | no           |</span>
<span class="org-table">| add_from_file_list      | file       | yes         | no     | no    | no           |</span>
<span class="org-table">| create_from_string      | string     | no          | yes    | yes   | yes          |</span>
<span class="org-table">| create_from_string_list | string     | yes         | yes    | yes   | yes          |</span>
<span class="org-table">| add_from_string         | string     | no          | no     | no    | no           |</span>
<span class="org-table">| add_from_string_list    | string     | yes         | no     | no    | no           |</span>

Functionally, parsing of the C++ headers is left to the <span class="org-verbatim">=CppHeaderParser=</span>
module, the output of which is parsed into internal objects using <span class="org-code">~Container~</span>
parsers.  The main functionality of the <span class="org-code">~Diagram~</span> class consists in building the
relationship lists between classes.  The assumption is that for a link to be
stored, it must be between two objects present in the <span class="org-code">~Diagram~</span> object (no
relationships with external classes).

To build the inheritance list, the objects are browsed and
<span class="org-code">~ClassInheritanceRelationship~</span> instances are added to the list whenever the
parent class is defined within the <span class="org-code">~Diagram~</span> object.

Construction of the list of aggregation links is slightly more complex.  A first
run through the object extracts all the member types for <span class="org-code">~Class~</span> objects.  Next
a list of (type, count) pairs is constructed for members of types defined within
the <span class="org-code">~Diagram~</span> object.  Finally, the list is used to instantiate
<span class="org-code">~ClassAggregationRelationship~</span> objects stored in a list.

The rendering function builds a string containing the PlantUML preamble and
postamble text for diagrams (<span class="org-code">~@startuml~</span>, <span class="org-code">~@enduml~</span>), the rendered text for each
object and the rendered relationship links.

In order to ensure that the rendering is reproducible, a sorting mechanism has
been implemented for objects, members and relationships.  Objects and object
members are sorted by type and name and relationships are sorted by parent name,
child name and link type if necessary.  The <span class="org-code">~add_from_*~</span> interface methods can
be used to avoid this sorting step.

<span class="org-meta-line">#+NAME: py-obj-diagram</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Diagram class</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Diagram</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">object</span></span><span class="org-block">):
    </span><span class="string"><span class="org-block">"""UML diagram object

    This class lists the objects in the set of files considere, and the
    relationships between object.

    The main interface to the `Diagram` object is via the ``create_*`` and
    ``add_*`` methods.  The former parses objects and builds relationship lists
    between the different parsed objects.  The latter only parses objects and
    does not builds relationship lists.

    Each method has versions for file and string inputs and folder string lists
    and file lists inputs.
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Constructor

        The `Diagram` class constructor simply initializes object lists.  It
        does not create objects or relationships.
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._objects = []
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._inheritance_list = []
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._aggregation_list = []

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">clear</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Reinitiliaze object"""</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.__init__()

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_sort_list</span></span><span class="org-block">(input_list):
        </span><span class="string"><span class="org-block">"""Sort list using `ClassRelationship` comparison

        Parameters
        ----------
        input_list : list(ClassRelationship)
            Sort list using the :func:`ClassRelationship.comparison_keys`
            comparison function
        """</span></span><span class="org-block">
        input_list.sort(key=</span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> obj: obj.comparison_keys())

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">sort_elements</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Sort elements in diagram

        Sort the objects and relationship links.  Objects are sorted using the
        :func:`Container.comparison_keys` comparison function and list are
        sorted using the `_sort_list` helper function.
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._objects.sort(key=</span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> obj: obj.comparison_keys())
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> obj </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._objects:
            obj.sort_members()
        Diagram._sort_list(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._inheritance_list)
        Diagram._sort_list(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._aggregation_list)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_build_helper</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, </span><span class="builtin"><span class="org-block">input</span></span><span class="org-block">, build_from=</span><span class="string"><span class="org-block">'string'</span></span><span class="org-block">, flag_build_lists=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">,
                      flag_reset=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Helper function to initialize a `Diagram` object from parsed headers

        Parameters
        ----------
        input : CppHeader or str or list(CppHeader) or list(str)
            Input of arbitrary type.  The processing depends on the
            ``build_from`` parameter
        build_from : str
            Determines the type of the ``input`` variable:

            ,* ``string``: ``input`` is a string containing C++ header code
            ,* ``file``: ``input`` is a filename to parse
            ,* ``string_list``: ``input`` is a list of strings containing C++
              header code
            ,* ``file_list``: ``input`` is a list of filenames to parse

        flag_build_lists : bool
            When True, relationships lists are built and the objects in the
            diagram are sorted, otherwise, only object parsing is performed
        flag_reset : bool
            If True, the object is initialized (objects and relationship lists
            are cleared) prior to parsing objects, otherwise, new objects are
            appended to the list of existing ones
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> flag_reset:
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.clear()
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> build_from </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> (</span><span class="string"><span class="org-block">'string'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'file'</span></span><span class="org-block">):
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.parse_objects(</span><span class="builtin"><span class="org-block">input</span></span><span class="org-block">, build_from)
        </span><span class="keyword"><span class="org-block">elif</span></span><span class="org-block"> build_from </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> (</span><span class="string"><span class="org-block">'string_list'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'file_list'</span></span><span class="org-block">):
            </span><span class="variable-name"><span class="org-block">build_from_single</span></span><span class="org-block"> = re.sub(</span><span class="string"><span class="org-block">'_list$'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">''</span></span><span class="org-block">, build_from)
            </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> single_input </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">input</span></span><span class="org-block">:
                </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.parse_objects(single_input, build_from_single)
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> flag_build_lists:
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.build_relationship_lists()
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.sort_elements()

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">create_from_file</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_file):
        </span><span class="string"><span class="org-block">"""Initialize `Diagram` object from header file

        Wrapper around the :func:`_build_helper` function, with ``file`` input,
        building the relationship lists and with object reset.
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._build_helper(header_file, build_from=</span><span class="string"><span class="org-block">'file'</span></span><span class="org-block">,
                           flag_build_lists=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">, flag_reset=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">create_from_file_list</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, file_list):
        </span><span class="string"><span class="org-block">"""Initialize `Diagram` object from list of header files

        Wrapper around the :func:`_build_helper` function, with ``file_list``
        input, building the relationship lists and with object reset.
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._build_helper(file_list, build_from=</span><span class="string"><span class="org-block">'file_list'</span></span><span class="org-block">,
                           flag_build_lists=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">, flag_reset=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">add_from_file</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_file):
        </span><span class="string"><span class="org-block">"""Augment `Diagram` object from header file

        Wrapper around the :func:`_build_helper` function, with ``file`` input,
        skipping building of the relationship lists and without object reset
        (new objects are added to the object).
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._build_helper(header_file, build_from=</span><span class="string"><span class="org-block">'file'</span></span><span class="org-block">,
                           flag_build_lists=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">, flag_reset=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">add_from_file_list</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, file_list):
        </span><span class="string"><span class="org-block">"""Augment `Diagram` object from list of header files

        Wrapper around the :func:`_build_helper` function, with ``file_list``
        input, skipping building of the relationship lists and without object
        reset (new objects are added to the object).
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._build_helper(file_list, build_from=</span><span class="string"><span class="org-block">'file_list'</span></span><span class="org-block">,
                           flag_build_lists=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">, flag_reset=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">create_from_string</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_string):
        </span><span class="string"><span class="org-block">"""Initialize `Diagram` object from header string

        Wrapper around the :func:`_build_helper` function, with ``string``
        input, building the relationship lists and with object reset.
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._build_helper(header_string, build_from=</span><span class="string"><span class="org-block">'string'</span></span><span class="org-block">,
                           flag_build_lists=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">, flag_reset=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">create_from_string_list</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, string_list):
        </span><span class="string"><span class="org-block">"""Initialize `Diagram` object from list of header strings

        Wrapper around the :func:`_build_helper` function, with ``string_list``
        input, skipping building of the relationship lists and with object
        reset.
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._build_helper(string_list, build_from=</span><span class="string"><span class="org-block">'string_list'</span></span><span class="org-block">,
                           flag_build_lists=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">, flag_reset=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">add_from_string</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_string):
        </span><span class="string"><span class="org-block">"""Augment `Diagram` object from header string

        Wrapper around the :func:`_build_helper` function, with ``string``
        input, skipping building of the relationship lists and without object
        reset (new objects are added to the object).
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._build_helper(header_string, build_from=</span><span class="string"><span class="org-block">'string'</span></span><span class="org-block">,
                           flag_build_lists=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">, flag_reset=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">add_from_string_list</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, string_list):
        </span><span class="string"><span class="org-block">"""Augment `Diagram` object from list of header strings

        Wrapper around the :func:`_build_helper` function, with ``string_list``
        input, building the relationship lists and without object reset (new
        objects are added to the object).
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._build_helper(string_list, build_from=</span><span class="string"><span class="org-block">'string_list'</span></span><span class="org-block">,
                           flag_build_lists=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">, flag_reset=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">build_relationship_lists</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Build inheritance and aggregation lists from parsed objects

        This method successively calls the :func:`build_inheritance_list` and
        :func:`build_aggregation_list` methods.
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.build_inheritance_list()
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.build_aggregation_list()

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">parse_objects</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, header_file, arg_type=</span><span class="string"><span class="org-block">'string'</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Parse objects

        This method parses file of string inputs using the CppHeaderParser
        module and extracts internal objects for rendering.

        Parameters
        ----------
        header_file : str
            A string containing C++ header code or a filename with C++ header
            code
        arg_type : str
            It set to ``string``, ``header_file`` is considered to be a string,
            otherwise, it is assumed to be a filename
        """</span></span><span class="org-block">
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Parse header file
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">parsed_header</span></span><span class="org-block"> = CppHeaderParser.CppHeader(header_file,
                                                  argType=arg_type)
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> container_type, container_iterator, \
            container_handler </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> CONTAINER_TYPE_MAP:
            </span><span class="variable-name"><span class="org-block">objects</span></span><span class="org-block"> = parsed_header.__getattribute__(container_type)
            </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> obj </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> container_iterator(objects):
                </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._objects.append(container_handler(obj))

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">build_inheritance_list</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Build list of inheritance between objects

        This method lists all the inheritance relationships between objects
        contained in the `Diagram` object (external relationships are ignored).

        The implementation establishes a list of available classes and loops
        over objects to obtain their inheritance.  When parent classes are in
        the list of available classes, their a `ClassInheritanceRelationship`
        object is added to the list.
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._inheritance_list = []
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Build list of classes in diagram
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">class_list</span></span><span class="org-block"> = [obj.get_name() </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> obj </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._objects
                      </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">isinstance</span></span><span class="org-block">(obj, Class)]

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Create relationships
</span></span><span class="org-block">
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Inheritance
</span></span><span class="org-block">        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> obj </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._objects:
            </span><span class="variable-name"><span class="org-block">obj_name</span></span><span class="org-block"> = obj.get_name()
            </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">isinstance</span></span><span class="org-block">(obj, Class):
                </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> parent </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> obj.build_inheritance_list():
                    </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> parent </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> class_list:
                        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._inheritance_list.append(
                            ClassInheritanceRelationship(parent, obj_name))

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">build_aggregation_list</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Build list of aggregation relationships

        This method loops over objects and finds members with type
        corresponding to other classes defined in the `Diagram` object (keeping
        a count of occurrences).

        The procedure first build an internal dictionary of relationships
        found, augmenting the count using the :func:`_augment_comp` function.
        In a second phase, `ClassAggregationRelationship` objects are created
        for each relationships, using the calculated count.
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._aggregation_list = []
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Build list of classes in diagram
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">class_list</span></span><span class="org-block"> = [obj.get_name() </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> obj </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._objects
                      </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">isinstance</span></span><span class="org-block">(obj, Class)]

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Build member type list
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">variable_type_list</span></span><span class="org-block"> = {}
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> obj </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._objects:
            </span><span class="variable-name"><span class="org-block">obj_name</span></span><span class="org-block"> = obj.get_name()
            </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">isinstance</span></span><span class="org-block">(obj, Class):
                </span><span class="variable-name"><span class="org-block">variable_type_list</span></span><span class="org-block">[obj_name] = obj.build_variable_type_list()
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Create aggregation links
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">aggregation_counts</span></span><span class="org-block"> = {}

        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> child_class </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> class_list:
            </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> child_class </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> variable_type_list.keys():
                </span><span class="variable-name"><span class="org-block">var_types</span></span><span class="org-block"> = variable_type_list[child_class]
                </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> var_type </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> var_types:
                    </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> parent </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> class_list:
                        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> re.search(r</span><span class="string"><span class="org-block">'\b'</span></span><span class="org-block"> + parent + r</span><span class="string"><span class="org-block">'\b'</span></span><span class="org-block">, var_type):
                            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._augment_comp(aggregation_counts, parent,
                                               child_class)
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> obj_class, obj_comp_list </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> aggregation_counts.items():
            </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> comp_parent, comp_count </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> obj_comp_list:
                </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._aggregation_list.append(
                    ClassAggregationRelationship(obj_class, comp_parent,
                                                 comp_count))

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_augment_comp</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">, c_dict, c_parent, c_child):
        </span><span class="string"><span class="org-block">"""Increment the aggregation reference count

        If the aggregation relationship is not in the list (``c_dict``), then
        add a new entry with count 1.  If the relationship is already in the
        list, then increment the count.

        Parameters
        ----------
        c_dict : dict
            List of aggregation relationships.  For each dictionary key, a pair
            of (str, int) elements: string and number of occurrences
        c_parent : str
            Parent class name
        c_child : str
            Child class name
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> c_child </span><span class="keyword"><span class="org-block">not</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> c_dict:
            </span><span class="variable-name"><span class="org-block">c_dict</span></span><span class="org-block">[c_child] = [[c_parent, 1], ]
        </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block">:
            </span><span class="variable-name"><span class="org-block">parent_list</span></span><span class="org-block"> = [c[0] </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> c </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> c_dict[c_child]]
            </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> c_parent </span><span class="keyword"><span class="org-block">not</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> parent_list:
                c_dict[c_child].append([c_parent, 1])
            </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block">:
                </span><span class="variable-name"><span class="org-block">c_idx</span></span><span class="org-block"> = parent_list.index(c_parent)
                c_dict[c_child][c_idx][1] += 1

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">render</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""Render full UML diagram

        The string returned by this function should be ready to use with the
        PlantUML program.  It includes all the parsed objects with their
        members, and the inheritance and aggregation relationships extracted
        from the list of objects.

        Returns
        -------
        str
            String containing the full string representation of the `Diagram`
            object, including objects and object relationships
        """</span></span><span class="org-block">
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Preamble
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">diagram_str</span></span><span class="org-block"> = </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._preamble()

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Objects
</span></span><span class="org-block">        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> obj </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._objects:
            </span><span class="variable-name"><span class="org-block">diagram_str</span></span><span class="org-block"> += obj.render() + </span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Inheritance
</span></span><span class="org-block">        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> inherit </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._inheritance_list:
            </span><span class="variable-name"><span class="org-block">diagram_str</span></span><span class="org-block"> += inherit.render() + </span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Aggregation
</span></span><span class="org-block">        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> comp </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._aggregation_list:
            </span><span class="variable-name"><span class="org-block">diagram_str</span></span><span class="org-block"> += comp.render() + </span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Postamble
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">diagram_str</span></span><span class="org-block"> += </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._postamble()

        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> diagram_str

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_preamble</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""PlantUML preamble text

        Returns
        -------
        str
            The PlantUML preamble text: ``@startuml``
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="string"><span class="org-block">'@startuml\n'</span></span><span class="org-block">

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_postamble</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="string"><span class="org-block">"""PlantUML postamble text

        Returns
        -------
        str
            The PlantUML postamble text: ``@enduml``
        """</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> </span><span class="string"><span class="org-block">'\n@enduml\n'</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Helper functions</span>

This section briefly describes the helper functions defined in the module.

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Sanitize type string</span>

The <span class="org-code">~_cleanup_type~</span> function tries to unify the string representation of
variable types by eliminating spaces around <span class="org-verbatim">=*=</span> characters.

<span class="org-meta-line">#+NAME: py-helper-cleanup-str</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Cleanup object type string</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_cleanup_type</span></span><span class="org-block">(type_str):
    </span><span class="string"><span class="org-block">"""Cleanup string representing a C++ type

    Cleanup simply consists in removing spaces before a ``*`` character and
    preventing multiple successive spaces in the string.

    Parameters
    ----------
    type_str : str
        A string representing a C++ type definition

    Returns
    -------
    str
        The type string after cleanup
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> re.sub(r</span><span class="string"><span class="org-block">'[ ]+([*&amp;])'</span></span><span class="org-block">, r</span><span class="string"><span class="org-block">'\1'</span></span><span class="org-block">,
                  re.sub(r</span><span class="string"><span class="org-block">'(\s)+'</span></span><span class="org-block">, r</span><span class="string"><span class="org-block">'\1'</span></span><span class="org-block">, type_str))
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Expand file list</span>

The <span class="org-link"><a href="nil:nil">main interface function</a></span> accepts wildcards in filenames; they are resolved
using the <span class="org-verbatim">=glob=</span> package.  The <span class="org-code">~expand_file_list~</span> function takes as input a list
of filenames and expands wildcards using the <span class="org-code">~glob~</span> command returning a list of
existing filenames without wildcards.

<span class="org-meta-line">#+NAME: py-build-file-list</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Expand wildcards in file list</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">expand_file_list</span></span><span class="org-block">(input_files):
    </span><span class="string"><span class="org-block">"""Find all files in list (expanding wildcards)

    This function uses `glob` to find files matching each string in the input
    list.

    Parameters
    ----------
    input_files : list(str)
        List of strings representing file names and possibly including
        wildcards

    Returns
    -------
    list(str)
        List of filenames (with wildcards expanded).  Each element contains the
        name of an existing file
    """</span></span><span class="org-block">
    </span><span class="variable-name"><span class="org-block">file_list</span></span><span class="org-block"> = []
    </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> input_file </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> input_files:
        </span><span class="variable-name"><span class="org-block">file_list</span></span><span class="org-block"> += glob.glob(input_file)
    </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> file_list
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Main function: create PlantUML from C++</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-module-create-uml</span>
<span class="org-special-keyword">:END:</span>

The <span class="org-code">~CreatePlantUMLFile~</span> function is the main entry point for the module.  It
takes as input a list of header files (possibly with wildcards) and an output
filename and converts the input header files into a text file ready for use with
the PlantUML program.

The function creates a <span class="org-code">~Diagram~</span> object, initializes it with the expanded list
of input files and writes the content of the <span class="org-code">~Diagram.render()~</span> method to the
output file.

<span class="org-meta-line">#+NAME: py-create-plantuml</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Main function</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">CreatePlantUMLFile</span></span><span class="org-block">(file_list, output_file=</span><span class="constant"><span class="org-block">None</span></span><span class="org-block">):
    </span><span class="string"><span class="org-block">""" Create PlantUML file from list of header files

    This function parses a list of C++ header files and generates a file for
    use with PlantUML.

    Parameters
    ----------
    file_list : list(str)
        List of filenames (possibly, with wildcards resolved with the
        :func:`expand_file_list` function)
    output_file : str
        Name of the output file
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">isinstance</span></span><span class="org-block">(file_list, </span><span class="builtin"><span class="org-block">str</span></span><span class="org-block">):
        </span><span class="variable-name"><span class="org-block">file_list_c</span></span><span class="org-block"> = [file_list, ]
    </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block">:
        </span><span class="variable-name"><span class="org-block">file_list_c</span></span><span class="org-block"> = file_list
    </span><span class="variable-name"><span class="org-block">diag</span></span><span class="org-block"> = Diagram()
    diag.create_from_file_list(</span><span class="builtin"><span class="org-block">list</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">set</span></span><span class="org-block">(expand_file_list(file_list_c))))
    </span><span class="variable-name"><span class="org-block">diag_render</span></span><span class="org-block"> = diag.render()

    </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> output_file </span><span class="keyword"><span class="org-block">is</span></span><span class="org-block"> </span><span class="constant"><span class="org-block">None</span></span><span class="org-block">:
        </span><span class="keyword"><span class="org-block">print</span></span><span class="org-block">(diag_render)
    </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block">:
        </span><span class="keyword"><span class="org-block">with</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">open</span></span><span class="org-block">(output_file, </span><span class="string"><span class="org-block">'wt'</span></span><span class="org-block">) </span><span class="keyword"><span class="org-block">as</span></span><span class="org-block"> fid:
            fid.write(diag_render)
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Command line interface</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-module-cmd</span>
<span class="org-special-keyword">:END:</span>

The <span class="org-link"><a href="nil:nil">~main~</a></span> function provides a minimal command line interface using <span class="org-verbatim">=argparse=</span>
to parse input arguments.  The function passes the command line arguments to the
<span class="org-link"><a href="nil:nil">~CreatePlantUMLFile~</a></span> function.

<span class="org-meta-line">#+NAME: py-cmd-main</span>
<span class="org-block-begin-line">#+BEGIN_SRC python -r
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Command line interface</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">main</span></span><span class="org-block">():(ref:module-main)
    </span><span class="string"><span class="org-block">"""Command line interface

    This function is a command-line interface to the
    :func:`hpp2plantuml.CreatePlantUMLFile` function.

    Arguments are read from the command-line, run with ``--help`` for help.
    """</span></span><span class="org-block">
    </span><span class="variable-name"><span class="org-block">parser</span></span><span class="org-block"> = argparse.ArgumentParser(description=</span><span class="string"><span class="org-block">'hpp2plantuml tool.'</span></span><span class="org-block">)
    parser.add_argument(</span><span class="string"><span class="org-block">'-o'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'--output-file'</span></span><span class="org-block">, dest=</span><span class="string"><span class="org-block">'output_file'</span></span><span class="org-block">,
                        required=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">, default=</span><span class="constant"><span class="org-block">None</span></span><span class="org-block">, metavar=</span><span class="string"><span class="org-block">'FILE'</span></span><span class="org-block">,
                        </span><span class="builtin"><span class="org-block">help</span></span><span class="org-block">=</span><span class="string"><span class="org-block">'Output file'</span></span><span class="org-block">)
    parser.add_argument(</span><span class="string"><span class="org-block">'-i'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'--input-file'</span></span><span class="org-block">, dest=</span><span class="string"><span class="org-block">'input_files'</span></span><span class="org-block">,
                        action=</span><span class="string"><span class="org-block">'append'</span></span><span class="org-block">, metavar=</span><span class="string"><span class="org-block">'HEADER-FILE'</span></span><span class="org-block">, required=</span><span class="constant"><span class="org-block">True</span></span><span class="org-block">,
                        </span><span class="builtin"><span class="org-block">help</span></span><span class="org-block">=</span><span class="string"><span class="org-block">'Input file (must be quoted'</span></span><span class="org-block"> +
                        </span><span class="string"><span class="org-block">' when using wildcards)'</span></span><span class="org-block">)
    </span><span class="variable-name"><span class="org-block">args</span></span><span class="org-block"> = parser.parse_args()
    </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">len</span></span><span class="org-block">(args.input_files) &gt; 0:
        CreatePlantUMLFile(args.input_files, args.output_file)

</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Standalone mode</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">__name__</span></span><span class="org-block"> == </span><span class="string"><span class="org-block">'__main__'</span></span><span class="org-block">:
    main()
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-1">* </span><span class="org-done">DONE</span><span class="org-level-1"> Usage</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-module-usage</span>
<span class="org-special-keyword">:END:</span>

The <span class="org-code">~hpp2plantuml~</span> package can be used from the command line or as a module in
other applications.

<span class="org-level-2">** Command line</span>

The command line usage is (<span class="org-code">~hpp2plantuml --help~</span>):


<span class="org-block-begin-line">#+BEGIN_EXAMPLE
</span><span class="ATTRLIST">usage: hpp2plantuml [-h] [-o FILE] -i HEADER-FILE

hpp2plantuml tool.

optional arguments:
  -h, --help            show this help message and exit
  -o FILE, --output-file FILE
                        Output file
  -i HEADER-FILE, --input-file HEADER-FILE
                        Input file (must be quoted when using wildcards)
</span><span class="org-block-end-line">#+END_EXAMPLE
</span>

Input files are added using the <span class="org-code">~-i~</span> option.  Inputs can be file paths or
include wildcards.  Note that the double quotes are required when using
wildcards.  The output file is selected with the <span class="org-code">~-o~</span> option.  The output is a
text file following the PlantUML syntax.

For instance, the following command will generate the input file for PlantUML
from several header files and store the output to the <span class="org-verbatim">=output.puml=</span> file.

<span class="org-meta-line">#+NAME: usage-sh</span>
<span class="org-block-begin-line">#+BEGIN_SRC sh
</span><span class="org-block">hpp2plantuml -i File_1.hpp -i </span><span class="string"><span class="org-block">"include/Helper_*.hpp"</span></span><span class="org-block"> -o output.puml
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** Module</span>

To use as a module, simply <span class="org-code">~import hpp2plantuml~</span>.  The <span class="org-code">~CreatePlantUMLFile~</span> can
then be used to create a PlantUML file from a set of input files.
Alternatively, the <span class="org-code">~Diagram~</span> object can be used directly to build internal
objects (from files or strings).  The <span class="org-code">~Diagram.render()~</span> method can be used to
produce a string output instead of writing to a text file.


<span class="org-level-1">* </span><span class="org-done">DONE</span><span class="org-level-1"> Tests</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:header-args:python+:</span> <span class="org-property-value">:tangle tests/test_hpp2plantuml.py</span>
<span class="org-special-keyword">:END:</span>

Testing is performed using the <span class="org-link"><a href="http://nose.readthedocs.io/en/latest/">nose</a></span> framework.  The tests are defined in the
<span class="org-verbatim">=test_hpp2plantuml.py=</span> file located in the test folder.  They can be run with
the <span class="org-verbatim">=python setup.py test=</span> command.

Two types of tests are considered: small scale tests for individual components,
which are defined in org-tables (C++ source/reference output pairs) and tests on
a large input header file.

For the tests stored in org-tables, the pipe character "|" being a special
character in org-mode, it is replaced by "@" in the tables and fixed in python.

Following is the test setup code.

<span class="org-meta-line">#+NAME: test-setup</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="string"><span class="org-block">"""Test module for hpp2plantuml"""</span></span><span class="org-block">

</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Imports</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> os
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> io
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> sys
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> re
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> nose.tools </span><span class="keyword"><span class="org-block">as</span></span><span class="org-block"> nt
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> CppHeaderParser
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> hpp2plantuml

</span><span class="variable-name"><span class="org-block">test_fold</span></span><span class="org-block"> = os.path.abspath(os.path.dirname(__file__))

</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Helper functions</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">get_parsed_element</span></span><span class="org-block">(input_str):
    </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> CppHeaderParser.CppHeader(input_str, argType=</span><span class="string"><span class="org-block">'string'</span></span><span class="org-block">)


</span><span class="type"><span class="org-block">@nt.nottest</span></span><span class="org-block">
</span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">fix_test_list_def</span></span><span class="org-block">(test_list):
    </span><span class="variable-name"><span class="org-block">test_list_out</span></span><span class="org-block"> = []
    </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> test_entry </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> test_list:
        </span><span class="variable-name"><span class="org-block">test_entry_out</span></span><span class="org-block"> = []
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> test_str </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> test_entry:
            test_entry_out.append(re.sub(u</span><span class="string"><span class="org-block">'@'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'|'</span></span><span class="org-block">, test_str))
        test_list_out.append(test_entry_out)
    </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> test_list_out
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Module tests</span>

The module tests are not strictly speaking unit tests, as they rely on parsing
of a header file, but they aim at evaluating simple functionality of the
different modules implemented.

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Container</span>

The test for the <span class="org-code">~Container~</span> class tests elementary functionality: members and
sorting keys.

<span class="org-meta-line">#+NAME: test-unit-container</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Test containers</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">TestContainer</span></span><span class="org-block">:
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">test_init</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="variable-name"><span class="org-block">c_type</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"container_type"</span></span><span class="org-block">
        </span><span class="variable-name"><span class="org-block">c_name</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"container_name"</span></span><span class="org-block">
        </span><span class="variable-name"><span class="org-block">c_obj</span></span><span class="org-block"> = hpp2plantuml.hpp2plantuml.Container(c_type, c_name)
        nt.assert_equal(c_obj.get_name(), c_name)
        nt.assert_equal(c_obj.render(), </span><span class="string"><span class="org-block">'container_type container_name {\n}\n'</span></span><span class="org-block">)

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">test_comparison_keys</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="variable-name"><span class="org-block">c_list</span></span><span class="org-block"> = [
            [</span><span class="string"><span class="org-block">'class'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'ABD'</span></span><span class="org-block">],
            [</span><span class="string"><span class="org-block">'enum'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'ABDa'</span></span><span class="org-block">],
            [</span><span class="string"><span class="org-block">'class'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'abcd'</span></span><span class="org-block">],
        ]
        </span><span class="variable-name"><span class="org-block">ref_sort_idx</span></span><span class="org-block"> = [0, 2, 1]
        </span><span class="variable-name"><span class="org-block">c_obj_list</span></span><span class="org-block"> = []
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> c_type, c_name </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> c_list:
            c_obj_list.append(hpp2plantuml.hpp2plantuml.Container(
                c_type, c_name))
        c_obj_list.sort(key=</span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> obj: obj.comparison_keys())

        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> i </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">range</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">len</span></span><span class="org-block">(c_list)):
            nt.assert_equal(c_obj_list[i].get_name(),
                            c_list[ref_sort_idx[i]][1])
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Class</span>

Testing for classes is performed by parsing minimal C++ code segments and
comparing the rendered text to a reference.  The input/output pairs are stored
in an org-table and tangled to test files.  Adding tests should be as simple as
adding rows to the table, with the constraint that each test should be contained
in a single row of the table.


<span class="org-level-4">**** </span><span class="org-done">DONE</span><span class="org-level-4"> Class variable</span>

Class variables have simple functionality (name, type and scope).  The following
table (Table<span class="org-macro">{{{tt}}}</span><span class="org-link"><a href="nil:nil">tbl-unittest-class_var</a></span>) defines tests that validate
the representation of variables.

<span class="org-meta-line">#+NAME: tbl-unittest-class_var</span>
<span class="org-meta-line">#+CAPTION:</span> <span class="org-block">List of test segments and corresponding PlantUML strings.</span>
<span class="org-table">| "class Test {\npublic:\nint member; };"     | "+member : int"  |</span>
<span class="org-table">| "class Test {\nprivate:\nint * member; };"  | "-member : int*" |</span>
<span class="org-table">| "class Test {\nprotected:\nint &amp;member; };" | "#member : int&amp;" |</span>


<span class="org-meta-line">#+NAME: test-unit-class_var</span>
<span class="org-block-begin-line">#+BEGIN_SRC python :var test_list_classvar=tbl-unittest-class_var
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Test class variables</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">TestClassVariable</span></span><span class="org-block">:
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">test_list_entries</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> test_idx, (input_str, output_ref_str) </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> \
            </span><span class="builtin"><span class="org-block">enumerate</span></span><span class="org-block">(fix_test_list_def(test_list_classvar)):
            </span><span class="variable-name"><span class="org-block">p</span></span><span class="org-block"> = get_parsed_element(input_str)
            </span><span class="variable-name"><span class="org-block">class_name</span></span><span class="org-block"> = re.sub(r</span><span class="string"><span class="org-block">'.*class\s*(\w+).*'</span></span><span class="org-block">, r</span><span class="string"><span class="org-block">'\1'</span></span><span class="org-block">,
                                input_str.replace(</span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">' '</span></span><span class="org-block">))
            </span><span class="variable-name"><span class="org-block">class_input</span></span><span class="org-block"> = [class_name, p.classes[class_name]]
            </span><span class="variable-name"><span class="org-block">obj_c</span></span><span class="org-block"> = hpp2plantuml.hpp2plantuml.Class(class_input)
            </span><span class="variable-name"><span class="org-block">obj_m</span></span><span class="org-block"> = obj_c._member_list[0]
            nt.assert_equal(output_ref_str, obj_m.render(),
                            </span><span class="string"><span class="org-block">'Test {0} failed [input: {1}]'</span></span><span class="org-block">.</span><span class="builtin"><span class="org-block">format</span></span><span class="org-block">(test_idx,
                                                                  input_str))
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-4">**** </span><span class="org-done">DONE</span><span class="org-level-4"> Class method</span>

The tests for class methods are listed in
Table<span class="org-macro">{{{tt}}}</span><span class="org-link"><a href="nil:nil">tbl-unittest-class_method</a></span>.  Note that template methods are not
supported by PlantUML.

<span class="org-meta-line">#+NAME: tbl-unittest-class_method</span>
<span class="org-meta-line">#+CAPTION:</span> <span class="org-block">List of test segments and corresponding PlantUML strings.</span>
<span class="org-table">| "class Test {\npublic:\nint &amp; func(int * a); };"                         | "+func(int* a) : int&amp;"         |</span>
<span class="org-table">| "class Test {\npublic:\nstatic int func(int &amp; a); };"                    | "+{static} func(int&amp; a) : int" |</span>
<span class="org-table">| "class Test {\nprivate:\nvirtual int * func() = 0; };"                   | "-{abstract} func() : int*"    |</span>
<span class="org-table">| "class Test {\npublic:\n~Test(); };"                                     | "+~Test()"                     |</span>
<span class="org-table">| "class Test {\nprotected:\ntemplate &lt;typename T&gt;int &amp;func(string &amp;); };" | "#func(string &amp;) : int&amp;"       |</span>


<span class="org-meta-line">#+NAME: test-unit-class_method</span>
<span class="org-block-begin-line">#+BEGIN_SRC python :var test_list_classmethod=tbl-unittest-class_method
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Test class methods</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">TestClassMethod</span></span><span class="org-block">:
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">test_list_entries</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> test_idx, (input_str, output_ref_str) </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> \
            </span><span class="builtin"><span class="org-block">enumerate</span></span><span class="org-block">(fix_test_list_def(test_list_classmethod)):
            </span><span class="variable-name"><span class="org-block">p</span></span><span class="org-block"> = get_parsed_element(input_str)
            </span><span class="variable-name"><span class="org-block">class_name</span></span><span class="org-block"> = re.sub(r</span><span class="string"><span class="org-block">'.*class\s*(\w+).*'</span></span><span class="org-block">, r</span><span class="string"><span class="org-block">'\1'</span></span><span class="org-block">,
                                input_str.replace(</span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">' '</span></span><span class="org-block">))
            </span><span class="variable-name"><span class="org-block">class_input</span></span><span class="org-block"> = [class_name, p.classes[class_name]]
            </span><span class="variable-name"><span class="org-block">obj_c</span></span><span class="org-block"> = hpp2plantuml.hpp2plantuml.Class(class_input)
            </span><span class="variable-name"><span class="org-block">obj_m</span></span><span class="org-block"> = obj_c._member_list[0]
            nt.assert_equal(output_ref_str, obj_m.render(),
                            </span><span class="string"><span class="org-block">'Test {0} failed [input: {1}]'</span></span><span class="org-block">.</span><span class="builtin"><span class="org-block">format</span></span><span class="org-block">(test_idx,
                                                                  input_str))
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-4">**** </span><span class="org-done">DONE</span><span class="org-level-4"> Class</span>

The unit test for classes includes rendering tests for the code segments in
Table<span class="org-macro">{{{tt}}}</span><span class="org-link"><a href="nil:nil">tbl-unittest-class</a></span>.  It includes templates and abstract classes.

<span class="org-meta-line">#+NAME: tbl-unittest-class</span>
<span class="org-meta-line">#+CAPTION:</span> <span class="org-block">List of test segments and corresponding PlantUML strings.</span>
<span class="org-table">| "class Test {\nprotected:\nint &amp; member; };"                       | "class Test {\n\t#member : int&amp;\n}\n"                                                 |</span>
<span class="org-table">| "class Test\n{\npublic:\nvirtual int func() = 0; };"               | "abstract class Test {\n\t+{abstract} func() : int\n}\n"                              |</span>
<span class="org-table">| "template &lt;typename T&gt; class Test{\nT* func(T&amp; arg); };"           | "class Test &lt;template &lt;typename T&gt;&gt; {\n\t-func(T&amp; arg) : T*\n}\n"                     |</span>
<span class="org-table">| "template &lt;typename T&gt; class Test{\nvirtual T* func(T&amp; arg)=0; };" | "abstract class Test &lt;template &lt;typename T&gt;&gt; {\n\t-{abstract} func(T&amp; arg) : T*\n}\n" |</span>


<span class="org-meta-line">#+NAME: test-unit-class</span>
<span class="org-block-begin-line">#+BEGIN_SRC python :var test_list_class=tbl-unittest-class
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Test classes</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">TestClass</span></span><span class="org-block">:
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">test_list_entries</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> test_idx, (input_str, output_ref_str) </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> \
            </span><span class="builtin"><span class="org-block">enumerate</span></span><span class="org-block">(fix_test_list_def(test_list_class)):
            </span><span class="variable-name"><span class="org-block">p</span></span><span class="org-block"> = get_parsed_element(input_str)
            </span><span class="variable-name"><span class="org-block">class_name</span></span><span class="org-block"> = re.sub(r</span><span class="string"><span class="org-block">'.*class\s*(\w+).*'</span></span><span class="org-block">, r</span><span class="string"><span class="org-block">'\1'</span></span><span class="org-block">,
                                input_str.replace(</span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">' '</span></span><span class="org-block">))
            </span><span class="variable-name"><span class="org-block">class_input</span></span><span class="org-block"> = [class_name, p.classes[class_name]]
            </span><span class="variable-name"><span class="org-block">obj_c</span></span><span class="org-block"> = hpp2plantuml.hpp2plantuml.Class(class_input)
            nt.assert_equal(output_ref_str, obj_c.render(),
                            </span><span class="string"><span class="org-block">'Test {0} failed [input: {1}]'</span></span><span class="org-block">.</span><span class="builtin"><span class="org-block">format</span></span><span class="org-block">(test_idx,
                                                                  input_str))
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Enum</span>

The unit test for enum objects includes rendering tests for the code segments in
Table<span class="org-macro">{{{tt}}}</span><span class="org-link"><a href="nil:nil">tbl-unittest-enum</a></span>.

<span class="org-meta-line">#+NAME: tbl-unittest-enum</span>
<span class="org-meta-line">#+CAPTION:</span> <span class="org-block">List of test segments and corresponding PlantUML strings.</span>
<span class="org-table">| "enum Test { A, B, CD, E };"        | "enum Test {\n\tA\n\tB\n\tCD\n\tE\n}\n" |</span>
<span class="org-table">| "enum Test\n{\n A = 0, B = 12\n };" | "enum Test {\n\tA\n\tB\n}\n"            |</span>


<span class="org-meta-line">#+NAME: test-unit-enum</span>
<span class="org-block-begin-line">#+BEGIN_SRC python :var test_list_enum=tbl-unittest-enum
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Test enum objects</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">TestEnum</span></span><span class="org-block">:
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">test_list_entries</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> test_idx, (input_str, output_ref_str) </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> \
            </span><span class="builtin"><span class="org-block">enumerate</span></span><span class="org-block">(fix_test_list_def(test_list_enum)):
            </span><span class="variable-name"><span class="org-block">p</span></span><span class="org-block"> = get_parsed_element(input_str)
            </span><span class="variable-name"><span class="org-block">enum_name</span></span><span class="org-block"> = re.sub(r</span><span class="string"><span class="org-block">'.*enum\s*(\w+).*'</span></span><span class="org-block">, r</span><span class="string"><span class="org-block">'\1'</span></span><span class="org-block">,
                               input_str.replace(</span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">' '</span></span><span class="org-block">))
            </span><span class="variable-name"><span class="org-block">enum_input</span></span><span class="org-block"> = p.enums[0]
            </span><span class="variable-name"><span class="org-block">obj_c</span></span><span class="org-block"> = hpp2plantuml.hpp2plantuml.Enum(enum_input)
            nt.assert_equal(output_ref_str, obj_c.render(),
                            </span><span class="string"><span class="org-block">'Test {0} failed [input: {1}]'</span></span><span class="org-block">.</span><span class="builtin"><span class="org-block">format</span></span><span class="org-block">(test_idx,
                                                                  input_str))
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Links</span>

The unit test for link objects includes rendering tests for the code segments in
Table<span class="org-macro">{{{tt}}}</span><span class="org-link"><a href="nil:nil">tbl-unittest-link</a></span>.  It tests inheritance and aggregation
relationships (with and without count).


<span class="org-meta-line">#+NAME: tbl-unittest-link</span>
<span class="org-meta-line">#+CAPTION:</span> <span class="org-block">List of test segments and corresponding PlantUML strings.</span>
<span class="org-table">| "class A{};\nclass B : A{};"           | "A &lt;@-- B"      |</span>
<span class="org-table">| "class A{};\nclass B : public A{};"    | "A &lt;@-- B"      |</span>
<span class="org-table">| "class B{};\nclass A{B obj;};"         | "A o-- B"       |</span>
<span class="org-table">| "class B{};\nclass A{B obj; B* ptr;};" | "A \"2\" o-- B" |</span>


<span class="org-meta-line">#+NAME: test-unit-link</span>
<span class="org-block-begin-line">#+BEGIN_SRC python :var test_list_link=tbl-unittest-link
</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">TestLink</span></span><span class="org-block">:
    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">test_list_entries</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> test_idx, (input_str, output_ref_str) </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> \
            </span><span class="builtin"><span class="org-block">enumerate</span></span><span class="org-block">(fix_test_list_def(test_list_link)):
            </span><span class="variable-name"><span class="org-block">obj_d</span></span><span class="org-block"> = hpp2plantuml.Diagram()
            </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Not very unittest-y
</span></span><span class="org-block">            obj_d.create_from_string(input_str)
            </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">len</span></span><span class="org-block">(obj_d._inheritance_list) &gt; 0:
                </span><span class="variable-name"><span class="org-block">obj_l</span></span><span class="org-block"> = obj_d._inheritance_list[0]
            </span><span class="keyword"><span class="org-block">elif</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">len</span></span><span class="org-block">(obj_d._aggregation_list) &gt; 0:
                </span><span class="variable-name"><span class="org-block">obj_l</span></span><span class="org-block"> = obj_d._aggregation_list[0]
            nt.assert_equal(output_ref_str, obj_l.render(),
                            </span><span class="string"><span class="org-block">'Test {0} failed [input: {1}]'</span></span><span class="org-block">.</span><span class="builtin"><span class="org-block">format</span></span><span class="org-block">(test_idx,
                                                                  input_str))
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Full system test</span>

The system test uses example header files and validates the PlantUML string
rendering compared to a saved reference.

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Input files</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-test-system-hpp</span>
<span class="org-special-keyword">:END:</span>

The header is split into two files, in order to test the ability to load
multiple inputs.  It contains a mix of abstract, template classes with members
of different scope and with different properties (static, abstract methods,
etc.).

The following can be extended to improve testing, as long as the corresponding
<span class="org-link"><a href="nil:nil">reference output</a></span> is kept up-to-date.

<span class="org-meta-line">#+NAME: hpp-simple-classes-1-2</span>
<span class="org-block-begin-line">#+BEGIN_SRC c++ :mkdirp yes :tangle tests/simple_classes_1_2.hpp
</span><span class="keyword"><span class="org-block">enum</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Enum01</span></span><span class="org-block"> { </span><span class="variable-name"><span class="org-block">VALUE_0</span></span><span class="org-block">, </span><span class="variable-name"><span class="org-block">VALUE_1</span></span><span class="org-block">, </span><span class="variable-name"><span class="org-block">VALUE_2</span></span><span class="org-block"> };

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Class01</span></span><span class="org-block"> {
</span><span class="keyword"><span class="org-block">protected</span></span><span class="org-block">:
    </span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">_protected_var</span></span><span class="org-block">;
    </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_ProtectedMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">);
    </span><span class="keyword"><span class="org-block">static</span></span><span class="org-block"> </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_StaticProtectedMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">);
    </span><span class="keyword"><span class="org-block">virtual</span></span><span class="org-block"> </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_AbstractMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">) = 0;
</span><span class="keyword"><span class="org-block">public</span></span><span class="org-block">:
    </span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">public_var</span></span><span class="org-block">;
    </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">PublicMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">);
    </span><span class="keyword"><span class="org-block">static</span></span><span class="org-block"> </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">StaticPublicMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">);
    </span><span class="keyword"><span class="org-block">virtual</span></span><span class="org-block"> </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">AbstractPublicMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">) = 0;
};

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Class02</span></span><span class="org-block"> : </span><span class="keyword"><span class="org-block">public</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Class01</span></span><span class="org-block"> {
</span><span class="keyword"><span class="org-block">public</span></span><span class="org-block">:
    </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">AbstractPublicMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">) override;
</span><span class="keyword"><span class="org-block">private</span></span><span class="org-block">:
    </span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">_private_var</span></span><span class="org-block">;
    </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_PrivateMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">);
    </span><span class="keyword"><span class="org-block">static</span></span><span class="org-block"> </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_StaticPrivateMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">);
    </span><span class="type"><span class="org-block">bool</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">_AbstractMethod</span></span><span class="org-block">(</span><span class="type"><span class="org-block">int</span></span><span class="org-block"> </span><span class="variable-name"><span class="org-block">param</span></span><span class="org-block">) override;
};
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-meta-line">#+NAME: hpp-simple-classes-3</span>
<span class="org-block-begin-line">#+BEGIN_SRC c++ :mkdirp yes :tangle tests/simple_classes_3.hpp
</span><span class="keyword"><span class="org-block">template</span></span><span class="org-block">&lt;</span><span class="keyword"><span class="org-block">typename</span></span><span class="org-block"> </span><span class="type"><span class="org-block">T</span></span><span class="org-block">&gt;
</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Class03</span></span><span class="org-block"> {
</span><span class="keyword"><span class="org-block">public</span></span><span class="org-block">:
    </span><span class="function-name"><span class="org-block">Class03</span></span><span class="org-block">();
    ~</span><span class="function-name"><span class="org-block">Class03</span></span><span class="org-block">();
</span><span class="keyword"><span class="org-block">private</span></span><span class="org-block">:
    </span><span class="type"><span class="org-block">Class01</span></span><span class="org-block">* </span><span class="variable-name"><span class="org-block">_obj</span></span><span class="org-block">;
    </span><span class="type"><span class="org-block">Class01</span></span><span class="org-block">* </span><span class="variable-name"><span class="org-block">_data</span></span><span class="org-block">;
    </span><span class="type"><span class="org-block">list</span></span><span class="org-block">&lt;Class02&gt; </span><span class="variable-name"><span class="org-block">_obj_list</span></span><span class="org-block">;
    </span><span class="type"><span class="org-block">T</span></span><span class="org-block">* </span><span class="variable-name"><span class="org-block">_typed_obj</span></span><span class="org-block">;
};
</span><span class="org-block-end-line">#+END_SRC
</span>


<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Reference output</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-test-system-ref</span>
<span class="org-special-keyword">:END:</span>

Following is the reference output for the input header files defined <span class="org-link"><a href="nil:nil">earlier</a></span>.
The comparison takes into account the white space, indentation, etc.


<span class="org-meta-line">#+NAME: puml-simple-classes</span>
<span class="org-block-begin-line">#+BEGIN_SRC plantuml :mkdirp yes :tangle tests/simple_classes.puml
</span><span class="keyword"><span class="org-block">@startuml</span></span><span class="org-block">
</span><span class="type"><span class="org-block">abstract</span></span><span class="org-block"> class Class01 {
    +{abstract} AbstractPublicMethod(int param) : bool
    +PublicMethod(int param) : bool
    +{static} StaticPublicMethod(bool param) : bool
    #{abstract} _AbstractMethod(int param) : bool
    #_ProtectedMethod(int param) : bool
    #{static} _StaticProtectedMethod(bool param) : bool
    #_protected_var : int
    +public_var : int
}

</span><span class="type"><span class="org-block">class</span></span><span class="org-block"> Class02 {
    +AbstractPublicMethod(int param) : bool
    -_AbstractMethod(int param) : bool
    -_PrivateMethod(int param) : bool
    -{static} _StaticPrivateMethod(bool param) : bool
    -_private_var : int
}

</span><span class="type"><span class="org-block">class</span></span><span class="org-block"> Class03 &lt;template&lt;typename T&gt;&gt; {
    +Class03()
    +~Class03()
    -_data : Class01*
    -_obj : Class01*
    -_typed_obj : T*
    -_obj_list : list&lt;Class02&gt;
}

</span><span class="type"><span class="org-block">enum</span></span><span class="org-block"> Enum01 {
    VALUE_0
    VALUE_1
    VALUE_2
}

Class01 </span><span class="keyword"><span class="org-block">&lt;|--</span></span><span class="org-block"> Class02
Class03 </span><span class="string"><span class="org-block">"2"</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">o--</span></span><span class="org-block"> Class01
Class03 </span><span class="keyword"><span class="org-block">o--</span></span><span class="org-block"> Class02

</span><span class="keyword"><span class="org-block">@enduml</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Test diagram generation</span>

The system test validates the following:
- input from multiple files, with and without wildcards,
- interfaces to the <span class="org-code">~Diagram~</span> class listed in
  Table<span class="org-macro">{{{tt}}}</span><span class="org-link"><a href="nil:nil">tbl-diagram-interface</a></span>,
- object reset,
- the <span class="org-code">~CreatePlantUMLFile~</span> interface, including stdout and file output.


<span class="org-meta-line">#+NAME: test-full-diagram</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Test overall system</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">TestFullDiagram</span></span><span class="org-block">():

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">__init__</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._input_files = [</span><span class="string"><span class="org-block">'simple_classes_1_2.hpp'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'simple_classes_3.hpp'</span></span><span class="org-block">]
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._input_files_w = [</span><span class="string"><span class="org-block">'simple_classes_*.hpp'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'simple_classes_3.hpp'</span></span><span class="org-block">]
        </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._diag_saved_ref = </span><span class="string"><span class="org-block">''</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">with</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">open</span></span><span class="org-block">(os.path.join(test_fold, </span><span class="string"><span class="org-block">'simple_classes.puml'</span></span><span class="org-block">), </span><span class="string"><span class="org-block">'rt'</span></span><span class="org-block">) </span><span class="keyword"><span class="org-block">as</span></span><span class="org-block"> fid:
            </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._diag_saved_ref = fid.read()

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">test_full_files</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Create first version
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">file_list_ref</span></span><span class="org-block"> = </span><span class="builtin"><span class="org-block">list</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">set</span></span><span class="org-block">(hpp2plantuml.hpp2plantuml.expand_file_list(
            [os.path.join(test_fold, f) </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> f </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._input_files])))
        </span><span class="variable-name"><span class="org-block">diag_ref</span></span><span class="org-block"> = hpp2plantuml.Diagram()
        diag_ref.create_from_file_list(file_list_ref)
        </span><span class="variable-name"><span class="org-block">diag_render_ref</span></span><span class="org-block"> = diag_ref.render()

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Compare to saved reference
</span></span><span class="org-block">        nt.assert_equal(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._diag_saved_ref, diag_render_ref)

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block"># Validate equivalent inputs
</span></span><span class="org-block">
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">File expansion
</span></span><span class="org-block">        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> file_list </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> [</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._input_files, </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._input_files_w]:
            </span><span class="variable-name"><span class="org-block">file_list_c</span></span><span class="org-block"> = </span><span class="builtin"><span class="org-block">list</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">set</span></span><span class="org-block">(hpp2plantuml.hpp2plantuml.expand_file_list(
                [os.path.join(test_fold, f) </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> f </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> file_list])))

            </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Create from file list
</span></span><span class="org-block">            </span><span class="variable-name"><span class="org-block">diag_c</span></span><span class="org-block"> = hpp2plantuml.Diagram()
            diag_c.create_from_file_list(file_list_c)
            nt.assert_equal(diag_render_ref, diag_c.render())

            </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Add from file list
</span></span><span class="org-block">            </span><span class="variable-name"><span class="org-block">diag_c_add</span></span><span class="org-block"> = hpp2plantuml.Diagram()
            diag_c_add.add_from_file_list(file_list_c)
            diag_c_add.build_relationship_lists()
            diag_c_add.sort_elements()
            nt.assert_equal(diag_render_ref, diag_c_add.render())

            </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Create from first file, add from rest of the list
</span></span><span class="org-block">            </span><span class="variable-name"><span class="org-block">diag_c_file</span></span><span class="org-block"> = hpp2plantuml.Diagram()
            diag_c_file.create_from_file(file_list_c[0])
            </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> file_c </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> file_list_c[1:]:
                diag_c_file.add_from_file(file_c)
            diag_c_file.build_relationship_lists()
            diag_c_file.sort_elements()
            nt.assert_equal(diag_render_ref, diag_c_file.render())

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">String inputs
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">input_str_list</span></span><span class="org-block"> = []
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> file_c </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> file_list_ref:
            </span><span class="keyword"><span class="org-block">with</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">open</span></span><span class="org-block">(file_c, </span><span class="string"><span class="org-block">'rt'</span></span><span class="org-block">) </span><span class="keyword"><span class="org-block">as</span></span><span class="org-block"> fid:
                input_str_list.append(fid.read())

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Create from string list
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">diag_str_list</span></span><span class="org-block"> = hpp2plantuml.Diagram()
        diag_str_list.create_from_string_list(input_str_list)
        nt.assert_equal(diag_render_ref, diag_str_list.render())

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Add from string list
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">diag_str_list_add</span></span><span class="org-block"> = hpp2plantuml.Diagram()
        diag_str_list_add.add_from_string_list(input_str_list)
        diag_str_list_add.build_relationship_lists()
        diag_str_list_add.sort_elements()
        nt.assert_equal(diag_render_ref, diag_str_list_add.render())

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Create from string
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">diag_str</span></span><span class="org-block"> = hpp2plantuml.Diagram()
        diag_str.create_from_string(</span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">.join(input_str_list))
        nt.assert_equal(diag_render_ref, diag_str.render())
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Reset and parse
</span></span><span class="org-block">        diag_str.clear()
        diag_str.create_from_string(</span><span class="string"><span class="org-block">'\n'</span></span><span class="org-block">.join(input_str_list))
        nt.assert_equal(diag_render_ref, diag_str.render())

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Manually build object
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">diag_manual_add</span></span><span class="org-block"> = hpp2plantuml.Diagram()
        </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> idx, (file_c, string_c) </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">enumerate</span></span><span class="org-block">(</span><span class="builtin"><span class="org-block">zip</span></span><span class="org-block">(file_list_ref,
                                                     input_str_list)):
            </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> idx == 0:
                diag_manual_add.add_from_file(file_c)
            </span><span class="keyword"><span class="org-block">else</span></span><span class="org-block">:
                diag_manual_add.add_from_string(string_c)
        diag_manual_add.build_relationship_lists()
        diag_manual_add.sort_elements()
        nt.assert_equal(diag_render_ref, diag_manual_add.render())

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">test_main_function</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">List files
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">file_list</span></span><span class="org-block"> = [os.path.join(test_fold, f) </span><span class="keyword"><span class="org-block">for</span></span><span class="org-block"> f </span><span class="keyword"><span class="org-block">in</span></span><span class="org-block"> </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._input_files]

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Output to string
</span></span><span class="org-block">        </span><span class="keyword"><span class="org-block">with</span></span><span class="org-block"> io.StringIO() </span><span class="keyword"><span class="org-block">as</span></span><span class="org-block"> io_stream:
            </span><span class="variable-name"><span class="org-block">sys.stdout</span></span><span class="org-block"> = io_stream
            hpp2plantuml.CreatePlantUMLFile(file_list)
            io_stream.seek(0)
            </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Read string output, exclude final line return
</span></span><span class="org-block">            </span><span class="variable-name"><span class="org-block">output_str</span></span><span class="org-block"> = io_stream.read()[:-1]
        </span><span class="variable-name"><span class="org-block">sys.stdout</span></span><span class="org-block"> = sys.__stdout__
        nt.assert_equal(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._diag_saved_ref, output_str)

        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Output to file
</span></span><span class="org-block">        </span><span class="variable-name"><span class="org-block">output_fname</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'output.puml'</span></span><span class="org-block">
        hpp2plantuml.CreatePlantUMLFile(file_list, output_fname)
        </span><span class="variable-name"><span class="org-block">output_fcontent</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">''</span></span><span class="org-block">
        </span><span class="keyword"><span class="org-block">with</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">open</span></span><span class="org-block">(output_fname, </span><span class="string"><span class="org-block">'rt'</span></span><span class="org-block">) </span><span class="keyword"><span class="org-block">as</span></span><span class="org-block"> fid:
            </span><span class="variable-name"><span class="org-block">output_fcontent</span></span><span class="org-block"> = fid.read()
        nt.assert_equal(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">._diag_saved_ref, output_fcontent)
        os.unlink(output_fname)
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-1">* </span><span class="org-done">DONE</span><span class="org-level-1"> Packaging</span>

In order to distribute and publish the hpp2plantuml module to <span class="org-link"><a href="https://pypi.python.org/pypi">PyPI</a></span>, the
<span class="org-verbatim">=setuptools=</span> package was used.

The following guides summarize the packaging process and provide useful
examples:
- <span class="org-link"><a href="https://hynek.me/articles/sharing-your-labor-of-love-pypi-quick-and-dirty/">https://hynek.me/articles/sharing-your-labor-of-love-pypi-quick-and-dirty/</a></span>
- <span class="org-link"><a href="https://python-packaging.readthedocs.io/en/latest/">https://python-packaging.readthedocs.io/en/latest/</a></span>
- <span class="org-link"><a href="https://packaging.python.org/distributing/">https://packaging.python.org/distributing/</a></span>


<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> </span><span class="org-verbatim"><span class="org-level-2">=__init__.py=</span></span>

The module's init file simply defines meta variables required by <span class="org-verbatim">=setuptools=</span>.
It also imports the main interface: the <span class="org-code">~CreatePlantUMLFile~</span> function and the
<span class="org-code">~Diagram~</span> class for use as a module.

The header is filled with the content of org-mode blocks.  The version number is
obtained using the source block described <span class="org-link"><a href="nil:nil">here</a></span>.

<span class="org-meta-line">#+NAME: py-init</span>
<span class="org-block-begin-line">#+BEGIN_SRC python :noweb yes :tangle src/hpp2plantuml/__init__.py
</span><span class="string"><span class="org-block">""" hpp2plantuml module

&lt;&lt;el-org-exp("</span></span><span class="org-block">sec-module</span><span class="string"><span class="org-block">", "</span></span><span class="org-block">rst</span><span class="string"><span class="org-block">")&gt;&gt;

Usage:

&lt;&lt;el-org-exp("</span></span><span class="org-block">sec-module-usage</span><span class="string"><span class="org-block">", "</span></span><span class="org-block">rst</span><span class="string"><span class="org-block">", "</span></span><span class="org-block">keep</span><span class="string"><span class="org-block">")&gt;&gt;
"""</span></span><span class="org-block">

</span><span class="variable-name"><span class="org-block">__title__</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"hpp2plantuml"</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">__description__</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"Convert C++ header files to PlantUML"</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">__version__</span></span><span class="org-block"> = &lt;&lt;get-version()&gt;&gt;
</span><span class="variable-name"><span class="org-block">__uri__</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"<a href="https://github.com/thibaultmarin/hpp2plantuml">https://github.com/thibaultmarin/hpp2plantuml</a>"</span></span><span class="org-block">
</span><span class="builtin"><span class="org-block">__doc__</span></span><span class="org-block"> = __description__ + </span><span class="string"><span class="org-block">" &lt;"</span></span><span class="org-block"> + __uri__ + </span><span class="string"><span class="org-block">"&gt;"</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">__author__</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"Thibault Marin"</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">__email__</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"thibault.marin@gmx.com"</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">__license__</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"MIT"</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">__copyright__</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"Copyright (c) 2016 Thibault Marin"</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">from</span></span><span class="org-block"> .hpp2plantuml </span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> CreatePlantUMLFile, Diagram

</span><span class="builtin"><span class="org-block">__all__</span></span><span class="org-block"> = [</span><span class="string"><span class="org-block">'CreatePlantUMLFile'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'Diagram'</span></span><span class="org-block">]
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> </span><span class="org-verbatim"><span class="org-level-2">=setup.cfg=</span></span>

The <span class="org-verbatim">=setup.cfg=</span> file defines some basic properties of the package.  It forces
"universal" wheel builds, sets the license file and defines documentation
commands.

The <span class="org-link"><a href="nil:nil">documentation</a></span> uses <span class="org-link"><a href="http://sphinx-doc.org">Sphinx</a></span> to generate the HTML documentation.  The
<span class="org-code">~build_sphinx~</span> configuration defines the location for the input and output
documentation files.  In practice, the documentation is built using a <span class="org-link"><a href="nil:nil">custom
command</a></span> for <span class="org-verbatim">=setup.py=</span> run using <span class="org-code">~python setup.py sphinx~</span>.

<span class="org-meta-line">#+NAME: cfg-setup</span>
<span class="org-block-begin-line">#+BEGIN_SRC conf :tangle setup.cfg
</span><span class="org-block">
[</span><span class="type"><span class="org-block">bdist_wheel</span></span><span class="org-block">]
</span><span class="variable-name"><span class="org-block">universal</span></span><span class="org-block"> = 1

[</span><span class="type"><span class="org-block">metadata</span></span><span class="org-block">]
</span><span class="variable-name"><span class="org-block">license_file</span></span><span class="org-block"> = LICENSE

[</span><span class="type"><span class="org-block">build_sphinx</span></span><span class="org-block">]
</span><span class="variable-name"><span class="org-block">source-dir</span></span><span class="org-block"> = doc/source
</span><span class="variable-name"><span class="org-block">build-dir</span></span><span class="org-block">  = doc/build
</span><span class="variable-name"><span class="org-block">all_files</span></span><span class="org-block">  = 1

[</span><span class="type"><span class="org-block">upload_sphinx</span></span><span class="org-block">]
</span><span class="variable-name"><span class="org-block">upload-dir</span></span><span class="org-block"> = doc/build/html
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> </span><span class="org-verbatim"><span class="org-level-2">=setup.py=</span></span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-package-setup-py</span>
<span class="org-special-keyword">:header-args:python+:</span> <span class="org-property-value">:tangle setup.py :noweb yes</span>
<span class="org-special-keyword">:END:</span>

The <span class="org-verbatim">=setup.py=</span> file is the interface to <span class="org-verbatim">=setuptools=</span>.  It defines the packaging
options.  Most of it is taken from <span class="org-link"><a href="https://hynek.me/articles/sharing-your-labor-of-love-pypi-quick-and-dirty/">this post</a></span>.

<span class="org-meta-line">#+NAME: py-setup-import</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="org-block">
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Imports</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> os
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> sys
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> re
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> codecs

</span><span class="keyword"><span class="org-block">from</span></span><span class="org-block"> setuptools </span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> setup, find_packages, Command
</span><span class="keyword"><span class="org-block">try</span></span><span class="org-block">:
    </span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> sphinx
    </span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> sphinx.apidoc
</span><span class="keyword"><span class="org-block">except</span></span><span class="org-block"> </span><span class="type"><span class="org-block">ImportError</span></span><span class="org-block">:
    </span><span class="keyword"><span class="org-block">pass</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Custom content</span>

The non-boiler part of the <span class="org-verbatim">=setup.py=</span> file defines the package information.

<span class="org-meta-line">#+NAME: py-setup-custom</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Custom fields</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block">###################################################################</span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">NAME</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">"hpp2plantuml"</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">PACKAGES</span></span><span class="org-block"> = find_packages(where=</span><span class="string"><span class="org-block">"src"</span></span><span class="org-block">)
</span><span class="variable-name"><span class="org-block">META_PATH</span></span><span class="org-block"> = os.path.join(</span><span class="string"><span class="org-block">"src"</span></span><span class="org-block">, NAME, </span><span class="string"><span class="org-block">"__init__.py"</span></span><span class="org-block">)
</span><span class="variable-name"><span class="org-block">KEYWORDS</span></span><span class="org-block"> = [</span><span class="string"><span class="org-block">"class"</span></span><span class="org-block">, </span><span class="string"><span class="org-block">"attribute"</span></span><span class="org-block">, </span><span class="string"><span class="org-block">"boilerplate"</span></span><span class="org-block">]
</span><span class="variable-name"><span class="org-block">CLASSIFIERS</span></span><span class="org-block"> = [
    </span><span class="string"><span class="org-block">"Development Status :: 4 - Beta"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Intended Audience :: Developers"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Natural Language :: English"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"License :: OSI Approved :: MIT License"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Operating System :: OS Independent"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Programming Language :: Python"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Programming Language :: Python :: 3"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Programming Language :: Python :: 3.3"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Programming Language :: Python :: 3.4"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Programming Language :: Python :: 3.5"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Programming Language :: Python :: Implementation :: PyPy"</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">"Topic :: Software Development :: Libraries :: Python Modules"</span></span><span class="org-block">,
]
</span><span class="variable-name"><span class="org-block">INSTALL_REQUIRES</span></span><span class="org-block"> = &lt;&lt;py-dependencies(</span><span class="string"><span class="org-block">"requirements"</span></span><span class="org-block">)&gt;&gt;
</span><span class="variable-name"><span class="org-block">INSTALL_REQUIRES</span></span><span class="org-block"> += [</span><span class="string"><span class="org-block">'sphinx'</span></span><span class="org-block">, ]
</span><span class="variable-name"><span class="org-block">SETUP_REQUIRES</span></span><span class="org-block"> = [</span><span class="string"><span class="org-block">'sphinx'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'numpydoc'</span></span><span class="org-block">]
</span><span class="comment-delimiter"><span class="org-block">###################################################################</span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Helper functions</span>

The following helper functions provide tools to extract metadata from the
<span class="org-verbatim">=__init__=</span> file and pass it to the <span class="org-code">~setup~</span> command.

<span class="org-meta-line">#+NAME: py-setup-helper</span>
<span class="org-block-begin-line">#+BEGIN_SRC python
</span><span class="org-block">
</span><span class="variable-name"><span class="org-block">HERE</span></span><span class="org-block"> = os.path.abspath(os.path.dirname(__file__))


</span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">read</span></span><span class="org-block">(*parts):
    </span><span class="string"><span class="org-block">"""
    Build an absolute path from *parts* and and return the contents of the
    resulting file.  Assume UTF-8 encoding.
    """</span></span><span class="org-block">
    </span><span class="keyword"><span class="org-block">with</span></span><span class="org-block"> codecs.</span><span class="builtin"><span class="org-block">open</span></span><span class="org-block">(os.path.join(HERE, *parts), </span><span class="string"><span class="org-block">"rb"</span></span><span class="org-block">, </span><span class="string"><span class="org-block">"utf-8"</span></span><span class="org-block">) </span><span class="keyword"><span class="org-block">as</span></span><span class="org-block"> f:
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> f.read()


</span><span class="variable-name"><span class="org-block">META_FILE</span></span><span class="org-block"> = read(META_PATH)


</span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">find_meta</span></span><span class="org-block">(meta):
    </span><span class="string"><span class="org-block">"""
    Extract __*meta*__ from META_FILE.
    """</span></span><span class="org-block">
    </span><span class="variable-name"><span class="org-block">meta_match</span></span><span class="org-block"> = re.search(
        r</span><span class="string"><span class="org-block">"^__{meta}__ = ['\"]([^'\"]*)['\"]"</span></span><span class="org-block">.</span><span class="builtin"><span class="org-block">format</span></span><span class="org-block">(meta=meta),
        META_FILE, re.M
    )
    </span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> meta_match:
        </span><span class="keyword"><span class="org-block">return</span></span><span class="org-block"> meta_match.group(1)
    </span><span class="keyword"><span class="org-block">raise</span></span><span class="org-block"> </span><span class="type"><span class="org-block">RuntimeError</span></span><span class="org-block">(</span><span class="string"><span class="org-block">"Unable to find __{meta}__ string."</span></span><span class="org-block">.</span><span class="builtin"><span class="org-block">format</span></span><span class="org-block">(meta=meta))

</span><span class="python-cell-cellbreak"><span class="comment-delimiter"><span class="org-block"># </span></span></span><span class="python-cell-cellbreak"><span class="comment"><span class="org-block">%% Sphinx Build</span></span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">

</span><span class="keyword"><span class="org-block">class</span></span><span class="org-block"> </span><span class="type"><span class="org-block">Sphinx</span></span><span class="org-block">(Command):
    </span><span class="variable-name"><span class="org-block">user_options</span></span><span class="org-block"> = []
    </span><span class="variable-name"><span class="org-block">description</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'Build sphinx documentation'</span></span><span class="org-block">

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">initialize_options</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="keyword"><span class="org-block">pass</span></span><span class="org-block">

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">finalize_options</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="keyword"><span class="org-block">pass</span></span><span class="org-block">

    </span><span class="keyword"><span class="org-block">def</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">run</span></span><span class="org-block">(</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">):
        </span><span class="variable-name"><span class="org-block">metadata</span></span><span class="org-block"> = </span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.distribution.metadata
        </span><span class="variable-name"><span class="org-block">src_dir</span></span><span class="org-block"> = (</span><span class="keyword"><span class="org-block">self</span></span><span class="org-block">.distribution.package_dir </span><span class="keyword"><span class="org-block">or</span></span><span class="org-block"> {</span><span class="string"><span class="org-block">''</span></span><span class="org-block">: </span><span class="string"><span class="org-block">''</span></span><span class="org-block">})[</span><span class="string"><span class="org-block">''</span></span><span class="org-block">]
        </span><span class="variable-name"><span class="org-block">src_dir</span></span><span class="org-block"> = os.path.join(os.getcwd(),  src_dir)
        sys.path.append(</span><span class="string"><span class="org-block">'src'</span></span><span class="org-block">)
        </span><span class="keyword"><span class="org-block">print</span></span><span class="org-block">(</span><span class="string"><span class="org-block">'pwd='</span></span><span class="org-block">, os.getcwd(), </span><span class="string"><span class="org-block">' src-dir='</span></span><span class="org-block">, src_dir)
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Run sphinx by calling the main method, '--full' also adds a
</span></span><span class="org-block">        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">conf.py
</span></span><span class="org-block">        sphinx.apidoc.main(
            [</span><span class="string"><span class="org-block">''</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'--private'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'-H'</span></span><span class="org-block">, metadata.name,
             </span><span class="string"><span class="org-block">'-A'</span></span><span class="org-block">, metadata.author,
             </span><span class="string"><span class="org-block">'-V'</span></span><span class="org-block">, metadata.version,
             </span><span class="string"><span class="org-block">'-R'</span></span><span class="org-block">, metadata.version,
             </span><span class="string"><span class="org-block">'-o'</span></span><span class="org-block">, os.path.join(</span><span class="string"><span class="org-block">'doc'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'source'</span></span><span class="org-block">), src_dir]
        )
        </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">build the doc sources
</span></span><span class="org-block">        sphinx.main([</span><span class="string"><span class="org-block">''</span></span><span class="org-block">, os.path.join(</span><span class="string"><span class="org-block">'doc'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'source'</span></span><span class="org-block">),
                     os.path.join(</span><span class="string"><span class="org-block">'doc'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'build'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'html'</span></span><span class="org-block">)])
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Setup</span>

This final block passes all the relevant package information to <span class="org-verbatim">=setuptools=</span>:
- package information: name, author, license, requirements,
- source code location,
- testing framework,
- console script: the package installs the <span class="org-verbatim">=hpp2plantuml=</span> <span class="org-link"><a href="nil:nil">command</a></span>.

<span class="org-meta-line">#+NAME: py-setup-main</span>
<span class="org-block-begin-line">#+BEGIN_SRC python -r
</span><span class="org-block">
</span><span class="keyword"><span class="org-block">if</span></span><span class="org-block"> </span><span class="builtin"><span class="org-block">__name__</span></span><span class="org-block"> == </span><span class="string"><span class="org-block">"__main__"</span></span><span class="org-block">:
    setup(
        name=NAME,
        description=find_meta(</span><span class="string"><span class="org-block">"description"</span></span><span class="org-block">),
        </span><span class="constant"><span class="org-block">license</span></span><span class="org-block">=find_meta(</span><span class="string"><span class="org-block">"license"</span></span><span class="org-block">),
        url=find_meta(</span><span class="string"><span class="org-block">"uri"</span></span><span class="org-block">),
        version=find_meta(</span><span class="string"><span class="org-block">"version"</span></span><span class="org-block">),
        author=find_meta(</span><span class="string"><span class="org-block">"author"</span></span><span class="org-block">),
        author_email=find_meta(</span><span class="string"><span class="org-block">"email"</span></span><span class="org-block">),
        maintainer=find_meta(</span><span class="string"><span class="org-block">"author"</span></span><span class="org-block">),
        maintainer_email=find_meta(</span><span class="string"><span class="org-block">"email"</span></span><span class="org-block">),
        keywords=KEYWORDS,
        long_description=read(</span><span class="string"><span class="org-block">"README.rst"</span></span><span class="org-block">),
        packages=PACKAGES,
        package_dir={</span><span class="string"><span class="org-block">""</span></span><span class="org-block">: </span><span class="string"><span class="org-block">"src"</span></span><span class="org-block">},
        zip_safe=</span><span class="constant"><span class="org-block">False</span></span><span class="org-block">,
        classifiers=CLASSIFIERS,
        install_requires=INSTALL_REQUIRES,
        setup_requires=SETUP_REQUIRES,
        test_suite=</span><span class="string"><span class="org-block">'nose.collector'</span></span><span class="org-block">,
        tests_require=[</span><span class="string"><span class="org-block">'nose'</span></span><span class="org-block">],
        entry_points={
            </span><span class="string"><span class="org-block">'console_scripts'</span></span><span class="org-block">: [</span><span class="string"><span class="org-block">'hpp2plantuml=hpp2plantuml.hpp2plantuml:main'</span></span><span class="org-block">]
        },
        cmdclass={</span><span class="string"><span class="org-block">'sphinx'</span></span><span class="org-block">: Sphinx}(ref:setup-sphinx)
    )
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Manifest</span>

The manifest file is used to include extra files to the package.

<span class="org-meta-line">#+NAME: setup-manifest</span>
<span class="org-block-begin-line">#+BEGIN_SRC conf :tangle MANIFEST.in
</span><span class="variable-name"><span class="org-block">include</span></span><span class="org-block"> *.rst *.txt LICENSE
</span><span class="variable-name"><span class="org-block">recursive-include</span></span><span class="org-block"> tests *.py
</span><span class="variable-name"><span class="org-block">recursive-include</span></span><span class="org-block"> tests *.hpp
</span><span class="variable-name"><span class="org-block">recursive-include</span></span><span class="org-block"> tests *.puml
</span><span class="variable-name"><span class="org-block">recursive-include</span></span><span class="org-block"> doc *.rst
</span><span class="variable-name"><span class="org-block">recursive-include</span></span><span class="org-block"> doc *.py
</span><span class="variable-name"><span class="org-block">prune</span></span><span class="org-block"> doc/build
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> README</span>

The README file is automatically generated from blocks defined in this
org-file (converted to RST format).

<span class="org-meta-line">#+NAME: rst-README</span>
<span class="org-block-begin-line">#+BEGIN_SRC rst :noweb yes :tangle README.rst
</span><span class="org-block">
</span><span class="rst-level-1"><span class="org-block">hpp2plantuml - Convert C++ header files to PlantUML</span></span><span class="org-block">
</span><span class="rst-adornment"><span class="org-block">===================================================</span></span><span class="org-block">

&lt;&lt;el-org-exp("sec-intro", "rst")&gt;&gt;

</span><span class="rst-level-2"><span class="org-block">Usage</span></span><span class="org-block">
</span><span class="rst-adornment"><span class="org-block">-----</span></span><span class="org-block">

&lt;&lt;el-org-exp("sec-module-usage", "rst", "keep")&gt;&gt;
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Documentation</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-package-doc</span>
<span class="org-special-keyword">:END:</span>

The module documentation is this org-file, which contains everything from the
module code to tests, packaging and documentation.

In order to distribute the package on standard platforms, a RST documentation is
also generated using <span class="org-link"><a href="http://sphinx-doc.org">Sphinx</a></span>.  The <span class="org-verbatim">=setup.py=</span> file contains a <span class="org-link"><a href="nil:nil">custom command</a></span>
"sphinx" to build the documentation.

The documentation is composed of two parts:
- this org-file is fully exported to RST,
- the <span class="org-code">~sphinx-api~</span> program is used to generate the module documentation from
  docstrings in the code.

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Sphinx configuration</span>

Sphinx configuration is performed via the <span class="org-verbatim">=conf.py=</span> file.  An example
configuration file can be generated using the <span class="org-verbatim">=sphinx-quickstart=</span> command.  The
content of the file is mostly following the defaults, with a few exceptions:
- the system path is modified to include the path to the package source code
  (<span class="org-link"><a href="nil:nil">(sphinx-conf-path)</a></span>),
- the <span class="org-verbatim">=numpydoc=</span> package is used to render the docstrings
  (<span class="org-link"><a href="nil:nil">(sphinx-conf-numpydoc)</a></span>).

<span class="org-meta-line">#+NAME: py-sphinx-conf</span>
<span class="org-block-begin-line">#+BEGIN_SRC python -r :noweb yes :mkdirp yes :tangle doc/source/conf.py
</span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">-*- coding: utf-8 -*-
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">hpp2plantuml documentation build configuration file, created by
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">sphinx-quickstart on Fri Dec  9 13:26:02 2016.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">This file is execfile()d with the current directory set to its
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">containing dir.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Note that not all possible configuration values are present in this
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">autogenerated file.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">All configuration values have a default; values that are commented out
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">serve to show the default.
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If extensions (or modules to document with autodoc) are in another directory,
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">add these directories to sys.path here. If the directory is relative to the
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">documentation root, use os.path.abspath to make it absolute, like shown here.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> os
</span><span class="keyword"><span class="org-block">import</span></span><span class="org-block"> sys
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">sys.path.insert(0, os.path.abspath('.'))
</span></span><span class="org-block">sys.path.insert(0, os.path.abspath(</span><span class="string"><span class="org-block">"../.."</span></span><span class="org-block">))(ref:sphinx-conf-path)

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Customizations
</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">autoclass_content</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'both'</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">autodoc_default_flags</span></span><span class="org-block"> = [</span><span class="string"><span class="org-block">'members'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'undoc-members'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'private-members'</span></span><span class="org-block">]
</span><span class="variable-name"><span class="org-block">numpydoc_show_class_members</span></span><span class="org-block"> = </span><span class="constant"><span class="org-block">False</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Customizations
</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">autoclass_content</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'both'</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">autodoc_default_flags</span></span><span class="org-block"> = [</span><span class="string"><span class="org-block">'members'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'undoc-members'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'private-members'</span></span><span class="org-block">]

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">-- General configuration ------------------------------------------------
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If your documentation needs a minimal Sphinx version, state it here.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">needs_sphinx = '1.0'
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Add any Sphinx extension module names here, as strings. They can be
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">extensions coming with Sphinx (named 'sphinx.ext.*') or your custom
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">ones.
</span></span><span class="variable-name"><span class="org-block">extensions</span></span><span class="org-block"> = [
    </span><span class="string"><span class="org-block">'sphinx.ext.autodoc'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'sphinx.ext.intersphinx'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'sphinx.ext.todo'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'sphinx.ext.coverage'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'sphinx.ext.mathjax'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'sphinx.ext.ifconfig'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'sphinx.ext.viewcode'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'sphinx.ext.autosummary'</span></span><span class="org-block">,
    </span><span class="string"><span class="org-block">'numpydoc'</span></span><span class="org-block">(ref:sphinx-conf-numpydoc)
]

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Add any paths that contain templates here, relative to this directory.
</span></span><span class="variable-name"><span class="org-block">templates_path</span></span><span class="org-block"> = [</span><span class="string"><span class="org-block">'_templates'</span></span><span class="org-block">]

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The suffix(es) of source filenames.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">You can specify multiple suffix as a list of string:
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">source_suffix = ['.rst', '.md']
</span></span><span class="variable-name"><span class="org-block">source_suffix</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'.rst'</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The encoding of source files.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">source_encoding = 'utf-8-sig'
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The master toctree document.
</span></span><span class="variable-name"><span class="org-block">master_doc</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'index'</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">General information about the project.
</span></span><span class="variable-name"><span class="org-block">project</span></span><span class="org-block"> = u</span><span class="string"><span class="org-block">'hpp2plantuml'</span></span><span class="org-block">
</span><span class="constant"><span class="org-block">copyright</span></span><span class="org-block"> = u</span><span class="string"><span class="org-block">'2016, Thibault Marin'</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">author</span></span><span class="org-block"> = u</span><span class="string"><span class="org-block">'Thibault Marin'</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The version info for the project you're documenting, acts as replacement for
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">|version| and |release|, also used in various other places throughout the
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">built documents.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The short X.Y version.
</span></span><span class="variable-name"><span class="org-block">version</span></span><span class="org-block"> = u</span><span class="string"><span class="org-block">'v'</span></span><span class="org-block"> + u&lt;&lt;get-version()&gt;&gt;
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The full version, including alpha/beta/rc tags.
</span></span><span class="variable-name"><span class="org-block">release</span></span><span class="org-block"> = u</span><span class="string"><span class="org-block">'v'</span></span><span class="org-block"> + u&lt;&lt;get-version()&gt;&gt;

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The language for content autogenerated by Sphinx. Refer to documentation
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">for a list of supported languages.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">This is also used if you do content translation via gettext catalogs.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Usually you set "language" from the command line for these cases.
</span></span><span class="variable-name"><span class="org-block">language</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'en'</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">There are two options for replacing |today|: either, you set today to some
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">non-false value, then it is used:
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">today = ''
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Else, today_fmt is used as the format for a strftime call.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">today_fmt = '%B %d, %Y'
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">List of patterns, relative to source directory, that match files and
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">directories to ignore when looking for source files.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">This patterns also effect to html_static_path and html_extra_path
</span></span><span class="variable-name"><span class="org-block">exclude_patterns</span></span><span class="org-block"> = []

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The reST default role (used for this markup: `text`) to use for all
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">documents.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="variable-name"><span class="org-block">default_role</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'autolink'</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, '()' will be appended to :func: etc. cross-reference text.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">add_function_parentheses = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, the current module name will be prepended to all description
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">unit titles (such as .. function::).
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">add_module_names = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, sectionauthor and moduleauthor directives will be shown in the
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">output. They are ignored by default.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">show_authors = False
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The name of the Pygments (syntax highlighting) style to use.
</span></span><span class="variable-name"><span class="org-block">pygments_style</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'sphinx'</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">A list of ignored prefixes for module index sorting.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">modindex_common_prefix = []
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, keep warnings as "system message" paragraphs in the built documents.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">keep_warnings = False
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, `todo` and `todoList` produce output, else they produce nothing.
</span></span><span class="variable-name"><span class="org-block">todo_include_todos</span></span><span class="org-block"> = </span><span class="constant"><span class="org-block">True</span></span><span class="org-block">


</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">-- Options for HTML output ----------------------------------------------
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The theme to use for HTML and HTML Help pages.  See the documentation for
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">a list of builtin themes.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="variable-name"><span class="org-block">html_theme</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'alabaster'</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Theme options are theme-specific and customize the look and feel of a theme
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">further.  For a list of options available for each theme, see the
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">documentation.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_theme_options = {}
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Add any paths that contain custom themes here, relative to this directory.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_theme_path = []
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The name for this set of Sphinx documents.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">"&lt;project&gt; v&lt;release&gt; documentation" by default.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_title = u'hpp2plantuml ' + u'v' + u&lt;&lt;get-version()&gt;&gt;
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">A shorter title for the navigation bar.  Default is the same as html_title.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_short_title = None
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The name of an image file (relative to this directory) to place at the top
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">of the sidebar.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_logo = None
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The name of an image file (relative to this directory) to use as a favicon of
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">the docs.  This file should be a Windows icon file (.ico) being 16x16 or 32x32
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">pixels large.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_favicon = None
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Add any paths that contain custom static files (such as style sheets) here,
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">relative to this directory. They are copied after the builtin static files,
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">so a file named "default.css" will overwrite the builtin "default.css".
</span></span><span class="variable-name"><span class="org-block">html_static_path</span></span><span class="org-block"> = [</span><span class="string"><span class="org-block">'_static'</span></span><span class="org-block">]

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Add any extra paths that contain custom files (such as robots.txt or
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">.htaccess) here, relative to this directory. These files are copied
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">directly to the root of the documentation.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_extra_path = []
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If not None, a 'Last updated on:' timestamp is inserted at every page
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">bottom, using the given strftime format.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The empty string is equivalent to '%b %d, %Y'.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_last_updated_fmt = None
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, SmartyPants will be used to convert quotes and dashes to
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">typographically correct entities.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_use_smartypants = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Custom sidebar templates, maps document names to template names.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_sidebars = {}
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Additional templates that should be rendered to pages, maps page names to
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">template names.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_additional_pages = {}
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If false, no module index is generated.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_domain_indices = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If false, no index is generated.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_use_index = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, the index is split into individual pages for each letter.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_split_index = False
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, links to the reST sources are added to the pages.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_show_sourcelink = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, "Created using Sphinx" is shown in the HTML footer. Default is True.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_show_sphinx = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, "(C) Copyright ..." is shown in the HTML footer. Default is True.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_show_copyright = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, an OpenSearch description file will be output, and all pages will
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">contain a &lt;link&gt; tag referring to it.  The value of this option must be the
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">base URL from which the finished HTML is served.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_use_opensearch = ''
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">This is the file name suffix for HTML files (e.g. ".xhtml").
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_file_suffix = None
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Language to be used for generating the HTML full-text search index.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Sphinx supports the following languages:
</span></span><span class="comment-delimiter"><span class="org-block">#   </span></span><span class="comment"><span class="org-block">'da', 'de', 'en', 'es', 'fi', 'fr', 'hu', 'it', 'ja'
</span></span><span class="comment-delimiter"><span class="org-block">#   </span></span><span class="comment"><span class="org-block">'nl', 'no', 'pt', 'ro', 'ru', 'sv', 'tr', 'zh'
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_search_language = 'en'
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">A dictionary with options for the search language support, empty by default.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">'ja' uses this config value.
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">'zh' user can custom change `jieba` dictionary path.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_search_options = {'type': 'default'}
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The name of a javascript file (relative to the configuration directory) that
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">implements a search results scorer. If empty, the default will be used.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">html_search_scorer = 'scorer.js'
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Output file base name for HTML help builder.
</span></span><span class="variable-name"><span class="org-block">htmlhelp_basename</span></span><span class="org-block"> = </span><span class="string"><span class="org-block">'hpp2plantumldoc'</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">-- Options for LaTeX output ---------------------------------------------
</span></span><span class="org-block">
</span><span class="variable-name"><span class="org-block">latex_elements</span></span><span class="org-block"> = {
     </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The paper size ('letterpaper' or 'a4paper').
</span></span><span class="org-block">     </span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">     </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">'papersize': 'letterpaper',
</span></span><span class="org-block">
     </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The font size ('10pt', '11pt' or '12pt').
</span></span><span class="org-block">     </span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">     </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">'pointsize': '10pt',
</span></span><span class="org-block">
     </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Additional stuff for the LaTeX preamble.
</span></span><span class="org-block">     </span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">     </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">'preamble': '',
</span></span><span class="org-block">
     </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Latex figure (float) alignment
</span></span><span class="org-block">     </span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="org-block">     </span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">'figure_align': 'htbp',
</span></span><span class="org-block">}

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Grouping the document tree into LaTeX files. List of tuples
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">(source start file, target name, title,
</span></span><span class="comment-delimiter"><span class="org-block">#  </span></span><span class="comment"><span class="org-block">author, documentclass [howto, manual, or own class]).
</span></span><span class="variable-name"><span class="org-block">latex_documents</span></span><span class="org-block"> = [
    (master_doc, </span><span class="string"><span class="org-block">'hpp2plantuml.tex'</span></span><span class="org-block">, u</span><span class="string"><span class="org-block">'hpp2plantuml Documentation'</span></span><span class="org-block">,
     u</span><span class="string"><span class="org-block">'Thibault Marin'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'manual'</span></span><span class="org-block">),
]

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">The name of an image file (relative to this directory) to place at the top of
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">the title page.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">latex_logo = None
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">For "manual" documents, if this is true, then toplevel headings are parts,
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">not chapters.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">latex_use_parts = False
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, show page references after internal links.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">latex_show_pagerefs = False
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, show URL addresses after external links.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">latex_show_urls = False
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Documents to append as an appendix to all manuals.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">latex_appendices = []
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">It false, will not define \strong, \code,     itleref, \crossref ... but only
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">\sphinxstrong, ..., \sphinxtitleref, ... To help avoid clash with user added
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">packages.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">latex_keep_old_macro_names = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If false, no module index is generated.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">latex_domain_indices = True
</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">-- Options for manual page output ---------------------------------------
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">One entry per manual page. List of tuples
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">(source start file, name, description, authors, manual section).
</span></span><span class="variable-name"><span class="org-block">man_pages</span></span><span class="org-block"> = [
    (master_doc, </span><span class="string"><span class="org-block">'hpp2plantuml'</span></span><span class="org-block">, u</span><span class="string"><span class="org-block">'hpp2plantuml Documentation'</span></span><span class="org-block">,
     [author], 1)
]

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, show URL addresses after external links.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">man_show_urls = False
</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">-- Options for Texinfo output -------------------------------------------
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Grouping the document tree into Texinfo files. List of tuples
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">(source start file, target name, title, author,
</span></span><span class="comment-delimiter"><span class="org-block">#  </span></span><span class="comment"><span class="org-block">dir menu entry, description, category)
</span></span><span class="variable-name"><span class="org-block">texinfo_documents</span></span><span class="org-block"> = [
    (master_doc, </span><span class="string"><span class="org-block">'hpp2plantuml'</span></span><span class="org-block">, u</span><span class="string"><span class="org-block">'hpp2plantuml Documentation'</span></span><span class="org-block">,
     author, </span><span class="string"><span class="org-block">'hpp2plantuml'</span></span><span class="org-block">, </span><span class="string"><span class="org-block">'One line description of project.'</span></span><span class="org-block">,
     </span><span class="string"><span class="org-block">'Miscellaneous'</span></span><span class="org-block">),
]

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Documents to append as an appendix to all manuals.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">texinfo_appendices = []
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If false, no module index is generated.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">texinfo_domain_indices = True
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">How to display URL addresses: 'footnote', 'no', or 'inline'.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">texinfo_show_urls = 'footnote'
</span></span><span class="org-block">
</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">If true, do not generate a @detailmenu in the "Top" node's menu.
</span></span><span class="comment-delimiter"><span class="org-block">#</span></span><span class="comment"><span class="org-block">
</span></span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">texinfo_no_detailmenu = False
</span></span><span class="org-block">

</span><span class="comment-delimiter"><span class="org-block"># </span></span><span class="comment"><span class="org-block">Example configuration for intersphinx: refer to the Python standard library.
</span></span><span class="variable-name"><span class="org-block">intersphinx_mapping</span></span><span class="org-block"> = {</span><span class="string"><span class="org-block">'https://docs.python.org/'</span></span><span class="org-block">: </span><span class="constant"><span class="org-block">None</span></span><span class="org-block">}
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Index page</span>

The index page is the entry point of the documentation.  It is formed by other
parts of the org document including a brief description of the usage and links
to the automatically generated and the org-file documents.

<span class="org-meta-line">#+NAME: doc-rst-index</span>
<span class="org-block-begin-line">#+BEGIN_SRC rst :noweb yes :mkdirp yes :tangle doc/source/index.rst
</span><span class="org-block">
</span><span class="rst-comment"><span class="org-block">.. hpp2plantuml documentation master file.
</span></span><span class="org-block">
</span><span class="rst-level-1"><span class="org-block">hpp2plantuml documentation</span></span><span class="org-block">
</span><span class="rst-adornment"><span class="org-block">==========================</span></span><span class="org-block">

</span><span class="rst-directive"><span class="org-block">.. toctree::</span></span><span class="org-block">
   </span><span class="rst-external"><span class="org-block">:maxdepth:</span></span><span class="org-block"> 4

&lt;&lt;el-org-exp("sec-intro", "rst")&gt;&gt;

&lt;&lt;el-org-exp("sec-module-usage", "rst", "keep")&gt;&gt;

</span><span class="rst-level-2"><span class="org-block">Module documentation generated from docstrings</span></span><span class="org-block">
</span><span class="rst-adornment"><span class="org-block">----------------------------------------------</span></span><span class="org-block">

</span><span class="rst-directive"><span class="org-block">:doc:</span></span><span class="rst-external"><span class="org-block">`hpp2plantuml`</span></span><span class="org-block">

</span><span class="rst-level-2"><span class="org-block">Full org-mode package documentation</span></span><span class="org-block">
</span><span class="rst-adornment"><span class="org-block">-----------------------------------</span></span><span class="org-block">

</span><span class="rst-directive"><span class="org-block">:doc:</span></span><span class="rst-external"><span class="org-block">`org-doc`</span></span><span class="org-block">

</span><span class="rst-level-1"><span class="org-block">Indices and tables</span></span><span class="org-block">
</span><span class="rst-adornment"><span class="org-block">==================</span></span><span class="org-block">

,* </span><span class="rst-directive"><span class="org-block">:ref:</span></span><span class="rst-external"><span class="org-block">`genindex`</span></span><span class="org-block">
,* </span><span class="rst-directive"><span class="org-block">:ref:</span></span><span class="rst-external"><span class="org-block">`modindex`</span></span><span class="org-block">
,* </span><span class="rst-directive"><span class="org-block">:ref:</span></span><span class="rst-external"><span class="org-block">`search`</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-3">*** </span><span class="org-done">DONE</span><span class="org-level-3"> Read The Docs</span>

In order to build the documentation on the <span class="org-link"><a href="http://read-the-docs.readthedocs.io/en/latest/">Read The Docs</a></span> website, a requirement
file is added for the <span class="org-verbatim">=numpydoc=</span> package.

<span class="org-meta-line">#+NAME: req-readthedocs</span>
<span class="org-block-begin-line">#+BEGIN_SRC conf :mkdirp yes :tangle doc/source/readthedocs-requirements.txt
</span><span class="variable-name"><span class="org-block">numpydoc</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-1">* </span><span class="org-done">DONE</span><span class="org-level-1"> Org-mode setup</span>

The generation of the package code depends on org-mode, mostly to expand blocks
with the <span class="org-link"><a href="http://orgmode.org/manual/Noweb-reference-syntax.html">=noweb=</a></span> interface.  The following defines helper functions to simplify
this process.

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Version string</span>
<span class="org-special-keyword">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">sec-org-el-version</span>
<span class="org-special-keyword">:END:</span>

The following source block is used to get the module's version number defined in
<span class="org-link"><a href="nil:nil">a single location</a></span> and include it at multiple locations.

<span class="org-meta-line">#+NAME: get-version</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp :var ver=hpp2plantuml-version :var lang="python"
</span><span class="org-block">(</span><span class="keyword"><span class="org-block">cond</span></span><span class="org-block"> ((string= lang </span><span class="string"><span class="org-block">"python"</span></span><span class="org-block">)
       (format </span><span class="string"><span class="org-block">"'%s'"</span></span><span class="org-block"> ver)))
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> org-to-rst</span>

The following source block converts the content of an org heading to rst format
using the <span class="org-link"><a href="nil:nil">~org-rst-convert-region-to-rst~</a></span> function.  The heading to process is
passed by its CUSTOM_ID property (as a string).  In addition, the output
language can set (although rst is the only instance used in this document) and
an additional flag <span class="org-code">~children~</span> can be used to control whether the subsections of
the target section are removed (<span class="org-code">~children = "remove"~</span>) of kept (any other
string, e.g. "keep").

<span class="org-meta-line">#+NAME: el-org-exp</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp -r :var input="sec-module-usage" :var lang="rst" :var children="remove" :results silent
</span><span class="org-block">(</span><span class="keyword"><span class="org-block">save-excursion</span></span><span class="org-block">
  (</span><span class="keyword"><span class="org-block">let</span></span><span class="org-block"> ((org-tree (org-element-parse-buffer)))
    (org-element-map
        org-tree 'headline
      (</span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> (r)
        (</span><span class="keyword"><span class="org-block">let</span></span><span class="org-block"> ((cid (org-element-property </span><span class="builtin"><span class="org-block">:CUSTOM_ID</span></span><span class="org-block"> r)))
          </span><span class="comment-delimiter"><span class="org-block">;; </span></span><span class="comment"><span class="org-block">Find desired heading (identified by CUSTOM_ID)
</span></span><span class="org-block">          (</span><span class="keyword"><span class="org-block">when</span></span><span class="org-block"> (string= cid input)
            (</span><span class="keyword"><span class="org-block">when</span></span><span class="org-block"> (string= children </span><span class="string"><span class="org-block">"remove"</span></span><span class="org-block">)
              </span><span class="comment-delimiter"><span class="org-block">;; </span></span><span class="comment"><span class="org-block">Remove all children
</span></span><span class="org-block">              (org-element-map (org-element-contents r) 'headline
                (</span><span class="keyword"><span class="org-block">lambda</span></span><span class="org-block"> (subr)
                  (org-element-extract-element subr))))
            (</span><span class="keyword"><span class="org-block">let</span></span><span class="org-block"> ((out-text (org-element-interpret-data r)))
                  </span><span class="comment-delimiter"><span class="org-block">;; </span></span><span class="comment"><span class="org-block">Convert to output format
</span></span><span class="org-block">                  (</span><span class="keyword"><span class="org-block">cond</span></span><span class="org-block"> ((string= lang </span><span class="string"><span class="org-block">"rst"</span></span><span class="org-block">)
                         (</span><span class="keyword"><span class="org-block">with-temp-buffer</span></span><span class="org-block">
                           (insert out-text)
                           (mark-whole-buffer)
                           (</span><span class="keyword"><span class="org-block">let</span></span><span class="org-block"> ((org-export-with-toc nil)
                                 (org-export-with-todo-keywords nil)
                                 (org-export-with-section-numbers nil)
                                 (org-export-with-broken-links t))
                             (org-rst-convert-region-to-rst))(ref:rst-convert-region)
                           (buffer-string)))
                        </span><span class="comment-delimiter"><span class="org-block">;; </span></span><span class="comment"><span class="org-block">Could support more languages
</span></span><span class="org-block">                        (t out-text))))))
      nil t)))
</span><span class="org-block-end-line">#+END_SRC
</span>

<span class="org-level-2">** </span><span class="org-done">DONE</span><span class="org-level-2"> Generate documentation</span>

When generating the rst documentation from this org-file, special handling is
required for source languages known to org but not to rst..  This is performed
using org's <span class="org-link"><a href="http://orgmode.org/manual/Advanced-configuration.html">filtering functionality</a></span>.  The <span class="org-link"><a href="nil:nil">~custom-rst-filter-org-block~</a></span> function
defines the filter responsible for post-processing source blocks when exporting
to rst.  Its goal is to fix languages unknown to sphinx (which relies on <span class="org-link"><a href="http://pygments.org/">the
pygmentize program</a></span> for syntax highlighting) such as <span class="org-verbatim">=plantuml=</span> and org's <span class="org-verbatim">=conf=</span>
blocks, replacing them by a simple example block.

<span class="org-meta-line">#+NAME: ox-rst-filter-src</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp -r
</span><span class="org-block">(</span><span class="keyword"><span class="org-block">defun</span></span><span class="org-block"> </span><span class="function-name"><span class="org-block">custom-rst-filter-org-block</span></span><span class="org-block"> (text backend info)(ref:el-rst-filter)
  (</span><span class="keyword"><span class="org-block">when</span></span><span class="org-block"> (org-export-derived-backend-p backend 'rst)
    (</span><span class="keyword"><span class="org-block">let*</span></span><span class="org-block"> ((pattern </span><span class="string"><span class="org-block">".*\.\. code-block:: </span></span><span class="regexp-grouping-backslash"><span class="string"><span class="org-block">\\</span></span></span><span class="regexp-grouping-construct"><span class="string"><span class="org-block">(</span></span></span><span class="string"><span class="org-block"><a href="nil:nil">[[:alnum:]]</a>+</span></span><span class="regexp-grouping-backslash"><span class="string"><span class="org-block">\\</span></span></span><span class="regexp-grouping-construct"><span class="string"><span class="org-block">)</span></span></span><span class="string"><span class="org-block">"</span></span><span class="org-block">)
           (pattern-line (concat pattern </span><span class="string"><span class="org-block">".*$"</span></span><span class="org-block">))
           (lang (</span><span class="keyword"><span class="org-block">progn</span></span><span class="org-block">
                   (string-match pattern text)
                   (match-string 1 text))))
      (</span><span class="keyword"><span class="org-block">cond</span></span><span class="org-block"> ((member lang '(</span><span class="string"><span class="org-block">"conf"</span></span><span class="org-block"> </span><span class="string"><span class="org-block">"plantuml"</span></span><span class="org-block">))
             (replace-regexp-in-string pattern-line </span><span class="string"><span class="org-block">"::\n"</span></span><span class="org-block"> text))
            (t text)))))
</span><span class="org-block-end-line">#+END_SRC
</span>
The command and options to generate the org-file documentation in rst format are
encapsulated in the following source block.

<span class="org-meta-line">#+NAME: el-export-rst-org-doc</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp :results silent
</span><span class="org-block">(</span><span class="keyword"><span class="org-block">require</span></span><span class="org-block"> '</span><span class="constant"><span class="org-block">ox-rst</span></span><span class="org-block">)
(</span><span class="keyword"><span class="org-block">let</span></span><span class="org-block"> ((org-export-with-toc nil)
      (org-export-with-todo-keywords nil)
      (org-export-with-section-numbers nil)
      (org-export-with-broken-links t)
      (org-export-filter-src-block-functions
       '(custom-rst-filter-org-block)))
  (org-export-to-file 'rst </span><span class="string"><span class="org-block">"doc/source/org-doc.rst"</span></span><span class="org-block">))
</span><span class="org-block-end-line">#+END_SRC
</span>


<span class="org-level-1">* Notes                                                            </span><span class="org-tag"><span class="org-level-1">:noexport:</span></span>

- <span class="org-checkbox">[-]</span> Add tests
  - <span class="org-checkbox">[ ]</span> Add test coverage report to documentation (full test from within org-mode?)
  - <span class="org-checkbox">[ ]</span> Test structs
  - <span class="org-checkbox">[X]</span> Unit tests
  - <span class="org-checkbox">[X]</span> Full diagram test
- <span class="org-checkbox">[ ]</span> Extra files for package
  - <span class="org-checkbox">[ ]</span> MANIFEST.in?
- <span class="org-checkbox">[X]</span> Fix export of org blocks
- <span class="org-checkbox">[X]</span> Code
  - <span class="org-checkbox">[X]</span> Add docstrings
  - <span class="org-checkbox">[X]</span> Add structs
- <span class="org-checkbox">[X]</span> setup.py
  - <span class="org-checkbox">[X]</span> install doesn't do anything
  - <span class="org-checkbox">[X]</span> add script to install
  - <span class="org-checkbox">[X]</span> add build doc command
- <span class="org-checkbox">[X]</span> conf.py (sphinx)
  - <span class="org-checkbox">[X]</span> Include both automatically generated documentation (from docstrings) and
    org file
  - <span class="org-checkbox">[X]</span> Render org blocks as regular text
- <span class="org-checkbox">[X]</span> Write elisp function which:
  - <span class="org-checkbox">[X]</span> tangles source files
  - <span class="org-checkbox">[X]</span> creates documentation rst (and README.rst)
- <span class="org-checkbox">[X]</span> Link to org-mode rst documentation from index.rst -&gt; Use only org-mode rst?
</pre>
  </body>
</html>
