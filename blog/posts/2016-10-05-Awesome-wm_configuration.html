<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-09-29 Sat 15:33 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Awesome-wm configuration</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Thibault Marin">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<!-- [[file:~/dotfiles/emacs/website/website.org::html-head][html-head]] -->
<link rel='stylesheet' href='/blog/css/site.css' type='text/css'/>
<script type="text/javascript">
    function rpl(expr, a, b) {
      var i = 0;
      while (i != -1) {
         i = expr.indexOf(a, i);
         if (i >= 0) {
            expr = expr.substring(0, i) + b + expr.substring(i + a.length);
            i += b.length;
         }
      }
      return expr
    }

    function show_org_source(flag_html = false){
        //document.location.href = rpl(document.location.href, "html", "org");
        var re = /[\/]$/g;
        var html_url = document.location.href.replace(re, '/index.html');
        var out_ext = flag_html? "org.html": "org";
        window.open(rpl(html_url, "html", out_ext), '_blank');
    }
</script>
<!-- html-head ends here -->
<link rel="alternate" type="application/rss+xml"
                href="/blog/rss.xml"
                title="RSS feed">
<script type="text/javascript" src="/blog/js/org-info.js">
/**
 *
 * @source: /blog/js/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in /blog/js/org-info.js.
 *
 * Copyright (C) 2012-2018 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in /blog/js/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "2");
org_html_manager.set("LINK_HOME", "/blog/index.html");
org_html_manager.set("LINK_UP", "/blog/index.html");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "1");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "showall");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="/blog/index.html"> UP </a>
 |
 <a accesskey="H" href="/blog/index.html"> HOME </a>
</div><div id="preamble" class="status">
<!-- [[file:~/dotfiles/emacs/website/website.org::html-preamble][html-preamble]] -->
<div class='topnav'>
  <ul>
    <li><a href='/blog/index.html'>Home</a></li>
    <li><a href='/blog/blog.html'>Blog</a></li>
    <li class="right feed"><a href='/blog/rss.xml'>RSS</a></li>
  </ul>
</div>

<div class="foreword">
  [2016-10-05 Wed 00:00 (last updated: 2018-08-19 Sun 18:10) Press <kbd>?</kbd> for navigation help]
</div>
<!-- html-preamble ends here -->
</div>
<div id="content">
<h1 class="title">Awesome-wm configuration</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7aef2b2">Introduction </a>
<ul>
<li><a href="#orgf8f9193">Requirements</a></li>
<li><a href="#org70876dc">Makefile</a></li>
</ul>
</li>
<li><a href="#orge9e57b1">Imports </a>
<ul>
<li><a href="#orgc6486b5">Standard awesome imports</a></li>
<li><a href="#awesome_paths">Paths</a></li>
<li><a href="#org8e1084f">Debian specific</a></li>
<li><a href="#orgaf7c530">Custom modules</a>
<ul>
<li><a href="#org208c593">launchbar module</a></li>
<li><a href="#org4933740">cmus module</a></li>
<li><a href="#org3872f35">ttrss module</a></li>
<li><a href="#org48da9ca">themes module</a></li>
<li><a href="#org565d93c"><code>icon_finder</code> module</a></li>
<li><a href="#org12d18db"><code>global_prompt</code> module</a></li>
<li><a href="#org500fb73"><code>my_utility</code> module</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org964bf14">Basic setup </a>
<ul>
<li><a href="#default_programs">Default programs</a></li>
<li><a href="#icons">Icons</a></li>
<li><a href="#org0d01f36">Error handling</a></li>
<li><a href="#org664f042">Modkey setting</a></li>
</ul>
</li>
<li><a href="#org3f8ca39">Desktop </a>
<ul>
<li><a href="#layouts">Layouts</a></li>
<li><a href="#theme">Theme</a>
<ul>
<li><a href="#org731e10e">Theme management module</a></li>
<li><a href="#org8bcd7fb">The <code>custom_defaults</code> file</a></li>
<li><a href="#orgb895d17">Theme selection</a></li>
<li><a href="#org420034e">Selected theme</a></li>
</ul>
</li>
<li><a href="#tags">Tags</a></li>
</ul>
</li>
<li><a href="#org138b532">Main bar </a>
<ul>
<li><a href="#launchbar">Launchbar</a>
<ul>
<li><a href="#org15a26d6">Module definition</a></li>
<li><a href="#org841589e">Instantiation</a></li>
</ul>
</li>
<li><a href="#shutdown">Shutdown menu</a></li>
<li><a href="#main_menu">Main menu</a></li>
<li><a href="#volume">Volume widget</a>
<ul>
<li><a href="#org5a4d17b">OSD volume</a></li>
</ul>
</li>
<li><a href="#memory">Memory</a></li>
<li><a href="#calendar">Calendar</a></li>
<li><a href="#email">Mail</a>
<ul>
<li><a href="#org03d1be6">Module definition</a></li>
<li><a href="#orgdbd59fb">Widget setup</a></li>
</ul>
</li>
<li><a href="#cmus">cmus</a>
<ul>
<li><a href="#orgc07b3b5">Imports</a></li>
<li><a href="#cmus_utils">Utility functions</a></li>
<li><a href="#cmus_global_variables">Global variables</a></li>
<li><a href="#cmus_pid">Check running instance</a></li>
<li><a href="#org8173b00">Controls</a></li>
<li><a href="#cmus_popup">Popup</a></li>
<li><a href="#cmus_play">Quick play command</a></li>
<li><a href="#cmus_hook">Main hook</a></li>
<li><a href="#org43f009d">cmus module usage</a></li>
</ul>
</li>
<li><a href="#ttrss">Tiny Tiny RSS</a>
<ul>
<li><a href="#ttrss-wrapper-py">Python wrapper script</a></li>
<li><a href="#org468c380">Credentials</a></li>
<li><a href="#org2234a9c">tt-rss module</a></li>
<li><a href="#ttrss-widget">tt-rss widget</a></li>
</ul>
</li>
<li><a href="#org6fe5816">Keyboard layout</a></li>
</ul>
</li>
<li><a href="#orgb860cf2">Effects </a>
<ul>
<li><a href="#org127d417">Monitor highlighting</a></li>
<li><a href="#effects_transparency">Transparency</a></li>
<li><a href="#org4d7b3ff">Window border change on focus</a></li>
<li><a href="#org4c30704">Snap client to screen edges</a></li>
</ul>
</li>
<li><a href="#orgf54a645">Bindings </a>
<ul>
<li><a href="#org15e1ba2">Mouse</a>
<ul>
<li><a href="#orgeb99989">General bindings</a></li>
<li><a href="#org3017c0d">Windows</a></li>
<li><a href="#bindings_mouse_taglist">Tag list</a></li>
<li><a href="#bindings_mouse_tasklist">Task list</a></li>
</ul>
</li>
<li><a href="#bindings_keyboard">Keyboard</a>
<ul>
<li><a href="#org3e212ab">Global bindings </a>
<ul>
<li><a href="#orgf6acf6c">Shortcuts popup</a></li>
<li><a href="#orgef15ed5">Tags</a></li>
<li><a href="#org88ef63b">Clients (windows)</a></li>
<li><a href="#org050825f">Layout</a></li>
<li><a href="#org5fffba8">Application shortcuts</a></li>
<li><a href="#keybindings_prompts">Prompts</a></li>
<li><a href="#org53c845c">Menubar</a></li>
<li><a href="#org902cb3e">Volume control</a></li>
<li><a href="#org7dd8fc7">Screen lock</a></li>
<li><a href="#pass_manager">Password manager</a></li>
<li><a href="#org0222cb0">Register keybindings</a></li>
</ul>
</li>
<li><a href="#orgf5c4719">Client bindings</a>
<ul>
<li><a href="#orgf9f7750">Fullscreen</a></li>
<li><a href="#org6f4fcb1">Kill window</a></li>
<li><a href="#org222ab09">Toggle floating window mode</a></li>
<li><a href="#orgdf0d68b">Move window to master position</a></li>
<li><a href="#org17f50a1">Move window to other screen</a></li>
<li><a href="#org9989aaa">Toggle on-top property</a></li>
<li><a href="#org78f04e3">Minimize window</a></li>
<li><a href="#orgb294277">Toggle maximized mode</a></li>
<li><a href="#org350fbd1">Show window information</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#wibox">Wibox </a>
<ul>
<li><a href="#org65ad674">Main prompt box</a></li>
<li><a href="#orgdca71e2">Launchers</a></li>
<li><a href="#orgf0c4535">Wibox</a></li>
<li><a href="#orgb9a7683">Close screen for loop</a></li>
</ul>
</li>
<li><a href="#rules">Rules</a></li>
<li><a href="#org120b361">Signals</a></li>
<li><a href="#icon_finder">Icon finder</a></li>
<li><a href="#global_prompt">Global prompt </a>
<ul>
<li><a href="#orgd49ee93">Imports</a></li>
<li><a href="#global_prompt_utils">Utilities</a></li>
<li><a href="#orga18383a">Prompts</a>
<ul>
<li><a href="#global_prompt_help">help</a></li>
<li><a href="#orgc12562c">session</a></li>
<li><a href="#orgf98186a">window</a></li>
<li><a href="#global_prompt_calc">calc</a>
<ul>
<li><a href="#org1c53582">Internal script</a></li>
<li><a href="#org77811e8">Prompt definition</a></li>
</ul>
</li>
<li><a href="#org7b6f172">cmus</a></li>
<li><a href="#global_prompt_music">music</a></li>
<li><a href="#org46b634f">web&#xa0;&#xa0;&#xa0;<span class="tag"><span class="feature_request">feature_request</span></span></a></li>
</ul>
</li>
<li><a href="#org809cbba">Main prompt</a></li>
</ul>
</li>
<li><a href="#startup_applications">Startup applications</a>
<ul>
<li><a href="#org90c3e9e">Screen setup script</a></li>
</ul>
</li>
<li><a href="#my_utility">Utilities </a>
<ul>
<li><a href="#orgfa063a3">String split</a></li>
<li><a href="#orgdc00280">HTML escape</a></li>
<li><a href="#orga11a31f">File listing</a></li>
<li><a href="#org626075e">Table operations</a></li>
<li><a href="#my_utility_confirm">Confirmation popup</a></li>
<li><a href="#my_utility_run_once">Run once</a></li>
<li><a href="#org81c1d87">Return object</a></li>
</ul>
</li>
<li><a href="#org4d73a7b">Resources</a></li>
</ul>
</div>
</div>

<div id="outline-container-org7aef2b2" class="outline-2">
<h2 id="org7aef2b2">Introduction </h2>
<div class="outline-text-2" id="text-org7aef2b2">
<p>
This file contains my configuration for the <a href="https://awesome.naquadah.org/">awesome</a> window manager along with
documentation of the different modules developed and used. The actual
configuration (a set of lua files) can be produced by running <code>org-babel-tangle</code>
on the original org file.
</p>

<p>
The resulting desktop is shown on Fig.&nbsp;<a href="#org37f4700">1</a>.  The following
bash script produces the image.  The most interesting part is the top wibox,
which is shown enlarged on Fig.&nbsp;<a href="#orgdf23b9a">2</a>.
</p>

<div class="org-src-container">
<pre class="src src-sh" id="orgdcd3b2d">
<span style="color: #b22222;"># </span><span style="color: #b22222;">Could get these from xrandr</span>
<span style="color: #a0522d;">res_x</span>=1920
<span style="color: #a0522d;">res_y</span>=1080
<span style="color: #a0522d;">screen_idx</span>=1

<span style="color: #a0522d;">width</span>=$(( $<span style="color: #a0522d;">res_x</span> ))
<span style="color: #a0522d;">height</span>=$(( $<span style="color: #a0522d;">res_y</span> ))
<span style="color: #a0522d;">start_x</span>=$(( $<span style="color: #a0522d;">screen_idx</span> * $<span style="color: #a0522d;">res_x</span> ))
<span style="color: #a0522d;">start_y</span>=$(( 0 ))

scrot desktop.png
convert desktop.png -crop ${<span style="color: #a0522d;">width</span>}x${<span style="color: #a0522d;">height</span>}+${<span style="color: #a0522d;">start_x</span>}+${<span style="color: #a0522d;">start_y</span>} desktop-main.png
rm desktop.png -rf
</pre>
</div>



<div id="org37f4700" class="figure">
<p><a href="../images/2016-10-05-Awesome-wm_configuration/desktop-main.png" width="100%"><img src="../images/2016-10-05-Awesome-wm_configuration/desktop-main.png" alt="desktop-main.png" width="100%"></a>
</p>
<p><span class="figure-number">Figure 1: </span>My awesome-wm desktop.</p>
</div>


<p>
This configuration is currently used on the following system:
</p>

<dl class="org-dl">
<dt>OS</dt><dd></dd>
</dl>
<div class="org-src-container">
<pre class="src src-sh" id="org5523b75">lsb_release -a
uname -a
</pre>
</div>

<pre class="example">
Distributor ID:	Debian
Description:	Debian GNU/Linux 9.0 (stretch)
Release:	9.0
Codename:	stretch
Linux dell-desktop 4.9.0-1-amd64 #1 SMP Debian 4.9.2-2 (2017-01-12) x86_64 GNU/Linux
</pre>


<dl class="org-dl">
<dt>awesome</dt><dd></dd>
</dl>
<div class="org-src-container">
<pre class="src src-sh" id="orgeb0ef47">awesome --version
</pre>
</div>

<pre class="example">
awesome v4.0 (Harder, Better, Faster, Stronger)
 • Compiled against Lua 5.1.5 (running with Lua 5.1)
 • D-Bus support: ✔
 • execinfo support: ✔
 • RandR 1.5 support: ✔
 • LGI version: 0.9.1
</pre>


<dl class="org-dl">
<dt>emacs</dt><dd></dd>
</dl>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga07a0c2">(emacs-version)
</pre>
</div>

<pre class="example">
"GNU Emacs 25.1.1 (x86_64-pc-linux-gnu, GTK+ Version 3.22.5)
 of 2016-12-31, modified by Debian"
</pre>


<dl class="org-dl">
<dt>org-mode</dt><dd></dd>
</dl>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org8cd09d7">(replace-regexp-in-string <span style="color: #8b2252;">"@.*)"</span> <span style="color: #8b2252;">"@ ... )"</span> (org-version nil t))
</pre>
</div>

<pre class="example">
"Org mode version 9.0.4 (release_9.0.4-270-ga10ddb @ ... )"
</pre>


<p>
Most of the code in this configuration comes from the default <code>rc.lua</code> delivered
with awesome-wm.  On my system, it is located under <code>/etc/xdg/awesome/rc.lua</code>.
</p>

<p>
Tangling this org file produces several lua files.  The main configuration is
contained in the <code>rc.lua</code> file (widgets, keybindings), and code for modules is
tangled to separate files.  To disable a component of this configuration, the
corresponding code block must be skipped during tangling.  To disable tangling
of an individual block, the preferred way is to add the <code>header-args</code> property
on the parent heading:
</p>

<div class="org-src-container">
<pre class="src src-org" id="orgd8e5c89"><span style="color: #a0522d;">** Disabled heading</span>
<span style="color: #a020f0;">   :PROPERTIES:</span>
   <span style="color: #a020f0;">:header-args+:</span> :tangle no
<span style="color: #a020f0;">   :END:</span>
</pre>
</div>

<p>
This can be done by adding the text manually or by using the <code>org-set-property</code>
function, which is bound to <kbd>C-c</kbd>&nbsp;<kbd>C-x</kbd>&nbsp;<kbd>p</kbd> by default.  Alternatively,
individual source blocks can be disabled by adding <code>:tangle no</code> on the
<code>#+BEGIN_SRC</code> line.
</p>

<p>
It is important to note that when tangling this file, any change made directly
to the lua files will be overridden by the code in this org file.  This can be
prevented by changing the permissions of the tangled files (see
<a href="http://orgmode.org/manual/tangle_002dmode.html">http://orgmode.org/manual/tangle_002dmode.html</a>).  Alternatively, the detangle
functionality in org-mode can be utilized to merge changes from the lua files
back to this org file: simply run <code>org-detangle</code> from the modified lua file and
changes should be merged back.  This requires the <code>#+PROPERTY: header-args
:comments link</code> option which is set at the top of this file.
</p>

<p>
This org file can also be exported to html to produce the documentation.  Note
that exporting this file (e.g. to HTML) executes some bash scripts (for
screenshots for instance), so use at your own risk.
</p>
</div>


<div id="outline-container-orgf8f9193" class="outline-3">
<h3 id="orgf8f9193">Requirements</h3>
<div class="outline-text-3" id="text-orgf8f9193">
<ul class="org-ul">
<li>Since the configuration is written in an org-mode file, emacs is required to
extract (tangle) the lua code.  A makefile is provided to run the tangle
operation on this file from the command line (the <a href="https://www.gnu.org/software/make">GNU make</a> utility is required
to use the makefile).  It also requires a recent version of org-mode, and
basic emacs modes for lua and python.</li>

<li>The music player widget requires <a href="https://cmus.github.io/">cmus</a> and uses <a href="http://eyed3.nicfit.net/">eyeD3</a> to extract cover art from
audio files.</li>

<li>The bash script used to display the volume through OSD requires the <code>aosd_cat</code>
command.</li>

<li>The memory monitor widget uses the <code>htop</code> command to display a summary of the
processes when moving the mouse over the widget.  This can be replaced by the
<code>top</code> command for instance.</li>

<li>The calendar widget lists events for each day using <a href="https://github.com/pimutils/khal">khal</a>.  I have it
synchronized to my (<a href="http://owncloud.org">owncloud</a>) CalDAV server using <a href="https://github.com/pimutils/vdirsyncer">vdirsyncer</a>.</li>

<li>The mail widget relies on <a href="https://www.djcbsoftware.nl/code/mu/">mu</a> to find emails to show in the popup notification
(emails are stored in maildir format).  This could be replaced by some other
script for IMAP emails.</li>

<li>The news widget requires a <a href="https://tt-rss.org/">Tiny Tiny RSS</a> instance, and the <a href="https://github.com/Vassius/ttrss-pythom">ttrss-python</a>
package; a wrapper python script to get news feeds is provided in this file.</li>

<li>If using the <a href="#global_prompt">global prompt module</a>, some modes include additional dependencies:

<ul class="org-ul">
<li>The music prompt requires <a href="http://www.mplayerhq.hu/design7/news.html">mplayer</a> and uses the <code>locate</code> program (part of the
<a href="https://www.gnu.org/software/findutils/"><code>findutils</code></a> package) to find audio files.</li>

<li>The <a href="#global_prompt_calc">calc</a> prompt requires a python script to perform calculations from
strings.  This script is provided in this org file.</li>
</ul></li>

<li>The transparency effect on focus (see the <a href="#effects_transparency">transparency</a> section) requires a
compositor, such as <code>xcompmgr</code>.</li>

<li>The password insertion feature (see the <a href="#pass_manager">corresponding section</a>) requires the
<a href="https://www.passwordstore.org/">pass</a> utility, <a href="https://tools.suckless.org/dmenu/">dmenu</a> and the <code>xclip</code> and <code>xdotool</code> programs.</li>

<li>When generating the HTML documentation (by running <kbd>C-c</kbd>&nbsp;<kbd>C-e</kbd>&nbsp;<kbd>h</kbd>&nbsp;<kbd>h</kbd> on
this buffer), screenshots are taken from the active desktop (assuming
awesome-wm is the running desktop environment).  This requires the <code>scrot</code> and
<a href="http://www.imagemagick.org"><code>imagemagick</code></a> programs.</li>
</ul>
</div>
</div>


<div id="outline-container-org70876dc" class="outline-3">
<h3 id="org70876dc">Makefile</h3>
<div class="outline-text-3" id="text-org70876dc">
<p>
A simple makefile can be used to generate the configuration files (<code>.lua</code>) and
the documentation.  Use <code>make</code> to update the configuration files from the org
source, <code>make doc-html</code> to export the org file into html.  The latex export
(<code>make doc-pdf</code>) is not supported (there is no syntax highlighting support for
lua in the <code>minted</code> package).
</p>

<p>
To get a reproducible <code>make</code> behavior, a minimal emacs initialization file is
provided here:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org3dfb48a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[makefile-init.el]</div>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Assume default folder for emacs packages</span>
(<span style="color: #a020f0;">let</span> ((default-directory  <span style="color: #8b2252;">"~/.emacs.d/elpa/"</span>))
  (normal-top-level-add-subdirs-to-load-path))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Explicitly load required packages</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">lua-mode</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">python-mode</span>)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Set source block languages</span>
(org-babel-do-load-languages
 'org-babel-load-languages
 '( (emacs-lisp . t)
    (lua        . t)
    (makefile   . t)
    (python     . t)
    (shell      . t)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Org options</span>
(<span style="color: #a020f0;">setq</span> org-confirm-babel-evaluate nil)
(<span style="color: #a020f0;">setq</span> org-src-fontify-natively t)
(<span style="color: #a020f0;">setq</span> org-src-preserve-indentation t)
(<span style="color: #a020f0;">setq</span> org-edit-src-content-indentation 0)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Credential extraction function (uses auth-source)</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">get-ttrss-cred</span> (<span style="color: #228b22;">&amp;optional</span> url)
  (<span style="color: #a020f0;">let</span> ((ttrss-url (<span style="color: #a020f0;">if</span> url url <span style="color: #8b2252;">"127.0.0.1:81/tt-rss"</span>))
        (ttrss-user nil)
        <span style="color: #b22222;">;;</span><span style="color: #b22222;">(ttrss-user "myuser")</span>
        (ttrss-pass nil)
        <span style="color: #b22222;">;;</span><span style="color: #b22222;">(ttrss-pass "mypassword")</span>
        )
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">auth-source</span>)
      (<span style="color: #a020f0;">let</span> ((auth (nth 0 (auth-source-search <span style="color: #483d8b;">:host</span> ttrss-url
                                             <span style="color: #483d8b;">:requires</span> '(user secret)))))
        (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (plist-get auth <span style="color: #483d8b;">:secret</span>) (plist-get auth <span style="color: #483d8b;">:user</span>))
          (<span style="color: #a020f0;">setq</span> ttrss-pass (funcall (plist-get auth <span style="color: #483d8b;">:secret</span>))
                ttrss-user (plist-get auth <span style="color: #483d8b;">:user</span>)))))
    `(,ttrss-url ,ttrss-user ,ttrss-pass)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Define credential extraction function before tangling</span>
(add-hook 'org-babel-pre-tangle-hook 'get-ttrss-cred)
</pre>
</div>

<p>
The makefile is relatively simple, one trick is to not use emacs in &#x2013;batch mode
when generating the HTML documentation, since it seems to interact with syntax
highlighting.
</p>

<div class="org-src-container">
<pre class="src src-makefile" id="orgc3fd478"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[makefile]</div>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Makefile for org file, with targets:</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">all: Tangle source blocks</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">doc-html: Export org-file to html</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">doc-pdf: Export org-file to pdf</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Input org file</span>
<span style="color: #a0522d;">input</span> = awesome-wm
<span style="color: #a0522d;">src</span> = $(<span style="color: #a0522d;">input</span>).org

<span style="color: #b22222;"># </span><span style="color: #b22222;">Emacs command</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Note: I can't seem to get syntax highlighting in the exported html when using</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">--batch</span>
<span style="color: #a0522d;">emacs</span> = emacs --batch --no-init-file --load makefile-init.el --find-file $(<span style="color: #a0522d;">src</span>)
<span style="color: #a0522d;">emacs_batch</span> = ${<span style="color: #a0522d;">emacs</span>} --batch

<span style="color: #b22222;"># </span><span style="color: #b22222;">Delete command</span>
<span style="color: #a0522d;">RM</span> = rm -rf

<span style="color: #0000ff;">all</span>:
    $(<span style="color: #a0522d;">emacs_batch</span>) --funcall org-babel-tangle --kill

<span style="color: #0000ff;">doc-html</span>:
    $(<span style="color: #a0522d;">emacs</span>) --funcall org-html-export-to-html --kill

<span style="color: #0000ff;">doc-pdf</span>:
    $(<span style="color: #a0522d;">emacs</span>) --funcall org-latex-export-to-pdf --kill

<span style="color: #0000ff;">clean</span>:
    $(<span style="color: #a0522d;">RM</span>) $(<span style="color: #a0522d;">input</span>).{html,tex,log,aux,dvi,pdf,ps,out,toc}
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orge9e57b1" class="outline-2">
<h2 id="orge9e57b1">Imports </h2>
<div class="outline-text-2" id="text-orge9e57b1">
<p>
The first section of the <code>rc.lua</code> file contains library imports used throughout
the file.
</p>
</div>


<div id="outline-container-orgc6486b5" class="outline-3">
<h3 id="orgc6486b5">Standard awesome imports</h3>
<div class="outline-text-3" id="text-orgc6486b5">
<p>
Standard modules listed here should come installed with awesome.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org34589ce"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Standard awesome library</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">gears</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"gears"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">awful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">util</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful.util"</span>)
<span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful.autofocus"</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Widget and layout library</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">wibox</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"wibox"</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Theme handling library</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">beautiful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"beautiful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">vicious</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"vicious"</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Notification library</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">naughty</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"naughty"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">menubar</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"menubar"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">hotkeys_popup</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful.hotkeys_popup"</span>).widget
</pre>
</div>
</div>
</div>


<div id="outline-container-org3e853bb" class="outline-3">
<h3 id="awesome_paths">Paths</h3>
<div class="outline-text-3" id="text-awesome_paths">
<p>
Paths are stored in the <code>awesome_paths</code> object which is later used to search for
launchbar programs, theme selection, maildir, icons, etc.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgacdc935"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Define global folders</span>
awesome_paths = {}

<span style="color: #b22222;">-- </span><span style="color: #b22222;">config_dir is used for local theme customizations and shortcut search</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">(launchbar module)</span>
awesome_paths.config_dir = awful.util.getdir(<span style="color: #8b2252;">"config"</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">system_dir is used for themes</span>
awesome_paths.system_dir = <span style="color: #8b2252;">"/usr/share/awesome/"</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">home_dir is used to locate the maildir, start dropbox</span>
awesome_paths.home_dir = <span style="color: #483d8b;">os</span>.<span style="color: #483d8b;">getenv</span>(<span style="color: #8b2252;">"HOME"</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Icon paths</span>
awesome_paths.icon_dir = <span style="color: #8b2252;">"/usr/share/icons/oxygen/base/16x16/"</span>
awesome_paths.iconapps_dir = { awesome_paths.icon_dir,
                               <span style="color: #8b2252;">"/usr/share/icons/hicolor/16x16/"</span>,
                               <span style="color: #8b2252;">"/usr/share/icons/gnome/16x16/"</span>,
                               <span style="color: #8b2252;">"/usr/share/icons/Tango/16x16/"</span>,
                               <span style="color: #8b2252;">"/usr/share/pixmaps/"</span> }
</pre>
</div>
</div>
</div>


<div id="outline-container-org8e1084f" class="outline-3">
<h3 id="org8e1084f">Debian specific</h3>
<div class="outline-text-3" id="text-org8e1084f">
<p>
Use the freedesktop menu, which lists most applications in categories, similar
to main menus in other desktop environments.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgdf8abfb"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Load Debian menu entries</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">freedesktop</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"freedesktop"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgaf7c530" class="outline-3">
<h3 id="orgaf7c530">Custom modules</h3>
<div class="outline-text-3" id="text-orgaf7c530">
<p>
The following imports are for custom modules implemented in this file.  The
filenames should match the names used with the <code>require</code> command.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org093800e"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Custom libraries</span>
</pre>
</div>
</div>


<div id="outline-container-org208c593" class="outline-4">
<h4 id="org208c593">launchbar module</h4>
<div class="outline-text-4" id="text-org208c593">
<p>
This module creates the launchers in the wibox from <code>.desktop</code> files (see the
<a href="#launchbar">Launchbar</a> section).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orge4111f7"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">local</span> <span style="color: #a0522d;">launchbar</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">'launchbar'</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-org4933740" class="outline-4">
<h4 id="org4933740">cmus module</h4>
<div class="outline-text-4" id="text-org4933740">
<p>
Control and display information from the <a href="https://cmus.github.io/">cmus</a> music player (see the <a href="#cmus">cmus</a>
section).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgdb46b67"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">local</span> <span style="color: #a0522d;">cmus</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"cmus"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-org3872f35" class="outline-4">
<h4 id="org3872f35">ttrss module</h4>
<div class="outline-text-4" id="text-org3872f35">
<p>
View RSS feed updates from <a href="https://tt-rss.org/">Tiny Tiny RSS</a> instance (see the <a href="#ttrss">Tiny Tiny RSS</a>
section).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgf798866"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">local</span> <span style="color: #a0522d;">ttrss</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"ttrss"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-org48da9ca" class="outline-4">
<h4 id="org48da9ca">themes module</h4>
<div class="outline-text-4" id="text-org48da9ca">
<p>
Manage desktop themes (see the <a href="#theme">Theme</a> section).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org56f01a3"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">local</span> <span style="color: #a0522d;">theme_customization</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"theme_customization"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-org565d93c" class="outline-4">
<h4 id="org565d93c"><code>icon_finder</code> module</h4>
<div class="outline-text-4" id="text-org565d93c">
<p>
Helper utility to find program icons in system paths (see the <a href="#icon_finder">Icon finder</a>
section).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org1a3e195"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">local</span> <span style="color: #a0522d;">icon_finder</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"icon_finder"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-org12d18db" class="outline-4">
<h4 id="org12d18db"><code>global_prompt</code> module</h4>
<div class="outline-text-4" id="text-org12d18db">
<p>
Generic command launcher (gnome-do style) (see the <a href="#global_prompt">Global prompt</a> section).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org840a33b"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">local</span> <span style="color: #a0522d;">global_prompt</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"global_prompt"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-org500fb73" class="outline-4">
<h4 id="org500fb73"><code>my_utility</code> module</h4>
<div class="outline-text-4" id="text-org500fb73">
<p>
Some utility functions (see the <a href="#my_utility">Utilities</a> section).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgb04edd5"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">local</span> <span style="color: #a0522d;">my_utility</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">'my_utility'</span>)
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org964bf14" class="outline-2">
<h2 id="org964bf14">Basic setup </h2>
<div class="outline-text-2" id="text-org964bf14">
<p>
This section contains general settings for the different desktop components:
search paths, default applications, main key modifiers and some boiler plate
code for error handling.
</p>
</div>


<div id="outline-container-orgea39779" class="outline-3">
<h3 id="default_programs">Default programs</h3>
<div class="outline-text-3" id="text-default_programs">
<p>
Define default programs.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orge2c6e60"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Define default programs</span>
terminal = <span style="color: #8b2252;">"x-terminal-emulator"</span>
termapps = <span style="color: #8b2252;">"urxvt"</span> <span style="color: #b22222;">-- </span><span style="color: #b22222;">"terminator"</span>
editor = <span style="color: #483d8b;">os</span>.<span style="color: #483d8b;">getenv</span>(<span style="color: #8b2252;">"EDITOR"</span>) <span style="color: #a020f0;">or</span> <span style="color: #8b2252;">"editor"</span>
editor_cmd = terminal .. <span style="color: #8b2252;">" -e "</span> .. editor
internet_browser = <span style="color: #8b2252;">"x-www-browser"</span>
mail_reader = <span style="color: #8b2252;">"thunderbird"</span>
emacs = <span style="color: #8b2252;">"emacs"</span>
explorer = <span style="color: #8b2252;">"xdg-open"</span>
mixer = <span style="color: #8b2252;">"pavucontrol"</span>
music_player = <span style="color: #8b2252;">"mplayer"</span>
passmenu = <span style="color: #8b2252;">"bash "</span> .. awesome_paths.config_dir .. <span style="color: #8b2252;">"/scripts/passmenu.sh --type"</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org3af2b19" class="outline-3">
<h3 id="icons">Icons</h3>
<div class="outline-text-3" id="text-icons">
<p>
Create an instance of the <a href="#icon_finder">Icon finder</a> module.  It is used throughout the
configuration to find icons for programs and session operations (<a href="#shutdown">Shutdown menu</a>).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org6c41a3e"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{ Icon finder</span>
myiconfinder = icon_finder.new(awesome_paths.iconapps_dir)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org0d01f36" class="outline-3">
<h3 id="org0d01f36">Error handling</h3>
<div class="outline-text-3" id="text-org0d01f36">
<p>
This is default code; it creates notifications when errors occur, which is
helpful to debug issues in <code>rc.lua</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgc94f6f3"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Error handling</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Check if awesome encountered an error during startup and fell back to</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">another config (This code will only ever execute for the fallback config)</span>
<span style="color: #a020f0;">if</span> awesome.startup_errors <span style="color: #a020f0;">then</span>
    naughty.notify({ preset = naughty.config.presets.critical,
                     title = <span style="color: #8b2252;">"Oops, there were errors during startup!"</span>,
                     text = awesome.startup_errors })
<span style="color: #a020f0;">end</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Handle runtime errors after startup</span>
<span style="color: #a020f0;">do</span>
    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">in_error</span> = <span style="color: #008b8b;">false</span>
    awesome.connect_signal(<span style="color: #8b2252;">"debug::error"</span>, <span style="color: #a020f0;">function</span> (err)
        <span style="color: #b22222;">-- </span><span style="color: #b22222;">Make sure we don't go into an endless error loop</span>
        <span style="color: #a020f0;">if</span> in_error <span style="color: #a020f0;">then</span> <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">end</span>
        in_error = <span style="color: #008b8b;">true</span>

        naughty.notify({ preset = naughty.config.presets.critical,
                         title = <span style="color: #8b2252;">"Oops, an error happened!"</span>,
                         text = <span style="color: #483d8b;">tostring</span>(err) })
        in_error = <span style="color: #008b8b;">false</span>
    <span style="color: #a020f0;">end</span>)
<span style="color: #a020f0;">end</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Helper functions</span>
<span style="color: #a020f0;">local</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">client_menu_toggle_fn</span>()
    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">instance</span> = <span style="color: #008b8b;">nil</span>

    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">function</span> ()
        <span style="color: #a020f0;">if</span> instance <span style="color: #a020f0;">and</span> instance.wibox.visible <span style="color: #a020f0;">then</span>
            instance:hide()
            instance = <span style="color: #008b8b;">nil</span>
        <span style="color: #a020f0;">else</span>
            instance = awful.menu.clients({ theme = { width = 250 } })
        <span style="color: #a020f0;">end</span>
    <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org664f042" class="outline-3">
<h3 id="org664f042">Modkey setting</h3>
<div class="outline-text-3" id="text-org664f042">
<p>
The modkey is the main key modifier for special bindings: use <code>Super</code> as main
modifier.  Also set <code>Alt</code> key.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org2503adb"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Default modkey.</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Usually, Mod4 is the key with a logo between Control and Alt.</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">If you do not like this or do not have such a key,</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">I suggest you to remap Mod4 to another key using xmodmap or other tools.</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">However, you can use another modifier like Mod1, but it may interact with</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">others.</span>
modkey = <span style="color: #8b2252;">"Mod4"</span>
altkey = <span style="color: #8b2252;">"Mod1"</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org3f8ca39" class="outline-2">
<h2 id="org3f8ca39">Desktop </h2>
<div class="outline-text-2" id="text-org3f8ca39">
<p>
This configuration is used with a dual screen system, where the widgets are
identical on both screens (except for the systray, which can only be added to
one screen).  An example of wibox produced by this file is shown on
Fig&nbsp;<a href="#orgdf23b9a">2</a>.
</p>

<p>
The following bash snippet produces the screenshot shown on
Fig.&nbsp;<a href="#orgdf23b9a">2</a> on export (the result is cached, so it is not
re-generated if the content of the code block is not changed).
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org8cb9171">
<span style="color: #b22222;"># </span><span style="color: #b22222;">Could get these from xrandr</span>
<span style="color: #a0522d;">res_x</span>=1920
<span style="color: #a0522d;">res_y</span>=1080
<span style="color: #a0522d;">screen_idx</span>=0

<span style="color: #a0522d;">width</span>=$(( $<span style="color: #a0522d;">res_x</span> / 2 ))
<span style="color: #a0522d;">height</span>=25
<span style="color: #a0522d;">start_x</span>=$(( $<span style="color: #a0522d;">screen_idx</span> * $<span style="color: #a0522d;">res_x</span> ))
<span style="color: #a0522d;">half_x</span>=$(( $<span style="color: #a0522d;">start_x</span> + $<span style="color: #a0522d;">width</span> ))

scrot desktop.png
convert desktop.png -crop ${<span style="color: #a0522d;">width</span>}x${<span style="color: #a0522d;">height</span>}+${<span style="color: #a0522d;">start_x</span>}+0 desktop-wibox-l.png
convert desktop.png -crop ${<span style="color: #a0522d;">width</span>}x${<span style="color: #a0522d;">height</span>}+${<span style="color: #a0522d;">half_x</span>}+0 desktop-wibox-r.png
convert desktop-wibox-l.png desktop-wibox-r.png -append desktop-wibox.png
rm desktop.png desktop-wibox-l.png desktop-wibox-r.png -rf
</pre>
</div>




<div id="orgdf23b9a" class="figure">
<p><a href="../images/2016-10-05-Awesome-wm_configuration/desktop-wibox.png" width="100%"><img src="../images/2016-10-05-Awesome-wm_configuration/desktop-wibox.png" alt="desktop-wibox.png" width="100%"></a>
</p>
<p><span class="figure-number">Figure 2: </span>Main wibox (split into two rows for display) with widgets (from left to right): <a href="#main_menu">awesome menu</a>, <a href="#tags">tags</a>, <a href="#launchbar">launchbar</a>, tasklist, <a href="#cmus">cmus</a>, <a href="#email">mail</a>, <a href="#ttrss">ttrss</a>, <a href="#memory">memory</a>, <a href="#volume">volume</a>, systray, <a href="#layouts">layout</a>, <a href="#calendar">date + calendar</a>, <a href="#shutdown">shutdown menu</a>.</p>
</div>
</div>



<div id="outline-container-org3ff5643" class="outline-3">
<h3 id="layouts">Layouts</h3>
<div class="outline-text-3" id="text-layouts">
<p>
This section defines the layouts for windows, I use the default code, with a few
entries disabled.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgf2c28f7"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Table of layouts to cover with awful.layout.inc, order matters.</span>
awful.layout.layouts =
{
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">awful.layout.suit.tile,</span>
    awful.layout.suit.tile.left,
    awful.layout.suit.tile.bottom,
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">awful.layout.suit.tile.top,</span>
    awful.layout.suit.fair,
    awful.layout.suit.fair.horizontal,
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">awful.layout.suit.spiral,</span>
    awful.layout.suit.spiral.dwindle,
    awful.layout.suit.max,
    awful.layout.suit.max.fullscreen,
    awful.layout.suit.magnifier,
    awful.layout.suit.corner.nw,
    awful.layout.suit.floating
}
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org1b2e628" class="outline-3">
<h3 id="theme">Theme</h3>
<div class="outline-text-3" id="text-theme">
<p>
Themes are handled through the <code>beautiful</code> module, which creates the <code>beautiful</code>
table upon instantiation.  Themes are assumed to be located in sub-folders of
the paths defined by the <code>awesome_paths.themes_system_path</code> and
<code>awesome_paths.themes_custom_path</code> variables.  They are defined by a <code>theme.lua</code>
file (the filename can be customized by modifying
<code>theme_customatization.theme_file</code>) and possibly a <code>custom.lua</code> file (the
filename can be customized by modifying <code>theme_customatization.custom_file</code>).
The <code>theme.lua</code> file fully defines the theme (colors, icons, etc.) and the
<code>custom.lua</code> is used to locally modify theme values.
</p>

<p>
Some of the custom modules used in this configuration rely on an extended
<code>beautiful</code> table.  Any required field that is not in the original <code>beautiful</code>
table <b>must</b> be defined in the <code>themes/custom_defaults.lua</code> file and can be
overridden by individual themes in the <code>custom.lua</code> file.
</p>
</div>


<div id="outline-container-org731e10e" class="outline-4">
<h4 id="org731e10e">Theme management module</h4>
<div class="outline-text-4" id="text-org731e10e">
<p>
The theme module has two main functions:
</p>
<ul class="org-ul">
<li>list the available themes into a theme menu,</li>
<li>define a complete <code>beautiful</code> table for a given theme.</li>
</ul>

<p>
The <code>theme_customatization.set_custom_theme</code> function takes a theme name as
input along with the <a href="#awesome_paths"><code>awesome_paths</code></a> variable.  It searches files named
<code>theme.lua</code> in the custom and system theme paths.  If a theme is found, the
<code>beautiful.init</code> function is called to initialize the <code>beautiful</code> table.  Next,
the <code>custom_defaults.lua</code> file is executed to complete the <code>beautiful</code> variables
with the custom ones required by this configuration.  Finally, the <code>beautiful</code>
table is augmented by inserting fields found in the theme's <code>custom.lua</code> file
(if present).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgd10a13c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[theme_customization.lua]</div>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Theme helper script</span>

<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">dofile</span> = <span style="color: #483d8b;">dofile</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">lfs</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"lfs"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">beautiful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"beautiful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">gears</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"gears"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">awful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">util</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful.util"</span>)

theme_customization = {}
theme_customization.theme_file = <span style="color: #8b2252;">"theme.lua"</span>
theme_customization.custom_file = <span style="color: #8b2252;">"custom.lua"</span>

<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">naughty</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"naughty"</span>)

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">theme_customization.set_custom_theme</span>(theme, awesome_paths)

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Locate theme file</span>
   path_list = {
      awesome_paths.themes_custom_path .. theme,
      awesome_paths.themes_system_path .. theme,
   }
   fname_theme = get_first_found_file(path_list,
                                      theme_customization.theme_file)
   <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> fname_theme <span style="color: #a020f0;">then</span>
      <span style="color: #a020f0;">return</span>
   <span style="color: #a020f0;">end</span>

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Locate customization file</span>
   fname_custom = get_first_found_file(path_list,
                                       theme_customization.custom_file)

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Initialize beautiful theme</span>
   beautiful.init(fname_theme)

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Load default customization (fields required by rc.lua not defined by</span>
   <span style="color: #b22222;">-- </span><span style="color: #b22222;">regular themes)</span>
   fname_custom_defaults = awesome_paths.themes_custom_path
      .. <span style="color: #8b2252;">"/custom_defaults.lua"</span>
   <span style="color: #a020f0;">if</span> util.file_readable(fname_custom_defaults) <span style="color: #a020f0;">then</span>
      <span style="color: #b22222;">-- </span><span style="color: #b22222;">`custom_defaults` table</span>
      custom_defaults = <span style="color: #483d8b;">dofile</span>(fname_custom_defaults)
   <span style="color: #a020f0;">else</span>
      custom_defaults = {}
   <span style="color: #a020f0;">end</span>

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Load theme customization</span>
   <span style="color: #a020f0;">if</span> fname_custom <span style="color: #a020f0;">then</span>
      custom = <span style="color: #483d8b;">dofile</span>(fname_custom) <span style="color: #b22222;">-- </span><span style="color: #b22222;">`custom` table</span>
   <span style="color: #a020f0;">else</span>
      custom = {a=<span style="color: #8b2252;">"b"</span>}
   <span style="color: #a020f0;">end</span>

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Join all tables</span>
   custom_tables = { custom_defaults, custom }
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">t</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(custom_tables) <span style="color: #a020f0;">do</span>
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">key</span>, <span style="color: #a0522d;">value</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">pairs</span>(t) <span style="color: #a020f0;">do</span>
         beautiful[key] = value
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">get_first_found_file</span>(path_list, fname)
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">f</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(path_list) <span style="color: #a020f0;">do</span>
      fname_full = f .. <span style="color: #8b2252;">"/"</span> .. fname
      <span style="color: #a020f0;">if</span> util.file_readable(fname_full) <span style="color: #a020f0;">then</span>
         <span style="color: #a020f0;">return</span> fname_full
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">nil</span>
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">theme_customization.create_themes_menu</span>(awesome_paths)

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">List of search paths</span>
   path_list = {
      awesome_paths.themes_custom_path,
      awesome_paths.themes_system_path,
   }

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Initialize table</span>
   theme_list = {}

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Perform search</span>
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">path</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(path_list) <span style="color: #a020f0;">do</span>
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">fold</span> <span style="color: #a020f0;">in</span> lfs.dir(path) <span style="color: #a020f0;">do</span>
         f_attr = lfs.attributes(path .. <span style="color: #8b2252;">"/"</span> .. fold, <span style="color: #8b2252;">"mode"</span>)
         <span style="color: #a020f0;">if</span> f_attr <span style="color: #a020f0;">and</span> f_attr == <span style="color: #8b2252;">"directory"</span> <span style="color: #a020f0;">and</span>
            fold ~= <span style="color: #8b2252;">"."</span> <span style="color: #a020f0;">and</span> fold ~= <span style="color: #8b2252;">".."</span> <span style="color: #a020f0;">then</span>
            fname_full = path .. <span style="color: #8b2252;">"/"</span> .. fold .. <span style="color: #8b2252;">"/"</span> ..
               theme_customization.theme_file
            <span style="color: #a020f0;">if</span> util.file_readable(fname_full) <span style="color: #a020f0;">then</span>
               <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> theme_list[fold] <span style="color: #a020f0;">then</span>
                  theme_list[fold] = path .. <span style="color: #8b2252;">"/"</span> .. fold .. <span style="color: #8b2252;">"/"</span> ..
                     theme_customization.theme_file
               <span style="color: #a020f0;">end</span>
            <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Create menu</span>
   menuitems = {}
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">theme_name</span>, <span style="color: #a0522d;">theme_file</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">pairs</span>(theme_list) <span style="color: #a020f0;">do</span>
      theme = <span style="color: #008b8b;">nil</span>
      theme = <span style="color: #483d8b;">dofile</span>(theme_file)
      theme_icon = theme.awesome_icon
      theme = <span style="color: #008b8b;">nil</span>
      <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(menuitems, {
         theme_name,
         <span style="color: #a020f0;">function</span> ()
            <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">theme_fname</span> = awesome_paths.themes_custom_path .. <span style="color: #8b2252;">"/theme"</span>
            <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">file</span> = <span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">open</span>(theme_fname, <span style="color: #8b2252;">"w"</span>)
            file:write(theme_name .. <span style="color: #8b2252;">"\n"</span>)
            file:close()
            awesome.restart()
         <span style="color: #a020f0;">end</span>,
         theme_icon })
   <span style="color: #a020f0;">end</span>

   <span style="color: #a020f0;">return</span> menuitems
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">return</span> theme_customization
</pre>
</div>
</div>
</div>


<div id="outline-container-org8bcd7fb" class="outline-4">
<h4 id="org8bcd7fb">The <code>custom_defaults</code> file</h4>
<div class="outline-text-4" id="text-org8bcd7fb">
<p>
The <code>custom_defaults</code> file returns a table with theme parameters required by
modules and absent from the original <code>beautiful</code> table.  For visual consistency,
some of the fields use values from the <code>beautiful</code> table itself.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgaf8eca7"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[themes/custom_defaults.lua]</div>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">beautiful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"beautiful"</span>)

custom_defaults = {}

<span style="color: #b22222;">-- </span><span style="color: #b22222;">mail widget</span>
custom_defaults.mail_fg_urgent = beautiful.fg_urgent
custom_defaults.mail_fg_normal = beautiful.fg_normal
custom_defaults.mail_fg_focus = beautiful.fg_focus

<span style="color: #b22222;">-- </span><span style="color: #b22222;">memory widget</span>
custom_defaults.mem_bg = beautiful.bg_normal

<span style="color: #b22222;">-- </span><span style="color: #b22222;">cmus widget</span>
custom_defaults.cmus_fg = beautiful.fg_normal

<span style="color: #b22222;">-- </span><span style="color: #b22222;">screen highlighter</span>
custom_defaults.screen_highlight_bg_active = beautiful.bg_minimize
custom_defaults.screen_highlight_fg_active = beautiful.fg_minimize
custom_defaults.screen_highlight_bg_inactive = beautiful.bg_normal
custom_defaults.screen_highlight_fg_inactive = beautiful.fg_normal

<span style="color: #a020f0;">return</span> custom_defaults
</pre>
</div>
</div>
</div>


<div id="outline-container-orgb895d17" class="outline-4">
<h4 id="orgb895d17">Theme selection</h4>
<div class="outline-text-4" id="text-orgb895d17">
<p>
In the main <code>rc.lua</code> file, the theme folders are first added to the
<code>awesome_paths</code> table (<code>awesome_paths.themes_system_path</code> and
<code>awesome_paths.themes_custom_path</code>).  Then the theme to load is read from the
<code>themes/theme</code> file.  This file should contain a single line with the name of
the theme to use (see the <a href="#orga3dcdcf">theme definition block</a>).  Note that lines starting
with "#" are ignored (such lines occur when tangling this org-file, to allow
"de-tangling").  Also note that parsing is rudimentary so empty lines may cause
issues.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org4a8ec1f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{ Theme management</span>
awesome_paths.themes_system_path = awesome_paths.system_dir .. <span style="color: #8b2252;">"/themes/"</span>
awesome_paths.themes_custom_path = awesome_paths.config_dir .. <span style="color: #8b2252;">"/themes/"</span>
theme_fname = awesome_paths.themes_custom_path .. <span style="color: #8b2252;">"/theme"</span>
theme_name = <span style="color: #8b2252;">"default"</span>
<span style="color: #a020f0;">if</span> util.file_readable(theme_fname) <span style="color: #a020f0;">then</span>
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">open</span>(theme_fname, <span style="color: #8b2252;">"r"</span>)
   theme_lines = my_utility.lines(f:read(<span style="color: #8b2252;">"*all"</span>))
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">k</span>, <span style="color: #a0522d;">v</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">pairs</span>(theme_lines) <span style="color: #a020f0;">do</span>
      <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">find</span>(v, <span style="color: #8b2252;">"^%s*[^#]"</span>) ~= <span style="color: #008b8b;">nil</span> <span style="color: #a020f0;">then</span>
         theme_name = v:gsub(<span style="color: #8b2252;">"^%s*(.-)%s*$"</span>, <span style="color: #8b2252;">"%1"</span>)
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
   f:close()
<span style="color: #a020f0;">end</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Set themes</span>
theme_customization.set_custom_theme(theme_name, awesome_paths)

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Build theme selection menu</span>
theme_menuitems = theme_customization.create_themes_menu(awesome_paths)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}</span>

<span style="color: #a020f0;">local</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">set_wallpaper</span>(s)
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Wallpaper</span>
    <span style="color: #a020f0;">if</span> beautiful.wallpaper <span style="color: #a020f0;">then</span>
        <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">wallpaper</span> = beautiful.wallpaper
        <span style="color: #b22222;">-- </span><span style="color: #b22222;">If wallpaper is a function, call it with the screen</span>
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">type</span>(wallpaper) == <span style="color: #8b2252;">"function"</span> <span style="color: #a020f0;">then</span>
            wallpaper = wallpaper(s)
        <span style="color: #a020f0;">end</span>
        gears.wallpaper.maximized(wallpaper, s, <span style="color: #008b8b;">true</span>)
    <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Re-set wallpaper when a screen's geometry changes (e.g. different resolution)</span>
screen.connect_signal(<span style="color: #8b2252;">"property::geometry"</span>, set_wallpaper)


awful.screen.connect_for_each_screen(<span style="color: #a020f0;">function</span>(s)
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Wallpaper</span>
    set_wallpaper(s)
<span style="color: #a020f0;">end</span>)
<span style="color: #b22222;">--</span><span style="color: #b22222;">}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org420034e" class="outline-4">
<h4 id="org420034e">Selected theme</h4>
<div class="outline-text-4" id="text-org420034e">
<p>
To change the default theme, change the content of the following <code>themes/theme</code>
file:
</p>

<div class="org-src-container">
<pre class="src src-conf" id="orga3dcdcf"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[themes/theme]</div>
xresources
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org82f364e" class="outline-3">
<h3 id="tags">Tags</h3>
<div class="outline-text-3" id="text-tags">
<p>
Tags are similar to workspaces in other desktop environments.  My configuration
is for my home desktop, which has two screens.  It is only slightly modified
from the default: a few tags are named instead of numbered and the default
layout on some tags is customized.
</p>

<ul class="org-ul">
<li>The first tag on each screen is for email: one for work using thunderbird and
one for my personal email using mu4e (emacs).  These are not started
automatically, I have a <a href="#rules">rule</a> to force thunderbird on the second screen, and I
manually start mu4e on the desired tag.</li>
<li>The second tag on the second screen is used for my resident instances of
<a href="http://newsboat.org/">newsboat</a> (terminal RSS reader) and <a href="https://cmus.github.io/">cmus</a> (terminal music player).  Both
programs are launched on startup (see <a href="#startup_applications">Startup applications</a>) and rules are used
to place them on the right screen and tag (see the <a href="#rules">Rules</a> section).</li>
</ul>

<div class="org-src-container">
<pre class="src src-lua" id="org6e15f67"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Tags</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Define a tag table which hold all screen tags.</span>
awful.screen.connect_for_each_screen(<span style="color: #a020f0;">function</span>(s)

      <span style="color: #b22222;">-- </span><span style="color: #b22222;">Each screen has its own tag table.</span>
      <span style="color: #b22222;">--</span><span style="color: #b22222;">awful.tag({ "@", "2", "3", "4", "5", "6", "7", "8", "9" }, s,</span>
      <span style="color: #b22222;">--   </span><span style="color: #b22222;">awful.layout.layouts[1])</span>

      awful.tag.add(<span style="color: #8b2252;">"@"</span>, { layout = awful.layout.suit.tile.bottom,
                           screen = s })
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">i</span> = 2, 8 <span style="color: #a020f0;">do</span>
         awful.tag.add(i, { layout = awful.layout.suit.tile.left,
                              screen = s })
      <span style="color: #a020f0;">end</span>

      awful.tag.add(<span style="color: #8b2252;">"9"</span>, { layout = awful.layout.suit.tile.floating,
                           screen = s })

      s.tags[1]:view_only()
<span style="color: #a020f0;">end</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-org138b532" class="outline-2">
<h2 id="org138b532">Main bar </h2>
<div class="outline-text-2" id="text-org138b532">
<p>
This section is the main part of the configuration, it defines and configures
the widgets present on the main wibox (Fig.&nbsp;<a href="#orgdf23b9a">2</a>).
</p>

<p>
Note that the widgets defined here must be later added to the wibox, which is
done in the <a href="#wibox">Wibox</a> section.
</p>

<p>
First, we create the simplest widget: a separator used to add visual spacing
between widgets.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgeebf593"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">---- </span><span style="color: #b22222;">{{{ Separators</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">separator</span> = wibox.widget.textbox()
separator:set_markup(<span style="color: #8b2252;">" &lt;span foreground='grey'&gt;&#183;&lt;/span&gt; "</span>)
<span style="color: #b22222;">---- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>


<div id="outline-container-org8d6b7c8" class="outline-3">
<h3 id="launchbar">Launchbar</h3>
<div class="outline-text-3" id="text-launchbar">
<p>
In most desktop environments, application shortcuts are stored in <code>.desktop</code>
files that give the application name, icon, command, etc.  The specification is
available <a href="https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html">here</a>.  The standard <code>awful.widget.launcher</code> module allows to add
<code>.desktop</code> files to a launchbar which can be displayed in a wibox (as shown on
Fig.&nbsp;<a href="#orgdf23b9a">2</a>).
</p>

<p>
A few examples can be found online, most notably:
</p>
<ul class="org-ul">
<li><a href="https://awesome.naquadah.org/wiki/Quick_launch_bar_widget/3.5">The basic quick launch bar</a> requires <code>.desktop</code> files to include a <code>Position</code>
field.  Usual <code>.desktop</code> files do not have this field so this is impractical.</li>
<li><a href="https://gist.github.com/alexander-yakushev/6343832">This script</a> lists all the <code>.desktop</code> files in a given folder and adds them to
the launchbar.  If the position field is missing, it is replaced, and
launchers are added in alphabetical order.</li>
</ul>
</div>


<div id="outline-container-org15a26d6" class="outline-4">
<h4 id="org15a26d6">Module definition</h4>
<div class="outline-text-4" id="text-org15a26d6">
<p>
This version is based on the second code segment, the only difference is that
the Exec entry of the <code>.desktop</code> file is cleaned up from its command line
arguments, such as "%u" for firefox (they seem to cause problems when
launching).  The other addition is the use of the custom <code>icon_finder</code> module
described in the <a href="#icon_finder">Icon finder</a> section.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgc6901c0"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[launchbar.lua]</div>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Quick launchbar widget for Awesome WM</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">http://awesome.naquadah.org/wiki/Quick_launch_bar_widget/3.5</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Put into your awesome/ folder and add the following to rc.lua:</span>
<span style="color: #b22222;">--   </span><span style="color: #b22222;">local launchbar = require('launchbar')</span>
<span style="color: #b22222;">--   </span><span style="color: #b22222;">local mylb = launchbar("/path/to/directory/with/shortcuts")</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Then add mylb to the wibox.</span>

<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">layout</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"wibox.layout"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">beautiful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"beautiful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">launcher</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful.widget.launcher"</span>)

<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">launchbar</span> = {}

<span style="color: #a020f0;">local</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">getValue</span>(t, key)
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">res</span> = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">find</span>(t, key .. <span style="color: #8b2252;">" *= *([^%c]+)%c"</span>)
   <span style="color: #a020f0;">return</span> res
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">launchbar.new</span>(filedir, icon_finder_helper)
   <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> filedir <span style="color: #a020f0;">then</span>
      <span style="color: #483d8b;">error</span>(<span style="color: #8b2252;">"Launchbar: filedir was not specified"</span>)
   <span style="color: #a020f0;">end</span>
   launchbar.icon_dirs = icondir
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">items</span> = {}
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">widget</span> = layout.fixed.horizontal()
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">files</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"ls "</span> .. filedir .. <span style="color: #8b2252;">"*.desktop"</span>, <span style="color: #8b2252;">'r'</span>))
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">f</span> <span style="color: #a020f0;">in</span> files:lines() <span style="color: #a020f0;">do</span>
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">ts</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">open</span>(f))
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">t</span> = ts:read(<span style="color: #8b2252;">"*all"</span>)
      ts:close()
      cmd = getValue(t, <span style="color: #8b2252;">"Exec"</span>)
      cmd = cmd:gsub(<span style="color: #8b2252;">"%%u"</span>, <span style="color: #8b2252;">""</span>)
      cmd = cmd:gsub(<span style="color: #8b2252;">"%%U"</span>, <span style="color: #8b2252;">""</span>)
      cmd = cmd:gsub(<span style="color: #8b2252;">"%%F"</span>, <span style="color: #8b2252;">""</span>)
      <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(
         items, {
            image = icon_finder_helper:find(getValue(t,<span style="color: #8b2252;">"Icon"</span>)),
            command = cmd,
            position = <span style="color: #483d8b;">tonumber</span>(getValue(t,<span style="color: #8b2252;">"Position"</span>)) <span style="color: #a020f0;">or</span> 255 })
   <span style="color: #a020f0;">end</span>
   files:close()
   <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">sort</span>(items, <span style="color: #a020f0;">function</span>(a,b) <span style="color: #a020f0;">return</span> a.position &lt; b.position <span style="color: #a020f0;">end</span>)
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">v</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(items) <span style="color: #a020f0;">do</span>
      <span style="color: #a020f0;">if</span> v.image <span style="color: #a020f0;">then</span>
         widget:add(launcher(v))
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">return</span> widget
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">return</span> <span style="color: #483d8b;">setmetatable</span>(launchbar, { __call = <span style="color: #a020f0;">function</span>(_, ...)
                                    <span style="color: #a020f0;">return</span> launchbar.new(...) <span style="color: #a020f0;">end</span> })
</pre>
</div>
</div>
</div>


<div id="outline-container-org841589e" class="outline-4">
<h4 id="org841589e">Instantiation</h4>
<div class="outline-text-4" id="text-org841589e">
<p>
The simplest way to use the module is to symlink <code>.desktop</code> files into a folder
and instantiate the launchbar object with the same folder as a parameter.  My
shortcuts are in a subfolder of the awesome config folder called <code>shortcuts</code>.
</p>

<p>
Note that the creation function also takes the icon finder instance as a
parameter (created in the <a href="#icons">Icons</a> section).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org0274caf"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{ Launchbar</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">mylaunchbar</span> = launchbar.new(awesome_paths.config_dir .. <span style="color: #8b2252;">"/shortcuts/"</span>,
                                  myiconfinder)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org3554ec0" class="outline-3">
<h3 id="shutdown">Shutdown menu</h3>
<div class="outline-text-3" id="text-shutdown">
<p>
By default, awesome has no menu to restart or shutdown the computer, just an
option to logout.  The following adds a menu with common shutdown, restart,
logout and lock items.  There is no support for hibernation but it should be
easy to add.
</p>

<p>
The shutdown and restart commands typically require the root password so the
sudoers file must be edited to allow the desired user to run the <code>shutdown</code>
command without password.  On Debian, the sudoers file can be edited by running
<code>sudo visudo</code> from a terminal.  My sudoers file contains the following:
</p>

<div class="org-src-container">
<pre class="src src-conf" id="orgaa1a9bf"><span style="color: #a0522d;">username ALL</span>=SHUTDOWN
<span style="color: #a0522d;">username ALL</span>=NOPASSWD: SHUTDOWN
</pre>
</div>

<p>
The menu is created as follows.  First, the icons are obtained from the <a href="#icons">icon
finder instance</a>, then the menu is built, wrapping commands with the
<a href="#my_utility_confirm"><code>confirm_action</code></a> function, which prompts for confirmation.  Note that the
filenames used to recover icons are the ones used in common themes (icons are in
found in folders set in the <code>awesome_paths</code> variable).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgf5a5211"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{ Shutdown menu</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Session management icons</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">icon_shutdown</span> = myiconfinder:find(<span style="color: #8b2252;">"system-shutdown.png"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">icon_restart</span> = myiconfinder:find(<span style="color: #8b2252;">"system-reboot.png"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">icon_logout</span> = myiconfinder:find(<span style="color: #8b2252;">"system-log-out.png"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">icon_lock</span> = myiconfinder:find(<span style="color: #8b2252;">"system-lock-screen.png"</span>)

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Shutdown menu</span>
myleave_menuitems = {
   { <span style="color: #8b2252;">"shutdown"</span>,
     <span style="color: #a020f0;">function</span>() my_utility.confirm_action(
           <span style="color: #a020f0;">function</span>()
              awful.spawn(<span style="color: #8b2252;">'sudo /sbin/shutdown -h now'</span>)
           <span style="color: #a020f0;">end</span>, <span style="color: #8b2252;">"Shutdown"</span>)
     <span style="color: #a020f0;">end</span>, icon_shutdown },
   { <span style="color: #8b2252;">"restart"</span>,
     <span style="color: #a020f0;">function</span>() my_utility.confirm_action(
           <span style="color: #a020f0;">function</span>()
              awful.spawn(<span style="color: #8b2252;">'sudo /sbin/shutdown -r now'</span>)
           <span style="color: #a020f0;">end</span>, <span style="color: #8b2252;">"Restart"</span>)
     <span style="color: #a020f0;">end</span>,
     icon_restart },
   { <span style="color: #8b2252;">"logout"</span>,
     <span style="color: #a020f0;">function</span>() my_utility.confirm_action(
           <span style="color: #a020f0;">function</span>()
              awesome.quit()
           <span style="color: #a020f0;">end</span>, <span style="color: #8b2252;">"Logout"</span>)
     <span style="color: #a020f0;">end</span>,
     icon_logout },
   { <span style="color: #8b2252;">"lock"</span>,
     <span style="color: #a020f0;">function</span>() my_utility.confirm_action(
           <span style="color: #a020f0;">function</span>()
              awful.spawn(<span style="color: #8b2252;">"xscreensaver-command -lock"</span>)
           <span style="color: #a020f0;">end</span>, <span style="color: #8b2252;">"Lock"</span>)
     <span style="color: #a020f0;">end</span>,
     icon_lock }
}
myleave_launcher = awful.widget.launcher({
      image = icon_shutdown,
      menu = awful.menu({ items = myleave_menuitems}) })
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orge5067f7" class="outline-3">
<h3 id="main_menu">Main menu</h3>
<div class="outline-text-3" id="text-main_menu">
<p>
The main menu is based on the default configuration with a few additions:
</p>
<ul class="org-ul">
<li>Selected applications are added to an "Apps" submenu</li>
<li>A theme selection menu</li>
<li>A "Leave" menu to control the session (shutdown, restart, lock)</li>
</ul>

<p>
The icons are found using the <a href="#icon_finder">icon finder</a> module.
</p>

<p>
This code block also configures the menubar, which can be used to quickly find
and launch applications by typing part of their name.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgd5f1f1f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Menu</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Create a laucher widget and a main menu</span>
myawesomemenu = {
   { <span style="color: #8b2252;">"hotkeys"</span>, <span style="color: #a020f0;">function</span>() <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">false</span>, hotkeys_popup.show_help <span style="color: #a020f0;">end</span>},
   { <span style="color: #8b2252;">"manual"</span>, terminal .. <span style="color: #8b2252;">" -e man awesome"</span> },
   { <span style="color: #8b2252;">"edit config"</span>, emacs .. <span style="color: #8b2252;">" "</span> .. awesome.conffile },
   { <span style="color: #8b2252;">"restart"</span>, awesome.restart },
   { <span style="color: #8b2252;">"quit"</span>, <span style="color: #a020f0;">function</span>() my_utility.confirm_action(
           <span style="color: #a020f0;">function</span>()
              awesome.quit()
           <span style="color: #a020f0;">end</span>, <span style="color: #8b2252;">"Logout"</span>)
   <span style="color: #a020f0;">end</span> }
}

mymainmenu = freedesktop.menu.build({
      before = { { <span style="color: #8b2252;">"awesome"</span>, myawesomemenu, beautiful.awesome_icon },
         { <span style="color: #8b2252;">"Terminal"</span>, terminal, myiconfinder:find(<span style="color: #8b2252;">"terminal"</span>) },
         { <span style="color: #8b2252;">"Apps"</span>,
           {
              { <span style="color: #8b2252;">"cmus"</span>, termapps .. <span style="color: #8b2252;">" -c cmus -e cmus"</span>,
                myiconfinder:find(<span style="color: #8b2252;">"multimedia-player"</span>) },
              { <span style="color: #8b2252;">"newsboat"</span>, termapps .. <span style="color: #8b2252;">" -c newsboat -e newsboat"</span>,
                myiconfinder:find(<span style="color: #8b2252;">"internet-news-reader"</span>) },
              { <span style="color: #8b2252;">"Internet"</span>, internet_browser,
                myiconfinder:find(<span style="color: #8b2252;">"web-browser"</span>) },
              { <span style="color: #8b2252;">"Mail reader"</span>, mail_reader,
                myiconfinder:find(<span style="color: #8b2252;">"internet-mail"</span>) },
              { <span style="color: #8b2252;">"emacs"</span>, emacs, myiconfinder:find(emacs) }
           }
         }
      },
      after = { { <span style="color: #8b2252;">"Themes"</span>, theme_menuitems },
         { <span style="color: #8b2252;">"Leave"</span>, myleave_menuitems, icon_shutdown }
      }
})

mylauncher = awful.widget.launcher({ image = beautiful.awesome_icon,
                                     menu = mymainmenu })
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Menubar configuration</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Set the terminal for applications that require it</span>
menubar.utils.terminal = terminal

<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orga5b73a7" class="outline-3">
<h3 id="volume">Volume widget</h3>
<div class="outline-text-3" id="text-volume">
<p>
The volume widget user the <code>wibox.container.radialprofressbar</code> widget defined in
awesome-wm 4 versions.  Volume control commands are also supported: a left click
on the widget toggles the mute option, a right click on the widget spawns a menu
with a single entry linking to the mixer program (see <a href="#default_programs">Default programs</a>).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgb9b24fa"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Volume</span>

volume_text = wibox.widget.textbox()
volume_text:set_text(<span style="color: #8b2252;">""</span>)

volume_master = wibox.container.radialprogressbar()
volume_master.border_color = <span style="color: #008b8b;">nil</span>
volume_master.min_value = 0
volume_master.max_value = 100
volume_master.forced_width = 20
volume_master.border_width = 3
volume_master.widget = volume_text

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">update_volume_widget</span>()
   volume_char_list = {<span style="color: #8b2252;">"&#128263;"</span>, <span style="color: #8b2252;">"&#128264;"</span>, <span style="color: #8b2252;">"&#128265;"</span>}

   awful.spawn.easy_async(
      awesome_paths.config_dir .. <span style="color: #8b2252;">"/scripts/osdvol.sh get"</span>,
      <span style="color: #a020f0;">function</span> (stdout, stderr, reason, exitcode)
         <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">k</span>, <span style="color: #a0522d;">v</span> <span style="color: #a020f0;">in</span> stdout:gmatch(<span style="color: #8b2252;">"([0-9]+)%%.*[[]([onf]+)[]].*"</span>) <span style="color: #a020f0;">do</span>
            <span style="color: #b22222;">-- </span><span style="color: #b22222;">There should be only one match</span>
            vol_str = k
            ismute = v == <span style="color: #8b2252;">"off"</span>
         <span style="color: #a020f0;">end</span>
         vol = <span style="color: #483d8b;">tonumber</span>(vol_str)
         volume_master.value = vol
         <span style="color: #a020f0;">if</span> ismute <span style="color: #a020f0;">then</span>
            vol_char = volume_char_list[1]
         <span style="color: #a020f0;">else</span>
            bin = <span style="color: #483d8b;">math</span>.<span style="color: #483d8b;">floor</span>(vol / (100 / (#volume_char_list - 1)))
            <span style="color: #a020f0;">if</span> bin &lt; 0 <span style="color: #a020f0;">then</span>
               bin = 0
            <span style="color: #a020f0;">elseif</span> bin &gt;= #volume_char_list - 1 <span style="color: #a020f0;">then</span>
               bin = #volume_char_list - 2
            <span style="color: #a020f0;">end</span>
            vol_char = volume_char_list[bin + 2]
         <span style="color: #a020f0;">end</span>

         volume_text:set_text(vol_char)
      <span style="color: #a020f0;">end</span>
   )
<span style="color: #a020f0;">end</span>

volume_menu_items = {
   { <span style="color: #8b2252;">"mixer"</span>, <span style="color: #a020f0;">function</span> () run_or_raise(mixer, { instance = <span style="color: #8b2252;">"mixer"</span> }) <span style="color: #a020f0;">end</span> }
}
volume_menu = awful.menu.new( { items = volume_menu_items } )
volume_buttons = awful.util.table.join(
   awful.button({ }, 1,
      <span style="color: #a020f0;">function</span> ()
         awful.spawn(awesome_paths.config_dir ..
                        <span style="color: #8b2252;">"/scripts/osdvol.sh mute"</span>)
         update_volume_widget()
   <span style="color: #a020f0;">end</span>),
   awful.button({ }, 4,
      <span style="color: #a020f0;">function</span> ()
         awful.spawn(awesome_paths.config_dir ..
                        <span style="color: #8b2252;">"/scripts/osdvol.sh volup"</span>)
         update_volume_widget()
   <span style="color: #a020f0;">end</span>),
   awful.button({ }, 5,
      <span style="color: #a020f0;">function</span> ()
         awful.spawn(awesome_paths.config_dir ..
                        <span style="color: #8b2252;">"/scripts/osdvol.sh voldown"</span>)
         update_volume_widget()
   <span style="color: #a020f0;">end</span>),
   awful.button({ }, 3,
      <span style="color: #a020f0;">function</span> ()
         volume_menu:toggle()
         update_volume_widget()
   <span style="color: #a020f0;">end</span>)
)
volume_master:buttons(volume_buttons)
update_volume_widget()
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>


<div id="outline-container-org5a4d17b" class="outline-4">
<h4 id="org5a4d17b">OSD volume</h4>
<div class="outline-text-4" id="text-org5a4d17b">
<p>
The volume widget relies on a bash script to control the volume (using the
<code>amixer</code> command).  It also displays the volume on the screen via OSD (using the
<code>aosd_cat</code> command.  The bash script is bound to volume keys on the keyboard
(see <a href="#bindings_keyboard">Keyboard bindings</a>).
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org44f37e0"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[scripts/osdvol.sh]</div><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>


<span style="color: #b22222;"># </span><span style="color: #b22222;">constants</span>
<span style="color: #a0522d;">FONT</span>=<span style="color: #8b2252;">'-*-fixed-*-*-*-*-100-*-*-*-*-*-*-*'</span>
<span style="color: #a0522d;">COLOR</span>=<span style="color: #8b2252;">"green"</span>
<span style="color: #a0522d;">DELAY</span>=4
<span style="color: #a0522d;">POS</span>=<span style="color: #8b2252;">"bottom"</span>
<span style="color: #a0522d;">ALIGN</span>=<span style="color: #8b2252;">"center"</span>
<span style="color: #a0522d;">BARMOD</span>=<span style="color: #8b2252;">"percentage"</span>
<span style="color: #a0522d;">VOLTXT</span>=<span style="color: #8b2252;">"Volume"</span>
<span style="color: #a0522d;">VOLMUTEDTXT</span>=<span style="color: #8b2252;">"Muted"</span>
<span style="color: #a0522d;">VOLSTEP</span>=5%



<span style="color: #b22222;"># </span><span style="color: #b22222;">kills an existing osd_cat process</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">needed when holding down a key to force repaint of the onscreen message</span>
<span style="color: #0000ff;">preKill</span>() {
    killall aosd_cat
}

<span style="color: #0000ff;">isMute</span>() {
    <span style="color: #a0522d;">VOLMUTE</span>=<span style="color: #8b2252;">"$(</span><span style="color: #ff00ff;">amixer</span><span style="color: #8b2252;"> sget Master,0 | grep "Front Left:" | awk '{print $6}')"</span>
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">gets the actual volume value</span>
<span style="color: #0000ff;">getVol</span>() {
    <span style="color: #a0522d;">VOL</span>=<span style="color: #8b2252;">"$(</span><span style="color: #ff00ff;">amixer</span><span style="color: #8b2252;"> sget Master,0 | grep "Front Left:"|</span>
<span style="color: #8b2252;">     awk '{print $5}'|sed -r 's/[][]//g')"</span>
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">gets the actual volume value and prints is on the screen</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">with a percent bar + a percent number</span>
<span style="color: #0000ff;">showVol</span>() {
    getVol
    <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">VOL</span> |  aosd_cat -p 1 --fore-color=green --shadow-color=<span style="color: #8b2252;">\#</span>006633 <span style="color: #8b2252;">\</span>
                          --font=<span style="color: #8b2252;">"Droid Sans Mono 32"</span> <span style="color: #8b2252;">\</span>
                          --x-offset=50 --y-offset=-0 --transparency=2 <span style="color: #8b2252;">\</span>
                          --fade-in=0 --fade-out=0 --fade-full=1000
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">reises the master channel by "VOLSTEP"</span>
<span style="color: #0000ff;">volUp</span>() {
    amixer sset Master,0 <span style="color: #8b2252;">"$VOLSTEP+"</span>
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">decreases the master channel by "VOLSTEP"</span>
<span style="color: #0000ff;">volDown</span>() {
    amixer sset Master,0 <span style="color: #8b2252;">"$VOLSTEP-"</span>
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">mutes the master channel</span>
<span style="color: #0000ff;">volMute</span>() {
    amixer sset Master,0 toggle
}


<span style="color: #b22222;"># </span><span style="color: #b22222;">main part</span>
preKill

<span style="color: #a020f0;">case</span> <span style="color: #8b2252;">"$1"</span><span style="color: #a020f0;"> in</span>
    <span style="color: #8b2252;">"volup"</span>)
        volUp
        showVol
        ;;
    <span style="color: #8b2252;">"voldown"</span>)
        volDown
        showVol
        ;;
    <span style="color: #8b2252;">"mute"</span>)
        volMute
        showVol
        ;;
    <span style="color: #8b2252;">"get"</span>)
        getVol
        isMute
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$VOL $VOLMUTE"</span>
        ;;
    *)
        ;;
<span style="color: #a020f0;">esac</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orge591070" class="outline-3">
<h3 id="memory">Memory</h3>
<div class="outline-text-3" id="text-memory">
<p>
Memory is monitored using a simple graph widget.  The memory metrics (total and
and used memory) are obtained by calling the <code>free</code> utility.  A popup window
with the output of the <code>top</code> command is shown one mouse-over events.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org43d3b56"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Memory usage</span>

<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">memory_label</span> = wibox.widget.textbox()
memory_label:set_text(<span style="color: #8b2252;">"&#9636; "</span>)
memory_graph = wibox.widget.graph {
   width = 20,
   height = 20
}
memory_widget = wibox.widget {
   max_value = 100,
   widget = memory_graph,
   forced_width = 20,
   color = beautiful.fg_normal,
   background_color = beautiful.bg_focus,
   border_color = beautiful.bg_normal
}
memory_widget_async = <span style="color: #008b8b;">false</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Read maximum size</span>
awful.spawn.easy_async(
   <span style="color: #8b2252;">"free -m"</span>,
   <span style="color: #a020f0;">function</span> (stdout, stderr, reason, code)
      memory_widget.max_value = <span style="color: #483d8b;">tonumber</span>(
         stdout:gmatch(<span style="color: #8b2252;">".*Mem:[ ]*([0-9]+).*"</span>)())
   <span style="color: #a020f0;">end</span>
)

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">memory_widget_update</span>()
   awful.spawn.easy_async(
      <span style="color: #8b2252;">"free -m"</span>,
      <span style="color: #a020f0;">function</span> (stdout, stderr, reason, code)
         memory_widget:add_value(
            <span style="color: #483d8b;">tonumber</span>(stdout:gmatch(<span style="color: #8b2252;">".*Mem:[ ]*[0-9]+[ ]*([0-9]+).*"</span>)()))
      <span style="color: #a020f0;">end</span>
   )
   <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">true</span>
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">memory_widget_htop_popup</span>(str)
   top_str = <span style="color: #8b2252;">""</span>
   num_lines_left = 20
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">k</span>, <span style="color: #a0522d;">str</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">pairs</span>(my_utility.lines(str)) <span style="color: #a020f0;">do</span>
      <span style="color: #a020f0;">if</span> num_lines_left &gt; 0 <span style="color: #a020f0;">then</span>
         top_str = top_str .. <span style="color: #8b2252;">"\n"</span> .. str
         num_lines_left = num_lines_left - 1
      <span style="color: #a020f0;">else</span>
         <span style="color: #a020f0;">break</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
   memory_popup = naughty.notify({
         title = <span style="color: #8b2252;">""</span>,
         text = top_str,
         font = <span style="color: #8b2252;">"monospace 10"</span>,
         timeout = 0,
         hover_timeout = 0.5,
         screen = awful.screen.focused()})
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">memory_widget_htop</span>()
   memory_cmd = <span style="color: #8b2252;">"top -b -n1 -o %CPU"</span>
   <span style="color: #a020f0;">if</span> memory_widget_async <span style="color: #a020f0;">then</span>
      awful.spawn.easy_async(
         memory_cmd,
         <span style="color: #a020f0;">function</span> (stdout, stderr, reason, exitcode)
            memory_widget_htop_popup(stdout)
         <span style="color: #a020f0;">end</span>
      )
   <span style="color: #a020f0;">else</span>
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">out</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(memory_cmd, <span style="color: #8b2252;">'r'</span>))
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">msg</span> = out:read(<span style="color: #8b2252;">"*all"</span>)
      out:close()
      memory_widget_htop_popup(msg)
   <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>

memory_widget:connect_signal(
   <span style="color: #8b2252;">'mouse::enter'</span>,
   <span style="color: #a020f0;">function</span> ()
       memory_widget_htop()
   <span style="color: #a020f0;">end</span>
)

memory_widget:connect_signal(
   <span style="color: #8b2252;">'mouse::leave'</span>,
   <span style="color: #a020f0;">function</span> ()
      <span style="color: #a020f0;">if</span> memory_popup <span style="color: #a020f0;">then</span>
         naughty.destroy(memory_popup)
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
)

memory_widget_timer = gears.timer.start_new(
   5, <span style="color: #a020f0;">function</span> () <span style="color: #a020f0;">return</span> memory_widget_update() <span style="color: #a020f0;">end</span>)

<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org4dc5e3e" class="outline-3">
<h3 id="calendar">Calendar</h3>
<div class="outline-text-3" id="text-calendar">
<p>
The calendar widget simply consists in display the output of the <code>khal</code> command
as a popup when the mouse points to the date widet.  This assumes that the
<code>khal</code> program is installed and configured.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org15dd3b4"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Calendar</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Create a textclock widget</span>
mytextclock = awful.widget.textclock()
mytextclock_cal_async = <span style="color: #008b8b;">false</span>


<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">mytextclock_widget_khal_popup</span>(str)
   textclock_popup = naughty.notify({
         title = <span style="color: #8b2252;">""</span>,
         text = str,
         font = <span style="color: #8b2252;">"monospace 10"</span>,
         timeout = 0,
         hover_timeout = 0.5,
         screen = awful.screen.focused()})
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">textclock_widget_khal</span>()
   cmd = <span style="color: #8b2252;">"bash -c \"source ~/data/software/python-env/caldav/bin/"</span> ..
      <span style="color: #8b2252;">"activate &amp;&amp; khal\""</span>
   <span style="color: #a020f0;">if</span> mytextclock_cal_async <span style="color: #a020f0;">then</span>
      awful.spawn.easy_async(
         cmd,
         <span style="color: #a020f0;">function</span> (stdout, stderr, reason, exitcode)
            mytextclock_widget_khal_popup(stdout)
         <span style="color: #a020f0;">end</span>
      )
   <span style="color: #a020f0;">else</span>
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">out</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(cmd, <span style="color: #8b2252;">'r'</span>))
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">msg</span> = out:read(<span style="color: #8b2252;">"*all"</span>)
      out:close()
      mytextclock_widget_khal_popup(msg)
   <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>

mytextclock:connect_signal(
   <span style="color: #8b2252;">'mouse::enter'</span>,
   <span style="color: #a020f0;">function</span> ()
       textclock_widget_khal()
   <span style="color: #a020f0;">end</span>
)

mytextclock:connect_signal(
   <span style="color: #8b2252;">'mouse::leave'</span>,
   <span style="color: #a020f0;">function</span> ()
      <span style="color: #a020f0;">if</span> textclock_popup <span style="color: #a020f0;">then</span>
         naughty.destroy(textclock_popup)
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
)

<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orga88fe91" class="outline-3">
<h3 id="email">Mail</h3>
<div class="outline-text-3" id="text-email">
<p>
I use maildir for my personal email, and mu for indexing.  The mail widget uses
the vicious maildir widget, combined with custom functions to display a summary
of active emails when moving the mouse over the widget.
</p>
</div>

<div id="outline-container-org03d1be6" class="outline-4">
<h4 id="org03d1be6">Module definition</h4>
<div class="outline-text-4" id="text-org03d1be6">
<p>
This module was taken from <a href="https://awesome.naquadah.org/wiki/Email_maildir_naughty_hoover">this post</a>, with small modifications to account for my
local setup.  In particular, the list of emails is obtained via a mu request
(<code>querystring</code>).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org547c991"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[mailhoover.lua]</div>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">string</span> = <span style="color: #483d8b;">string</span>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">tostring</span> = <span style="color: #483d8b;">tostring</span>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">io</span> = <span style="color: #483d8b;">io</span>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">table</span> = <span style="color: #483d8b;">table</span>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">pairs</span> = <span style="color: #483d8b;">pairs</span>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">os</span> = <span style="color: #483d8b;">os</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">awful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">naughty</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"naughty"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">beautiful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">'beautiful'</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">my_utility</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"my_utility"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">mailhoover</span> = {}

<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">popup</span>

<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">mailhoover</span> = {}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">mailhoover:addToWidget</span>(<span style="color: #483d8b;">print</span>,mywidget, querystring, maxcount,
                                mail_colors)
   mywidget:connect_signal(
      <span style="color: #8b2252;">'mouse::enter'</span>,
      <span style="color: #a020f0;">function</span> ()
         <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">query_format</span> = <span style="color: #8b2252;">"&lt;span color='"</span> .. beautiful.mail_fg_normal ..
            <span style="color: #8b2252;">"'&gt;&lt;b&gt;&lt;u&gt;%s&lt;/u&gt;\n&lt;/b&gt;&lt;/span&gt;"</span>
         <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">info</span> = mailhoover:read_index(<span style="color: #483d8b;">print</span>, querystring, maxcount,
                                            mail_colors)
         popup = naughty.notify({
               title = <span style="color: #8b2252;">""</span>,
               text = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">format</span>(query_format, querystring) .. <span style="color: #8b2252;">"&lt;br&gt;"</span> ..
                  info,
               timeout = 0,
               hover_timeout = 0.5,
               screen = awful.screen.focused()
         })
   <span style="color: #a020f0;">end</span>)
   mywidget:connect_signal(<span style="color: #8b2252;">'mouse::leave'</span>,
                           <span style="color: #a020f0;">function</span> () naughty.destroy(popup) <span style="color: #a020f0;">end</span>)
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">mailhoover:read_index</span>(<span style="color: #483d8b;">print</span>, querystring, maxcount, mail_colors)
    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">info</span> = <span style="color: #8b2252;">""</span>
    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">count</span> = 0

    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">'mu find -f "d f s m" -s d -z '</span> ..
                              querystring, <span style="color: #8b2252;">'r'</span>))
    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">out</span> = f:read(<span style="color: #8b2252;">"*all"</span>)
    f:close()

    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">nlines</span> = 1
    <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">line</span> <span style="color: #a020f0;">in</span> out:gmatch(<span style="color: #8b2252;">"[^\r\n]+"</span>) <span style="color: #a020f0;">do</span>
       line = line:gsub(<span style="color: #8b2252;">"&lt;"</span>, <span style="color: #8b2252;">"["</span>)
       line = line:gsub(<span style="color: #8b2252;">"&gt;"</span>, <span style="color: #8b2252;">"]"</span>)
       line = line:gsub(<span style="color: #8b2252;">"CDT"</span>, <span style="color: #8b2252;">""</span>)
       fold = line:gsub(<span style="color: #8b2252;">".*/([^%s]+)/([^%s]+)$"</span>, <span style="color: #8b2252;">"%1_%2"</span>)
       col_hex = beautiful.mail_fg_normal
       <span style="color: #a020f0;">if</span> mail_colors ~= <span style="color: #008b8b;">nil</span> <span style="color: #a020f0;">then</span>
          <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">k</span>, <span style="color: #a0522d;">v</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">pairs</span>(mail_colors) <span style="color: #a020f0;">do</span>
             <span style="color: #a020f0;">if</span> fold:match(k) <span style="color: #a020f0;">then</span>
                col_hex = v
                <span style="color: #a020f0;">break</span>
             <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">end</span>
       <span style="color: #a020f0;">end</span>
       line = my_utility.html_escape(line)
       info = info .. <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">format</span>(<span style="color: #8b2252;">"&lt;span color='"</span> .. col_hex .. <span style="color: #8b2252;">"'&gt;"</span> ..
                                       line .. <span style="color: #8b2252;">"&lt;/span&gt;"</span>) .. <span style="color: #8b2252;">'\n'</span>
       nlines = nlines + 1
       <span style="color: #a020f0;">if</span> nlines == maxcount <span style="color: #a020f0;">then</span> <span style="color: #a020f0;">break</span> <span style="color: #a020f0;">end</span>
    <span style="color: #a020f0;">end</span>

    <span style="color: #a020f0;">return</span> info
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">return</span> mailhoover
</pre>
</div>
</div>
</div>


<div id="outline-container-orgdbd59fb" class="outline-4">
<h4 id="orgdbd59fb">Widget setup</h4>
<div class="outline-text-4" id="text-orgdbd59fb">
<p>
The vicious module is used to report the number of new messages in a list of
maildir folders.  The color of the widget text changes from
<code>beautiful.mail_fg_normal</code> to <code>beautiful.mail_fg_urgent</code> when new messages are
present.
</p>

<p>
Additionally, a right-click on the widget spawns a small menu with options to
open mail clients (thunderbird and mu4e).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgb0606b6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Mail widget</span>
mailicon = wibox.widget.textbox()
mailfolders = my_utility.scandir(awesome_paths.home_dir  ..
                                    <span style="color: #8b2252;">'/maildir/INBOX'</span>, <span style="color: #8b2252;">'*/ -d'</span>)
my_utility.table_path_remove(mailfolders, { <span style="color: #8b2252;">"."</span>, <span style="color: #8b2252;">".."</span>, <span style="color: #8b2252;">"cur"</span>, <span style="color: #8b2252;">"new"</span>, <span style="color: #8b2252;">"tmp"</span> })
<span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(mailfolders, awesome_paths.home_dir  .. <span style="color: #8b2252;">'/maildir/INBOX'</span>)
<span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(mailfolders, awesome_paths.home_dir  .. <span style="color: #8b2252;">'/maildir/status/action'</span>)

vicious.register(mailicon, vicious.widgets.mdir,
                 <span style="color: #a020f0;">function</span> (widget, args)
                    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">new_messages</span> = args[1] + args[2]
                    <span style="color: #a020f0;">if</span> new_messages == 0
                    <span style="color: #a020f0;">then</span> <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">format</span>(<span style="color: #8b2252;">'&#9993; 0'</span>)
                    <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">format</span>(<span style="color: #8b2252;">'&lt;span color="#dc322f"&gt;&#9993; '</span> ..
                                                 new_messages ..
                                                 <span style="color: #8b2252;">'&lt;/span&gt; | '</span>)
                    <span style="color: #a020f0;">end</span>
                 <span style="color: #a020f0;">end</span>, 60, mailfolders)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Mail mouse over</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">mailhoover</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"mailhoover"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">mail_query</span> = <span style="color: #8b2252;">"maildir:/INBOX* or maildir:/status*"</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">mail_colors</span> = {
   status_waiting_on = beautiful.mail_fg_normal,
   status_action     = beautiful.mail_fg_urgent,
   INBOX             = beautiful.mail_fg_focus,
}
mailhoover:addToWidget(<span style="color: #483d8b;">print</span>, mailicon, mail_query, 20, mail_colors)
mailmenu_items = {
   { <span style="color: #8b2252;">"emacs"</span>, <span style="color: #a020f0;">function</span> () run_or_raise(<span style="color: #8b2252;">"emacs -f mu4e"</span>,
                                       { class = <span style="color: #8b2252;">"Emacs"</span> }) <span style="color: #a020f0;">end</span> },
   { <span style="color: #8b2252;">"thunderbird"</span>, <span style="color: #a020f0;">function</span> () run_or_raise(mail_reader,
                                             { class = <span style="color: #8b2252;">"Thunderbird"</span> }) <span style="color: #a020f0;">end</span> }
}
mailmenu = awful.menu.new( { items = mailmenu_items } )
mailbuttons = awful.util.table.join(
   awful.button({ }, 3, <span style="color: #a020f0;">function</span> () mailmenu:toggle() <span style="color: #a020f0;">end</span>)
)
mailicon:buttons(mailbuttons)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org18cd9ef" class="outline-3">
<h3 id="cmus">cmus</h3>
<div class="outline-text-3" id="text-cmus">
<p>
Music is controlled by cmus, which is launched on startup.  The original widget
was taken from <a href="http://blog.rolinh.ch/linux/un-widget-controleur-pour-le-lecteur-audio-cmus-pour-awesome-wm/">here</a>.
</p>

<p>
The widget has the following features:
</p>
<ol class="org-ol">
<li>Show the current play state, song artist, title and current position in the
wibox widget.</li>
<li>Toggle play / pause on click</li>
<li>Go to cmus on right click</li>
<li>On mouse over events, show a track listing of the current playing album in a
notification window (popup), with the cover art (parsed from the file
metadata using eyeD3).</li>
<li>A function to search for a given album by name or select an album at random
and play it in cmus (<a href="#cmus_play">Quick play command</a>).  This function is not used by the
widget but by the <a href="#global_prompt">global prompt module</a>.</li>
</ol>

<p>
An example of the widget in action is shown on Fig.&nbsp;<a href="#orgd0d8e89">3</a>.
</p>

<p>
This module is not generic, modifications are likely to be necessary if the
setup is different from mine.  My music library is organized as follows:
</p>
<ul class="org-ul">
<li>All my music is in <code>~/data/music/</code> where each album is in a separate folder
with name <code>YYYY-ARTIST-ALBUM</code> (the quick play command explicitly assumes this
format, so it probably won't work with different conventions).  The format is
set in a regular expression (<code>cmus_album_regex</code> in the <a href="#cmus_global_variables">Global variables</a>
section).</li>
<li>Songs all have the cover art in their metadata.  This is where the cover art
displayed in the popup notification comes from.  There is no clever mechanism
to pick an image file in the album folder, although it should be possible to
implement one.</li>
<li>The extracted cover art is cached in <code>~/cmus_img/</code>.</li>
</ul>

<p>
This is admittedly pretty constraining, but supporting more generic setups seems
feasible, with some work.
</p>
</div>


<div id="outline-container-orgc07b3b5" class="outline-4">
<h4 id="orgc07b3b5">Imports</h4>
<div class="outline-text-4" id="text-orgc07b3b5">
<p>
First, import the necessary libraries.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgede98e2"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[cmus.lua]</div>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">awful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">naughty</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"naughty"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">beautiful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">'beautiful'</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">util</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful.util"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">my_utility</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"my_utility"</span>)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgcbc0474" class="outline-4">
<h4 id="cmus_utils">Utility functions</h4>
<div class="outline-text-4" id="text-cmus_utils">
<p>
A few utility functions are used in the module:
</p>
<dl class="org-dl">
<dt><code>get_path</code></dt><dd>Extract path from filename.</dd>
<dt><code>cmusover_addToWidget</code></dt><dd>Show album popup on mouse over.</dd>
<dt><code>get_mp3_info</code></dt><dd>Get a string representation of file ID3 tags using eyeD3.  The
output string is of the form "track number - track title - track length"
where the track title is padded so that the whole string length is
<code>strlen</code> (this does not seem to work with accentuated letters).</dd>
</dl>

<div class="org-src-container">
<pre class="src src-lua" id="org81c7656"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[cmus.lua]</div>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">get_path</span>(str, sep)
    sep = sep <span style="color: #a020f0;">or</span> <span style="color: #8b2252;">'/'</span>
    <span style="color: #a020f0;">return</span> str:match(<span style="color: #8b2252;">"(.*"</span> .. sep .. <span style="color: #8b2252;">")"</span>)
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">cmusover_addToWidget</span>(widget)
   widget:connect_signal(
      <span style="color: #8b2252;">'mouse::enter'</span>, <span style="color: #a020f0;">function</span> () cmus_popup(0) <span style="color: #a020f0;">end</span>)
   widget:connect_signal(
      <span style="color: #8b2252;">'mouse::leave'</span>, <span style="color: #a020f0;">function</span> () naughty.destroy(popup) <span style="color: #a020f0;">end</span>)
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">get_mp3_info</span>(fname, strlen)
   <span style="color: #b22222;">-- </span><span style="color: #b22222;">FIXME: fix padding for accentuated letters.</span>
   cmd = <span style="color: #8b2252;">'eyeD3 --no-color '</span> .. <span style="color: #8b2252;">'"'</span> .. fname .. <span style="color: #8b2252;">'"'</span>
   cmd_out = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(cmd, <span style="color: #8b2252;">'r'</span>))
   out = cmd_out:read(<span style="color: #8b2252;">"*all"</span>)
   cmd_out:close()
   track = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(out, <span style="color: #8b2252;">'track: %d*'</span>),
                       <span style="color: #8b2252;">'track: '</span>, <span style="color: #8b2252;">''</span>)
   title = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(out, <span style="color: #8b2252;">'title: %C*'</span>),
                       <span style="color: #8b2252;">'title: '</span>, <span style="color: #8b2252;">''</span>)
   time_str = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(out, <span style="color: #8b2252;">'Time: [%d:]*'</span>)
   <span style="color: #a020f0;">if</span> time_str == <span style="color: #008b8b;">nil</span> <span style="color: #a020f0;">then</span>
      time = <span style="color: #8b2252;">"-"</span>
   <span style="color: #a020f0;">else</span>
      time = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(time_str, <span style="color: #8b2252;">'Time: '</span>, <span style="color: #8b2252;">''</span>)
   <span style="color: #a020f0;">end</span>
   sfmt = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">format</span>(<span style="color: #8b2252;">'%%-%d.%ds'</span>, strlen, strlen)
   <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">format</span>(<span style="color: #8b2252;">'%2d - '</span>..sfmt..<span style="color: #8b2252;">' - %s'</span>, track, title, time)
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org8fa9efb" class="outline-4">
<h4 id="cmus_global_variables">Global variables</h4>
<div class="outline-text-4" id="text-cmus_global_variables">
<p>
Setup variables are used to find albums by folder name in the music folder
(using the <code>cmus_album_regex</code> variable) and to cache the track listing and cover
art.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org4b6e53a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[cmus.lua]</div>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Album folder regexp</span>
cmus_album_regex = <span style="color: #8b2252;">"^[0-9]\\{4\\}-"</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Album display (with cover)</span>
cmus_file_g = <span style="color: #8b2252;">""</span>
cmus_img_g = <span style="color: #8b2252;">""</span>
cmus_img_fold = <span style="color: #483d8b;">os</span>.<span style="color: #483d8b;">getenv</span>(<span style="color: #8b2252;">"HOME"</span>) .. <span style="color: #8b2252;">"/cmus_img/"</span>
cmus_album_g = <span style="color: #8b2252;">""</span>
cmus_album_list_g = <span style="color: #8b2252;">""</span>
cmus_file_list_g = <span style="color: #008b8b;">nil</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org88b5b81" class="outline-4">
<h4 id="cmus_pid">Check running instance</h4>
<div class="outline-text-4" id="text-cmus_pid">
<p>
This function detects whether a cmus instance is running by requesting its PID.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orga33c473"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[cmus.lua]</div>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Get cmus PID to check if it is running</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">getCmusPid</span>()
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">fpid</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"pgrep cmus"</span>, <span style="color: #8b2252;">'r'</span>))
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">pid</span> = fpid:read(<span style="color: #8b2252;">"*n"</span>)
   fpid:close()
   <span style="color: #a020f0;">return</span> pid
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org8173b00" class="outline-4">
<h4 id="org8173b00">Controls</h4>
<div class="outline-text-4" id="text-org8173b00">
<p>
A cmus instance can be controlled from a terminal using the <code>cmus-remote</code>
command.  The following function passes simple controls to cmus-remote (play,
pause, stop, next, etc.).  In practice only the play / pause functionality is
used: clicking on the widget toggles the play state (play / pause).
</p>


<div class="org-src-container">
<pre class="src src-lua" id="org7929689"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[cmus.lua]</div>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Enable cmus control</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">cmus_control</span> (action)
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">cmus_info</span>, <span style="color: #a0522d;">cmus_state</span>
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">cmus_run</span> = getCmusPid()
   <span style="color: #a020f0;">if</span> cmus_run <span style="color: #a020f0;">then</span>
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">out</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"cmus-remote -Q"</span>, <span style="color: #8b2252;">'r'</span>))
      cmus_info = out:read(<span style="color: #8b2252;">"*all"</span>)
      out:close()
      <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> cmus_info <span style="color: #a020f0;">then</span> <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">end</span>
      cmus_state = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_info, <span style="color: #8b2252;">"status %a*"</span>),
                               <span style="color: #8b2252;">"status "</span>, <span style="color: #8b2252;">""</span>)
      <span style="color: #a020f0;">if</span> cmus_state ~= <span style="color: #8b2252;">"stopped"</span> <span style="color: #a020f0;">then</span>
         <span style="color: #a020f0;">if</span> action == <span style="color: #8b2252;">"next"</span> <span style="color: #a020f0;">then</span>
            <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"cmus-remote -n"</span>, <span style="color: #8b2252;">'r'</span>))
         <span style="color: #a020f0;">elseif</span> action == <span style="color: #8b2252;">"previous"</span> <span style="color: #a020f0;">then</span>
            <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"cmus-remote -r"</span>, <span style="color: #8b2252;">'r'</span>))
         <span style="color: #a020f0;">elseif</span> action == <span style="color: #8b2252;">"stop"</span> <span style="color: #a020f0;">then</span>
            <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"cmus-remote -s"</span>, <span style="color: #8b2252;">'r'</span>))
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">if</span> action == <span style="color: #8b2252;">"play_pause"</span> <span style="color: #a020f0;">then</span>
         <span style="color: #a020f0;">if</span> cmus_state == <span style="color: #8b2252;">"playing"</span> <span style="color: #a020f0;">or</span> cmus_state == <span style="color: #8b2252;">"paused"</span> <span style="color: #a020f0;">then</span>
            <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"cmus-remote -u"</span>, <span style="color: #8b2252;">'r'</span>))
         <span style="color: #a020f0;">elseif</span> cmus_state == <span style="color: #8b2252;">"stopped"</span> <span style="color: #a020f0;">then</span>
            <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"cmus-remote -p"</span>, <span style="color: #8b2252;">'r'</span>))
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org20961bd" class="outline-4">
<h4 id="cmus_popup">Popup</h4>
<div class="outline-text-4" id="text-cmus_popup">
<p>
The popup notification (Fig.&nbsp;<a href="#orgd0d8e89">3</a>) shows the content of the
global variables defined earlier (see <a href="#cmus_global_variables">global variables</a>) and updated by the
<code>cmus_hook</code> function (see the <a href="#cmus_hook">Main hook</a> section).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org9d5655e"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[cmus.lua]</div>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">cmus_popup</span>(timeout)
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">img</span>
   <span style="color: #a020f0;">if</span> util.file_readable(cmus_img_g) <span style="color: #a020f0;">then</span>
      img = cmus_img_g
   <span style="color: #a020f0;">else</span>
      img = <span style="color: #008b8b;">nil</span>
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">if</span> cmus_album_list_g ~= <span style="color: #8b2252;">""</span> <span style="color: #a020f0;">then</span>
      popup = naughty.notify({
            title = cmus_album_g,
            text = cmus_album_list_g,
            font = <span style="color: #8b2252;">"monospace 10"</span>,
            icon = img,
            icon_size = 192,
            timeout = timeout,
            hover_timeout = 0.5,
            screen = awful.screen.focused()
      })
   <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>
</pre>
</div>

<p>
The following bash script, uses <code>awesome-client</code> to spawn the popup notification
and performs a screen capture (Fig.&nbsp;<a href="#orgd0d8e89">3</a>).
</p>

<div class="org-src-container">
<pre class="src src-sh" id="orgef1ac63">
<span style="color: #b22222;"># </span><span style="color: #b22222;">Could get these from xrandr</span>
<span style="color: #a0522d;">res_x</span>=1920
<span style="color: #a0522d;">res_y</span>=1080
<span style="color: #a0522d;">screen_idx</span>=1 <span style="color: #b22222;"># </span><span style="color: #b22222;">starts at 0</span>

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"local cmus = require(\"cmus\"); cmus_popup(5)"</span> | awesome-client

<span style="color: #a0522d;">width</span>=$(( 3 * $<span style="color: #a0522d;">res_x</span> / 8 ))
<span style="color: #a0522d;">height</span>=250
<span style="color: #a0522d;">start_x</span>=$(( $<span style="color: #a0522d;">res_x</span> * $<span style="color: #a0522d;">screen_idx</span> + $<span style="color: #a0522d;">res_x</span> - $<span style="color: #a0522d;">width</span> ))

sleep 0.5

scrot desktop.png
convert desktop.png -crop ${<span style="color: #a0522d;">width</span>}x${<span style="color: #a0522d;">height</span>}+${<span style="color: #a0522d;">start_x</span>}+0 desktop-cmus-popup.png
rm desktop.png -rf
</pre>
</div>


<div id="orgd0d8e89" class="figure">
<p><a href="../images/2016-10-05-Awesome-wm_configuration/desktop-cmus-popup.png" width="60%"><img src="../images/2016-10-05-Awesome-wm_configuration/desktop-cmus-popup.png" alt="desktop-cmus-popup.png" width="60%"></a>
</p>
<p><span class="figure-number">Figure 3: </span>Cmus popup notification, with album cover and track list.</p>
</div>
</div>
</div>


<div id="outline-container-org7d44693" class="outline-4">
<h4 id="cmus_play">Quick play command</h4>
<div class="outline-text-4" id="text-cmus_play">
<p>
The quick play command <code>cmus_play</code> is used to start playing a new album, picked
randomly (<code>rand</code> mode) or from a string (<code>album</code> mode).  There is no single song
mode; it could probably be added, but I use a direct search and mplayer to play
individual songs via the <a href="#global_prompt_music">global prompt module</a>.
</p>

<p>
Once the folder to play is found, some work is required to get cmus to play it.
First, cmus must be in playlist mode (i.e. the <code>play_library</code> flag must of set
to false).  <code>cmus-remote</code> is used to interrogate the running instance and then a
second time to disable the <code>play_library</code> mode if necessary.  Then, the current
playlist is cleared (<code>cmus-remote -c</code>), the desired folder is added to the
playlist and playback is started.  A combination of stop, next and play commands
seems to be the best way to get the playlist to start.
</p>

<p>
The commands are written into a temporary bash script, which is executed at the
end of the function (I was not able to get this to work without the intermediate
bash script).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org716c5c4"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[cmus.lua]</div>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">cmus_play</span>(mode, fold)
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">out</span>
   <span style="color: #a020f0;">if</span> mode == <span style="color: #8b2252;">"rand"</span> <span style="color: #a020f0;">then</span>
      alb_sel_cmd = <span style="color: #8b2252;">"ls "</span> .. global_prompt.music_folder .. <span style="color: #8b2252;">" | "</span> ..
         <span style="color: #8b2252;">"grep \""</span> .. cmus_album_regex .. <span style="color: #8b2252;">"\" | sort -R | head -n1"</span>
   <span style="color: #a020f0;">elseif</span> mode == <span style="color: #8b2252;">"album"</span> <span style="color: #a020f0;">then</span>
      alb_sel_cmd = <span style="color: #8b2252;">"ls "</span> .. global_prompt.music_folder .. <span style="color: #8b2252;">" | "</span> ..
         <span style="color: #8b2252;">"grep \""</span> .. cmus_album_regex .. <span style="color: #8b2252;">"\" | grep -i \""</span> .. fold .. <span style="color: #8b2252;">"\" |"</span> ..
         <span style="color: #8b2252;">"tail -n1"</span>
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(alb_sel_cmd, <span style="color: #8b2252;">'r'</span>))
   out = f:read(<span style="color: #8b2252;">"*all"</span>):gsub(<span style="color: #8b2252;">"\n$"</span>, <span style="color: #8b2252;">""</span>)
   f:close()

   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Determine if play_library flag need to be toggled</span>
   f = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"cmus-remote -Q | grep play_library | awk '{print $3}'"</span>))
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">lib_flag</span> = f:read(<span style="color: #8b2252;">"*all"</span>):gsub(<span style="color: #8b2252;">"\n$"</span>, <span style="color: #8b2252;">""</span>)
   f:close()

   <span style="color: #a020f0;">if</span> lib_flag == <span style="color: #8b2252;">"true"</span> <span style="color: #a020f0;">then</span>
      mp_cmds = { <span style="color: #8b2252;">"cmus-remote -C \"toggle play_library\""</span> }
   <span style="color: #a020f0;">else</span>
      mp_cmds = {}
   <span style="color: #a020f0;">end</span>
   <span style="color: #b22222;">-- </span><span style="color: #b22222;">table.insert(mp_cmds, "cmus-remote --stop")</span>
   <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(mp_cmds, <span style="color: #8b2252;">"cmus-remote -P -c \""</span> ..
                   global_prompt.music_folder .. <span style="color: #8b2252;">"/"</span> ..
                   out .. <span style="color: #8b2252;">"\""</span>)
   <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(mp_cmds, <span style="color: #8b2252;">"cmus-remote -C \"view playlist\""</span>)
   <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(mp_cmds, <span style="color: #8b2252;">"cmus-remote --stop"</span>)
   <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(mp_cmds, <span style="color: #8b2252;">"cmus-remote --next"</span>)
   <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(mp_cmds, <span style="color: #8b2252;">"cmus-remote --play"</span>)
   <span style="color: #a020f0;">if</span> mp_cmds <span style="color: #a020f0;">then</span>
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">file</span>
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">flag_batch</span> = <span style="color: #008b8b;">true</span> <span style="color: #b22222;">-- </span><span style="color: #b22222;">problems when not using this</span>
      <span style="color: #a020f0;">if</span> flag_batch <span style="color: #a020f0;">then</span>
         file = <span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">"/tmp/cmus.sh"</span>, <span style="color: #8b2252;">"w"</span>)
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">cmd</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(mp_cmds) <span style="color: #a020f0;">do</span>
         <span style="color: #a020f0;">if</span> flag_batch <span style="color: #a020f0;">then</span>
            file:write(cmd .. <span style="color: #8b2252;">"\nsleep 1\n"</span>)
         <span style="color: #a020f0;">else</span>
            awful.spawn.with_shell(cmd)
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">if</span> flag_batch <span style="color: #a020f0;">then</span>
         file:close()
         awful.spawn.with_shell(<span style="color: #8b2252;">"bash /tmp/cmus.sh"</span>)
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org36a0e9c" class="outline-4">
<h4 id="cmus_hook">Main hook</h4>
<div class="outline-text-4" id="text-cmus_hook">
<p>
The <code>cmus_hook</code> function is responsible for updating the text of the music
widget, and the content of the popup notification.  It is run on a frequent
timer (2 seconds by default).
</p>

<p>
The hook first checks for the presence of a running cmus instance using the
<a href="#cmus_pid"><code>getCmusPid</code></a> function.  If a running instance is found and its status is
currently "playing" or "paused", the hook proceeds to extract information about
the currently playing file.  As shown in Fig.&nbsp;<a href="#orgdf23b9a">2</a>, the widget
shows the playing status with a unicode character (play / pause), the artist and
song title and the track position (formatted as "position" / "duration").
</p>

<p>
The rest of the function populates the album track list.  <code>cmus_album_str</code>
contains the album name and the year between parentheses.  If the album name is
different from the one cached in the <a href="#cmus_global_variables">global variable</a> <code>cmus_album_g</code>, the track
list is updated.
</p>

<p>
To update the track list, the cover art is first extracted from the current
playing file using the eyeD3 utility.  This requires all audio files to contain
the album art as metadata.  The extracted cover art is saved in the folder
defined by the <code>cmus_img_fold</code> variable.
</p>

<p>
Further, all the <code>.mp3</code> files in the same folder as the file being played are
listed, their metadata is extracted using the <a href="#cmus_utils"><code>get_mp3_info</code></a> function, and they
are added to the <code>cmus_album_list_g</code> variable.  The song currently playing is
highlighted in the list.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org0fff3d2"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[cmus.lua]</div>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">cmus_hook</span>()
   <span style="color: #b22222;">-- </span><span style="color: #b22222;">check if cmus is running</span>
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">cmus_run</span> = getCmusPid()
   <span style="color: #a020f0;">if</span> cmus_run <span style="color: #a020f0;">then</span>
      out = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"cmus-remote -Q"</span>, <span style="color: #8b2252;">'r'</span>))
      cmus_info = out:read(<span style="color: #8b2252;">"*all"</span>)
      out:close()
      <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> cmus_info <span style="color: #a020f0;">then</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"."</span> <span style="color: #a020f0;">end</span>
      cmus_status = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_info, <span style="color: #8b2252;">"status %a*"</span>)
      <span style="color: #a020f0;">if</span> cmus_status == <span style="color: #008b8b;">nil</span> <span style="color: #a020f0;">then</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"."</span> <span style="color: #a020f0;">end</span>
      cmus_state = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(cmus_status,<span style="color: #8b2252;">"status "</span>,<span style="color: #8b2252;">""</span>)
      <span style="color: #a020f0;">if</span> cmus_state == <span style="color: #8b2252;">"playing"</span> <span style="color: #a020f0;">or</span> cmus_state == <span style="color: #8b2252;">"paused"</span> <span style="color: #a020f0;">then</span>
         cmus_artist = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(
                                      cmus_info, <span style="color: #8b2252;">"tag artist %C*"</span>),
                                   <span style="color: #8b2252;">"tag artist "</span>,<span style="color: #8b2252;">""</span>)
         cmus_title = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_info,
                                               <span style="color: #8b2252;">"tag title %C*"</span>),
                                  <span style="color: #8b2252;">"tag title "</span>,<span style="color: #8b2252;">""</span>)
         cmus_album = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_info,
                                               <span style="color: #8b2252;">"tag album %C*"</span>),
                                  <span style="color: #8b2252;">"tag album "</span>,<span style="color: #8b2252;">""</span>)
         cmus_year = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_info,
                                              <span style="color: #8b2252;">"tag date %C*"</span>),
                                 <span style="color: #8b2252;">"tag date "</span>,<span style="color: #8b2252;">""</span>)
         cmus_curtime = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_info,
                                                 <span style="color: #8b2252;">"position %d*"</span>),
                                    <span style="color: #8b2252;">"position "</span>,<span style="color: #8b2252;">""</span>)
         cmus_curtime_formated = <span style="color: #483d8b;">math</span>.<span style="color: #483d8b;">floor</span>(cmus_curtime/60) .. <span style="color: #8b2252;">':'</span> ..
            <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">format</span>(<span style="color: #8b2252;">"%02d"</span>,cmus_curtime % 60)
         cmus_totaltime = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_info,
                                                   <span style="color: #8b2252;">"duration %d*"</span>),
                                      <span style="color: #8b2252;">"duration "</span>,<span style="color: #8b2252;">""</span>)
         cmus_totaltime_formated = <span style="color: #483d8b;">math</span>.<span style="color: #483d8b;">floor</span>(cmus_totaltime/60) .. <span style="color: #8b2252;">':'</span> ..
            <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">format</span>(<span style="color: #8b2252;">"%02d"</span>,cmus_totaltime % 60)
         cmus_album_str = cmus_album .. <span style="color: #8b2252;">" ("</span> .. cmus_year .. <span style="color: #8b2252;">")"</span>
         <span style="color: #a020f0;">if</span> cmus_artist == <span style="color: #8b2252;">""</span> <span style="color: #a020f0;">then</span>
            cmus_artist = <span style="color: #8b2252;">"unknown artist"</span>
         <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">if</span> cmus_title == <span style="color: #8b2252;">""</span> <span style="color: #a020f0;">then</span>
            cmus_title = <span style="color: #8b2252;">"unknown title"</span>
         <span style="color: #a020f0;">end</span>
         <span style="color: #b22222;">-- </span><span style="color: #b22222;">cmus_title = string.format("%.5c", cmus_title)</span>
         cmus_string = cmus_artist .. <span style="color: #8b2252;">" - "</span> .. cmus_title .. <span style="color: #8b2252;">" ("</span> ..
            cmus_curtime_formated .. <span style="color: #8b2252;">"/"</span> .. cmus_totaltime_formated .. <span style="color: #8b2252;">")"</span>
         <span style="color: #a020f0;">if</span> cmus_state == <span style="color: #8b2252;">"paused"</span> <span style="color: #a020f0;">then</span>
            cmus_string = <span style="color: #8b2252;">'&#9208; '</span> .. cmus_string .. <span style="color: #8b2252;">''</span>
         <span style="color: #a020f0;">else</span>
            cmus_string = <span style="color: #8b2252;">'&#9204; '</span> .. cmus_string .. <span style="color: #8b2252;">''</span>
         <span style="color: #a020f0;">end</span>
         cmus_file = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(<span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_info, <span style="color: #8b2252;">"file %C*"</span>),
                                 <span style="color: #8b2252;">"file "</span>,<span style="color: #8b2252;">""</span>)
         <span style="color: #a020f0;">if</span> cmus_album_str ~= cmus_album_g <span style="color: #a020f0;">then</span>
            cmd = <span style="color: #8b2252;">"rm "</span> .. cmus_img_fold .. <span style="color: #8b2252;">"/*; "</span> ..
               <span style="color: #8b2252;">"eyeD3 --no-color --write-images="</span> .. cmus_img_fold .. <span style="color: #8b2252;">"/ "</span> ..
               <span style="color: #8b2252;">"\"$(cmus-remote -Q|grep \"^file\"|"</span> ..
               <span style="color: #8b2252;">"sed -r 's/^file\\s*//g')\""</span>
            out = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(cmd .. <span style="color: #8b2252;">" 2&gt;&amp;1"</span>, <span style="color: #8b2252;">'r'</span>))
            cmus_img_dump = out:read(<span style="color: #8b2252;">"*all"</span>)
            out:close()
            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_img_dump, <span style="color: #8b2252;">'file not found'</span>) <span style="color: #a020f0;">then</span>
               <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">fname</span> = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>(cmus_img_dump, <span style="color: #8b2252;">"Writing %C*"</span>)
               <span style="color: #a020f0;">if</span> fname ~= <span style="color: #008b8b;">nil</span> <span style="color: #a020f0;">then</span>
                  cmus_img_g = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(
                     <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(fname, <span style="color: #8b2252;">"Writing "</span>,<span style="color: #8b2252;">""</span>), <span style="color: #8b2252;">"...$"</span>, <span style="color: #8b2252;">""</span>)
               <span style="color: #a020f0;">end</span>
            <span style="color: #a020f0;">end</span>
            cmus_album_g = cmus_album_str
            cmus_file_list_g = my_utility.scandir(get_path(cmus_file), <span style="color: #8b2252;">'*.mp3'</span>)
         <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">if</span> cmus_file_g ~= cmus_file <span style="color: #a020f0;">then</span>
            cmus_file_g = cmus_file
            cmus_album_list_g = <span style="color: #8b2252;">''</span>
            <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">k</span>, <span style="color: #a0522d;">f</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">pairs</span>(cmus_file_list_g) <span style="color: #a020f0;">do</span>
               <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">f_esc</span> = my_utility.filename_escape(f)
               <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">file_info</span> = get_mp3_info(f_esc, 35)
               file_info = my_utility.html_escape(file_info)
               <span style="color: #a020f0;">if</span> f == cmus_file <span style="color: #a020f0;">then</span>
                  file_info = <span style="color: #8b2252;">"&lt;span color='"</span> .. beautiful.cmus_fg ..
                     <span style="color: #8b2252;">"'&gt;&lt;b&gt;"</span> .. file_info .. <span style="color: #8b2252;">"&lt;/b&gt;&lt;/span&gt;"</span>
               <span style="color: #a020f0;">end</span>
               cmus_album_list_g = cmus_album_list_g .. file_info .. <span style="color: #8b2252;">'\n'</span>
            <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">else</span>
         cmus_string = <span style="color: #8b2252;">'-- not playing --'</span>
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">return</span> cmus_string
   <span style="color: #a020f0;">else</span>
      <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'-- not running --'</span>
   <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org43f009d" class="outline-4">
<h4 id="org43f009d">cmus module usage</h4>
<div class="outline-text-4" id="text-org43f009d">
<p>
In the main <code>rc.lua</code> file, we create the widget, connect it to the <code>cmus_hook</code>
function with a timer object (updated every 2 seconds), add the popup
notification to mouse over events and setup the click actions.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org28a9741"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ cmus</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Cmus Widget</span>
tb_cmus = wibox.widget.textbox()
tb_cmus:set_text(<span style="color: #8b2252;">"cmus"</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">refresh Cmus widget</span>
cmus_timer = timer({timeout = 2})
cmus_timer:connect_signal(
   <span style="color: #8b2252;">"timeout"</span>,
   <span style="color: #a020f0;">function</span>()
      tb_cmus:set_text(<span style="color: #8b2252;">'&#9834; '</span> .. cmus_hook() .. <span style="color: #8b2252;">' '</span>)
<span style="color: #a020f0;">end</span>)
cmus_timer:start()
<span style="color: #b22222;">-- </span><span style="color: #b22222;">pause on click</span>
cmusbuttons = awful.util.table.join(
   awful.button({ }, 1, <span style="color: #a020f0;">function</span>() cmus_control(<span style="color: #8b2252;">"play_pause"</span>) <span style="color: #a020f0;">end</span>),
   awful.button({ }, 3,
      <span style="color: #a020f0;">function</span>()
         run_or_raise(termapps .. <span style="color: #8b2252;">" -name cmus -e cmus"</span>,
                      { instance = <span style="color: #8b2252;">"cmus"</span> })
   <span style="color: #a020f0;">end</span>)
)
tb_cmus:buttons(cmusbuttons)
cmusover_addToWidget(tb_cmus)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org5efccfa" class="outline-3">
<h3 id="ttrss">Tiny Tiny RSS</h3>
<div class="outline-text-3" id="text-ttrss">
<p>
The RSS widget relies on an instance of Tiny Tiny RSS and the <a href="https://github.com/Vassius/ttrss-python">ttrss python
package</a>.  Extraction of RSS entries is performed using the following python
wrapper script.
</p>
</div>


<div id="outline-container-orgfde960c" class="outline-4">
<h4 id="ttrss-wrapper-py">Python wrapper script</h4>
<div class="outline-text-4" id="text-ttrss-wrapper-py">
<p>
The python wrapper script is a simple interface to the ttrss python package.  It
requires the following packages (besides <code>ttrss-python</code>):
</p>
<dl class="org-dl">
<dt><code>argparse</code></dt><dd>command-line arguments parser,</dd>
<dt><code>keyring</code></dt><dd>extract credentials from keyring,</dd>
<dt><code>textwrap</code></dt><dd>wraps output string within fixed width paragraph.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-python" id="org3ccb28f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[scripts/ttrss-wrapper.py]</div><span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">Get unread feeds from tt-rss site</span>

<span style="color: #8b2252;">"""</span>

<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% Imports</span>


<span style="color: #a020f0;">import</span> ttrss.client
<span style="color: #a020f0;">import</span> keyring
<span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">import</span> textwrap

<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% Parse options</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(description=<span style="color: #8b2252;">'Get tt-rss feeds.'</span>)
    parser.add_argument(<span style="color: #8b2252;">'-U'</span>, <span style="color: #8b2252;">'--url'</span>, dest=<span style="color: #8b2252;">'url'</span>, required=<span style="color: #008b8b;">True</span>,
                        <span style="color: #483d8b;">type</span>=<span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'TinyTiny RSS URL'</span>)
    parser.add_argument(<span style="color: #8b2252;">'-u'</span>, <span style="color: #8b2252;">'--user'</span>, dest=<span style="color: #8b2252;">'user'</span>, required=<span style="color: #008b8b;">True</span>,
                        <span style="color: #483d8b;">type</span>=<span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Username'</span>)
    parser.add_argument(<span style="color: #8b2252;">'-p'</span>, <span style="color: #8b2252;">'--pass'</span>, dest=<span style="color: #8b2252;">'passwd'</span>, required=<span style="color: #008b8b;">False</span>,
                        <span style="color: #483d8b;">type</span>=<span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Password'</span>)
    parser.add_argument(<span style="color: #8b2252;">'-W'</span>, <span style="color: #8b2252;">'--width'</span>, dest=<span style="color: #8b2252;">'text_width'</span>, default=50,
                        required=<span style="color: #008b8b;">False</span>, <span style="color: #483d8b;">type</span>=<span style="color: #483d8b;">int</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Width of text output'</span>)
    parser.add_argument(<span style="color: #8b2252;">'-c'</span>, <span style="color: #8b2252;">'--count'</span>, dest=<span style="color: #8b2252;">'flag_count'</span>, action=<span style="color: #8b2252;">'store_true'</span>,
                        required=<span style="color: #008b8b;">False</span>,
                        <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Output only the number of unread items'</span>)
    parser.add_argument(<span style="color: #8b2252;">'-r'</span>, <span style="color: #8b2252;">'--mark-read'</span>, dest=<span style="color: #8b2252;">'flag_mark_read'</span>,
                        action=<span style="color: #8b2252;">'store_true'</span>, required=<span style="color: #008b8b;">False</span>,
                        <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Mark all unread items as read'</span>)
    <span style="color: #a0522d;">args</span> = parser.parse_args()
<span style="color: #a020f0;">else</span>:
    <span style="color: #a020f0;">from</span> collections <span style="color: #a020f0;">import</span> namedtuple
    <span style="color: #a0522d;">Args</span> = namedtuple(<span style="color: #8b2252;">'arg'</span>, [<span style="color: #8b2252;">'user'</span>, <span style="color: #8b2252;">'passwd'</span>, <span style="color: #8b2252;">'url'</span>, <span style="color: #8b2252;">'text_width'</span>,
                              <span style="color: #8b2252;">'flag_count'</span>, <span style="color: #8b2252;">'flag_mark_read'</span>])
    <span style="color: #a0522d;">args</span> = Args(user=<span style="color: #8b2252;">''</span>, url=<span style="color: #8b2252;">''</span>, text_width=50,
                flag_count=<span style="color: #008b8b;">False</span>, flag_mark_read=<span style="color: #008b8b;">False</span>, passwd=<span style="color: #008b8b;">None</span>)

<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% Get password</span>


<span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> args.passwd:
    <span style="color: #a0522d;">args.passwd</span> = keyring.get_password(<span style="color: #8b2252;">'tt-rss'</span>, args.user)

<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% Create connection</span>


<span style="color: #a0522d;">client</span> = ttrss.client.TTRClient(args.url, args.user, args.passwd,
                                auto_login=<span style="color: #008b8b;">True</span>, http_auth=())
client.login()


<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% Get unread feeds</span>


<span style="color: #a0522d;">hl</span> = client.get_headlines(view_mode=<span style="color: #8b2252;">'unread'</span>)


<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% Render output</span>

<span style="color: #a020f0;">if</span> args.flag_count:
    <span style="color: #a020f0;">print</span>(<span style="color: #483d8b;">len</span>(hl))
<span style="color: #a020f0;">else</span>:
    <span style="color: #a020f0;">for</span> hh <span style="color: #a020f0;">in</span> hl:
        <span style="color: #a020f0;">if</span> args.flag_mark_read:
            client.mark_read(hh.<span style="color: #483d8b;">id</span>)
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">print</span>(<span style="color: #8b2252;">"\n"</span>.join([
                (<span style="color: #8b2252;">"- "</span> <span style="color: #a020f0;">if</span> ii == 0 <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">"  "</span>) + tt
                <span style="color: #a020f0;">for</span> ii, tt <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(
                        textwrap.wrap(hh.title,
                                      args.text_width))
            ]))

<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% Cleanup</span>


client.logout()
</pre>
</div>

<p>
The script takes as parameters the URL to the Tiny Tiny RSS instance, a user
name and a password.  It gathers unread feeds and prints them into a string.  It
also adds the option to get the credentials from the keyring
(e.g. <code>gnome-keyring</code> or <code>KWallet</code>).  This functionality requires the <code>keyring</code>
python package.
</p>

<p>
Here is the help text for the <code>ttrss-wrapper.py</code> script:
</p>

<div class="org-src-container">
<pre class="src src-sh" id="orgf909264">
<span style="color: #b22222;"># </span><span style="color: #b22222;">Use " || echo " to ensure a success code is returned</span>
python3 scripts/ttrss-wrapper.py --help || <span style="color: #483d8b;">echo</span>
</pre>
</div>

<pre class="example">
usage: ttrss-wrapper.py [-h] -U URL -u USER [-p PASSWD] [-W TEXT_WIDTH] [-c]
                        [-r]

Get tt-rss feeds.

optional arguments:
  -h, --help            show this help message and exit
  -U URL, --url URL     TinyTiny RSS URL
  -u USER, --user USER  Username
  -p PASSWD, --pass PASSWD
                        Password
  -W TEXT_WIDTH, --width TEXT_WIDTH
                        Width of text output
  -c, --count           Output only the number of unread items
  -r, --mark-read       Mark all unread items as read
</pre>
</div>
</div>


<div id="outline-container-org468c380" class="outline-4">
<h4 id="org468c380">Credentials</h4>
<div class="outline-text-4" id="text-org468c380">
<p>
In my setup, credentials are stored in the <code>~/.authinfo.gpg</code> file.  The
following emacs-lisp snippet defines a function to get the username and password
from the url.  This should also work for the un-encrypted version using
<code>.authinfo</code>.
</p>

<p>
If not using authinfo, the credentials can be hard-coded in this emacs-lisp
snippet.  In the following source block, replace line&nbsp;<a href="#coderef-user-nil" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-user-nil');" onmouseout="CodeHighlightOff(this, 'coderef-user-nil');">3</a> by
line&nbsp;<a href="#coderef-user-hardcoded" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-user-hardcoded');" onmouseout="CodeHighlightOff(this, 'coderef-user-hardcoded');">4</a> and line&nbsp;<a href="#coderef-pass-nil" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-pass-nil');" onmouseout="CodeHighlightOff(this, 'coderef-pass-nil');">5</a> by
line&nbsp;<a href="#coderef-pass-hardcoded" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-pass-hardcoded');" onmouseout="CodeHighlightOff(this, 'coderef-pass-hardcoded');">6</a> and set the correct password.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org58d0bae"><span class="linenr"> 1: </span>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">get-ttrss-cred</span> (<span style="color: #228b22;">&amp;optional</span> url)
<span class="linenr"> 2: </span>  (<span style="color: #a020f0;">let</span> ((ttrss-url (<span style="color: #a020f0;">if</span> url url <span style="color: #8b2252;">"127.0.0.1:81/tt-rss"</span>))
<span id="coderef-user-nil" class="coderef-off"><span class="linenr"> 3: </span>        (ttrss-user nil)</span>
<span id="coderef-user-hardcoded" class="coderef-off"><span class="linenr"> 4: </span>        <span style="color: #b22222;">;;</span><span style="color: #b22222;">(ttrss-user "myuser")</span></span>
<span id="coderef-pass-nil" class="coderef-off"><span class="linenr"> 5: </span>        (ttrss-pass nil)</span>
<span id="coderef-pass-hardcoded" class="coderef-off"><span class="linenr"> 6: </span>        <span style="color: #b22222;">;;</span><span style="color: #b22222;">(ttrss-pass "mypassword")</span></span>
<span class="linenr"> 7: </span>        )
<span class="linenr"> 8: </span>    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">auth-source</span>)
<span class="linenr"> 9: </span>      (<span style="color: #a020f0;">let</span> ((auth (nth 0 (auth-source-search <span style="color: #483d8b;">:host</span> ttrss-url
<span class="linenr">10: </span>                                             <span style="color: #483d8b;">:requires</span> '(user secret)))))
<span class="linenr">11: </span>        (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (plist-get auth <span style="color: #483d8b;">:secret</span>) (plist-get auth <span style="color: #483d8b;">:user</span>))
<span class="linenr">12: </span>          (<span style="color: #a020f0;">setq</span> ttrss-pass (funcall (plist-get auth <span style="color: #483d8b;">:secret</span>))
<span class="linenr">13: </span>                ttrss-user (plist-get auth <span style="color: #483d8b;">:user</span>)))))
<span class="linenr">14: </span>    `(,ttrss-url ,ttrss-user ,ttrss-pass)))
</pre>
</div>

<p>
Note that this approach saves the credentials unencrypted in the <code>ttrss.lua</code>
module.  It may be preferable to rely on a keyring to get the password.
However, the <code>authinfo</code> approach can still be safely used with version control
if the org file is version-controlled and the tangled lua files are not.
</p>
</div>
</div>


<div id="outline-container-org2234a9c" class="outline-4">
<h4 id="org2234a9c">tt-rss module</h4>
<div class="outline-text-4" id="text-org2234a9c">
<p>
The tt-rss module defines functions used by the <a href="#ttrss-widget">widget</a>:
</p>
<dl class="org-dl">
<dt><code>ttrss_get_count</code></dt><dd>return the number of unread feeds,</dd>
<dt><code>ttrss_get_feeds</code></dt><dd>return a formatted list of unread feeds,</dd>
<dt><code>ttrss_mark_read</code></dt><dd>mark all feeds as read,</dd>
<dt><code>ttrss_set_mouseover</code></dt><dd>setup the widget to display a popup notification with
the list of unread feeds on mouse-over.</dd>
</dl>

<p>
These functions internally use the <code>ttrss_get</code> function which interacts with the
<a href="#ttrss-wrapper-py"><code>ttrss-wrapper.py</code></a> python script.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgc88556e"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[ttrss.lua]</div>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Script options</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">ttrss_cmd</span> = <span style="color: #8b2252;">"python3 "</span> .. awesome_paths.config_dir ..
   <span style="color: #8b2252;">"/scripts/ttrss-wrapper.py "</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">ttrss_url</span> = <span style="color: #8b2252;">"http://"</span> .. ttrss_cred[1]
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">ttrss_user</span> = ttrss_cred[2]
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">ttrss_pass</span> = ttrss_cred[3]
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">ttrss_textwidth</span> = 100

<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">awful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">naughty</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"naughty"</span>)

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">ttrss_get_count</span>()
    <span style="color: #a020f0;">return</span> ttrss_get(<span style="color: #8b2252;">"count"</span>)
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">ttrss_get_feeds</span>()
    <span style="color: #a020f0;">return</span> ttrss_get(<span style="color: #8b2252;">"feeds"</span>)
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">ttrss_mark_read</span>()
    <span style="color: #a020f0;">return</span> ttrss_get(<span style="color: #8b2252;">"mark_read"</span>)
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">ttrss_get</span>(action)
   <span style="color: #a020f0;">if</span> action == <span style="color: #8b2252;">"feeds"</span> <span style="color: #a020f0;">then</span>
      args = <span style="color: #8b2252;">""</span>
   <span style="color: #a020f0;">elseif</span> action == <span style="color: #8b2252;">"count"</span> <span style="color: #a020f0;">then</span>
      args = <span style="color: #8b2252;">"-c"</span>
   <span style="color: #a020f0;">elseif</span> action == <span style="color: #8b2252;">"mark_read"</span> <span style="color: #a020f0;">then</span>
      args = <span style="color: #8b2252;">"-r"</span>
   <span style="color: #a020f0;">end</span>
   cmd = ttrss_cmd .. <span style="color: #8b2252;">" -U "</span> .. ttrss_url .. <span style="color: #8b2252;">" -u "</span> .. ttrss_user ..
      <span style="color: #8b2252;">" -p "</span> .. ttrss_pass .. <span style="color: #8b2252;">" -W "</span> .. ttrss_textwidth .. <span style="color: #8b2252;">" "</span> .. args
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">out</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(cmd, <span style="color: #8b2252;">'r'</span>))
   ttrss_info = out:read(<span style="color: #8b2252;">"*all"</span>)
   out:close()
   <span style="color: #a020f0;">return</span> ttrss_info
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">ttrss_set_mouseover</span>(mywidget)
   mywidget:connect_signal(<span style="color: #8b2252;">'mouse::enter'</span>,
                           <span style="color: #a020f0;">function</span> ()
                              <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">info</span> = ttrss_get_feeds()
                              <span style="color: #a020f0;">if</span> info ~= <span style="color: #8b2252;">""</span> <span style="color: #a020f0;">then</span>
                                 popup = naughty.notify({
                                       title = <span style="color: #8b2252;">""</span>,
                                       text = info,
                                       timeout = 0,
                                       hover_timeout = 0.5,
                                       screen = awful.screen.focused()})
                              <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>)
   mywidget:connect_signal(<span style="color: #8b2252;">'mouse::leave'</span>, <span style="color: #a020f0;">function</span> ()
                              naughty.destroy(popup) <span style="color: #a020f0;">end</span>)
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org107da05" class="outline-4">
<h4 id="ttrss-widget">tt-rss widget</h4>
<div class="outline-text-4" id="text-ttrss-widget">
<p>
The ttrss widget is a textbox with the text updated on a timer (every 10 minutes
by default) to display the number of unread items.  On a mouse over event, a
list of unread feeds is shown in a popup notification.  Finally, click actions
are added to the widget:
</p>
<ul class="org-ul">
<li>a left click shows a menu with entries "Refresh" and "Mark as read" which
respectively refresh the widget count and mark all unread items as read,</li>
<li>a right click spawns a menu with shortcuts to the terminal and GUI RSS
applications newsboat and liferea.</li>
</ul>

<div class="org-src-container">
<pre class="src src-lua" id="org49ce3a5"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ tt-rss</span>
tb_ttrss = wibox.widget.textbox()
tb_ttrss:set_text(<span style="color: #8b2252;">"ttrss"</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">refresh</span>
ttrss_timer = timer({timeout = 600})
ttrss_timer:connect_signal(<span style="color: #8b2252;">"timeout"</span>,
                           <span style="color: #a020f0;">function</span> ()
                              tb_ttrss:set_text(<span style="color: #8b2252;">'&#9749; '</span> .. ttrss_get_count()) <span style="color: #a020f0;">end</span>)
ttrss_timer:start()
tb_ttrss:set_text(<span style="color: #8b2252;">'&#9749; '</span> .. ttrss_get_count())
ttrssmenu_l_items = {
   { <span style="color: #8b2252;">"Refresh"</span>, <span style="color: #a020f0;">function</span> () tb_ttrss:set_text(<span style="color: #8b2252;">'&#9749; '</span> .. ttrss_get_count()) <span style="color: #a020f0;">end</span> },
   { <span style="color: #8b2252;">"Mark as read"</span>, <span style="color: #a020f0;">function</span> ()
        ttrss_mark_read()
        tb_ttrss:set_text(<span style="color: #8b2252;">'&#9749; '</span> .. ttrss_get_count())
   <span style="color: #a020f0;">end</span> }
}
ttrssmenu_r_items = {
   { <span style="color: #8b2252;">"newsboat"</span>, <span style="color: #a020f0;">function</span> () run_or_raise(
           termapps .. <span style="color: #8b2252;">" -name newsboat -e newsboat"</span>,
           { instance=<span style="color: #8b2252;">"newsboat"</span>} ) <span style="color: #a020f0;">end</span> },
   { <span style="color: #8b2252;">"liferea"</span>, <span style="color: #a020f0;">function</span> () run_or_raise(
           <span style="color: #8b2252;">"liferea"</span>, { class = <span style="color: #8b2252;">"Liferea"</span> }) <span style="color: #a020f0;">end</span> }
}
ttrssmenu_l = awful.menu.new( { items = ttrssmenu_l_items } )
ttrssmenu_r = awful.menu.new( { items = ttrssmenu_r_items } )
ttrss_buttons = awful.util.table.join(
   awful.button({ }, 1, <span style="color: #a020f0;">function</span> () ttrssmenu_l:toggle() <span style="color: #a020f0;">end</span>),
   awful.button({ }, 3, <span style="color: #a020f0;">function</span> () ttrssmenu_r:toggle() <span style="color: #a020f0;">end</span>)
)
tb_ttrss:buttons(ttrss_buttons)
ttrss_set_mouseover(tb_ttrss)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org6fe5816" class="outline-3">
<h3 id="org6fe5816">Keyboard layout</h3>
<div class="outline-text-3" id="text-org6fe5816">
<p>
Add a widget to control the keyboard layout.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org3aaa362"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Keyboard map indicator and switcher</span>
mykeyboardlayout = awful.widget.keyboardlayout()
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgb860cf2" class="outline-2">
<h2 id="orgb860cf2">Effects </h2>
<div class="outline-text-2" id="text-orgb860cf2">
<p>
This section contains setup of visual effects that can be used with awesome-wm.
</p>
</div>


<div id="outline-container-org127d417" class="outline-3">
<h3 id="org127d417">Monitor highlighting</h3>
<div class="outline-text-3" id="text-org127d417">
<p>
It is sometimes difficult to tell which monitor is the active one, so I
implemented a simple hook to highlight the wibox on the active screen.  The
actual colors are defined through the <a href="#theme">theme manager</a>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org551434c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Highlight current monitor</span>
screen_highlight_timer = timer({timeout = 0.2})
screen_highlight_idx = 1
screen_highlight_timer:connect_signal(
   <span style="color: #8b2252;">"timeout"</span>,
   <span style="color: #a020f0;">function</span> ()
      <span style="color: #a020f0;">if</span> awful.screen.focused() ~= screen_highlight_idx <span style="color: #a020f0;">then</span>
         screen_highlight_idx = awful.screen.focused()
         <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> <span style="color: #a020f0;">in</span> screen <span style="color: #a020f0;">do</span>
            <span style="color: #a020f0;">if</span> s == awful.screen.focused() <span style="color: #a020f0;">then</span>
               col_bg = beautiful.screen_highlight_bg_active
               col_fg = beautiful.screen_highlight_fg_active
            <span style="color: #a020f0;">else</span>
               col_bg = beautiful.screen_highlight_bg_inactive
               col_fg = beautiful.screen_highlight_fg_inactive
            <span style="color: #a020f0;">end</span>
            s.mywibox:set_bg(col_bg)
            s.mywibox:set_fg(col_fg)
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>)
screen_highlight_timer:start()
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org8bcfec4" class="outline-3">
<h3 id="effects_transparency">Transparency</h3>
<div class="outline-text-3" id="text-effects_transparency">
<p>
If using a compositor (e.g. <code>xcompmgr</code>), effects can be applied on windows.
This block makes windows transparent when losing focus, and opaque when
regaining focus.  Note that this block is disabled by default (see the
<code>:PROPERTY:</code> drawer).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgf69412a">
<span style="color: #b22222;">-- </span><span style="color: #b22222;">{{ Transparency</span>
client.connect_signal(<span style="color: #8b2252;">"focus"</span>, <span style="color: #a020f0;">function</span>(c)
                         c.border_color = beautiful.border_focus
                         c.opacity = 1
<span style="color: #a020f0;">end</span>)
client.connect_signal(<span style="color: #8b2252;">"unfocus"</span>, <span style="color: #a020f0;">function</span>(c)
                         c.border_color = beautiful.border_normal
                         c.opacity = 0.9
<span style="color: #a020f0;">end</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org4d7b3ff" class="outline-3">
<h3 id="org4d7b3ff">Window border change on focus</h3>
<div class="outline-text-3" id="text-org4d7b3ff">
<p>
Add a signal to change the color of window borders when losing / receiving
focus.  This comes from the default configuration.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org9e469a7"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{ Window border</span>
client.connect_signal(<span style="color: #8b2252;">"focus"</span>, <span style="color: #a020f0;">function</span>(c)
                         c.border_color = beautiful.border_focus
<span style="color: #a020f0;">end</span>)
client.connect_signal(<span style="color: #8b2252;">"unfocus"</span>, <span style="color: #a020f0;">function</span>(c)
                         c.border_color = beautiful.border_normal
<span style="color: #a020f0;">end</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org4c30704" class="outline-3">
<h3 id="org4c30704">Snap client to screen edges</h3>
<div class="outline-text-3" id="text-org4c30704">
<p>
Awesome 4 adds edge snapping, the following disables it.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orge6ae67c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>awful.mouse.snap.edge_enabled = <span style="color: #008b8b;">false</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgf54a645" class="outline-2">
<h2 id="orgf54a645">Bindings </h2>
<div class="outline-text-2" id="text-orgf54a645">
<p>
Bindings include mouse click actions for the different widgets and windows as
well as keyboard shortcuts.
</p>
</div>


<div id="outline-container-org15e1ba2" class="outline-3">
<h3 id="org15e1ba2">Mouse</h3>
<div class="outline-text-3" id="text-org15e1ba2">
<p>
Mouse bindings are defined using tables filled by <code>awful.button</code> elements.
</p>
</div>


<div id="outline-container-orgeb99989" class="outline-4">
<h4 id="orgeb99989">General bindings</h4>
<div class="outline-text-4" id="text-orgeb99989">
<p>
This section handles mouse actions on an empty workspace:
</p>
<ul class="org-ul">
<li>a right-click pops-up the <a href="#main_menu">main menu</a>,</li>
<li>the mouse wheel moves to the previous / next tag.</li>
</ul>

<div class="org-src-container">
<pre class="src src-lua" id="orgb99787a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Mouse bindings</span>
root.buttons(awful.util.table.join(
    awful.button({ }, 3, <span style="color: #a020f0;">function</span> () mymainmenu:toggle() <span style="color: #a020f0;">end</span>),
    awful.button({ }, 4, awful.tag.viewprev),
    awful.button({ }, 5, awful.tag.viewnext)
))
</pre>
</div>
</div>
</div>


<div id="outline-container-org3017c0d" class="outline-4">
<h4 id="org3017c0d">Windows</h4>
<div class="outline-text-4" id="text-org3017c0d">
<p>
Mouse actions for clicks on windows are defined here:
</p>
<ul class="org-ul">
<li>a left click sets the focus,</li>
<li><code>modkey</code> + left click drag moves the window,</li>
<li><code>modkey</code> + right click drag resizes the window.</li>
</ul>
<p>
The <code>clientbuttons</code> table created by this block is later added to each window
via the <a href="#rules">rules</a> mechanism.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org2ee597b"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Focus, move, resize window on click</span>
clientbuttons = awful.util.table.join(
    awful.button({ }, 1, <span style="color: #a020f0;">function</span> (c) client.focus = c; c:raise() <span style="color: #a020f0;">end</span>),
    awful.button({ modkey }, 1, awful.mouse.client.move),
    awful.button({ modkey }, 3, awful.mouse.client.resize))

<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org82f78f5" class="outline-4">
<h4 id="bindings_mouse_taglist">Tag list</h4>
<div class="outline-text-4" id="text-bindings_mouse_taglist">
<p>
The mouse can be used to navigate between between tags, when the mouse is over
the tag list widget:
</p>
<ul class="org-ul">
<li>a left click on a tag icon moves to the corresponding tag,</li>
<li><code>modkey</code> + left click moves the current window to the desired tag,</li>
<li>a right click toggles the visibility of the corresponding tag (on top of the
current tag, so all windows from the tag under the mouse will appear in the
currently active tag),</li>
<li><code>modkey</code> + right click toggles the current tag's visibility on the tag under
the mouse,</li>
<li>the mouse wheel goes to the previous / next tag.</li>
</ul>

<div class="org-src-container">
<pre class="src src-lua" id="org34e553d"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Create a wibox for each screen and add it</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">taglist_buttons</span> = awful.util.table.join(
                    awful.button({ }, 1, <span style="color: #a020f0;">function</span>(t) t:view_only() <span style="color: #a020f0;">end</span>),
                    awful.button({ modkey }, 1, <span style="color: #a020f0;">function</span>(t)
                                              <span style="color: #a020f0;">if</span> client.focus <span style="color: #a020f0;">then</span>
                                                  client.focus:move_to_tag(t)
                                              <span style="color: #a020f0;">end</span>
                                          <span style="color: #a020f0;">end</span>),
                    awful.button({ }, 3, awful.tag.viewtoggle),
                    awful.button({ modkey }, 3, <span style="color: #a020f0;">function</span>(t)
                                              <span style="color: #a020f0;">if</span> client.focus <span style="color: #a020f0;">then</span>
                                                  client.focus:toggle_tag(t)
                                              <span style="color: #a020f0;">end</span>
                                          <span style="color: #a020f0;">end</span>),
                    awful.button({ }, 4,
                       <span style="color: #a020f0;">function</span>(t) awful.tag.viewprev(t.screen) <span style="color: #a020f0;">end</span>),
                    awful.button({ }, 5,
                       <span style="color: #a020f0;">function</span>(t) awful.tag.viewnext(t.screen) <span style="color: #a020f0;">end</span>)
                )
</pre>
</div>
</div>
</div>


<div id="outline-container-orgbe3eac6" class="outline-4">
<h4 id="bindings_mouse_tasklist">Task list</h4>
<div class="outline-text-4" id="text-bindings_mouse_tasklist">
<p>
Task list mouse actions are the following:
</p>
<ul class="org-ul">
<li>a left click toggles window minimization,</li>
<li>a right click spawns a menu listing the open windows (on all screens and
tags),</li>
<li>the mouse wheel cycles through windows in the current screen and tag.</li>
</ul>

<div class="org-src-container">
<pre class="src src-lua" id="org2806277"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tasklist_buttons</span> = awful.util.table.join(
   awful.button({ }, 1, <span style="color: #a020f0;">function</span> (c)
         <span style="color: #a020f0;">if</span> c == client.focus <span style="color: #a020f0;">then</span>
            c.minimized = <span style="color: #008b8b;">true</span>
         <span style="color: #a020f0;">else</span>
            <span style="color: #b22222;">-- </span><span style="color: #b22222;">Without this, the following</span>
            <span style="color: #b22222;">-- </span><span style="color: #b22222;">:isvisible() makes no sense</span>
            c.minimized = <span style="color: #008b8b;">false</span>
            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> c:isvisible() <span style="color: #a020f0;">and</span> c.first_tag <span style="color: #a020f0;">then</span>
               c.first_tag:view_only()
            <span style="color: #a020f0;">end</span>
            <span style="color: #b22222;">-- </span><span style="color: #b22222;">This will also un-minimize</span>
            <span style="color: #b22222;">-- </span><span style="color: #b22222;">the client, if needed</span>
            client.focus = c
            c:raise()
         <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>),
   awful.button({ }, 3, client_menu_toggle_fn()),
   awful.button({ }, 4, <span style="color: #a020f0;">function</span> ()
         awful.client.focus.byidx(1)
   <span style="color: #a020f0;">end</span>),
   awful.button({ }, 5, <span style="color: #a020f0;">function</span> ()
         awful.client.focus.byidx(-1)
<span style="color: #a020f0;">end</span>))
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org18f9073" class="outline-3">
<h3 id="bindings_keyboard">Keyboard</h3>
<div class="outline-text-3" id="text-bindings_keyboard">
<p>
Keyboard bindings are split into two categories: global bindings and client
(windows) bindings.
</p>
</div>

<div id="outline-container-org3e212ab" class="outline-4">
<h4 id="org3e212ab">Global bindings </h4>
<div class="outline-text-4" id="text-org3e212ab">
<p>
Keybindings are defined in subsections, and can be individually disabled by
setting the <code>tangle</code> property to <code>no</code>.
</p>

<p>
First, we initialize the table for the keys.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org92e078b"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Key bindings</span>
globalkeys = {}
</pre>
</div>
</div>

<div id="outline-container-orgf6acf6c" class="outline-5">
<h5 id="orgf6acf6c">Shortcuts popup</h5>
<div class="outline-text-5" id="text-orgf6acf6c">
<p>
Display the help popup.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgd44aad6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, }, <span style="color: #8b2252;">"s"</span>, hotkeys_popup.show_help,
       {description=<span style="color: #8b2252;">"show help"</span>, group=<span style="color: #8b2252;">"awesome"</span>})
)
</pre>
</div>
</div>
</div>



<div id="outline-container-orgef15ed5" class="outline-5">
<h5 id="orgef15ed5">Tags</h5>
<div class="outline-text-5" id="text-orgef15ed5">
<p>
This section defines tag navigation keybindings and window movement between
tags.
</p>
</div>


<ul class="org-ul">
<li><a id="org00e1252"></a>Previous/next tag with <code>modkey</code><br>
<div class="outline-text-6" id="text-org00e1252">
<p>
Move the the previous / next tag:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgd702843"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, }, <span style="color: #8b2252;">"Left"</span>, awful.tag.viewprev,
              {description = <span style="color: #8b2252;">"view previous"</span>, group = <span style="color: #8b2252;">"tag"</span>}),
    awful.key({ modkey, }, <span style="color: #8b2252;">"Right"</span>, awful.tag.viewnext,
              {description = <span style="color: #8b2252;">"view next"</span>, group = <span style="color: #8b2252;">"tag"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="orge9bc58b"></a>Previous/next tag on all screens with <code>Ctrl</code> + <code>Alt</code><br>
<div class="outline-text-6" id="text-orge9bc58b">
<p>
Move to the previous / next tag (using <code>Ctrl</code> + <code>Alt</code> as on other desktop
environments) on all screens:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgd7641e4"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ altkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"Left"</span>,
       <span style="color: #a020f0;">function</span> ()
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">screen_cur</span> = awful.screen.focused()
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag_orig</span> = screen_cur.selected_tag
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag_prev</span> = tag_orig.index
          tag_prev = tag_prev - 1
          <span style="color: #a020f0;">if</span> tag_prev == 0 <span style="color: #a020f0;">then</span>
             tag_prev = #screen_cur.tags
          <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> <span style="color: #a020f0;">in</span> screen <span style="color: #a020f0;">do</span>
             <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = s.tags[tag_prev]
             <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                tag:view_only()
             <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">end</span>
       <span style="color: #a020f0;">end</span>,
       {description = <span style="color: #8b2252;">"Move all screens to left tag"</span>, group = <span style="color: #8b2252;">"tag"</span>}),
    awful.key({ altkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"Right"</span>,
       <span style="color: #a020f0;">function</span> ()
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">screen_cur</span> = awful.screen.focused()
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag_orig</span> = screen_cur.selected_tag
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag_next</span> = tag_orig.index
          tag_next = tag_next + 1
          <span style="color: #a020f0;">if</span> tag_next &gt; #screen_cur.tags <span style="color: #a020f0;">then</span>
             tag_next = 1
          <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> <span style="color: #a020f0;">in</span> screen <span style="color: #a020f0;">do</span>
             <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = s.tags[tag_next]
             <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                tag:view_only()
             <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">end</span>
       <span style="color: #a020f0;">end</span>,
       {description = <span style="color: #8b2252;">"Move all screens to right tag"</span>, group = <span style="color: #8b2252;">"tag"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org6bdb158"></a>Move window to previous/next with <code>Ctrl</code> + <code>Alt</code> + <code>Shift</code><br>
<div class="outline-text-6" id="text-org6bdb158">
<p>
Move the current window to the previous / next tag:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org852750c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
   awful.key({ altkey, <span style="color: #8b2252;">"Control"</span>, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"Left"</span>,
       <span style="color: #a020f0;">function</span> ()
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">screen_cur</span> = awful.screen.focused()
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag_orig</span> = screen_cur.selected_tag
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag_prev</span> = tag_orig.index
          tag_prev = tag_prev - 1
          <span style="color: #a020f0;">if</span> tag_prev == 0 <span style="color: #a020f0;">then</span>
             tag_prev = #screen_cur.tags
          <span style="color: #a020f0;">end</span>

          <span style="color: #a020f0;">if</span> client.focus <span style="color: #a020f0;">then</span>
             <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = screen_cur.tags[tag_prev]
             <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                client.focus:move_to_tag(tag)
             <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">end</span>

          <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> <span style="color: #a020f0;">in</span> screen <span style="color: #a020f0;">do</span>
             <span style="color: #a020f0;">if</span> s ~= screen_cur <span style="color: #a020f0;">then</span>
                <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = s.tags[tag_prev]
                <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                   tag:view_only()
                <span style="color: #a020f0;">end</span>
             <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">if</span> screen_cur.tags[tag_prev] <span style="color: #a020f0;">then</span>
             <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = screen_cur.tags[tag_prev]
             tag:view_only()
          <span style="color: #a020f0;">end</span>
       <span style="color: #a020f0;">end</span>,
       {description = <span style="color: #8b2252;">"Move client left tag"</span>, group = <span style="color: #8b2252;">"tag"</span>}),
    awful.key({ altkey, <span style="color: #8b2252;">"Control"</span>, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"Right"</span>,
       <span style="color: #a020f0;">function</span> ()
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">screen_cur</span> = awful.screen.focused()
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag_orig</span> = screen_cur.selected_tag
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag_next</span> = tag_orig.index
          tag_next = tag_next + 1
          <span style="color: #a020f0;">if</span> tag_next &gt; #screen_cur.tags <span style="color: #a020f0;">then</span>
             tag_next = 1
          <span style="color: #a020f0;">end</span>

          <span style="color: #a020f0;">if</span> client.focus <span style="color: #a020f0;">then</span>
             <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = screen_cur.tags[tag_next]
             <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                client.focus:move_to_tag(tag)
             <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">end</span>

          <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> <span style="color: #a020f0;">in</span> screen <span style="color: #a020f0;">do</span>
             <span style="color: #a020f0;">if</span> s ~= screen_cur <span style="color: #a020f0;">then</span>
                <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = s.tags[tag_next]
                <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                   tag:view_only()
                <span style="color: #a020f0;">end</span>
             <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">end</span>
          <span style="color: #a020f0;">if</span> screen_cur.tags[tag_next] <span style="color: #a020f0;">then</span>
             <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = screen_cur.tags[tag_next]
             tag:view_only()
          <span style="color: #a020f0;">end</span>
       <span style="color: #a020f0;">end</span>,
       {description = <span style="color: #8b2252;">"Move client right tag"</span>, group = <span style="color: #8b2252;">"tag"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org2ba5fe6"></a>Go to tag number<br>
<div class="outline-text-6" id="text-org2ba5fe6">
<p>
Bind numbers to tags (with <code>modkey</code>):
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org3bc1e21"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Bind all key numbers to tags.</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Be careful: we use keycodes to make it works on any keyboard layout.</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">This should map on the top row of your keyboard, usually 1 to 9.</span>
<span style="color: #a020f0;">for</span> <span style="color: #a0522d;">i</span> = 1, 9 <span style="color: #a020f0;">do</span>
    globalkeys = awful.util.table.join(globalkeys,
        <span style="color: #b22222;">-- </span><span style="color: #b22222;">View tag only.</span>
        awful.key({ modkey }, <span style="color: #8b2252;">"#"</span> .. i + 9,
                  <span style="color: #a020f0;">function</span> ()
                        <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">screen</span> = awful.screen.focused()
                        <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = screen.tags[i]
                        <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                           tag:view_only()
                        <span style="color: #a020f0;">end</span>
                  <span style="color: #a020f0;">end</span>,
                  {description = <span style="color: #8b2252;">"view tag #"</span>..i, group = <span style="color: #8b2252;">"tag"</span>})
    )
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</li>


<li><a id="org4648ef4"></a>Go to tag number on all screens with <code>Ctrl</code> + <code>Alt</code><br>
<div class="outline-text-6" id="text-org4648ef4">
<p>
Alternative binding to go to a tag by number on all screens with <code>Ctrl</code> + <code>Alt</code>:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org838346c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">for</span> <span style="color: #a0522d;">i</span> = 1, 9 <span style="color: #a020f0;">do</span>
    globalkeys = awful.util.table.join(globalkeys,
        <span style="color: #b22222;">-- </span><span style="color: #b22222;">View tag for all screens.</span>
        awful.key({ altkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"#"</span> .. i + 9,
                  <span style="color: #a020f0;">function</span> ()
                        <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> <span style="color: #a020f0;">in</span> screen <span style="color: #a020f0;">do</span>
                              <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = s.tags[i]
                              <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                                 tag:view_only()
                              <span style="color: #a020f0;">end</span>
                        <span style="color: #a020f0;">end</span>
                  <span style="color: #a020f0;">end</span>,
                  {description = <span style="color: #8b2252;">"toggle tag #"</span> .. i, group = <span style="color: #8b2252;">"tag"</span>})
    )
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</li>


<li><a id="org1d06ce4"></a>Change tag on other screen<br>
<div class="outline-text-6" id="text-org1d06ce4">
<p>
Move the other screen to a specific tag number (assumes two screens) using
<code>modkey</code> + <code>Alt</code> and a tag number:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org4f778e9"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">for</span> <span style="color: #a0522d;">i</span> = 1, 9 <span style="color: #a020f0;">do</span>
    globalkeys = awful.util.table.join(globalkeys,
        <span style="color: #b22222;">-- </span><span style="color: #b22222;">View tag for other screen.</span>
        awful.key({ modkey, altkey }, <span style="color: #8b2252;">"#"</span> .. i + 9,
                  <span style="color: #a020f0;">function</span> ()
                     <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">screen_cur</span> = awful.screen.focused()
                     <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> <span style="color: #a020f0;">in</span> screen <span style="color: #a020f0;">do</span>
                        <span style="color: #a020f0;">if</span> s ~= screen_cur <span style="color: #a020f0;">then</span>
                           <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = s.tags[i]
                           <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                              tag:view_only()
                           <span style="color: #a020f0;">end</span>
                        <span style="color: #a020f0;">end</span>
                     <span style="color: #a020f0;">end</span>
                  <span style="color: #a020f0;">end</span>,
                  {description = <span style="color: #8b2252;">"Change tag for other screen"</span>, group = <span style="color: #8b2252;">"tag"</span>})
    )
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</li>


<li><a id="org5c27fbf"></a>Move window to tag<br>
<div class="outline-text-6" id="text-org5c27fbf">
<p>
Move the current client (window) to tag by number:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org4dfa39b"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">for</span> <span style="color: #a0522d;">i</span> = 1, 9 <span style="color: #a020f0;">do</span>
    globalkeys = awful.util.table.join(globalkeys,
        <span style="color: #b22222;">-- </span><span style="color: #b22222;">Move client to tag.</span>
        awful.key({ modkey, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"#"</span> .. i + 9,
           <span style="color: #a020f0;">function</span> ()
              <span style="color: #a020f0;">if</span> client.focus <span style="color: #a020f0;">then</span>
                 <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = client.focus.screen.tags[i]
                 <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                    client.focus:move_to_tag(tag)
                 <span style="color: #a020f0;">end</span>
              <span style="color: #a020f0;">end</span>
           <span style="color: #a020f0;">end</span>,
           {description = <span style="color: #8b2252;">"move focused client to tag #"</span>..i, group = <span style="color: #8b2252;">"tag"</span>})
    )
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</li>


<li><a id="org4a2f310"></a>Select tag<br>
<div class="outline-text-6" id="text-org4a2f310">
<p>
Activate other tag on the current one:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org6350d8c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">for</span> <span style="color: #a0522d;">i</span> = 1, 9 <span style="color: #a020f0;">do</span>
    globalkeys = awful.util.table.join(globalkeys,
        <span style="color: #b22222;">-- </span><span style="color: #b22222;">Toggle tag.</span>
        awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"#"</span> .. i + 9,
                  <span style="color: #a020f0;">function</span> ()
                      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">screen</span> = awful.screen.focused()
                      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = screen.tags[i]
                      <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                         awful.tag.viewtoggle(tag)
                      <span style="color: #a020f0;">end</span>
                  <span style="color: #a020f0;">end</span>,
                  {description = <span style="color: #8b2252;">"toggle focused client on tag #"</span> .. i,
                   group = <span style="color: #8b2252;">"tag"</span>})
    )
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</li>


<li><a id="org5472064"></a>Show current tag on other tag<br>
<div class="outline-text-6" id="text-org5472064">
<p>
Activate current tag on another one:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgc6c17ce"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">for</span> <span style="color: #a0522d;">i</span> = 1, 9 <span style="color: #a020f0;">do</span>
    globalkeys = awful.util.table.join(globalkeys,
        <span style="color: #b22222;">-- </span><span style="color: #b22222;">Toggle tag.</span>
        awful.key({ modkey, <span style="color: #8b2252;">"Control"</span>, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"#"</span> .. i + 9,
           <span style="color: #a020f0;">function</span> ()
              <span style="color: #a020f0;">if</span> client.focus <span style="color: #a020f0;">then</span>
                 <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">tag</span> = client.focus.screen.tags[i]
                 <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">then</span>
                    client.focus:toggle_tag(tag)
                 <span style="color: #a020f0;">end</span>
              <span style="color: #a020f0;">end</span>
        <span style="color: #a020f0;">end</span>)
    )
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</li>


<li><a id="org592392c"></a>Go to other screen<br>
<div class="outline-text-6" id="text-org592392c">
<p>
Move to previous / next screen with <code>modkey</code> + <code>Ctrl</code> + <code>j</code> / <code>k</code>:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgf12ad05"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"j"</span>,
      <span style="color: #a020f0;">function</span> () awful.screen.focus_relative( 1) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"focus the next screen"</span>, group = <span style="color: #8b2252;">"screen"</span>}),
   awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"k"</span>,
      <span style="color: #a020f0;">function</span> () awful.screen.focus_relative(-1) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"focus the previous screen"</span>, group = <span style="color: #8b2252;">"screen"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org6b71312"></a>Go to other screen (alternative)<br>
<div class="outline-text-6" id="text-org6b71312">
<p>
Use <code>modkey</code> + <code>Ctrl</code> + (<code>Shift</code>) <code>TAB</code>:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org99ef27d"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"Tab"</span>,
       <span style="color: #a020f0;">function</span> () awful.screen.focus_relative(-1) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"focus the next screen"</span>, group = <span style="color: #8b2252;">"screen"</span>}),
    awful.key({ modkey, <span style="color: #8b2252;">"Control"</span>, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"Tab"</span>,
       <span style="color: #a020f0;">function</span> () awful.screen.focus_relative(1) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"focus the previous screen"</span>, group = <span style="color: #8b2252;">"screen"</span>})
)
</pre>
</div>
</div>
</li>
</ul>
</div>


<div id="outline-container-org88ef63b" class="outline-5">
<h5 id="org88ef63b">Clients (windows)</h5>
<div class="outline-text-5" id="text-org88ef63b">
<p>
This section contains keybindings to operate on clients (windows).
</p>
</div>

<ul class="org-ul">
<li><a id="orgcc5aefd"></a>Go to previous / next window<br>
<div class="outline-text-6" id="text-orgcc5aefd">
<p>
Move to the previous / next window on the current screen using <code>modkey</code> + <code>j</code> /
<code>k</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgaee8a39"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Clients</span>
    awful.key({ modkey, }, <span style="color: #8b2252;">"j"</span>,
        <span style="color: #a020f0;">function</span> ()
            awful.client.focus.byidx( 1)
        <span style="color: #a020f0;">end</span>,
        {description = <span style="color: #8b2252;">"focus next by index"</span>, group = <span style="color: #8b2252;">"client"</span>}),
    awful.key({ modkey, }, <span style="color: #8b2252;">"k"</span>,
        <span style="color: #a020f0;">function</span> ()
            awful.client.focus.byidx(-1)
        <span style="color: #a020f0;">end</span>,
        {description = <span style="color: #8b2252;">"focus prev by index"</span>, group = <span style="color: #8b2252;">"client"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="orgb02f929"></a>Jump to last window<br>
<div class="outline-text-6" id="text-orgb02f929">
<p>
Go to the tag with the last focused window:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org0b39de1"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, }, <span style="color: #8b2252;">"Escape"</span>, awful.tag.history.restore,
       {description = <span style="color: #8b2252;">"go back"</span>, group = <span style="color: #8b2252;">"tag"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org7cc8d27"></a>Jump to urgent window<br>
<div class="outline-text-6" id="text-org7cc8d27">
<p>
Jump to window with urgent flag:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgac4c07c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, }, <span style="color: #8b2252;">"u"</span>, awful.client.urgent.jumpto,
       {description = <span style="color: #8b2252;">"jump to urgent client"</span>, group = <span style="color: #8b2252;">"client"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org44f6080"></a>Browse window history<br>
<div class="outline-text-6" id="text-org44f6080">
<p>
Loop through window history on the current tag and screen (like <code>Alt</code> + <code>TAB</code>):
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orga7c314c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, }, <span style="color: #8b2252;">"Tab"</span>,
        <span style="color: #a020f0;">function</span> ()
            awful.client.focus.history.previous()
            <span style="color: #a020f0;">if</span> client.focus <span style="color: #a020f0;">then</span>
                client.focus:raise()
            <span style="color: #a020f0;">end</span>
        <span style="color: #a020f0;">end</span>,
        {description = <span style="color: #8b2252;">"go back"</span>, group = <span style="color: #8b2252;">"client"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org32a614d"></a>Restore window<br>
<div class="outline-text-6" id="text-org32a614d">
<p>
Restore minimized window:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org74ebe58"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"n"</span>,
       <span style="color: #a020f0;">function</span> ()
          <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">c</span> = awful.client.restore()
          <span style="color: #b22222;">-- </span><span style="color: #b22222;">Focus restored client</span>
          <span style="color: #a020f0;">if</span> c <span style="color: #a020f0;">then</span>
             client.focus = c
             c:raise()
          <span style="color: #a020f0;">end</span>
       <span style="color: #a020f0;">end</span>,
       {description = <span style="color: #8b2252;">"restore minimized"</span>, group = <span style="color: #8b2252;">"client"</span>})
)
</pre>
</div>
</div>
</li>
</ul>
</div>


<div id="outline-container-org050825f" class="outline-5">
<h5 id="org050825f">Layout</h5>
<div class="outline-text-5" id="text-org050825f">
<p>
This sections contains keybindings related to layout manipulations.
</p>
</div>


<ul class="org-ul">
<li><a id="org7f82435"></a>Move window within layout<br>
<div class="outline-text-6" id="text-org7f82435">
<p>
Swap window with previous / next in current layout using <code>modkey</code> + <code>shift</code> +
<code>j</code> / <code>k</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orge7a3b34"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Layout manipulation</span>
   awful.key({ modkey, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"j"</span>,
      <span style="color: #a020f0;">function</span> () awful.client.swap.byidx(  1) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"swap with next client by index"</span>, group = <span style="color: #8b2252;">"client"</span>}),
   awful.key({ modkey, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"k"</span>,
      <span style="color: #a020f0;">function</span> () awful.client.swap.byidx( -1) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"swap with previousclient by index"</span>, group = <span style="color: #8b2252;">"client"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org78501ef"></a>Resize layout<br>
<div class="outline-text-6" id="text-org78501ef">
<p>
Control client size within layout:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgbd265db"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ modkey,           }, <span style="color: #8b2252;">"l"</span>,
      <span style="color: #a020f0;">function</span> () awful.tag.incmwfact( 0.05) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"increase master width factor"</span>, group = <span style="color: #8b2252;">"layout"</span>}),
   awful.key({ modkey,           }, <span style="color: #8b2252;">"h"</span>,
      <span style="color: #a020f0;">function</span> () awful.tag.incmwfact(-0.05) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"decrease master width factor"</span>, group = <span style="color: #8b2252;">"layout"</span>}),
   awful.key({ modkey, <span style="color: #8b2252;">"Shift"</span>   }, <span style="color: #8b2252;">"h"</span>,
      <span style="color: #a020f0;">function</span> () awful.tag.incnmaster( 1)   <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"increase the number of master clients"</span>,
       group = <span style="color: #8b2252;">"layout"</span>}),
   awful.key({ modkey, <span style="color: #8b2252;">"Shift"</span>   }, <span style="color: #8b2252;">"l"</span>,
      <span style="color: #a020f0;">function</span> () awful.tag.incnmaster(-1)   <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"decrease the number of master clients"</span>,
       group = <span style="color: #8b2252;">"layout"</span>}),
   awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"h"</span>,
      <span style="color: #a020f0;">function</span> () awful.tag.incncol( 1)      <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"increase the number of columns"</span>, group = <span style="color: #8b2252;">"layout"</span>}),
   awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"l"</span>,
      <span style="color: #a020f0;">function</span> () awful.tag.incncol(-1)      <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"decrease the number of columns"</span>, group = <span style="color: #8b2252;">"layout"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org0c1bb2d"></a>Change layout<br>
<div class="outline-text-6" id="text-org0c1bb2d">
<p>
Cycle through available layouts using <code>modkey</code> + <code>space</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org7c08094"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ modkey, }, <span style="color: #8b2252;">"space"</span>,
      <span style="color: #a020f0;">function</span> () awful.layout.inc( 1) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"select next"</span>, group = <span style="color: #8b2252;">"layout"</span>}),
   awful.key({ modkey, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"space"</span>,
      <span style="color: #a020f0;">function</span> () awful.layout.inc(-1) <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"select previous"</span>, group = <span style="color: #8b2252;">"layout"</span>})
)
</pre>
</div>
</div>
</li>
</ul>
</div>


<div id="outline-container-org5fffba8" class="outline-5">
<h5 id="org5fffba8">Application shortcuts</h5>
<div class="outline-text-5" id="text-org5fffba8">
<p>
Keybindings for frequently used <a href="#default_programs">applications</a>.
</p>
</div>


<ul class="org-ul">
<li><a id="org61079c7"></a>Toggle main menu<br>
<div class="outline-text-6" id="text-org61079c7">
<p>
Toggle <a href="#main_menu">main menu</a>:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orge7a047d"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, }, <span style="color: #8b2252;">"w"</span>, <span style="color: #a020f0;">function</span> () mymainmenu:show() <span style="color: #a020f0;">end</span>,
              {description = <span style="color: #8b2252;">"show main menu"</span>, group = <span style="color: #8b2252;">"awesome"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org362e632"></a>Terminal<br>
<div class="outline-text-6" id="text-org362e632">
<p>
Open a terminal with <code>modkey</code> + <code>return</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org9763a5a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ modkey, }, <span style="color: #8b2252;">"Return"</span>,
      <span style="color: #a020f0;">function</span> () awful.spawn(terminal) <span style="color: #a020f0;">end</span>,
      { description = <span style="color: #8b2252;">"open a terminal"</span>, group = <span style="color: #8b2252;">"launcher"</span> })
)
</pre>
</div>
</div>
</li>


<li><a id="org2242652"></a>Internet browser<br>
<div class="outline-text-6" id="text-org2242652">
<p>
Start the web browser with <code>modkey</code> + <code>ctrl</code> + <code>return</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgc8c6984"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"Return"</span>,
      <span style="color: #a020f0;">function</span> () awful.spawn(internet_browser) <span style="color: #a020f0;">end</span>,
      { description = <span style="color: #8b2252;">"internet browser"</span>, group = <span style="color: #8b2252;">"launcher"</span> })
)
</pre>
</div>
</div>
</li>


<li><a id="orga7dcf8b"></a>Conkeror<br>
<div class="outline-text-6" id="text-orga7dcf8b">
<p>
Start conkeror, an alternative web browser using <code>modkey</code> + <code>ctrl</code> + <code>shift</code> +
<code>return</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgca01f44"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ modkey, <span style="color: #8b2252;">"Control"</span>, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"Return"</span>,
      <span style="color: #a020f0;">function</span> () awful.spawn(<span style="color: #8b2252;">"conkeror"</span>) <span style="color: #a020f0;">end</span>,
      { description = <span style="color: #8b2252;">"conkeror browser"</span>, group = <span style="color: #8b2252;">"launcher"</span> })
)
</pre>
</div>
</div>
</li>


<li><a id="org9933156"></a>Emacs<br>
<div class="outline-text-6" id="text-org9933156">
<p>
Start emacs with <code>modkey</code> + <code>shift</code> + <code>return</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgb0a4b4f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ modkey, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"Return"</span>,
      <span style="color: #a020f0;">function</span> () awful.spawn(emacs) <span style="color: #a020f0;">end</span>,
      { description = <span style="color: #8b2252;">"start emacs"</span>, group = <span style="color: #8b2252;">"launcher"</span> })
)
</pre>
</div>
</div>
</li>


<li><a id="orgaeb2085"></a>File explorer<br>
<div class="outline-text-6" id="text-orgaeb2085">
<p>
Start the file explorer software with <code>modkey</code> + <code>e</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org0d7855b"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ modkey, }, <span style="color: #8b2252;">"e"</span>,
      <span style="color: #a020f0;">function</span> () awful.spawn.with_shell(explorer .. <span style="color: #8b2252;">" ~"</span>) <span style="color: #a020f0;">end</span>,
      { description = <span style="color: #8b2252;">"open file explorer"</span>, group = <span style="color: #8b2252;">"launcher"</span> })
)
</pre>
</div>
</div>
</li>


<li><a id="orged30b3d"></a>Awesome restart<br>
<div class="outline-text-6" id="text-orged30b3d">
<p>
Restart awesome-wm (reload <code>rc.lua</code>) with <code>modkey</code> + <code>ctrl</code> + <code>r</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org6b6234c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"r"</span>, awesome.restart,
       {description = <span style="color: #8b2252;">"reload awesome"</span>, group = <span style="color: #8b2252;">"awesome"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org3c6e0fc"></a>Logout<br>
<div class="outline-text-6" id="text-org3c6e0fc">
<p>
Log out with <code>modkey</code> + <code>shift</code> + <code>q</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgaab8750"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"q"</span>, awesome.quit,
       {description = <span style="color: #8b2252;">"quit awesome"</span>, group = <span style="color: #8b2252;">"awesome"</span>})
)
</pre>
</div>
</div>
</li>
</ul>
</div>


<div id="outline-container-org6250a68" class="outline-5">
<h5 id="keybindings_prompts">Prompts</h5>
<div class="outline-text-5" id="text-keybindings_prompts">
<p>
This section contains keybindings for prompts.
</p>
</div>


<ul class="org-ul">
<li><a id="orgc3ac92b"></a>Shell execution<br>
<div class="outline-text-6" id="text-orgc3ac92b">
<p>
Execute arbitrary shell commands with <code>modkey</code> + <code>r</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgf61553d"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Prompt</span>
    awful.key({ modkey }, <span style="color: #8b2252;">"r"</span>,
       <span style="color: #a020f0;">function</span> () awful.screen.focused().mypromptbox:run() <span style="color: #a020f0;">end</span>,
       {description = <span style="color: #8b2252;">"run prompt"</span>, group = <span style="color: #8b2252;">"launcher"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="orgd01f35a"></a>Lua execution<br>
<div class="outline-text-6" id="text-orgd01f35a">
<p>
Execute lua code with <code>modkey</code> + <code>x</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgcb29bf6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey }, <span style="color: #8b2252;">"x"</span>,
              <span style="color: #a020f0;">function</span> ()
                  awful.prompt.run {
                    prompt       = <span style="color: #8b2252;">"Run Lua code: "</span>,
                    textbox      = awful.screen.focused().mypromptbox.widget,
                    exe_callback = awful.util.eval,
                    history_path = awful.util.get_cache_dir() .. <span style="color: #8b2252;">"/history_eval"</span>
                  }
              <span style="color: #a020f0;">end</span>,
              {description = <span style="color: #8b2252;">"lua execute prompt"</span>, group = <span style="color: #8b2252;">"awesome"</span>})
)
</pre>
</div>
</div>
</li>


<li><a id="org3b0fca5"></a>Global prompt<br>
<div class="outline-text-6" id="text-org3b0fca5">
<p>
Toggle the custom <a href="#global_prompt">global prompt</a> with <code>modkey</code> + <code>z</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orge0e657a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ modkey }, <span style="color: #8b2252;">"z"</span>,
      <span style="color: #a020f0;">function</span> ()
         awful.screen.focused().mywibox_globalprompt.visible = <span style="color: #008b8b;">true</span>
         awful.prompt.run {
            prompt = <span style="color: #8b2252;">"&#9658; "</span>,
            textbox = awful.screen.focused().myglobalpromptbox.widget,
            exe_callback = global_prompt.run,
            completion_callback = global_prompt.comp,
            history_path = awful.util.getdir(<span style="color: #8b2252;">"cache"</span>) .. <span style="color: #8b2252;">"/history_global"</span>,
            history_max = 50,
            <span style="color: #0000ff;">done_callback</span> = <span style="color: #a020f0;">function</span> ()
               <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> <span style="color: #a020f0;">in</span> screen <span style="color: #a020f0;">do</span>
                  s.mywibox_globalprompt.visible = <span style="color: #008b8b;">false</span>
               <span style="color: #a020f0;">end</span>
            <span style="color: #a020f0;">end</span>
         }
      <span style="color: #a020f0;">end</span>,
      {description = <span style="color: #8b2252;">"Global prompt"</span>, group = <span style="color: #8b2252;">"launcher"</span>})
)
</pre>
</div>
</div>
</li>
</ul>
</div>


<div id="outline-container-org53c845c" class="outline-5">
<h5 id="org53c845c">Menubar</h5>
<div class="outline-text-5" id="text-org53c845c">
<p>
Start the menubar with <code>modkey</code> + <code>a</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org59e040d"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Menubar</span>
globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey }, <span style="color: #8b2252;">"p"</span>, <span style="color: #a020f0;">function</span>() menubar.show() <span style="color: #a020f0;">end</span>,
              {description = <span style="color: #8b2252;">"show the menubar"</span>, group = <span style="color: #8b2252;">"launcher"</span>})
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org902cb3e" class="outline-5">
<h5 id="org902cb3e">Volume control</h5>
<div class="outline-text-5" id="text-org902cb3e">
<p>
Use special keyboard keys to control the audio volume:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org179d8c6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Volume</span>
globalkeys = awful.util.table.join(
   globalkeys,
   awful.key({ }, <span style="color: #8b2252;">"XF86AudioRaiseVolume"</span>,
      <span style="color: #a020f0;">function</span> ()
         awful.spawn(awesome_paths.config_dir ..
                        <span style="color: #8b2252;">"/scripts/osdvol.sh volup"</span>)
         update_volume_widget()
   <span style="color: #a020f0;">end</span>),
   awful.key({ }, <span style="color: #8b2252;">"XF86AudioLowerVolume"</span>,
      <span style="color: #a020f0;">function</span> ()
         awful.spawn(awesome_paths.config_dir ..
                        <span style="color: #8b2252;">"/scripts/osdvol.sh voldown"</span>)
         update_volume_widget()
   <span style="color: #a020f0;">end</span>),
   awful.key({ }, <span style="color: #8b2252;">"XF86AudioMute"</span>,
      <span style="color: #a020f0;">function</span> ()
         awful.spawn(awesome_paths.config_dir ..
                        <span style="color: #8b2252;">"/scripts/osdvol.sh mute"</span>)
         update_volume_widget()
   <span style="color: #a020f0;">end</span>)
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org7dd8fc7" class="outline-5">
<h5 id="org7dd8fc7">Screen lock</h5>
<div class="outline-text-5" id="text-org7dd8fc7">
<p>
Lock the screen using <code>xscreensaver</code> with <code>modkey</code> + <code>ctrl</code> + <code>l</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org8c28280"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Screen lock</span>
globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"l"</span>,
       <span style="color: #a020f0;">function</span> ()
          awful.spawn(<span style="color: #8b2252;">"xscreensaver-command -lock"</span>)
       <span style="color: #a020f0;">end</span>,
       {description = <span style="color: #8b2252;">"Lock screen"</span>, group = <span style="color: #8b2252;">"awesome"</span>})
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org20b97c0" class="outline-5">
<h5 id="pass_manager">Password manager</h5>
<div class="outline-text-5" id="text-pass_manager">
<p>
I use the <a href="https://www.passwordstore.org/">pass</a> utility to manage passwords.  It comes with a <a href="https://tools.suckless.org/dmenu/">dmenu</a> tool
(<code>passmenu</code>) for inserting passwords (or copying them to the clipboard).  The
following is a slightly modified version of the <code>passmenu</code> script.  The original
script returns the first line for each password entry; instead, the following
script reads the line preceding the first empty line.
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org59996a6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[scripts/passmenu.sh]</div><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/</span><span style="color: #a020f0;">env</span><span style="color: #b22222;"> bash</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Add `--type` to type the password using xdotool</span>

<span style="color: #483d8b;">shopt</span> -s nullglob globstar

<span style="color: #b22222;"># </span><span style="color: #b22222;">If set to true the password name must be passed via the command line (after</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">--type)</span>
<span style="color: #a0522d;">flag_debug</span>=false

<span style="color: #b22222;"># </span><span style="color: #b22222;">Type or copy to clipboard</span>
<span style="color: #a0522d;">typeit</span>=0
<span style="color: #a020f0;">if</span> [[ $<span style="color: #a0522d;">1</span> == <span style="color: #8b2252;">"--type"</span> ]]; <span style="color: #a020f0;">then</span>
    <span style="color: #a0522d;">typeit</span>=1
    <span style="color: #483d8b;">shift</span>
<span style="color: #a020f0;">fi</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Build list of passwords for dmenu</span>
<span style="color: #a0522d;">prefix</span>=${<span style="color: #a0522d;">PASSWORD_STORE_DIR</span>-~/.password-store}
<span style="color: #a0522d;">password_files</span>=( <span style="color: #8b2252;">"$prefix"</span>/**/*.gpg )
<span style="color: #a0522d;">password_files</span>=( <span style="color: #8b2252;">"${password_files[@]#"</span>$<span style="color: #a0522d;">prefix</span><span style="color: #8b2252;">"/}"</span> )
<span style="color: #a0522d;">password_files</span>=( <span style="color: #8b2252;">"${password_files[@]%.gpg}"</span> )

<span style="color: #b22222;"># </span><span style="color: #b22222;">Read password name from command line if used in debug mode</span>
<span style="color: #a020f0;">if</span> [[ <span style="color: #8b2252;">"$flag_debug"</span> = true ]]; <span style="color: #a020f0;">then</span>
    <span style="color: #a0522d;">password</span>=$<span style="color: #a0522d;">1</span>
<span style="color: #a020f0;">else</span>
    <span style="color: #a0522d;">password</span>=$(<span style="color: #ff00ff;">printf</span> <span style="color: #8b2252;">'%s\n'</span> <span style="color: #8b2252;">"${password_files[@]}"</span> | dmenu <span style="color: #8b2252;">"$@"</span>)
<span style="color: #a020f0;">fi</span>

[[ -n $<span style="color: #a0522d;">password</span> ]] || <span style="color: #a020f0;">exit</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Get password</span>
<span style="color: #a0522d;">pass_full</span>=$(<span style="color: #ff00ff;">pass</span> show <span style="color: #8b2252;">"$password"</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Keep line before first empty line</span>
<span style="color: #a0522d;">pass</span>=$(<span style="color: #ff00ff;">echo</span> <span style="color: #8b2252;">"$pass_full"</span> | awk <span style="color: #8b2252;">'{if ($0 ~ /^$/){ exit; } else { a=$0; }} END {print a}'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Print, type or store password</span>
<span style="color: #a020f0;">if</span> [[ <span style="color: #8b2252;">"$flag_debug"</span> = true ]]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"type=$typeit, $pass"</span>
<span style="color: #a020f0;">else</span>
    <span style="color: #a020f0;">if</span> [[ $<span style="color: #a0522d;">typeit</span> -eq 0 ]]; <span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">pass</span> | xclip -selection c
    <span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">pass</span> | xdotool type --clearmodifiers --file -
    <span style="color: #a020f0;">fi</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>

<p>
The following adds a keybinding to start the custom <code>passmenu</code> command.  To use
it, place the cursor on a password field (e.g. in a terminal or web page) and
press the keybinding.  Then use a fuzzy text search on the spawned <code>dmenu</code>.
This will insert the corresponding password.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org75a2051"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Screen lock</span>
globalkeys = awful.util.table.join(globalkeys,
    awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"p"</span>,
       <span style="color: #a020f0;">function</span> ()
          awful.spawn(passmenu)
       <span style="color: #a020f0;">end</span>,
       {description = <span style="color: #8b2252;">"Insert password"</span>, group = <span style="color: #8b2252;">"awesome"</span>})
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org0222cb0" class="outline-5">
<h5 id="org0222cb0">Register keybindings</h5>
<div class="outline-text-5" id="text-org0222cb0">
<p>
Register the keybindings defined in the <code>globalkeys</code> table:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org47c8d58"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">Set keys</span>
root.keys(globalkeys)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgf5c4719" class="outline-4">
<h4 id="orgf5c4719">Client bindings</h4>
<div class="outline-text-4" id="text-orgf5c4719">
<p>
The keybindings defined in this section control individual windows.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgd18db00"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = {}
</pre>
</div>
</div>

<div id="outline-container-orgf9f7750" class="outline-5">
<h5 id="orgf9f7750">Fullscreen</h5>
<div class="outline-text-5" id="text-orgf9f7750">
<p>
Get the current window in fullscreen with <code>modkey</code> + <code>f</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org8f8a057"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = awful.util.table.join(
   clientkeys,
   awful.key({ modkey, }, <span style="color: #8b2252;">"f"</span>,
      <span style="color: #a020f0;">function</span> (c) c.fullscreen = <span style="color: #a020f0;">not</span> c.fullscreen  <span style="color: #a020f0;">end</span>)
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org6f4fcb1" class="outline-5">
<h5 id="org6f4fcb1">Kill window</h5>
<div class="outline-text-5" id="text-org6f4fcb1">
<p>
Kill current window with <code>modkey</code> + <code>shift</code> + <code>c</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org88e65d7"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = awful.util.table.join(clientkeys,
    awful.key({ modkey, <span style="color: #8b2252;">"Shift"</span> }, <span style="color: #8b2252;">"c"</span>, <span style="color: #a020f0;">function</span> (c) c:kill() <span style="color: #a020f0;">end</span>)
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org222ab09" class="outline-5">
<h5 id="org222ab09">Toggle floating window mode</h5>
<div class="outline-text-5" id="text-org222ab09">
<p>
Set window to floating mode (does not use layout) with <code>modkey</code> + <code>ctrl</code> +
<code>space</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org1263c92"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = awful.util.table.join(clientkeys,
    awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"space"</span>, awful.client.floating.toggle )
)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgdf0d68b" class="outline-5">
<h5 id="orgdf0d68b">Move window to master position</h5>
<div class="outline-text-5" id="text-orgdf0d68b">
<p>
Swap window with window in the current layout's master position with <code>modkey</code> +
<code>ctrl</code> + <code>return</code>.  Note that this is currently overridden by the web browser
shortcut.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org6e945b9"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = awful.util.table.join(
   clientkeys,
   awful.key({ modkey, <span style="color: #8b2252;">"Control"</span> }, <span style="color: #8b2252;">"Return"</span>,
      <span style="color: #a020f0;">function</span> (c) c:swap(awful.client.getmaster()) <span style="color: #a020f0;">end</span>)
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org17f50a1" class="outline-5">
<h5 id="org17f50a1">Move window to other screen</h5>
<div class="outline-text-5" id="text-org17f50a1">
<p>
Send current window to other screen with <code>modkey</code> + <code>o</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org77bfb5b"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = awful.util.table.join(
   clientkeys,
   awful.key({ modkey, }, <span style="color: #8b2252;">"o"</span>, <span style="color: #a020f0;">function</span> (c)
         c:move_to_screen(c.screen.index - 1)
   <span style="color: #a020f0;">end</span>)
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org9989aaa" class="outline-5">
<h5 id="org9989aaa">Toggle on-top property</h5>
<div class="outline-text-5" id="text-org9989aaa">
<p>
Toggle on-top flag (useful for floating windows) with <code>modkey</code> + <code>t</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orge789105"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = awful.util.table.join(clientkeys,
    awful.key({ modkey, }, <span style="color: #8b2252;">"t"</span>, <span style="color: #a020f0;">function</span> (c) c.ontop = <span style="color: #a020f0;">not</span> c.ontop <span style="color: #a020f0;">end</span>)
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org78f04e3" class="outline-5">
<h5 id="org78f04e3">Minimize window</h5>
<div class="outline-text-5" id="text-org78f04e3">
<p>
Minimize the current window with <code>modkey</code> + <code>n</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org91c7509"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = awful.util.table.join(clientkeys,
    awful.key({ modkey, }, <span style="color: #8b2252;">"n"</span>,
        <span style="color: #a020f0;">function</span> (c)
            <span style="color: #b22222;">-- </span><span style="color: #b22222;">The client currently has the input focus, so it cannot be</span>
            <span style="color: #b22222;">-- </span><span style="color: #b22222;">minimized, since minimized clients can't have the focus.</span>
            c.minimized = <span style="color: #008b8b;">true</span>
        <span style="color: #a020f0;">end</span>)
)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgb294277" class="outline-5">
<h5 id="orgb294277">Toggle maximized mode</h5>
<div class="outline-text-5" id="text-orgb294277">
<p>
Toggle maximize property for the current window with <code>modkey</code> + <code>m</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org1a4b712"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = awful.util.table.join(clientkeys,
    awful.key({ modkey,           }, <span style="color: #8b2252;">"m"</span>,
        <span style="color: #a020f0;">function</span> (c)
            c.maximized_horizontal = <span style="color: #a020f0;">not</span> c.maximized_horizontal
            c.maximized_vertical   = <span style="color: #a020f0;">not</span> c.maximized_vertical
        <span style="color: #a020f0;">end</span>)
)
</pre>
</div>
</div>
</div>


<div id="outline-container-org350fbd1" class="outline-5">
<h5 id="org350fbd1">Show window information</h5>
<div class="outline-text-5" id="text-org350fbd1">
<p>
Show a popup notification with information on the current window (class,
properties, etc.).  Triggered by pressing <code>modkey</code> + <code>i</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org4bbcd5f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>clientkeys = awful.util.table.join(clientkeys,
    awful.key({ modkey,           }, <span style="color: #8b2252;">"i"</span>,
      <span style="color: #a020f0;">function</span> (c)
        <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">geom</span> = c:geometry()
        <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">t</span> = <span style="color: #8b2252;">""</span>

        <span style="color: #a020f0;">if</span> c.class <span style="color: #a020f0;">then</span> t = t .. <span style="color: #8b2252;">"Class: "</span> .. c.class .. <span style="color: #8b2252;">"\n"</span> <span style="color: #a020f0;">end</span>
        <span style="color: #a020f0;">if</span> c.instance <span style="color: #a020f0;">then</span> t = t .. <span style="color: #8b2252;">"Instance: "</span> .. c.instance .. <span style="color: #8b2252;">"\n"</span> <span style="color: #a020f0;">end</span>
        <span style="color: #a020f0;">if</span> c.role <span style="color: #a020f0;">then</span> t = t .. <span style="color: #8b2252;">"Role: "</span> .. c.role .. <span style="color: #8b2252;">"\n"</span> <span style="color: #a020f0;">end</span>
        <span style="color: #a020f0;">if</span> c.name <span style="color: #a020f0;">then</span> t = t .. <span style="color: #8b2252;">"Name: "</span> .. c.name .. <span style="color: #8b2252;">"\n"</span> <span style="color: #a020f0;">end</span>
        <span style="color: #a020f0;">if</span> c.type <span style="color: #a020f0;">then</span> t = t .. <span style="color: #8b2252;">"Type: "</span> .. c.type .. <span style="color: #8b2252;">"\n"</span> <span style="color: #a020f0;">end</span>
        <span style="color: #a020f0;">if</span> c.fullscreen <span style="color: #a020f0;">then</span> t = t .. <span style="color: #8b2252;">"Fullscreen; yes\n"</span> <span style="color: #a020f0;">end</span>
        <span style="color: #a020f0;">if</span> c.maximized_horizontal <span style="color: #a020f0;">then</span> t = t .. <span style="color: #8b2252;">"Maximized Horizontal: yes\n"</span> <span style="color: #a020f0;">en</span><span style="color: #ee82ee; background-color: #333333;">d</span>
        <span style="color: #a020f0;">if</span> c.maximized_vertical <span style="color: #a020f0;">then</span> t = t .. <span style="color: #8b2252;">"Maximized Vertical: yes\n"</span> <span style="color: #a020f0;">end</span>
        <span style="color: #a020f0;">if</span> c.above <span style="color: #a020f0;">then</span> t = t .. <span style="color: #8b2252;">"Above: yes\n"</span> <span style="color: #a020f0;">end</span>

        <span style="color: #a020f0;">if</span> geom.width <span style="color: #a020f0;">and</span> geom.height <span style="color: #a020f0;">and</span> geom.x <span style="color: #a020f0;">and</span> geom.y <span style="color: #a020f0;">then</span>
           t = t .. <span style="color: #8b2252;">"Dimensions: "</span> .. <span style="color: #8b2252;">"x:"</span> .. geom.x .. <span style="color: #8b2252;">" y:"</span> .. geom.y ..
              <span style="color: #8b2252;">" w:"</span> .. geom.width .. <span style="color: #8b2252;">" h:"</span> .. geom.height
        <span style="color: #a020f0;">end</span>

        naughty.notify({
          text = t,
          timeout = 5,
        })
    <span style="color: #a020f0;">end</span>)
)

<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgc071392" class="outline-2">
<h2 id="wibox">Wibox </h2>
<div class="outline-text-2" id="text-wibox">
<p>
The wibox is the top bar shown on Fig.&nbsp;<a href="#org37f4700">1</a>.  It is populated
with widgets previously set up, including the <a href="#main_menu">main menu</a>, <a href="#tags">tag list</a>, task list and
the custom <a href="#cmus">music</a> / <a href="#email">email</a> / <a href="#ttrss">news</a> widgets.
</p>

<p>
A wibox is created on each screen; the only difference between the screens is
that only a single instance of the system tray widget can be added (it is added
on screen 1 for my configuration).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org2de0202"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{ Wibox</span>

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Create a wibox for each screen and add it</span>
awful.screen.connect_for_each_screen(<span style="color: #a020f0;">function</span>(s)
</pre>
</div>

<p>
In the following sections, <code>s</code> is the current screen index.
</p>
</div>


<div id="outline-container-org65ad674" class="outline-3">
<h3 id="org65ad674">Main prompt box</h3>
<div class="outline-text-3" id="text-org65ad674">
<p>
The prompts defined in the <a href="#keybindings_prompts">key bindings section</a> toggle the visibility of a text
widget on the wibox for user input.  This text widget is defined here:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org7b0dd57"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Create a promptbox for each screen</span>
    s.mypromptbox = awful.widget.prompt()
    s.mypromptbox.font = <span style="color: #8b2252;">"Consolas 18"</span>

    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Confirmation prompt</span>
    s.mypromptbox_conf = awful.widget.prompt()

    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Global prompt</span>
    s.myglobalpromptbox = awful.widget.prompt()
    s.mywibox_globalprompt = awful.wibox({ position = <span style="color: #8b2252;">"bottom"</span>, screen = s,
                                     font = <span style="color: #8b2252;">"Consolas 18"</span> })
    s.mywibox_globalprompt:setup {
       layout = wibox.layout.align.horizontal,
       s.myglobalpromptbox
    }
    s.mywibox_globalprompt.visible = <span style="color: #008b8b;">false</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgdca71e2" class="outline-3">
<h3 id="orgdca71e2">Launchers</h3>
<div class="outline-text-3" id="text-orgdca71e2">
<p>
Create launchers.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org559d692"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Create launchers</span>
    s.mylaunchbar = launchbar.new(awesome_paths.config_dir .. <span style="color: #8b2252;">"/shortcuts/"</span>,
                                  myiconfinder)
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf0c4535" class="outline-3">
<h3 id="orgf0c4535">Wibox</h3>
<div class="outline-text-3" id="text-orgf0c4535">
<p>
This section defines the main wibox, which can be seen at the top in
Fig.&nbsp;<a href="#org37f4700">1</a>.  It contains all the widgets and is defined as
follows:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org603df41"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Create the wibox</span>
    s.mywibox = awful.wibox({ position = <span style="color: #8b2252;">"top"</span>, screen = s })

    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Create an imagebox widget which will contains an icon indicating which</span>
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">layout we're using.  We need one layoutbox per screen.</span>
    s.mylayoutbox = awful.widget.layoutbox(s)
    s.mylayoutbox:buttons(
       awful.util.table.join(
          awful.button({ }, 1, <span style="color: #a020f0;">function</span> () awful.layout.inc( 1) <span style="color: #a020f0;">end</span>),
          awful.button({ }, 3, <span style="color: #a020f0;">function</span> () awful.layout.inc(-1) <span style="color: #a020f0;">end</span>),
          awful.button({ }, 4, <span style="color: #a020f0;">function</span> () awful.layout.inc( 1) <span style="color: #a020f0;">end</span>),
          awful.button({ }, 5, <span style="color: #a020f0;">function</span> () awful.layout.inc(-1) <span style="color: #a020f0;">end</span>)))

    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Create a tasklist widget</span>
    s.mytasklist = awful.widget.tasklist(
       s, awful.widget.tasklist.filter.currenttags, tasklist_buttons)

    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Create a taglist widget</span>
    s.mytaglist = awful.widget.taglist(s, awful.widget.taglist.filter.all,
                                       taglist_buttons)

    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Add widgets to the wibox</span>
    s.mywibox:setup {
        layout = wibox.layout.align.horizontal,
        { <span style="color: #b22222;">-- </span><span style="color: #b22222;">Left widgets</span>
            layout = wibox.layout.fixed.horizontal,
            mylauncher,
            s.mypromptbox_conf,
            s.mytaglist,
            s.mylaunchbar,
            s.mypromptbox
        },
        s.mytasklist, <span style="color: #b22222;">-- </span><span style="color: #b22222;">Middle widget</span>
        { <span style="color: #b22222;">-- </span><span style="color: #b22222;">Right widgets</span>
            layout = wibox.layout.fixed.horizontal,
            tb_cmus,
            separator,
            mailicon,
            separator,
            tb_ttrss,
            separator,
            memory_label,
            memory_widget,
            separator,
            volume_master,
            separator,
            mykeyboardlayout,
            wibox.widget.systray(),
            mytextclock,
            <span style="color: #b22222;">--</span><span style="color: #b22222;">calendar,</span>
            s.mylayoutbox,
            myleave_launcher
        },
    }
</pre>
</div>

<p>
The wibox is decomposed into three sections: left, center and right.  Widgets
are added to each section and then concatenated into a single layout which is in
turn added to the wibox.
</p>
</div>
</div>


<div id="outline-container-orgb9a7683" class="outline-3">
<h3 id="orgb9a7683">Close screen for loop</h3>
<div class="outline-text-3" id="text-orgb9a7683">
<p>
This code block closes the <a href="#org2de0202">for loop</a> creating a wibox on each screen.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgd953ee0"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #a020f0;">end</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org3d8153a" class="outline-2">
<h2 id="rules">Rules</h2>
<div class="outline-text-2" id="text-rules">
<p>
Awesome allows the definition of rules for program window management based on
their class or instance name.  If the link is still up, <a href="https://awesome.naquadah.org/wiki/Understanding_Rules">this page</a> contains some
basic description of rules.
</p>

<p>
Only a few simple rules are defined here:
</p>
<ul class="org-ul">
<li>Set of few programs as "floating": mplayer, pinentry, gimp.</li>
<li>Fix cmus, newsboat on the second tag of the second screen.</li>
<li>Thunderbird goes on the first tag of the second screen.</li>
<li>I had issues with <code>ristretto</code> starting in a maximized state; I am not sure
whether it is necessary, but I am explicitly disabling the "maximized" option
here.</li>
</ul>

<div class="org-src-container">
<pre class="src src-lua" id="orge8c77f6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Rules</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Rules to apply to new clients (through the "manage" signal).</span>
awful.rules.rules = {
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">All clients will match this rule.</span>
    { rule = { },
      properties = { border_width = beautiful.border_width,
                     border_color = beautiful.border_normal,
                     focus = awful.client.focus.filter,
                     raise = <span style="color: #008b8b;">true</span>,
                     keys = clientkeys,
                     buttons = clientbuttons,
                     screen = awful.screen.preferred } },

    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Floating clients.</span>
    { rule_any = {
        instance = {
          <span style="color: #8b2252;">"DTA"</span>,  <span style="color: #b22222;">-- </span><span style="color: #b22222;">Firefox addon DownThemAll.</span>
          <span style="color: #8b2252;">"copyq"</span>,  <span style="color: #b22222;">-- </span><span style="color: #b22222;">Includes session name in class.</span>
        },
        class = {
          <span style="color: #8b2252;">"Arandr"</span>,
          <span style="color: #8b2252;">"Gpick"</span>,
          <span style="color: #8b2252;">"Kruler"</span>,
          <span style="color: #8b2252;">"MessageWin"</span>,  <span style="color: #b22222;">-- </span><span style="color: #b22222;">kalarm.</span>
          <span style="color: #8b2252;">"Sxiv"</span>,
          <span style="color: #8b2252;">"Wpa_gui"</span>,
          <span style="color: #8b2252;">"pinentry"</span>,
          <span style="color: #8b2252;">"veromix"</span>,
          <span style="color: #8b2252;">"xtightvncviewer"</span>,
          <span style="color: #8b2252;">"MPlayer"</span>,
          <span style="color: #8b2252;">"gimp"</span>,
          <span style="color: #8b2252;">"plugin-container"</span>},

        name = {
          <span style="color: #8b2252;">"Event Tester"</span>,  <span style="color: #b22222;">-- </span><span style="color: #b22222;">xev.</span>
        },
        role = {
          <span style="color: #8b2252;">"AlarmWindow"</span>,  <span style="color: #b22222;">-- </span><span style="color: #b22222;">Thunderbird's calendar.</span>
          <span style="color: #8b2252;">"pop-up"</span>,       <span style="color: #b22222;">-- </span><span style="color: #b22222;">e.g. Google Chrome's (detached) Developer Tools.</span>
        }
      }, properties = { floating = <span style="color: #008b8b;">true</span> }},

    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Add titlebars to normal clients and dialogs</span>
    <span style="color: #b22222;">--</span><span style="color: #b22222;">{ rule_any = {type = { "normal", "dialog" }</span>
    <span style="color: #b22222;">--  </span><span style="color: #b22222;">}, properties = { titlebars_enabled = true }</span>
    <span style="color: #b22222;">--</span><span style="color: #b22222;">},</span>

    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Set Firefox to always map on the tag named "2" on screen 1.</span>
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">{ rule = { class = "Firefox" },</span>
    <span style="color: #b22222;">--   </span><span style="color: #b22222;">properties = { screen = 1, tag = "2" } },</span>
    { rule = { instance = <span style="color: #8b2252;">"cmus"</span> },
      properties = { screen = 2, tag = <span style="color: #8b2252;">"2"</span> } },
    { rule = { instance = <span style="color: #8b2252;">"tmplayer"</span> },
      properties = { screen = 2, tag = <span style="color: #8b2252;">"2"</span> } },
    { rule = { instance = <span style="color: #8b2252;">"newsboat"</span> },
      properties = { screen = 2, tag = <span style="color: #8b2252;">"2"</span> } },
    { rule = { class = <span style="color: #8b2252;">"Thunderbird"</span> },
      properties = { screen = 2, tag = <span style="color: #8b2252;">"@"</span> } },
    { rule = { instance = <span style="color: #8b2252;">"ristretto"</span> },
      properties = { maximized = <span style="color: #008b8b;">false</span> } },
}
<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org120b361" class="outline-2">
<h2 id="org120b361">Signals</h2>
<div class="outline-text-2" id="text-org120b361">
<p>
This is default code setting up focus following the mouse, titlebars (which are
disabled) and border coloring.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org18a7de0"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div><span style="color: #b22222;">-- </span><span style="color: #b22222;">{{{ Signals</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Signal function to execute when a new client appears.</span>
client.connect_signal(<span style="color: #8b2252;">"manage"</span>, <span style="color: #a020f0;">function</span> (c)
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">Set the windows at the slave,</span>
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">i.e. put it at the end of others instead of setting it master.</span>
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">if not awesome.startup then awful.client.setslave(c) end</span>

    <span style="color: #a020f0;">if</span> awesome.startup <span style="color: #a020f0;">and</span>
      <span style="color: #a020f0;">not</span> c.size_hints.user_position
      <span style="color: #a020f0;">and</span> <span style="color: #a020f0;">not</span> c.size_hints.program_position <span style="color: #a020f0;">then</span>
        <span style="color: #b22222;">-- </span><span style="color: #b22222;">Prevent clients from being unreachable after screen count changes.</span>
        awful.placement.no_offscreen(c)
    <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>)

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Add a titlebar if titlebars_enabled is set to true in the rules.</span>
client.connect_signal(<span style="color: #8b2252;">"request::titlebars"</span>, <span style="color: #a020f0;">function</span>(c)
    <span style="color: #b22222;">-- </span><span style="color: #b22222;">buttons for the titlebar</span>
    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">buttons</span> = awful.util.table.join(
        awful.button({ }, 1, <span style="color: #a020f0;">function</span>()
            client.focus = c
            c:raise()
            awful.mouse.client.move(c)
        <span style="color: #a020f0;">end</span>),
        awful.button({ }, 3, <span style="color: #a020f0;">function</span>()
            client.focus = c
            c:raise()
            awful.mouse.client.resize(c)
        <span style="color: #a020f0;">end</span>)
    )

    awful.titlebar(c) : setup {
        { <span style="color: #b22222;">-- </span><span style="color: #b22222;">Left</span>
            awful.titlebar.widget.iconwidget(c),
            buttons = buttons,
            layout  = wibox.layout.fixed.horizontal
        },
        { <span style="color: #b22222;">-- </span><span style="color: #b22222;">Middle</span>
            { <span style="color: #b22222;">-- </span><span style="color: #b22222;">Title</span>
                align  = <span style="color: #8b2252;">"center"</span>,
                widget = awful.titlebar.widget.titlewidget(c)
            },
            buttons = buttons,
            layout  = wibox.layout.flex.horizontal
        },
        { <span style="color: #b22222;">-- </span><span style="color: #b22222;">Right</span>
            awful.titlebar.widget.floatingbutton (c),
            awful.titlebar.widget.maximizedbutton(c),
            awful.titlebar.widget.stickybutton   (c),
            awful.titlebar.widget.ontopbutton    (c),
            awful.titlebar.widget.closebutton    (c),
            layout = wibox.layout.fixed.horizontal()
        },
        layout = wibox.layout.align.horizontal
    }
<span style="color: #a020f0;">end</span>)

<span style="color: #b22222;">-- </span><span style="color: #b22222;">Enable sloppy focus, so that focus follows mouse.</span>
client.connect_signal(<span style="color: #8b2252;">"mouse::enter"</span>, <span style="color: #a020f0;">function</span>(c)
    <span style="color: #a020f0;">if</span> awful.layout.get(c.screen) ~= awful.layout.suit.magnifier
        <span style="color: #a020f0;">and</span> awful.client.focus.filter(c) <span style="color: #a020f0;">then</span>
        client.focus = c
    <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>)

<span style="color: #b22222;">-- </span><span style="color: #b22222;">}}}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgac776d3" class="outline-2">
<h2 id="icon_finder">Icon finder</h2>
<div class="outline-text-2" id="text-icon_finder">
<p>
This is a module used to attempt to automatically find icons for programs.  It
is used by the <a href="#launchbar">launchbar</a> module, and menus (<a href="#main_menu">main menu</a> and <a href="#shutdown">shutdown menu</a>).  It
searches for icons in folders defined in the <code>awesome_paths.iconapps_dir</code>
variable (<code>png</code> and <code>svg</code> files).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org1c3419c"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[icon_finder.lua]</div>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">util</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful.util"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">beautiful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"beautiful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">lfs</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"lfs"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">io</span> = <span style="color: #483d8b;">io</span>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">string</span> = <span style="color: #483d8b;">string</span>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">table</span> = <span style="color: #483d8b;">table</span>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">ipairs</span> = <span style="color: #483d8b;">ipairs</span>
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">tonumber</span> = <span style="color: #483d8b;">tonumber</span>

<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">icon_finder</span> = {}
icon_finder.__index = icon_finder

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">icon_finder.new</span>(icondirs_list)
   <span style="color: #a020f0;">local</span> <span style="color: #483d8b;">self</span> = <span style="color: #483d8b;">setmetatable</span>({}, icon_finder)
   <span style="color: #483d8b;">self</span>.icondirs_list = icondirs_list
   <span style="color: #483d8b;">self</span>.subdir_list = {
      <span style="color: #8b2252;">""</span>,
      <span style="color: #8b2252;">"actions"</span>,
      <span style="color: #8b2252;">"animations"</span>,
      <span style="color: #8b2252;">"apps"</span>,
      <span style="color: #8b2252;">"categories"</span>,
      <span style="color: #8b2252;">"devices"</span>,
      <span style="color: #8b2252;">"emblems"</span>,
      <span style="color: #8b2252;">"emotes"</span>,
      <span style="color: #8b2252;">"mimetypes"</span>,
      <span style="color: #8b2252;">"places"</span>,
      <span style="color: #8b2252;">"special"</span>,
      <span style="color: #8b2252;">"status"</span>
   }
   <span style="color: #483d8b;">self</span>.ext_list = { <span style="color: #8b2252;">"png"</span>, <span style="color: #8b2252;">"svg"</span>, <span style="color: #8b2252;">"xpm"</span> }
   <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">self</span>
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">icon_finder:find</span>(icon_name)
   <span style="color: #a020f0;">if</span> icon_name == <span style="color: #008b8b;">nil</span> <span style="color: #a020f0;">then</span>
      <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">nil</span>
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">if</span> icon_name <span style="color: #a020f0;">and</span> util.file_readable(icon_name) <span style="color: #a020f0;">then</span>
      <span style="color: #a020f0;">return</span> icon_name
   <span style="color: #a020f0;">end</span>
   wildcard = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">sub</span>(icon_name, 1, 1) == <span style="color: #8b2252;">'*'</span>

   <span style="color: #a020f0;">if</span> wildcard <span style="color: #a020f0;">then</span>
      iname = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">sub</span>(icon_name, 2, -1)
   <span style="color: #a020f0;">else</span>
      iname = icon_name
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">ext</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(<span style="color: #483d8b;">self</span>.ext_list) <span style="color: #a020f0;">do</span>
      iname = iname:gsub(<span style="color: #8b2252;">"%."</span> .. ext .. <span style="color: #8b2252;">"$"</span>, <span style="color: #8b2252;">""</span>)
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">self</span>.icondirs_list <span style="color: #a020f0;">then</span>
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">v_base</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(<span style="color: #483d8b;">self</span>.icondirs_list) <span style="color: #a020f0;">do</span>
         <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">v_sub</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(<span style="color: #483d8b;">self</span>.subdir_list) <span style="color: #a020f0;">do</span>
            v = v_base .. <span style="color: #8b2252;">"/"</span> .. v_sub .. <span style="color: #8b2252;">"/"</span>
            <span style="color: #a020f0;">if</span> wildcard <span style="color: #a020f0;">then</span>
               <span style="color: #a020f0;">if</span> lfs.attributes(v, <span style="color: #8b2252;">"mode"</span>) == <span style="color: #8b2252;">"directory"</span> <span style="color: #a020f0;">then</span>
                  <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">file</span> <span style="color: #a020f0;">in</span> lfs.dir(v) <span style="color: #a020f0;">do</span>
                     f_attr = lfs.attributes(v .. <span style="color: #8b2252;">"/"</span> .. file, <span style="color: #8b2252;">"mode"</span>)
                     <span style="color: #a020f0;">if</span> f_attr <span style="color: #a020f0;">and</span> f_attr == <span style="color: #8b2252;">"file"</span> <span style="color: #a020f0;">then</span>
                        i = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">find</span>(file, iname)
                        <span style="color: #a020f0;">if</span> i <span style="color: #a020f0;">then</span>
                           <span style="color: #a020f0;">return</span> v .. <span style="color: #8b2252;">'/'</span> .. file
                        <span style="color: #a020f0;">end</span>
                     <span style="color: #a020f0;">end</span>
                  <span style="color: #a020f0;">end</span>
               <span style="color: #a020f0;">end</span>
            <span style="color: #a020f0;">else</span>
               <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">ext</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(<span style="color: #483d8b;">self</span>.ext_list) <span style="color: #a020f0;">do</span>
                  <span style="color: #a020f0;">if</span> util.file_readable(v .. <span style="color: #8b2252;">"/"</span> .. iname .. <span style="color: #8b2252;">"."</span> .. ext) <span style="color: #a020f0;">then</span>
                     <span style="color: #a020f0;">return</span> v .. <span style="color: #8b2252;">'/'</span> .. iname .. <span style="color: #8b2252;">"."</span> .. ext
                  <span style="color: #a020f0;">end</span>
               <span style="color: #a020f0;">end</span>
            <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
   <span style="color: #b22222;">-- </span><span style="color: #b22222;">Return default icon if missing</span>
   <span style="color: #a020f0;">return</span> beautiful.awesome_icon
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">return</span> <span style="color: #483d8b;">setmetatable</span>(icon_finder, { __call = <span style="color: #a020f0;">function</span>(cls, ...)
                                      <span style="color: #a020f0;">return</span> cls.new(...) <span style="color: #a020f0;">end</span> })
</pre>
</div>
</div>
</div>


<div id="outline-container-org2866f93" class="outline-2">
<h2 id="global_prompt">Global prompt </h2>
<div class="outline-text-2" id="text-global_prompt">
<p>
The default awesome-wm configuration provides two prompts: one to execute shell
commands and one to execute lua code.  The <code>global_prompt</code> module is a custom
module aimed at simplifying the addition of prompts, similar to launchers such
as gnome-do, kupfer for instance.
</p>

<p>
A few prompts are also defined in this module, more can be added as needed.
</p>
</div>

<div id="outline-container-orgd49ee93" class="outline-3">
<h3 id="orgd49ee93">Imports</h3>
<div class="outline-text-3" id="text-orgd49ee93">
<p>
This module requires basic awesome-wm libraries, and file system tools.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org0c9aa17"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">awful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">util</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful.util"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">lfs</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"lfs"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">runorraise</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"runorraise"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">capi</span> = {
  tag = tag,
  client = client,
  keygrabber = keygrabber,
  mouse = mouse,
  screen = screen
}
<span style="color: #a020f0;">local</span> <span style="color: #483d8b;">io</span> = <span style="color: #483d8b;">io</span>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">naughty</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"naughty"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">cmus</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"cmus"</span>)

global_prompt = {}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgbdb1de7" class="outline-3">
<h3 id="global_prompt_utils">Utilities</h3>
<div class="outline-text-3" id="text-global_prompt_utils">
<p>
First, define some helper functions:
</p>

<dl class="org-dl">
<dt><code>generic_completion_wrapper</code></dt><dd>build completion from a list of items.</dd>

<dt><code>table.val_to_str</code></dt><dd>convert value to string.</dd>

<dt><code>table.key_to_str</code></dt><dd>convert table key to string.</dd>

<dt><code>table.tostring</code></dt><dd>convert table to string.</dd>
</dl>

<div class="org-src-container">
<pre class="src src-lua" id="org3c3d934"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">generic_completion_wrapper</span>(kw, list, str, cur_pos, ncomp)
   out_str, out_pos = awful.completion.generic(str, cur_pos, ncomp, list)
   out_str = kw .. <span style="color: #8b2252;">" "</span> .. out_str
   out_pos = out_pos + kw:len() + 1
   <span style="color: #a020f0;">return</span> out_str, out_pos
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #483d8b;">table</span>.val_to_str ( v )
  <span style="color: #a020f0;">if</span> <span style="color: #8b2252;">"string"</span> == <span style="color: #483d8b;">type</span>( v ) <span style="color: #a020f0;">then</span>
    v = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>( v, <span style="color: #8b2252;">"\n"</span>, <span style="color: #8b2252;">"\\n"</span> )
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>( <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(v,<span style="color: #8b2252;">"[^'\"]"</span>,<span style="color: #8b2252;">""</span>), <span style="color: #8b2252;">'^"+$'</span> ) <span style="color: #a020f0;">then</span>
      <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"'"</span> .. v .. <span style="color: #8b2252;">"'"</span>
    <span style="color: #a020f0;">end</span>
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'"'</span> .. <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(v,<span style="color: #8b2252;">'"'</span>, <span style="color: #8b2252;">'\\"'</span> ) .. <span style="color: #8b2252;">'"'</span>
  <span style="color: #a020f0;">else</span>
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"table"</span> == <span style="color: #483d8b;">type</span>( v ) <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">table</span>.tostring( v ) <span style="color: #a020f0;">or</span>
      <span style="color: #483d8b;">tostring</span>( v )
  <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #483d8b;">table</span>.key_to_str ( k )
  <span style="color: #a020f0;">if</span> <span style="color: #8b2252;">"string"</span> == <span style="color: #483d8b;">type</span>( k ) <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">match</span>( k, <span style="color: #8b2252;">"^[_%a][_%a%d]*$"</span> ) <span style="color: #a020f0;">then</span>
    <span style="color: #a020f0;">return</span> k
  <span style="color: #a020f0;">else</span>
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"["</span> .. <span style="color: #483d8b;">table</span>.val_to_str( k ) .. <span style="color: #8b2252;">"]"</span>
  <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #483d8b;">table</span>.tostring( tbl )
  <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">result</span>, <span style="color: #a0522d;">done</span> = {}, {}
  <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">k</span>, <span style="color: #a0522d;">v</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>( tbl ) <span style="color: #a020f0;">do</span>
    <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>( result, <span style="color: #483d8b;">table</span>.val_to_str( v ) )
    done[ k ] = <span style="color: #008b8b;">true</span>
  <span style="color: #a020f0;">end</span>
  <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">k</span>, <span style="color: #a0522d;">v</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">pairs</span>( tbl ) <span style="color: #a020f0;">do</span>
    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> done[ k ] <span style="color: #a020f0;">then</span>
      <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>( result,
        <span style="color: #483d8b;">table</span>.key_to_str( k ) .. <span style="color: #8b2252;">"="</span> .. <span style="color: #483d8b;">table</span>.val_to_str( v ) )
    <span style="color: #a020f0;">end</span>
  <span style="color: #a020f0;">end</span>
  <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{"</span> .. <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">concat</span>( result, <span style="color: #8b2252;">","</span> ) .. <span style="color: #8b2252;">"}"</span>
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orga18383a" class="outline-3">
<h3 id="orga18383a">Prompts</h3>
<div class="outline-text-3" id="text-orga18383a">
<p>
The prompts included in the module are listed here.  Prompts are called by
entering a keyword, followed by some arguments in the promptbox (i.e. the user
input is of the form <code>KEYWORD ARGS</code>).  A prompt is defined as follows:
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgf5d615f">
global_prompt.prompt_TEMPLATE = {
   keyword={<span style="color: #8b2252;">"?"</span>, <span style="color: #8b2252;">"h"</span>}, <span style="color: #b22222;">-- </span><span style="color: #b22222;">list of strings</span>
   help=<span style="color: #8b2252;">"Help message for prompt"</span>,
   <span style="color: #0000ff;">run_function</span> = <span style="color: #a020f0;">function</span>(kw, name)
      <span style="color: #b22222;">-- </span><span style="color: #b22222;">Execute code</span>
   <span style="color: #a020f0;">end</span>,
   <span style="color: #0000ff;">comp_function</span> = <span style="color: #a020f0;">function</span>(kw, name, cur_pos, ncomp)
      <span style="color: #a020f0;">return</span> generic_completion_wrapper(kw, { <span style="color: #8b2252;">"AUTOCOMPLETE-WORD-1"</span>,
                                              <span style="color: #8b2252;">"AUTOCOMPLETE-WORD-2"</span> },
                                        name, cur_pos, ncomp)
}
</pre>
</div>

<p>
A prompt is a table with the following entries:
</p>
<dl class="org-dl">
<dt><code>keyword</code></dt><dd>List of keywords for prompt.</dd>
<dt><code>help</code></dt><dd>Help message (for use with <a href="#global_prompt_help">help prompt</a>).</dd>
<dt><code>run_function</code></dt><dd>Function to run when calling the prompt.  The <code>name</code>
parameter is the <code>ARGS</code> string passed from the prompt (the user input is
<code>KEYWORD ARGS</code>).</dd>
<dt><code>comp_function</code></dt><dd>Completion function which can be created using
<a href="#global_prompt_utils"><code>generic_completion_wrapper</code></a>.</dd>
</dl>
</div>


<div id="outline-container-orgc177881" class="outline-4">
<h4 id="global_prompt_help">help</h4>
<div class="outline-text-4" id="text-global_prompt_help">
<p>
The help prompt prints a list of the available prompts, along with the
corresponding help text as shown on Fig.&nbsp;<a href="#org3a32e25">4</a>.  The
keyword is <code>h</code> or <code>?</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org8ddb761"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
global_prompt.prompt_help = {
   keyword={<span style="color: #8b2252;">"?"</span>, <span style="color: #8b2252;">"h"</span>}, help=<span style="color: #8b2252;">"Show a list of available commands"</span>,
   <span style="color: #0000ff;">run_function</span> = <span style="color: #a020f0;">function</span>(kw, name)
      help_str = <span style="color: #8b2252;">""</span>
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">p</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(global_prompt.prompt_list) <span style="color: #a020f0;">do</span>
         help_str = help_str .. <span style="color: #8b2252;">"&lt;b&gt;["</span>
         <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">ki</span>, <span style="color: #a0522d;">key</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(p[<span style="color: #8b2252;">"keyword"</span>]) <span style="color: #a020f0;">do</span>
            <span style="color: #a020f0;">if</span> ki &gt; 1 <span style="color: #a020f0;">then</span>
               help_str = help_str .. <span style="color: #8b2252;">", "</span>
            <span style="color: #a020f0;">end</span>
            help_str = help_str .. key
         <span style="color: #a020f0;">end</span>
         help_str = help_str .. <span style="color: #8b2252;">"]&lt;/b&gt;: "</span> .. p[<span style="color: #8b2252;">"help"</span>] .. <span style="color: #8b2252;">"\n"</span>
      <span style="color: #a020f0;">end</span>
      naughty.notify( { text = <span style="color: #8b2252;">"&lt;b&gt;&lt;u&gt;Command list&lt;/u&gt;&lt;/b&gt;\n"</span> .. help_str } )
   <span style="color: #a020f0;">end</span>,
   comp_function = <span style="color: #008b8b;">nil</span>
}
</pre>
</div>

<p>
The following script manually spawns the help box shown on
Fig.&nbsp;<a href="#org3a32e25">4</a> and performs a screenshot.
</p>

<div class="org-src-container">
<pre class="src src-sh" id="orge5f4b43">
<span style="color: #b22222;"># </span><span style="color: #b22222;">Could get these from xrandr</span>
<span style="color: #a0522d;">res_x</span>=1920
<span style="color: #a0522d;">res_y</span>=1080
<span style="color: #a0522d;">screen_idx</span>=0 <span style="color: #b22222;"># </span><span style="color: #b22222;">starts at 0</span>

<span style="color: #a0522d;">req_str</span>=<span style="color: #8b2252;">"local global_prompt = require(\"global_prompt\");"</span>
<span style="color: #a0522d;">cmd_str</span>=<span style="color: #8b2252;">"global_prompt.prompt_help.run_function()"</span>

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$req_str $cmd_str"</span> | awesome-client

<span style="color: #a0522d;">width</span>=$(( 1 * $<span style="color: #a0522d;">res_x</span> / 6 ))
<span style="color: #a0522d;">height</span>=160
<span style="color: #a0522d;">start_x</span>=$(( $<span style="color: #a0522d;">res_x</span> * $<span style="color: #a0522d;">screen_idx</span> + $<span style="color: #a0522d;">res_x</span> - $<span style="color: #a0522d;">width</span> ))

sleep 0.5

scrot desktop.png
convert desktop.png -crop ${<span style="color: #a0522d;">width</span>}x${<span style="color: #a0522d;">height</span>}+${<span style="color: #a0522d;">start_x</span>}+0 desktop-global_prompt-help.png
rm desktop.png -rf
</pre>
</div>



<div id="org3a32e25" class="figure">
<p><a href="../images/2016-10-05-Awesome-wm_configuration/desktop-global-prompt-help.png" width="40%"><img src="../images/2016-10-05-Awesome-wm_configuration/desktop-global-prompt-help.png" alt="desktop-global-prompt-help.png" width="40%"></a>
</p>
<p><span class="figure-number">Figure 4: </span>Help notification from global prompt.</p>
</div>
</div>
</div>



<div id="outline-container-orgc12562c" class="outline-4">
<h4 id="orgc12562c">session</h4>
<div class="outline-text-4" id="text-orgc12562c">
<p>
The session prompt offers session management commands (shutdown, restart,
logout, lock), similar to the <a href="#shutdown">shutdown menu</a>.  The keyword is <code>s</code>, so <code>s
shutdown</code> will trigger a shutdown (with confirmation prompt).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org0c7279a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
global_prompt.prompt_session = {
   keyword={<span style="color: #8b2252;">"s"</span>}, help=<span style="color: #8b2252;">"Session control (shutdown, restart, logout, lock)"</span>,
   <span style="color: #0000ff;">run_function</span> = <span style="color: #a020f0;">function</span>(kw, cmd)
      <span style="color: #b22222;">-- </span><span style="color: #b22222;">list of commands: mplayer -input cmdlist | more</span>
      <span style="color: #a020f0;">if</span> cmd == <span style="color: #8b2252;">"shutdown"</span> <span style="color: #a020f0;">then</span>
         my_utility.confirm_action(
            <span style="color: #a020f0;">function</span>()
               awful.spawn(<span style="color: #8b2252;">'sudo /sbin/shutdown -h now'</span>)
            <span style="color: #a020f0;">end</span>, <span style="color: #8b2252;">"Shutdown"</span>)
      <span style="color: #a020f0;">elseif</span> cmd == <span style="color: #8b2252;">"restart"</span> <span style="color: #a020f0;">then</span>
         my_utility.confirm_action(
            <span style="color: #a020f0;">function</span>()
               awful.spawn(<span style="color: #8b2252;">'sudo /sbin/shutdown -r now'</span>)
            <span style="color: #a020f0;">end</span>, <span style="color: #8b2252;">"Restart"</span>)
      <span style="color: #a020f0;">elseif</span> cmd == <span style="color: #8b2252;">"logout"</span> <span style="color: #a020f0;">then</span>
         my_utility.confirm_action(
            <span style="color: #a020f0;">function</span>()
               awesome.quit()
            <span style="color: #a020f0;">end</span>, <span style="color: #8b2252;">"Logout"</span>)
      <span style="color: #a020f0;">elseif</span> cmd == <span style="color: #8b2252;">"lock"</span> <span style="color: #a020f0;">then</span>
         awful.spawn(<span style="color: #8b2252;">'xscreensaver-command -lock'</span>)
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>,
   <span style="color: #0000ff;">comp_function</span> = <span style="color: #a020f0;">function</span>(kw, name, cur_pos, ncomp)
      <span style="color: #a020f0;">return</span> generic_completion_wrapper(kw, { <span style="color: #8b2252;">"shutdown"</span>, <span style="color: #8b2252;">"restart"</span>, <span style="color: #8b2252;">"logout"</span>,
                                              <span style="color: #8b2252;">"lock"</span> },
                                        name, cur_pos, ncomp)
   <span style="color: #a020f0;">end</span>
}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf98186a" class="outline-4">
<h4 id="orgf98186a">window</h4>
<div class="outline-text-4" id="text-orgf98186a">
<p>
The window prompt allows to quickly jump to an existing window.  It lists open
windows by their class and name and compares the argument to the listed
class / title pairs.  Tab completion is also implemented.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgf0f2cbe"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
global_prompt.prompt_window = {
   keyword={<span style="color: #8b2252;">"j"</span>}, help=<span style="color: #8b2252;">"Jump to window"</span>,
   <span style="color: #0000ff;">run_function</span> = <span style="color: #a020f0;">function</span>(kw, cmd)
      cmd_l = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">lower</span>(cmd)
      client_list = {}
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> = 1, screen.count() <span style="color: #a020f0;">do</span>
         client_list_s = capi.client.get(s)
         <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">c</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(client_list_s) <span style="color: #a020f0;">do</span>
            <span style="color: #a020f0;">if</span> cmd_l == <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">lower</span>(c.class .. <span style="color: #8b2252;">": "</span> .. c.name) <span style="color: #a020f0;">then</span>
               awful.client.jumpto(c)
               <span style="color: #a020f0;">return</span>
            <span style="color: #a020f0;">end</span>
            <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(client_list, {c, c.class .. <span style="color: #8b2252;">": "</span> .. c.name})
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">c</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(client_list) <span style="color: #a020f0;">do</span>
         <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">lower</span>(c[1].name):find(cmd_l) <span style="color: #a020f0;">or</span>
            <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">lower</span>(c[1].class):find(cmd_l) <span style="color: #a020f0;">then</span>
            awful.client.jumpto(c[1])
            <span style="color: #a020f0;">return</span>
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>,
   <span style="color: #0000ff;">comp_function</span> = <span style="color: #a020f0;">function</span>(kw, name, cur_pos, ncomp)
      client_list = {}
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">s</span> = 1, screen.count() <span style="color: #a020f0;">do</span>
         client_list_s = capi.client.get(s)
         <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">c</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(client_list_s) <span style="color: #a020f0;">do</span>
            <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(client_list, <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">lower</span>(c.class .. <span style="color: #8b2252;">": "</span> .. c.name))
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">return</span> generic_completion_wrapper(kw, client_list,
                                        name, cur_pos, ncomp)
   <span style="color: #a020f0;">end</span>
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org8b813df" class="outline-4">
<h4 id="global_prompt_calc">calc</h4>
<div class="outline-text-4" id="text-global_prompt_calc">
<p>
The calculator prompt uses a python script to perform calculations.  It allows
simple math operations including common functions (e.g. trigonometric,
logarithmic etc.).
</p>
</div>

<div id="outline-container-org1c53582" class="outline-5">
<h5 id="org1c53582">Internal script</h5>
<div class="outline-text-5" id="text-org1c53582">
<p>
The calculator script was adapted from <a href="http://www.peterbe.com/plog/calculator-in-python-for-dummies">this one</a>.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org761a0d0"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[scripts/calc.py]</div>
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/python3</span>

<span style="color: #8b2252;">""" A simple calculator """</span>

<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% Imports</span>

<span style="color: #a020f0;">import</span> sys
<span style="color: #a020f0;">import</span> math

<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% Functions</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">http://www.peterbe.com/plog/calculator-in-python-for-dummies</span>


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>(expr, advanced=<span style="color: #008b8b;">True</span>):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">safe_eval</span>(expr, symbols={}):
       <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">eval</span>(expr, <span style="color: #483d8b;">dict</span>(__builtins__=<span style="color: #008b8b;">None</span>), symbols)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">whole_number_to_float</span>(match):
       <span style="color: #a0522d;">group</span> = match.group()
       <span style="color: #a020f0;">if</span> group.find(<span style="color: #8b2252;">'.'</span>) == -1:
          <span style="color: #a020f0;">return</span> group + <span style="color: #8b2252;">'.0'</span>
       <span style="color: #a020f0;">return</span> group
    <span style="color: #a0522d;">expr</span> = expr.replace(<span style="color: #8b2252;">'^'</span>,<span style="color: #8b2252;">'**'</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">expr = integers_regex.sub(whole_number_to_float, expr)</span>
    <span style="color: #a020f0;">if</span> advanced:
       <span style="color: #a020f0;">return</span> safe_eval(expr, <span style="color: #483d8b;">vars</span>(math))
    <span style="color: #a020f0;">else</span>:
       <span style="color: #a020f0;">return</span> safe_eval(expr)

<span style="color: #b22222; font-weight: bold; text-decoration: overline;"># </span><span style="color: #b22222; font-weight: bold; text-decoration: overline;">%% main</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a020f0;">print</span>(calc(<span style="color: #8b2252;">' '</span>.join(sys.argv[1:])))
</pre>
</div>
</div>
</div>


<div id="outline-container-org77811e8" class="outline-5">
<h5 id="org77811e8">Prompt definition</h5>
<div class="outline-text-5" id="text-org77811e8">
<p>
The definition of the prompt is straightforward: the arguments are wrapped
around double quotes and passed to the <code>calc.py</code> script.  The result is shown in
a popup notification.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org110873e"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
global_prompt.calc_cmd = <span style="color: #8b2252;">"python3 "</span> .. awesome_paths.config_dir ..
   <span style="color: #8b2252;">"/scripts/calc.py "</span>
global_prompt.prompt_calc = {
   keyword={<span style="color: #8b2252;">"c"</span>}, help=<span style="color: #8b2252;">"Calculator"</span>,
   <span style="color: #0000ff;">run_function</span> = <span style="color: #a020f0;">function</span>(kw, expr)
      expr = expr:match(<span style="color: #8b2252;">"^%s*(.-)%s*$"</span>)
      <span style="color: #a020f0;">if</span> expr.sub(1, 1) ~= <span style="color: #8b2252;">"\""</span> <span style="color: #a020f0;">then</span>
         expr = <span style="color: #8b2252;">"\""</span> .. expr
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">if</span> expr.sub(-1, 1) ~= <span style="color: #8b2252;">"\""</span> <span style="color: #a020f0;">then</span>
         expr = expr .. <span style="color: #8b2252;">"\""</span>
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">c</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(global_prompt.calc_cmd .. <span style="color: #8b2252;">" "</span> .. expr, <span style="color: #8b2252;">'r'</span>))
      <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">result</span> = c:read(<span style="color: #8b2252;">"*all"</span>):gsub(<span style="color: #8b2252;">"\n$"</span>, <span style="color: #8b2252;">""</span>)
      c:close()
      naughty.notify({ text = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">sub</span>(expr, 2, -2) .. <span style="color: #8b2252;">" = "</span> .. result,
                       timeout = 10 })
   <span style="color: #a020f0;">end</span>,
   comp_function = <span style="color: #008b8b;">nil</span>
}
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org7b6f172" class="outline-4">
<h4 id="org7b6f172">cmus</h4>
<div class="outline-text-4" id="text-org7b6f172">
<p>
The cmus prompt is an interface to the <a href="#cmus_play">cmus quick play command</a>.  The supported
arguments are:
</p>
<dl class="org-dl">
<dt>play/pause/stop/next/prev</dt><dd>control playback,</dd>
<dt>info</dt><dd>spawn the <a href="#cmus_popup">cmus popup notification</a>,</dd>
<dt>random</dt><dd>play a random album,</dd>
<dt>album</dt><dd>play an album with title matching the remaining prompt arguments.</dd>
</dl>


<div class="org-src-container">
<pre class="src src-lua" id="org9fce558"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
global_prompt.prompt_cmus = {
   keyword={<span style="color: #8b2252;">"cm"</span>}, help=<span style="color: #8b2252;">"cmus remote"</span>,
   <span style="color: #0000ff;">run_function</span> = <span style="color: #a020f0;">function</span>(kw, cmd)
      <span style="color: #b22222;">-- </span><span style="color: #b22222;">list of commands: mplayer -input cmdlist | more</span>
      mp_cmd = <span style="color: #008b8b;">nil</span>
      mp_cmds = <span style="color: #008b8b;">nil</span>
      <span style="color: #a020f0;">if</span> cmd == <span style="color: #8b2252;">"pause"</span> <span style="color: #a020f0;">or</span> cmd == <span style="color: #8b2252;">"p"</span> <span style="color: #a020f0;">then</span>
         mp_cmd = <span style="color: #8b2252;">"--pause"</span>
      <span style="color: #a020f0;">elseif</span> cmd == <span style="color: #8b2252;">"play"</span> <span style="color: #a020f0;">then</span>
         mp_cmd = <span style="color: #8b2252;">"--play"</span>
      <span style="color: #a020f0;">elseif</span> cmd == <span style="color: #8b2252;">"next"</span> <span style="color: #a020f0;">then</span>
         mp_cmd = <span style="color: #8b2252;">"--next"</span>
      <span style="color: #a020f0;">elseif</span> cmd == <span style="color: #8b2252;">"prev"</span> <span style="color: #a020f0;">then</span>
         mp_cmd = <span style="color: #8b2252;">"--prev"</span>
      <span style="color: #a020f0;">elseif</span> cmd == <span style="color: #8b2252;">"stop"</span> <span style="color: #a020f0;">then</span>
         mp_cmd = <span style="color: #8b2252;">"--stop"</span>
      <span style="color: #a020f0;">elseif</span> cmd == <span style="color: #8b2252;">"info"</span> <span style="color: #a020f0;">or</span> cmd == <span style="color: #8b2252;">"i"</span> <span style="color: #a020f0;">then</span>
         cmus_popup(5)
      <span style="color: #a020f0;">elseif</span> cmd == <span style="color: #8b2252;">"random"</span> <span style="color: #a020f0;">then</span>
         cmus_play(<span style="color: #8b2252;">"rand"</span>)
      <span style="color: #a020f0;">elseif</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">sub</span>(cmd, 1, 5) == <span style="color: #8b2252;">"album"</span> <span style="color: #a020f0;">then</span>
         album_name = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">sub</span>(cmd, 6, -1):match(<span style="color: #8b2252;">"^%s*(.-)%s*$"</span>)
         search_str = album_name
         search_str = search_str:gsub(<span style="color: #8b2252;">"[ ]+"</span>, <span style="color: #8b2252;">".*"</span>)
         cmus_play(<span style="color: #8b2252;">"album"</span>, search_str)
      <span style="color: #a020f0;">else</span>
         mp_cmd = cmd
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">if</span> mp_cmd <span style="color: #a020f0;">then</span>
         cmd = <span style="color: #8b2252;">"cmus-remote "</span> .. mp_cmd
         awful.spawn.with_shell(cmd)
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>,
   <span style="color: #0000ff;">comp_function</span> = <span style="color: #a020f0;">function</span>(kw, name, cur_pos, ncomp)
      <span style="color: #a020f0;">return</span> generic_completion_wrapper(kw, { <span style="color: #8b2252;">"pause"</span>, <span style="color: #8b2252;">"play"</span>, <span style="color: #8b2252;">"next"</span>, <span style="color: #8b2252;">"prev"</span>,
                                              <span style="color: #8b2252;">"random"</span>, <span style="color: #8b2252;">"album"</span>, <span style="color: #8b2252;">"info"</span> },
                                        name, cur_pos, ncomp)
   <span style="color: #a020f0;">end</span>
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org205e163" class="outline-4">
<h4 id="global_prompt_music">music</h4>
<div class="outline-text-4" id="text-global_prompt_music">
<p>
The music prompt plays individual music files in <code>mplayer</code>, as opposed to the
cmus tools, which play albums using <code>cmus</code>.  The music folder is indexed into
the <code>music.db</code> file using the <code>updatedb</code> program, and song searches are
performed using the <code>locate</code> program (both parts of the <code>findutils</code> package).
The <code>music.db</code> file is updated on a schedule (daily) via <code>crontab</code>:
</p>

<div class="org-src-container">
<pre class="src src-conf" id="org0fd9f74">
<span style="color: #b22222;"># </span><span style="color: #b22222;">Crontab entry for music database update</span>
0 9 * * * updatedb --require-visibility 0 -U ~/data/music/ -o ~/data/music/music.db &gt; ~/log/update_musicdb.log
</pre>
</div>

<p>
The music prompt defines two keywords:
</p>
<dl class="org-dl">
<dt><code>m</code></dt><dd>play an audio file (with file format in the list defined by
<code>global_prompt.music_ext_list</code>).  The extra argument is either a full path
to a file name in which case the file is played or a search string which is
used to interrogate the <code>music.db</code> database and obtain a file to play.</dd>
<dt><code>mc</code></dt><dd>control the existing mplayer instance via a named pipe constructed
using <code>mkfifo</code>.  Available commands are <code>pause</code> (or <code>p</code>) and <code>quit</code> (or
<code>q</code>).</dd>
</dl>

<p>
Note that the spawned mplayer instance is given a custom class name (<code>-c
tmplayer</code>) to apply a custom <a href="#rules">rule</a> to it: it is placed on the same screen and
client as the main cmus instance.
</p>

<p>
The completion function for the <code>m</code> keyword performs a search on the argument
and returns the list of matching files in the <code>music.db</code> database.  Completion
for the <code>mc</code> keyword simply lists the available commands.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org570219f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
global_prompt.mplayer_pipe = <span style="color: #8b2252;">"/tmp/awesome-mplayer.pipe"</span>
global_prompt.music_folder = <span style="color: #8b2252;">"/media/data/music/"</span>
global_prompt.music_locate_db = global_prompt.music_folder .. <span style="color: #8b2252;">"music.db"</span>
global_prompt.music_ext_list = { <span style="color: #8b2252;">".mp3"</span>, <span style="color: #8b2252;">".flac"</span>, <span style="color: #8b2252;">".ogg"</span>, <span style="color: #8b2252;">".aac"</span> }
global_prompt.prompt_music = {
   keyword={<span style="color: #8b2252;">"m"</span>, <span style="color: #8b2252;">"mc"</span>}, help=<span style="color: #8b2252;">"Open music files using locate db"</span>,
   <span style="color: #0000ff;">run_function</span>=<span style="color: #a020f0;">function</span>(kw, name)
      <span style="color: #a020f0;">if</span> kw == <span style="color: #8b2252;">"m"</span> <span style="color: #a020f0;">then</span>
         fname = <span style="color: #008b8b;">nil</span>
         <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> name <span style="color: #a020f0;">then</span>
            <span style="color: #a020f0;">return</span>
         <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">if</span> util.file_readable(global_prompt.music_folder .. <span style="color: #8b2252;">"/"</span> .. name) <span style="color: #a020f0;">then</span>
            fname = global_prompt.music_folder .. <span style="color: #8b2252;">"/"</span> .. name
         <span style="color: #a020f0;">else</span>
            locate_file = global_prompt.music_locate_db
            search_str = name
            search_str = search_str:gsub(<span style="color: #8b2252;">"['\"?!-:,]"</span>, <span style="color: #8b2252;">"."</span>)
            search_str = search_str:gsub(<span style="color: #8b2252;">"[ ]+"</span>, <span style="color: #8b2252;">".*"</span>)
            <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">ext</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(global_prompt.music_ext_list) <span style="color: #a020f0;">do</span>
               <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">m</span> = <span style="color: #8b2252;">"locate -d "</span> .. locate_file ..
                  <span style="color: #8b2252;">" -i --limit 1 -r \""</span> .. search_str .. <span style="color: #8b2252;">".*\\"</span> ..
                  ext .. <span style="color: #8b2252;">"$\""</span>
               <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">c</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(m, <span style="color: #8b2252;">'r'</span>))
               <span style="color: #a020f0;">if</span> c <span style="color: #a020f0;">then</span>
                  <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">mfile</span> = c:read(<span style="color: #8b2252;">"*line"</span>)
                  fname = mfile
                  c:close()
                  <span style="color: #a020f0;">break</span>
               <span style="color: #a020f0;">end</span>
            <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">if</span> fname <span style="color: #a020f0;">then</span>
            <span style="color: #a020f0;">if</span> music_player == <span style="color: #8b2252;">"mplayer"</span> <span style="color: #a020f0;">then</span>
               <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> lfs.attributes(global_prompt.mplayer_pipe, <span style="color: #8b2252;">"mode"</span>) <span style="color: #a020f0;">then</span>
                  awful.spawn(<span style="color: #8b2252;">"mkfifo "</span> .. global_prompt.mplayer_pipe)
               <span style="color: #a020f0;">end</span>
               extra_args = <span style="color: #8b2252;">" -slave -input file="</span> ..
                  global_prompt.mplayer_pipe .. <span style="color: #8b2252;">" "</span>
            <span style="color: #a020f0;">else</span>
               extra_args = <span style="color: #8b2252;">""</span>
            <span style="color: #a020f0;">end</span>
            awful.spawn(termapps .. <span style="color: #8b2252;">" -name tmplayer -e bash -c \""</span> ..
                           music_player .. extra_args .. <span style="color: #8b2252;">" \\\""</span> ..
                           fname .. <span style="color: #8b2252;">"\\\"\""</span>)
         <span style="color: #a020f0;">else</span>
            naughty.notify( {
                  text = name .. <span style="color: #8b2252;">" not found ("</span> .. search_str .. <span style="color: #8b2252;">")"</span> } )
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">elseif</span> kw == <span style="color: #8b2252;">"mc"</span> <span style="color: #a020f0;">then</span>
         <span style="color: #b22222;">-- </span><span style="color: #b22222;">list of commands: mplayer -input cmdlist | more</span>
         <span style="color: #a020f0;">if</span> lfs.attributes(global_prompt.mplayer_pipe,
                           <span style="color: #8b2252;">"mode"</span>) == <span style="color: #8b2252;">"named pipe"</span> <span style="color: #a020f0;">then</span>
            <span style="color: #a020f0;">if</span> name == <span style="color: #8b2252;">"pause"</span> <span style="color: #a020f0;">or</span> name == <span style="color: #8b2252;">"p"</span> <span style="color: #a020f0;">then</span>
               mp_cmd = <span style="color: #8b2252;">"pause"</span>
            <span style="color: #a020f0;">elseif</span> name == <span style="color: #8b2252;">"quit"</span> <span style="color: #a020f0;">or</span> name == <span style="color: #8b2252;">"q"</span> <span style="color: #a020f0;">then</span>
               mp_cmd = <span style="color: #8b2252;">"quit"</span>
            <span style="color: #a020f0;">else</span>
               mp_cmd = name
            <span style="color: #a020f0;">end</span>
            cmd = <span style="color: #8b2252;">"echo \""</span> .. mp_cmd .. <span style="color: #8b2252;">"\" &gt; "</span> .. global_prompt.mplayer_pipe
            awful.spawn.with_shell(cmd)
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>,
   <span style="color: #0000ff;">comp_function</span>=<span style="color: #a020f0;">function</span>(kw, name, cur_pos, ncomp)
      <span style="color: #a020f0;">if</span> #name == 0 <span style="color: #a020f0;">then</span>
         <span style="color: #a020f0;">return</span> name, cur_pos
      <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">if</span> kw == <span style="color: #8b2252;">"m"</span> <span style="color: #a020f0;">then</span>
         <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">file_list</span> = {}
         search_str = name
         search_str = search_str:gsub(<span style="color: #8b2252;">"['\"?!-:,]"</span>, <span style="color: #8b2252;">"."</span>)
         search_str = search_str:gsub(<span style="color: #8b2252;">"[ ]+"</span>, <span style="color: #8b2252;">".*"</span>)
         <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">m</span> = <span style="color: #8b2252;">"locate -d "</span> .. global_prompt.music_locate_db ..
                   <span style="color: #8b2252;">" -i -r "</span> .. search_str
         <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">c</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(m, <span style="color: #8b2252;">'r'</span>))
         <span style="color: #a020f0;">if</span> c <span style="color: #a020f0;">then</span>
            <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">mfiles</span> = c:read(<span style="color: #8b2252;">"*all"</span>)
            c:close()
            <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">line</span> <span style="color: #a020f0;">in</span> mfiles:gmatch(<span style="color: #8b2252;">"[^\r\n]+"</span>) <span style="color: #a020f0;">do</span>
               line_s = line:gsub(global_prompt.music_folder, <span style="color: #8b2252;">""</span>)
               <span style="color: #a020f0;">if</span> line_s <span style="color: #a020f0;">then</span>
                  <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">ext</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(global_prompt.music_ext_list) <span style="color: #a020f0;">do</span>
                     <span style="color: #a020f0;">if</span> line_s:find(ext .. <span style="color: #8b2252;">"$"</span>) <span style="color: #a020f0;">then</span>
                        <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(file_list, line_s)
                     <span style="color: #a020f0;">end</span>
                  <span style="color: #a020f0;">end</span>
               <span style="color: #a020f0;">end</span>
            <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">else</span>
            <span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">stderr</span>:write(err)
            <span style="color: #a020f0;">return</span> kw .. <span style="color: #8b2252;">' '</span> .. name, cur_pos
         <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">if</span> #file_list == 0 <span style="color: #a020f0;">then</span>
            <span style="color: #a020f0;">return</span> kw .. <span style="color: #8b2252;">' '</span> .. name, cur_pos
         <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">while</span> ncomp &gt; #file_list <span style="color: #a020f0;">do</span>
            ncomp = ncomp - #file_list
         <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"m "</span> .. file_list[ncomp], 3
      <span style="color: #a020f0;">elseif</span> kw == <span style="color: #8b2252;">"mc"</span> <span style="color: #a020f0;">then</span>
         <span style="color: #a020f0;">return</span> generic_completion_wrapper(kw, { <span style="color: #8b2252;">"pause"</span>, <span style="color: #8b2252;">"quit"</span>, <span style="color: #8b2252;">"volume"</span> },
                                           name, cur_pos, ncomp)
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
}
</pre>
</div>
</div>
</div>



<div id="outline-container-org46b634f" class="outline-4">
<h4 id="org46b634f">web&#xa0;&#xa0;&#xa0;<span class="tag"><span class="feature_request">feature_request</span></span></h4>
<div class="outline-text-4" id="text-org46b634f">
<p>
The web prompt was originally aimed at handling questions where the answer would
be obtained from a web search (e.g. using <a href="https://duckduckgo.com/api">duckduckgo</a> search API).  This is
currently not implemented and the web prompt simply spawns a web browser window,
and starts a duckduckgo search with the input arguments.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org10def03"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
global_prompt.search_url = <span style="color: #8b2252;">"https://duckduckgo.com/?q=%s"</span>
global_prompt.prompt_web = {
   keyword={<span style="color: #8b2252;">"w"</span>}, help=<span style="color: #8b2252;">"Web search"</span>,
   <span style="color: #0000ff;">run_function</span> = <span style="color: #a020f0;">function</span>(kw, expr)
      is_url = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">find</span>(expr, <span style="color: #8b2252;">"[.][0-9a-zA-Z]+$"</span>)
      naughty.notify({text=is_url})
      <span style="color: #a020f0;">if</span> is_url == <span style="color: #008b8b;">nil</span> <span style="color: #a020f0;">then</span>
         expr_search = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(expr, <span style="color: #8b2252;">"%s+"</span>, <span style="color: #8b2252;">"+"</span>)
         expr_url = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">format</span>(global_prompt.search_url, expr_search)
      <span style="color: #a020f0;">else</span>
         expr_url = expr
      <span style="color: #a020f0;">end</span>
      awful.spawn.with_shell(internet_browser .. <span style="color: #8b2252;">" "</span> .. expr_url)
   <span style="color: #a020f0;">end</span>,
   comp_function = <span style="color: #008b8b;">nil</span>
}
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org809cbba" class="outline-3">
<h3 id="org809cbba">Main prompt</h3>
<div class="outline-text-3" id="text-org809cbba">
<p>
Once the prompts are defined they are added to the <code>prompt_list</code> table.  The
final part of the module defines the main hook handling user input.  The first
word in the user input is matched against known keywords, and, if a matching
prompt keyword is found, the remaining arguments are passed to the corresponding
<code>run_function</code> and <code>comp_function</code> to handle <code>ENTER</code> and <code>TAB</code> key presses
respectively.
</p>


<div class="org-src-container">
<pre class="src src-lua" id="org2002650"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[global_prompt.lua]</div>
global_prompt.prompt_list = { global_prompt.prompt_help,
                              global_prompt.prompt_music,
                              global_prompt.prompt_calc,
                              global_prompt.prompt_cmus,
                              global_prompt.prompt_session,
                              global_prompt.prompt_window,
                              global_prompt.prompt_web }

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">global_prompt.run</span>(str)
   str_stripped = str:match(<span style="color: #8b2252;">"^%s*(.-)%s*$"</span>)
   <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> str_stripped:match(<span style="color: #8b2252;">"%s"</span>) <span style="color: #a020f0;">then</span>
      kw = str_stripped
      args = <span style="color: #8b2252;">""</span>
   <span style="color: #a020f0;">else</span>
      kw = str:match(<span style="color: #8b2252;">"^%s*([^ ]+) .*$"</span>)
      args = str:match(<span style="color: #8b2252;">"^%s*[^ ]+ (.*)$"</span>):match(<span style="color: #8b2252;">"^%s*(.-)%s*$"</span>)
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">p</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(global_prompt.prompt_list) <span style="color: #a020f0;">do</span>
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">key</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(p[<span style="color: #8b2252;">"keyword"</span>]) <span style="color: #a020f0;">do</span>
         <span style="color: #a020f0;">if</span> key == kw <span style="color: #a020f0;">then</span>
            <span style="color: #a020f0;">return</span> p[<span style="color: #8b2252;">"run_function"</span>](kw, args)
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">global_prompt.comp</span>(str, cur_pos, ncomp)
   str_stripped = str:match(<span style="color: #8b2252;">"^%s*(.-)%s*$"</span>)
   <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> str_stripped:match(<span style="color: #8b2252;">"%s"</span>) <span style="color: #a020f0;">then</span>
      kw = str_stripped
      args = <span style="color: #8b2252;">""</span>
   <span style="color: #a020f0;">else</span>
      kw = str:match(<span style="color: #8b2252;">"^%s*([^ ]+) .*$"</span>)
      args = str:match(<span style="color: #8b2252;">"^%s*[^ ]+ (.*)$"</span>)
      <span style="color: #a020f0;">if</span> args <span style="color: #a020f0;">then</span>
         args = args:match(<span style="color: #8b2252;">"^%s*(.-)%s*$"</span>)
      <span style="color: #a020f0;">else</span>
         args = <span style="color: #8b2252;">""</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">p</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(global_prompt.prompt_list) <span style="color: #a020f0;">do</span>
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">key</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">ipairs</span>(p[<span style="color: #8b2252;">"keyword"</span>]) <span style="color: #a020f0;">do</span>
         <span style="color: #a020f0;">if</span> key == kw <span style="color: #a020f0;">and</span> p[<span style="color: #8b2252;">"comp_function"</span>] <span style="color: #a020f0;">then</span>
            <span style="color: #a020f0;">return</span> p[<span style="color: #8b2252;">"comp_function"</span>](kw, args, cur_pos, ncomp)
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">return</span> generic_completion_wrapper(<span style="color: #8b2252;">""</span>, {},
                                     str, cur_pos, ncomp)
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">return</span> global_prompt

<span style="color: #b22222;">-- </span><span style="color: #b22222;">TODO:</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">X web search (parse answer / open in (text) browseer)</span>
<span style="color: #b22222;">--   </span><span style="color: #b22222;">duckduckgo API</span>
<span style="color: #b22222;">--   </span><span style="color: #b22222;">translator</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">X cmus control (random album?)</span>
<span style="color: #b22222;">--   </span><span style="color: #b22222;">mu4e control?</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">X Goto window</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">X mplayer: start in slave, control</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">(http://ubuntuforums.org/showthread.php?t=1629000)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org3e8e9e2" class="outline-2">
<h2 id="startup_applications">Startup applications</h2>
<div class="outline-text-2" id="text-startup_applications">
<p>
The end of the <code>rc.lua</code> file contains a list of applications to run on startup.
Programs are spawned using the <a href="#my_utility_run_once"><code>run_once</code></a> utility.  The applications launched on
startup are:
</p>
<ul class="org-ul">
<li><code>screen_default.sh</code> which is a <code>xrandr</code> script to setup my monitors</li>
<li><code>numlock&amp;</code> which switches the numlock key on</li>
<li>the dropbox daemon</li>
<li>the network-manager applet</li>
<li><code>xscreensaver</code> for screen locking</li>
<li>the UPnP server <a href="https://wiki.gnome.org/Projects/Rygel"><code>rygel</code></a></li>
<li>the RSS reader <code>newsboat</code></li>
<li>the music player <code>cmus</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-lua" id="org2776f57"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[rc.lua]</div>my_utility.run_once(<span style="color: #8b2252;">"numlockx&amp;"</span>)
my_utility.run_once(<span style="color: #8b2252;">"bash "</span> .. awesome_paths.config_dir
                       .. <span style="color: #8b2252;">"/scripts/screen_default.sh"</span>)
my_utility.run_once(awesome_paths.home_dir .. <span style="color: #8b2252;">"/.dropbox-dist/dropboxd"</span>)
my_utility.run_once(<span style="color: #8b2252;">"nm-applet"</span>) <span style="color: #b22222;">-- </span><span style="color: #b22222;">networking</span>
my_utility.run_once(<span style="color: #8b2252;">"xscreensaver -nosplash"</span>)
my_utility.run_once(<span style="color: #8b2252;">"rygel"</span>)
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Compositing (required for transparency)</span>
<span style="color: #b22222;">--</span><span style="color: #b22222;">my_utility.run_once("xcompmgr")</span>

my_utility.run_once(termapps .. <span style="color: #8b2252;">" -name newsboat -e newsboat"</span>)
my_utility.run_once(termapps .. <span style="color: #8b2252;">" -name cmus -e cmus"</span>)

<span style="color: #b22222;">--</span><span style="color: #b22222;">run_or_raise(terminal)</span>
<span style="color: #b22222;">--</span><span style="color: #b22222;">my_utility.run_once("pidgin",nil,nil,2)</span>
</pre>
</div>
</div>

<div id="outline-container-org90c3e9e" class="outline-3">
<h3 id="org90c3e9e">Screen setup script</h3>
<div class="outline-text-3" id="text-org90c3e9e">
<p>
The <code>screen_default.sh</code> script contains the following command (which should be
changed according to the monitor setup):
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org56c52c6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[scripts/screen_default.sh]</div><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">sh</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Setup screens</span>
xrandr --setprovideroutputsource 1 0
xrandr --output HDMI-1 --primary --mode 1920x1080 --pos 0x0 --rotate normal <span style="color: #8b2252;">\</span>
       --output DP-1 --off <span style="color: #8b2252;">\</span>
       --output VGA-1 --off <span style="color: #8b2252;">\</span>
       --output VGA-1-2  --mode 1600x900 --pos 3840x0 --rotate normal <span style="color: #8b2252;">\</span>
       --output HDMI-1-2 --mode 1920x1080 --pos 1920x0 --rotate normal <span style="color: #8b2252;">\</span>
       --output DVI-I-1-1 --off
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgedcf4e8" class="outline-2">
<h2 id="my_utility">Utilities </h2>
<div class="outline-text-2" id="text-my_utility">
<p>
The <code>my_utility</code> module contains some helper functions used throughout the
configuration.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org08ed89d"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my_utility.lua]</div>
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">awful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"awful"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">naughty</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"naughty"</span>)
<span style="color: #a020f0;">local</span> <span style="color: #a0522d;">beautiful</span> = <span style="color: #483d8b;">require</span>(<span style="color: #8b2252;">"beautiful"</span>)

my_utility = {}
</pre>
</div>
</div>


<div id="outline-container-orgfa063a3" class="outline-3">
<h3 id="orgfa063a3">String split</h3>
<div class="outline-text-3" id="text-orgfa063a3">
<p>
The <code>my_utility.lines</code> function splits the input string by rows.  A table with
the lines is returned; it can be iterated over using <code>for k, v in
pairs(lines_output)</code>.  This was taken from <a href="http://lua-users.org/wiki/SplitJoin">http://lua-users.org/wiki/SplitJoin</a>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org8c09102"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my_utility.lua]</div>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">my_utility.lines</span>(str)
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">t</span> = {}
   <span style="color: #a020f0;">local</span> <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">helper</span>(line) <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">insert</span>(t, line) <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">""</span> <span style="color: #a020f0;">end</span>
   helper((str:gsub(<span style="color: #8b2252;">"(.-)\r?\n"</span>, helper)))
   <span style="color: #a020f0;">return</span> t
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgdc00280" class="outline-3">
<h3 id="orgdc00280">HTML escape</h3>
<div class="outline-text-3" id="text-orgdc00280">
<p>
Notifications in awesome-wm accept HTML inputs, but there is no built-in
function to cleanup strings.  The <code>my_utility.html_escape</code> function provides
some very basic escaping.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org3a0e7a0"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my_utility.lua]</div>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">my_utility.html_escape</span>(str)
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">t</span> = str
   t = t:gsub(<span style="color: #8b2252;">"&amp;"</span>, <span style="color: #8b2252;">"&amp;amp;"</span>)
   t = t:gsub(<span style="color: #8b2252;">"&lt;"</span>, <span style="color: #8b2252;">"&amp;lt;"</span>)
   t = t:gsub(<span style="color: #8b2252;">"&gt;"</span>, <span style="color: #8b2252;">"&amp;gt;"</span>)
   t = t:gsub(<span style="color: #8b2252;">"'"</span>, <span style="color: #8b2252;">"&amp;apos;"</span>)

   <span style="color: #a020f0;">return</span> t
<span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">my_utility.filename_escape</span>(str)
   <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">t</span> = str

   t = t:gsub(<span style="color: #8b2252;">"[$]"</span>, <span style="color: #8b2252;">"\\$"</span>)

   <span style="color: #a020f0;">return</span> t
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orga11a31f" class="outline-3">
<h3 id="orga11a31f">File listing</h3>
<div class="outline-text-3" id="text-orga11a31f">
<p>
The <code>scandir</code> utility lists files in a given folder (from
<a href="http://stackoverflow.com/a/11130774">http://stackoverflow.com/a/11130774</a>).
</p>

<div class="org-src-container">
<pre class="src src-lua" id="org0398f48"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my_utility.lua]</div>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Lua implementation of scandir function</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">my_utility.scandir</span>(directory, pattern)
    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">i</span>, <span style="color: #a0522d;">t</span>, <span style="color: #a0522d;">popen</span> = 0, {}, <span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>
    <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">assert</span>(popen(<span style="color: #8b2252;">'ls -a "'</span>..directory..<span style="color: #8b2252;">'/"'</span>..pattern, <span style="color: #8b2252;">'r'</span>))
    <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">filename</span> <span style="color: #a020f0;">in</span> f:lines() <span style="color: #a020f0;">do</span>
        i = i + 1
        t[i] = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">gsub</span>(filename, <span style="color: #8b2252;">"//"</span>, <span style="color: #8b2252;">"/"</span>)
    <span style="color: #a020f0;">end</span>
    f:close()
    <span style="color: #a020f0;">return</span> t
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org626075e" class="outline-3">
<h3 id="org626075e">Table operations</h3>
<div class="outline-text-3" id="text-org626075e">
<div class="org-src-container">
<pre class="src src-lua" id="org206b964"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my_utility.lua]</div>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">Remove paths from list of paths (based on last folder)</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">my_utility.table_path_remove</span>(table_in, remove_list)

   <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">i</span> = 1, #remove_list <span style="color: #a020f0;">do</span>
      tstring = remove_list[i]
      <span style="color: #a020f0;">for</span> <span style="color: #a0522d;">j</span> = 1, #table_in <span style="color: #a020f0;">do</span>
         mstring = <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">sub</span>(table_in[j], -#tstring - 1, -2)
         <span style="color: #a020f0;">if</span> tstring == mstring <span style="color: #a020f0;">then</span>
            <span style="color: #483d8b;">table</span>.<span style="color: #483d8b;">remove</span>(table_in, j)
            <span style="color: #a020f0;">break</span>
         <span style="color: #a020f0;">end</span>
      <span style="color: #a020f0;">end</span>
   <span style="color: #a020f0;">end</span>

<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>



<div id="outline-container-orgff84630" class="outline-3">
<h3 id="my_utility_confirm">Confirmation popup</h3>
<div class="outline-text-3" id="text-my_utility_confirm">
<p>
The <code>my_utility.confirm_action</code> is used with the <a href="#shutdown">shutdown menu</a> to prompt for
confirmation before performing actions (e.g. shutdown).  It uses a promptbox
placed on each wibox and runs the function <code>func</code> when the "y" character is
entered in the promptbox.  Note that, since the promptbox is barely visible, the
color of the whole wibox (on the current screen) is temporarily set to
<code>beautiful.bg_urgent</code> / <code>beautiful.fg_urgent</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgda3963f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my_utility.lua]</div>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">my_utility.confirm_action</span>(func, name)
   awful.screen.focused().mywibox:set_bg(beautiful.bg_urgent)
   awful.screen.focused().mywibox:set_fg(beautiful.fg_urgent)
   awful.prompt.run {
         prompt = name .. <span style="color: #8b2252;">" [y/N] "</span>,
         textbox = awful.screen.focused().mypromptbox_conf.widget,
         <span style="color: #0000ff;">exe_callback</span> = <span style="color: #a020f0;">function</span> (t)
            <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">string</span>.<span style="color: #483d8b;">lower</span>(t) == <span style="color: #8b2252;">'y'</span> <span style="color: #a020f0;">then</span>
               func()
            <span style="color: #a020f0;">end</span>
         <span style="color: #a020f0;">end</span>,
         history_path = <span style="color: #008b8b;">nil</span>,
         <span style="color: #0000ff;">done_callback</span> = <span style="color: #a020f0;">function</span> ()
            awful.screen.focused().mywibox:set_bg(
               beautiful.screen_highlight_bg_active)
            awful.screen.focused().mywibox:set_fg(
               beautiful.screen_highlight_fg_active)
         <span style="color: #a020f0;">end</span>
   }
<span style="color: #a020f0;">end</span>
</pre>
</div>

<p>
Here is an example of usage using <code>awesome-client</code>, with a screenshot of the
confirmation prompt on Fig.&nbsp;<a href="#org6fd87ae">5</a>.
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org893b54f">
<span style="color: #b22222;"># </span><span style="color: #b22222;">Could get these from xrandr</span>
<span style="color: #a0522d;">res_x</span>=1920
<span style="color: #a0522d;">res_y</span>=1080
<span style="color: #a0522d;">screen_idx</span>=1 <span style="color: #b22222;"># </span><span style="color: #b22222;">starts at 0</span>

<span style="color: #a0522d;">req_str</span>=<span style="color: #8b2252;">"local my_utility = require(\"my_utility\");"</span>
<span style="color: #a0522d;">cmd_str</span>=<span style="color: #8b2252;">"my_utility.confirm_action(function () end, \"Shutdown\")"</span>

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$req_str $cmd_str"</span> | awesome-client

<span style="color: #a0522d;">width</span>=$(( 3 * $<span style="color: #a0522d;">res_x</span> / 8 ))
<span style="color: #a0522d;">height</span>=25
<span style="color: #a0522d;">start_x</span>=$(( $<span style="color: #a0522d;">res_x</span> * $<span style="color: #a0522d;">screen_idx</span> ))

sleep 0.5

scrot desktop.png
convert desktop.png -crop ${<span style="color: #a0522d;">width</span>}x${<span style="color: #a0522d;">height</span>}+${<span style="color: #a0522d;">start_x</span>}+0 desktop-confirm_action.png
rm desktop.png -rf
</pre>
</div>


<div id="org6fd87ae" class="figure">
<p><a href="../images/2016-10-05-Awesome-wm_configuration/desktop-confirm-action.png" width="60%"><img src="../images/2016-10-05-Awesome-wm_configuration/desktop-confirm-action.png" alt="desktop-confirm-action.png" width="60%"></a>
</p>
<p><span class="figure-number">Figure 5: </span>Confirmation prompt before shutdown (left-most text).</p>
</div>
</div>
</div>


<div id="outline-container-org33db839" class="outline-3">
<h3 id="my_utility_run_once">Run once</h3>
<div class="outline-text-3" id="text-my_utility_run_once">
<p>
The <code>run_once</code> utility is a commonly used lua function to spawn a program if is
not already running.  The code is from
<a href="https://awesome.naquadah.org/wiki/Autostart">https://awesome.naquadah.org/wiki/Autostart</a>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orgdf5b283"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my_utility.lua]</div>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">my_utility.run_once</span>(prg, arg_string, pname, s, tag)
    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> prg <span style="color: #a020f0;">then</span>
        <span style="color: #a020f0;">do</span> <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">nil</span> <span style="color: #a020f0;">end</span>
    <span style="color: #a020f0;">end</span>

    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> pname <span style="color: #a020f0;">then</span>
       pname = prg
    <span style="color: #a020f0;">end</span>

    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> arg_string <span style="color: #a020f0;">then</span>
       cmd_pgrep = pname
       cmd_exe = prg
    <span style="color: #a020f0;">else</span>
       cmd_pgrep = pname .. <span style="color: #8b2252;">" "</span> .. arg_string
       cmd_exe = prg .. <span style="color: #8b2252;">" "</span> .. arg_string
    <span style="color: #a020f0;">end</span>
    cmd = <span style="color: #8b2252;">"pgrep -f -u $USER -x '"</span> .. cmd_pgrep .. <span style="color: #8b2252;">"' || ("</span> .. cmd_exe .. <span style="color: #8b2252;">")"</span>
    <span style="color: #a020f0;">if</span> s <span style="color: #a020f0;">and</span> tag <span style="color: #a020f0;">then</span>
       <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">out</span> = <span style="color: #483d8b;">assert</span>(<span style="color: #483d8b;">io</span>.<span style="color: #483d8b;">popen</span>(<span style="color: #8b2252;">"pgrep -f -x '"</span> .. cmd_pgrep .. <span style="color: #8b2252;">"'"</span>))
       <span style="color: #a020f0;">local</span> <span style="color: #a0522d;">pid</span> = out:read(<span style="color: #8b2252;">"*all"</span>)
       out:close()
       <span style="color: #a020f0;">if</span> pid == <span style="color: #8b2252;">""</span> <span style="color: #a020f0;">then</span>
          awful.spawn(cmd_exe, { tag = screen[s].tags[tag] })
       <span style="color: #a020f0;">end</span>
    <span style="color: #a020f0;">else</span>
       awful.spawn.with_shell(cmd)
    <span style="color: #a020f0;">end</span>
<span style="color: #a020f0;">end</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org81c1d87" class="outline-3">
<h3 id="org81c1d87">Return object</h3>
<div class="outline-text-3" id="text-org81c1d87">
<p>
The module is instantiated by <code>local my_utility = require("my_utility")</code> and
functions are called using <code>my_utility.function(...)</code>.
</p>

<div class="org-src-container">
<pre class="src src-lua" id="orga99cf45"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my_utility.lua]</div>
<span style="color: #a020f0;">return</span> my_utility
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org4d73a7b" class="outline-2">
<h2 id="org4d73a7b">Resources</h2>
<div class="outline-text-2" id="text-org4d73a7b">
<ul class="org-ul">
<li>awesome wiki: <a href="https://awesome.naquadah.org/wiki">https://awesome.naquadah.org/wiki</a> (this may disappear in the
future as described in <a href="https://github.com/awesomeWM/awesome-www/issues/7">https://github.com/awesomeWM/awesome-www/issues/7</a>)</li>
<li>awesome-wm API: <a href="http://new.awesomewm.org/doc/api">http://new.awesomewm.org/doc/api</a></li>
<li>blingbling examples: <a href="https://github.com/cedlemo/blingbling">https://github.com/cedlemo/blingbling</a></li>
<li>Themes:
<ul class="org-ul">
<li><a href="https://awesome.naquadah.org/wiki/Beautiful_themes">https://awesome.naquadah.org/wiki/Beautiful_themes</a></li>
<li><a href="https://github.com/copycat-killer/awesome-copycats">https://github.com/copycat-killer/awesome-copycats</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<!-- [[file:~/dotfiles/emacs/website/website.org::html-postamble][html-postamble]] -->
<div id="show_source">
  <input type="button" class="footer-button" value="Show Org source (html)"
         onClick='show_org_source(true)' />
  <input type="button" class="footer-button" value="Show Org source (raw)"
         onClick='show_org_source()' />
</div>
<div class='footer'>
  Last updated 2018-08-19 Sun 18:10. <br>
  Built with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 25.2.2 (<a href="https://orgmode.org">Org</a> mode 9.1.14).
</div>
<!-- html-postamble ends here -->
</div>
</body>
</html>
