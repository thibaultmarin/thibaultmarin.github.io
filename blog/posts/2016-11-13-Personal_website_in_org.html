<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2017-12-04 Mon 21:30 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Personal website in org</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Thibault Marin">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<!-- [[file:~/dotfiles/emacs/website/website.org::html-head][html-head]] -->
<link rel='stylesheet' href='/blog/css/site.css' type='text/css'/>
<script type="text/javascript">
    function rpl(expr, a, b) {
      var i = 0;
      while (i != -1) {
         i = expr.indexOf(a, i);
         if (i >= 0) {
            expr = expr.substring(0, i) + b + expr.substring(i + a.length);
            i += b.length;
         }
      }
      return expr
    }

    function show_org_source(flag_html = false){
        //document.location.href = rpl(document.location.href, "html", "org");
        var re = /[\/]$/g;
        var html_url = document.location.href.replace(re, '/index.html');
        var out_ext = flag_html? "org.html": "org";
        window.open(rpl(html_url, "html", out_ext), '_blank');
    }
</script>
<!-- html-head ends here -->
<link rel="alternate" type="application/rss+xml"
                href="/blog/rss.xml"
                title="RSS feed">
<script type="text/javascript" src="/blog/js/org-info.js">
/**
 *
 * @source: /blog/js/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in /blog/js/org-info.js.
 *
 * Copyright (C) 2012-2017 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in /blog/js/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "2");
org_html_manager.set("LINK_HOME", "/blog/index.html");
org_html_manager.set("LINK_UP", "/blog/index.html");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "1");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "showall");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="/blog/index.html"> UP </a>
 |
 <a accesskey="H" href="/blog/index.html"> HOME </a>
</div><div id="preamble" class="status">
<!-- [[file:~/dotfiles/emacs/website/website.org::html-preamble][html-preamble]] -->
<div class='topnav'>
  <ul>
    <li><a href='/blog/index.html'>Home</a></li>
    <li><a href='/blog/blog.html'>Blog</a></li>
    <li class="right feed"><a href='/blog/rss.xml'>RSS</a></li>
  </ul>
</div>

<div class="foreword">
  [2016-11-13 Sun 00:00 (last updated: 2017-12-04 Mon 21:30) Press <kbd>?</kbd> for navigation help]
</div>
<!-- html-preamble ends here -->
</div>
<div id="content">
<h1 class="title">Personal website in org</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org92d2b4b">Introduction</a></li>
<li><a href="#css">Style</a>
<ul>
<li><a href="#org6f34bde">Variables</a></li>
<li><a href="#orgf10a9d0">Table of contents</a>
<ul>
<li><a href="#orge9218e3">Basic style</a></li>
<li><a href="#org87bbe94">Position</a>
<ul>
<li><a href="#orge7979a4">Large screen</a></li>
<li><a href="#org83080be">Medium screen</a></li>
<li><a href="#orgf7d8791">Small screen</a></li>
</ul>
</li>
<li><a href="#org4b24ab3">List style</a></li>
</ul>
</li>
<li><a href="#org20bdeb2">Navigation bar</a>
<ul>
<li><a href="#orga0f66a2">Basic style</a></li>
<li><a href="#org4ecb81d">Position</a>
<ul>
<li><a href="#orga495571">Medium and large screen</a></li>
<li><a href="#org6cbbf25">Small screen</a></li>
</ul>
</li>
<li><a href="#org5d53fe9">List style</a></li>
</ul>
</li>
<li><a href="#orgc8a254d">Source blocks</a></li>
<li><a href="#orgfbaf943">Tables</a></li>
<li><a href="#orga47088d">Org-js</a></li>
<li><a href="#org2fc99b4">Body</a>
<ul>
<li><a href="#org0b6a264">Preamble</a></li>
<li><a href="#org960fb9b">Content</a></li>
<li><a href="#org1417f0b">Postamble</a></li>
</ul>
</li>
<li><a href="#org814ba01">Fonts</a></li>
<li><a href="#org803e2e6">HTML tags</a>
<ul>
<li><a href="#org874bf2a">Buttons</a></li>
<li><a href="#orgeab3653">Keyboard shortcut (<code>&lt;kbd&gt;</code>)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd080c73">Common HTML</a>
<ul>
<li><a href="#html_head">Head</a></li>
<li><a href="#html_preamble">Preamble</a></li>
<li><a href="#html_postamble">Postamble</a></li>
</ul>
</li>
<li><a href="#index_org">Main page</a></li>
<li><a href="#page-blog-posts">Blog page</a></li>
<li><a href="#sec-org-setup">Org header</a></li>
<li><a href="#org8d0bdcc">Emacs setup</a>
<ul>
<li><a href="#org4e9bfc0">Header</a></li>
<li><a href="#sitemap">Sitemap</a></li>
<li><a href="#rss">RSS</a></li>
<li><a href="#orgb002cb8">Mathjax path</a></li>
<li><a href="#orgdce6e33">Custom backend</a>
<ul>
<li><a href="#org4d2d334">Preprocess buffer</a></li>
<li><a href="#src-block-tangle">Source block processing</a></li>
</ul>
</li>
<li><a href="#orge1e2fec">Publishing function</a></li>
<li><a href="#org3ae0edc">Org-publishing setup</a></li>
<li><a href="#el-publish-wrapper">Publishing wrapper function</a></li>
<li><a href="#el-push-to-blog">Push org-file to blog</a></li>
<li><a href="#orgafc3ac9">Footer</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org92d2b4b" class="outline-2">
<h2 id="org92d2b4b">Introduction</h2>
<div class="outline-text-2" id="text-org92d2b4b">
<p>
This post describes the configuration for this website, which is statically
generated using emacs and org-mode.  Org-mode's publishing functionality is used
to generate the HTML content from source <code>org</code> files.  Here is a list of
existing examples that I have used to build this website:
</p>

<ul class="org-ul">
<li><a href="http://bastibe.de/2013-11-13-blogging-with-emacs.html">http://bastibe.de/2013-11-13-blogging-with-emacs.html</a></li>
<li><a href="http://emacs-doctor.com/blogging-from-emacs.html">http://emacs-doctor.com/blogging-from-emacs.html</a></li>
<li><a href="http://endlessparentheses.com/how-i-blog-one-year-of-posts-in-a-single-org-file.html">http://endlessparentheses.com/how-i-blog-one-year-of-posts-in-a-single-org-file.html</a></li>
<li><a href="https://github.com/howardabrams/dot-files/blob/master/emacs-blog.org">https://github.com/howardabrams/dot-files/blob/master/emacs-blog.org</a></li>
<li><a href="http://www.john2x.com/blog/blogging-with-orgmode.html">http://www.john2x.com/blog/blogging-with-orgmode.html</a></li>
<li><a href="https://ogbe.net/blog/blogging_with_org.html">https://ogbe.net/blog/blogging_with_org.html</a></li>
<li><a href="http://nicolas.petton.fr/blog/blogging-with-org-mode.html">http://nicolas.petton.fr/blog/blogging-with-org-mode.html</a></li>
</ul>

<p>
As for other posts in this website, the actual configuration files, including
emacs-lisp configuration, CSS, etc. can be generated by tangling the org-file
(<code>org-babel-tangle</code> bound to <kbd>C-c</kbd>&nbsp;<kbd>C-v</kbd>&nbsp;<kbd>t</kbd> by default).
</p>

<p>
The folder structure is similar to the one described in the <a href="http://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html">Worg tutorial</a>: the
website source is composed of org files with the following structure:
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org7b0e846">tree -a org/ -I <span style="color: #8b2252;">"*~"</span>
</pre>
</div>

<pre class="example">
org/
├── blog.org
├── css
│   └── site.css
├── html
│   ├── html_head.html
│   ├── html_postamble.html
│   └── html_preamble.html
├── images
│   ├── 2016-10-05-Awesome-wm_configuration
│   │   ├── desktop-cmus-popup.png
│   │   ├── desktop-confirm_action.png
│   │   ├── desktop-global_prompt-help.png
│   │   ├── desktop-main.png
│   │   └── desktop-wibox.png
│   ├── 2016-11-13-Personal_website_in_org
│   │   └── website-post.png
│   └── feed-icon-28x28.png
├── index.org
├── js
│   └── org-info.js
├── posts
│   ├── 2016-10-05-Awesome-wm_configuration.org
│   └── 2016-11-13-Personal_website_in_org.org
├── rss.org
├── setup.org
└── sitemap.org

7 directories, 19 files
</pre>

<p>
The start page is the index.org file, which is described <a href="#index_org">later</a>.  It includes
links to the different pages, and a list of recent blog posts.  Blog posts are
located in the <code>posts/</code> folder, where each file contains a single post and the
filename is prefixed by the post date.  Attachments for blog posts (e.g. images)
are placed in the <code>images/</code> folder with a subfolder corresponding to the post
filename.  Blog posts are pushed to the blog from regular org files using a
<a href="#el-push-to-blog">custom function</a> which handles file naming and attachments.  Finally, the static
content is located in the <code>css/</code>, <code>js/</code> and <code>html/</code> folders.
</p>

<p>
The workflow I use to update this website is as follows:
</p>
<ul class="org-ul">
<li>for basic webpages (i.e. everything but the blog posts), edit the org files in
the source tree,</li>
<li>for blog posts, create a standalone org file outside of the website source
tree, then push it using the <a href="#el-push-to-blog">push-to-blog</a> function, which handles file links
and adds boilerplate options to the org file before moving the processed org
file to the website source tree,</li>
<li>finally run the <a href="#el-publish-wrapper">publishing wrapper function</a> to generate the website,</li>
<li>optionally push the changes to the actual server (e.g. github pages).</li>
</ul>
</div>
</div>


<div id="outline-container-org35587d2" class="outline-2">
<h2 id="css">Style</h2>
<div class="outline-text-2" id="text-css">
<p>
The styling of the website is done in CSS, the goal being to make it modular
rather than aesthetically pleasing (as visible on Fig.&nbsp;<a href="#org09a20c9">1</a>).
When tangled, this section generates the <code>site.css</code> used for styling.
</p>


<div id="org09a20c9" class="figure">
<p><a href="../images/2016-11-13-Personal_website_in_org/website-post.png" width="80%"><img src="../images/2016-11-13-Personal_website_in_org/website-post.png" alt="website-post.png" width="80%"></a>
</p>
<p><span class="figure-number">Figure 1: </span>Screenshot of a post.</p>
</div>

<p>
The website design is "responsive": the layout varies based on the client's
size.  Three client sizes are considered: large (width \(\geq\) 1024 px), medium
(600 px \(\leq\) width \(<\) 1024 px) and small (width \(<\) 600 px).
</p>
</div>

<div id="outline-container-org6f34bde" class="outline-3">
<h3 id="org6f34bde">Variables</h3>
<div class="outline-text-3" id="text-org6f34bde">
<p>
Most of the properties used for styling are defined at the top of the style
file.  This could be done via org variables passed to the CSS source block, but
<code>ob-css</code> does not support this (it seems that it could be added with minimal
effort for scalar variables at least).
</p>

<div class="org-src-container">
<pre class="src src-css" id="org7da03ae"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #b22222;">/** </span><span style="color: #b22222;">CSS variables</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>

<span style="color: #0000ff;">:root </span>{
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Body </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">---- </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--body-bg</span>: <span style="color: #000000; background-color: #FFFFFF;">white</span>;
    <span style="color: #a0522d;">--content-padding</span>: 10px;
    <span style="color: #a0522d;">--content-bg</span>: <span style="color: #000000; background-color: #F1F1F1;">#F1F1F1</span>;
    <span style="color: #a0522d;">--content-box-shadow</span>: 0;
    <span style="color: #a0522d;">--body-margin</span>: 30px; <span style="color: #b22222;">/* </span><span style="color: #b22222;">not used for small screens </span><span style="color: #b22222;">*/</span>

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Footer </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">------ </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--footer-border</span>: 1px solid <span style="color: #ffffff; background-color: #000000;">black</span>;
    <span style="color: #a0522d;">--footer-padding</span>: 10px;
    <span style="color: #a0522d;">--footer-buttons-bg</span>: <span style="color: #ffffff; background-color: #4C6FB0;">#4C6FB0</span>;
    <span style="color: #a0522d;">--footer-buttons-bg-hover</span>: <span style="color: #ffffff; background-color: #000080;">navy</span>;
    <span style="color: #a0522d;">--footer-buttons-padding</span>: 5px 10px;
    <span style="color: #a0522d;">--footer-buttons-color</span>: <span style="color: #000000; background-color: #FFFFFF;">white</span>;
    <span style="color: #a0522d;">--footer-buttons-font-size</span>: 90%;
    <span style="color: #a0522d;">--footer-buttons-border</span>: 2px solid <span style="color: #ffffff; background-color: #000080;">navy</span>;
    <span style="color: #a0522d;">--footer-buttons-min-width</span>: 270px;

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Table of contents </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">----------------- </span><span style="color: #b22222;">*/</span>

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Basic style </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--toc-bg</span>: <span style="color: #000000; background-color: #f1f1f1;">#f1f1f1</span>;
    <span style="color: #a0522d;">--toc-box-shadow</span>: 0 0 0.8em <span style="color: #ffffff; background-color: #777777;">#777777</span>;
    <span style="color: #a0522d;">--toc-border-radius</span>: 5px;
    <span style="color: #a0522d;">--toc-li-color</span>: <span style="color: #ffffff; background-color: #000000;">black</span>;
    <span style="color: #a0522d;">--toc-hover-bg-color</span>: <span style="color: #ffffff; background-color: #555;">#555</span>;
    <span style="color: #a0522d;">--toc-hover-color</span>: <span style="color: #000000; background-color: #FFFFFF;">white</span>;

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Layout </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--toc-nav-vspacing</span>: 20px;
    <span style="color: #a0522d;">--toc-base-padding</span>: 5px;
    <span style="color: #a0522d;">--toc-ul-padding-left</span>: 20px;
    <span style="color: #a0522d;">--toc-local-padding</span>: 5px;
    <span style="color: #a0522d;">--toc-extra-padding-x</span>: 4px;

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Navigation bar </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">-------------- </span><span style="color: #b22222;">*/</span>

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Basic style </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--nav-bg</span>: <span style="color: #ffffff; background-color: #333;">#333</span>;
    <span style="color: #a0522d;">--nav-hover</span>: <span style="color: #ffffff; background-color: #111;">#111</span>;

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">RSS </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">--- </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--rss-img</span>: url(<span style="color: #8b2252;">"/blog/images/feed-icon-28x28.png"</span>);

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Tables </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">------ </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--tbl-border-color</span>: <span style="color: #ffffff; background-color: #4E4E4F;">#4E4E4F</span>;
    <span style="color: #a0522d;">--tbl-border-size</span>: 1px;

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Org-js </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">------ </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--org-js-console-bg</span>: var(<span style="color: #a0522d;">--footer-buttons-bg</span>);

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Fonts </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">----- </span><span style="color: #b22222;">*/</span>

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Text </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--font-body-family</span>: Arial, sans-serif;
    <span style="color: #a0522d;">--font-body-size</span>: 14pt;

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Code </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--font-code-family</span>: DejaVu, Lucida Console, monospace;
    <span style="color: #a0522d;">--font-code-color</span>: <span style="color: #ffffff; background-color: #4E4E4F;">#4E4E4F</span>;
    <span style="color: #a0522d;">--font-code-size</span>: 11pt;
    <span style="color: #a0522d;">--font-src-family</span>: DejaVu, Lucida Console, monospace;
    <span style="color: #a0522d;">--font-example-family</span>: DejaVu, Lucida Console, monospace;
    <span style="color: #a0522d;">--font-example-size</span>: 11pt;

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Links </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--font-a-color</span>: <span style="color: #ffffff; background-color: #000080;">navy</span>;
    <span style="color: #a0522d;">--font-a-coderef-color</span>: <span style="color: #000000; background-color: #7082BC;">#7082BC</span>;

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Color scheme </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">------------ </span><span style="color: #b22222;">*/</span>

    <span style="color: #b22222;">/* </span><span style="color: #b22222;">Source blocks </span><span style="color: #b22222;">*/</span>
    <span style="color: #a0522d;">--src-bg</span>: <span style="color: #000000; background-color: #fBF9E7;">#fBF9E7</span>;
    <span style="color: #a0522d;">--lua-bg</span>: var(<span style="color: #a0522d;">--src-bg</span>);

}

<span style="color: #b22222;">/** </span><span style="color: #b22222;">Responsive variables</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">Large screens </span><span style="color: #b22222;">*/</span>
<span style="color: #483d8b;">@media</span> (min-width: 1024px) {
    :root {
        <span style="color: #a0522d;">--side-width</span>: 250px;
        <span style="color: #a0522d;">--body-width</span>: calc(92% - var(<span style="color: #a0522d;">--side-width</span>));
        <span style="color: #a0522d;">--nav-base-font-size</span>: 80%;
        <span style="color: #a0522d;">--nav-height</span>: 50px;
        <span style="color: #a0522d;">--nav-padding</span>: 14px 16px;
        <span style="color: #a0522d;">--toc-base-font-size</span>: 70%;
        <span style="color: #a0522d;">--toc-ul-font-size</span>: 150%;
        <span style="color: #a0522d;">--toc-ul-local-font-size</span>: 130%;
        <span style="color: #a0522d;">--toc-ul-2-font-size</span>: 80%;
        <span style="color: #a0522d;">--toc-ul-3-font-size</span>: 80%;
        <span style="color: #a0522d;">--font-src-size</span>: 11pt;
        <span style="color: #a0522d;">--rss-padding</span>: 0 0 0 25px;
        <span style="color: #a0522d;">--rss-size</span>: 25px 25px;
        <span style="color: #a0522d;">--rss-pos</span>: 50%;
    }
}

<span style="color: #b22222;">/* </span><span style="color: #b22222;">Medium screens </span><span style="color: #b22222;">*/</span>
<span style="color: #483d8b;">@media</span> (min-width: 600px) and (max-width: 1024px) {
    :root {
        <span style="color: #a0522d;">--side-width</span>: 150px;
        <span style="color: #a0522d;">--body-width</span>: calc(92% - var(<span style="color: #a0522d;">--side-width</span>));
        <span style="color: #a0522d;">--nav-base-font-size</span>: 70%;
        <span style="color: #a0522d;">--nav-height</span>: 30px;
        <span style="color: #a0522d;">--nav-padding</span>: 5px 6px;
        <span style="color: #a0522d;">--toc-base-font-size</span>: 70%;
        <span style="color: #a0522d;">--toc-ul-font-size</span>: 130%;
        <span style="color: #a0522d;">--toc-ul-local-font-size</span>: 130%;
        <span style="color: #a0522d;">--toc-ul-2-font-size</span>: 80%;
        <span style="color: #a0522d;">--font-src-size</span>: 11pt;
        <span style="color: #a0522d;">--rss-padding</span>: 0 0 19px 9px;
        <span style="color: #a0522d;">--rss-size</span>: 10px 10px;
        <span style="color: #a0522d;">--rss-pos</span>: 25%;
    }
}

<span style="color: #b22222;">/* </span><span style="color: #b22222;">Small screens </span><span style="color: #b22222;">*/</span>
<span style="color: #483d8b;">@media</span> (max-width: 600px) {
    :root {
        <span style="color: #a0522d;">--side-width</span>: 150px; <span style="color: #b22222;">/* </span><span style="color: #b22222;">unused in this case </span><span style="color: #b22222;">*/</span>
        <span style="color: #a0522d;">--body-width</span>: 100%;
        <span style="color: #a0522d;">--nav-base-font-size</span>: 80%;
        <span style="color: #a0522d;">--nav-height</span>: 30px;
        <span style="color: #a0522d;">--nav-padding</span>: 5px 6px;
        <span style="color: #a0522d;">--toc-base-font-size</span>: 80%;
        <span style="color: #a0522d;">--toc-ul-font-size</span>: 120%;
        <span style="color: #a0522d;">--toc-ul-local-font-size</span>: 130%;
        <span style="color: #a0522d;">--toc-ul-2-font-size</span>: 80%;
        <span style="color: #a0522d;">--font-src-size</span>: 10pt;
        <span style="color: #a0522d;">--rss-padding</span>: 0 0 19px 20px;
        <span style="color: #a0522d;">--rss-size</span>: 20px 20px;
        <span style="color: #a0522d;">--rss-pos</span>: 19%;
    }
}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf10a9d0" class="outline-3">
<h3 id="orgf10a9d0">Table of contents</h3>
<div class="outline-text-3" id="text-orgf10a9d0">
<p>
Exported pages use <a href="http://orgmode.org/worg/code/org-info-js/">org-infojs</a> for navigation.  It comes with a nice table of
contents for the document (with CSS id <code>#table-of-contents</code>).  Similar to the
fixed table of contents used on the <a href="http://orgmode.org/worg/">Worg website</a>, it is fixed on one side of the
page.
</p>

<p>
A local table of contents for each section is also used (since blog posts tend
to be quite lengthy), and styled in a similar fashion.  The relevant CSS class
is <code>.org-info-js_local-toc</code>.
</p>

<p>
The table of contents is "responsive" as it adapts to the viewport (client)
size:
</p>
<ul class="org-ul">
<li>Fixed vertical menu for large screens</li>
<li>Reduce to single level table on medium size screens</li>
<li>Collapse to regular section (floating) for small screens</li>
</ul>
</div>


<div id="outline-container-orge9218e3" class="outline-4">
<h4 id="orge9218e3">Basic style</h4>
<div class="outline-text-4" id="text-orge9218e3">
<p>
First, we define the basic styling properties for the table of contents: color,
shadow, size, etc.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org96fcc62"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #b22222;">/** </span><span style="color: #b22222;">Table of content</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">Basic styling (color, font, shadow) common to global and local TOC </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">#table-of-contents, .org-info-js_local-toc </span>{
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--toc-bg</span>);
    <span style="color: #a0522d;">box-shadow</span>: var(<span style="color: #a0522d;">--toc-box-shadow</span>);
    <span style="color: #a0522d;">border-bottom-left-radius</span>: var(<span style="color: #a0522d;">--toc-border-radius</span>);
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--toc-base-font-size</span>);
}

<span style="color: #b22222;">/* </span><span style="color: #b22222;">Size (global TOC only) </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">#table-of-contents </span>{
    <span style="color: #a0522d;">width</span>: var(<span style="color: #a0522d;">--side-width</span>);
}

<span style="color: #0000ff;">.org-info-js_local-toc </span>{
    <span style="color: #a0522d;">padding</span>: var(<span style="color: #a0522d;">--toc-local-padding</span>);
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org87bbe94" class="outline-4">
<h4 id="org87bbe94">Position</h4>
<div class="outline-text-4" id="text-org87bbe94">
<p>
The placement of the table of contents depends on the screen size: the different
definitions are placed here.
</p>
</div>

<div id="outline-container-orge7979a4" class="outline-5">
<h5 id="orge7979a4">Large screen</h5>
<div class="outline-text-5" id="text-orge7979a4">
<p>
For medium and large screens, the table of contents is fixed on the left of the
screen.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org4ae0254"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #b22222;">/* </span><span style="color: #b22222;">Fixed vertical table of content </span><span style="color: #b22222;">*/</span>
<span style="color: #483d8b;">@media</span> screen and (min-width: 600px) {
    <span style="color: #0000ff;">#table-of-contents </span>{
        <span style="color: #a0522d;">position</span>: fixed;
        <span style="color: #a0522d;">left</span>: 0;
        <span style="color: #a0522d;">top</span>: calc(var(<span style="color: #a0522d;">--nav-height</span>) + var(<span style="color: #a0522d;">--toc-nav-vspacing</span>));
        <span style="color: #a0522d;">bottom</span>: var(<span style="color: #a0522d;">--toc-nav-vspacing</span>);
        <span style="color: #a0522d;">padding</span>: var(<span style="color: #a0522d;">--toc-base-padding</span>);
        <span style="color: #a0522d;">overflow</span>: auto;
    }
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org83080be" class="outline-5">
<h5 id="org83080be">Medium screen</h5>
<div class="outline-text-5" id="text-org83080be">
<p>
For medium and small screens, the table of contents is limited to only top level
headings.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org1dc756b"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #483d8b;">@media</span> screen and (max-width: 1024px) {
    <span style="color: #0000ff;">#table-of-contents &gt; div &gt; ul &gt; li &gt; ul </span>{
        <span style="color: #a0522d;">display</span>: none;
    }
}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf7d8791" class="outline-5">
<h5 id="orgf7d8791">Small screen</h5>
<div class="outline-text-5" id="text-orgf7d8791">
<p>
For small screens, the table of contents is a regular section, and it is set to
use (almost) all the available width.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org1d529a8"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #483d8b;">@media</span> screen and (max-width: 600px) {
    <span style="color: #0000ff;">#table-of-contents </span>{
        <span style="color: #a0522d;">position</span>: relative;
        <span style="color: #a0522d;">width</span>: 90%;
        <span style="color: #a0522d;">margin</span>: auto;
    }
}
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org4b24ab3" class="outline-4">
<h4 id="org4b24ab3">List style</h4>
<div class="outline-text-4" id="text-org4b24ab3">
<p>
The style for entries in the table of contents are defined here.  The following
block sets font sizes and alignment.
</p>

<div class="org-src-container">
<pre class="src src-css" id="orgfb2a1aa"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #0000ff;">#table-of-contents ul, .org-info-js_local-toc ul </span>{
    <span style="color: #a0522d;">list-style-type</span>: none;
    <span style="color: #a0522d;">margin</span>: 0;
    <span style="color: #a0522d;">padding-left</span>: var(<span style="color: #a0522d;">--toc-ul-padding-left</span>);
}

<span style="color: #0000ff;">#table-of-contents ul </span>{
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--toc-ul-font-size</span>);
}

<span style="color: #0000ff;">.org-info-js_local-toc ul </span>{
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--toc-ul-local-font-size</span>);
}

<span style="color: #0000ff;">#table-of-contents &gt; div &gt; ul, .org-info-js_local-toc &gt; div &gt; ul </span>{
    <span style="color: #a0522d;">list-style-type</span>: none;
    <span style="color: #a0522d;">margin</span>: 0;
    <span style="color: #a0522d;">padding-left</span>: var(<span style="color: #a0522d;">--toc-extra-padding-x</span>);
}

<span style="color: #0000ff;">#table-of-contents &gt; div &gt; ul &gt; li &gt; ul</span>{
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--toc-ul-2-font-size</span>);
    <span style="color: #a0522d;">vertical-align</span>: middle;
}

<span style="color: #0000ff;">#table-of-contents &gt; div &gt; ul &gt; li &gt; ul &gt; li &gt; ul</span>{
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--toc-ul-3-font-size</span>);
    <span style="color: #a0522d;">vertical-align</span>: middle;
}
</pre>
</div>

<p>
The appearance of links is defined here:
</p>

<div class="org-src-container">
<pre class="src src-css" id="org9cb50b6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #0000ff;">#table-of-contents li a, .org-info-js_local-toc li a </span>{
    <span style="color: #a0522d;">display</span>: block;
    <span style="color: #a0522d;">color</span>: var(<span style="color: #a0522d;">--toc-li-color</span>);
    <span style="color: #a0522d;">text-decoration</span>: none;
}

<span style="color: #0000ff;">#table-of-contents li a </span>{
    <span style="color: #a0522d;">vertical-align</span>: middle;
}

<span style="color: #0000ff;">#table-of-contents li a:hover:not(.active), .org-info-js_local-toc li a:hover:not(.active) </span>{
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--toc-hover-bg-color</span>);
    <span style="color: #a0522d;">color</span>: var(<span style="color: #a0522d;">--toc-hover-color</span>);
}
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org20bdeb2" class="outline-3">
<h3 id="org20bdeb2">Navigation bar</h3>
<div class="outline-text-3" id="text-org20bdeb2">
<p>
A small navigation bar is added to all pages in the website (on the top left
corner).  It contains links to the home page, a list of blog posts and the RSS
feed.  As for the table of contents, its sizes decreases for medium size
clients, and collapses to a floating menu at the top for small clients.
</p>
</div>

<div id="outline-container-orga0f66a2" class="outline-4">
<h4 id="orga0f66a2">Basic style</h4>
<div class="outline-text-4" id="text-orga0f66a2">
<p>
First, the basic style elements are defined, including the position, size, color
and text alignment.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org6150ee7"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #b22222;">/** </span><span style="color: #b22222;">Navigation bar</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*/</span>

<span style="color: #0000ff;">.topnav </span>{
    <span style="color: #a0522d;">top</span>: 0;
    <span style="color: #a0522d;">left</span>: 0;
    <span style="color: #a0522d;">max-height</span>: var(<span style="color: #a0522d;">--nav-height</span>);
    <span style="color: #a0522d;">vertical-align</span>: middle;
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--nav-bg</span>);
    <span style="color: #a0522d;">width</span>: var(<span style="color: #a0522d;">--side-width</span>);
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--nav-base-font-size</span>);
}

<span style="color: #b22222;">/* </span><span style="color: #b22222;">RSS icon </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">.feed </span>{
    <span style="color: #a0522d;">margin-left</span>: 3px;
    <span style="color: #a0522d;">padding</span>: var(<span style="color: #a0522d;">--rss-padding</span>);
    <span style="color: #a0522d;">background</span>: var(<span style="color: #a0522d;">--rss-img</span>) no-repeat 0 var(<span style="color: #a0522d;">--rss-pos</span>);
    <span style="color: #a0522d;">background-size</span>: var(<span style="color: #a0522d;">--rss-size</span>);
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org4ecb81d" class="outline-4">
<h4 id="org4ecb81d">Position</h4>
<div class="outline-text-4" id="text-org4ecb81d">
</div>

<div id="outline-container-orga495571" class="outline-5">
<h5 id="orga495571">Medium and large screen</h5>
<div class="outline-text-5" id="text-orga495571">
<p>
For medium and large screens, the navigation bar is fixed on the top left
corner.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org7e3a66e"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #483d8b;">@media</span> screen and (min-width: 600px) {
    <span style="color: #0000ff;">.topnav </span>{
        <span style="color: #a0522d;">position</span>: fixed;
    }
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org6cbbf25" class="outline-5">
<h5 id="org6cbbf25">Small screen</h5>
<div class="outline-text-5" id="text-org6cbbf25">
<p>
For small screens, the navigation bar is placed at the top, and made floating.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org23705d6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #483d8b;">@media</span> screen and (max-width: 600px) {
    <span style="color: #0000ff;">.topnav </span>{
        <span style="color: #a0522d;">position</span>: relative;
        <span style="color: #a0522d;">width</span>: 100%;
    }
}
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org5d53fe9" class="outline-4">
<h4 id="org5d53fe9">List style</h4>
<div class="outline-text-4" id="text-org5d53fe9">
<p>
The following block sets the style of the navigation items.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org79f965a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #0000ff;">.topnav ul </span>{
    <span style="color: #a0522d;">list-style-type</span>: none;
    <span style="color: #a0522d;">margin</span>: 0;
    <span style="color: #a0522d;">padding</span>: 0;
    <span style="color: #a0522d;">overflow</span>: hidden;
    <span style="color: #a0522d;">position</span>: relative;
    <span style="color: #a0522d;">vertical-align</span>: middle;
}

<span style="color: #0000ff;">.topnav li </span>{
    <span style="color: #a0522d;">float</span>: left;
    <span style="color: #a0522d;">vertical-align</span>: middle;
    <span style="color: #a0522d;">position</span>: relative;
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-css" id="org8e8f30a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #0000ff;">.topnav li a </span>{
    <span style="color: #a0522d;">display</span>: block;
    <span style="color: #a0522d;">color</span>: <span style="color: #000000; background-color: #FFFFFF;">white</span>;
    <span style="color: #a0522d;">text-align</span>: left;
    <span style="color: #a0522d;">padding</span>: var(<span style="color: #a0522d;">--nav-padding</span>);
    <span style="color: #a0522d;">text-decoration</span>: none;
    <span style="color: #a0522d;">position</span>: relative;
    <span style="color: #a0522d;">vertical-align</span>: middle;
}

<span style="color: #0000ff;">.topnav li a:hover:not(.active) </span>{
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--nav-hover</span>);
}

<span style="color: #0000ff;">.topnav .right </span>{
    <span style="color: #a0522d;">float</span>: right;
}
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgc8a254d" class="outline-3">
<h3 id="orgc8a254d">Source blocks</h3>
<div class="outline-text-3" id="text-orgc8a254d">
<p>
This section defines the appearance of source blocks in the rendered HTML.  The
main features are:
</p>
<ul class="org-ul">
<li>allow scrollbars on overflow,</li>
<li>move the tooltip with the language inside the div block,</li>
<li>set colors for the background and the filename label (see the
<a href="#src-block-tangle">source labeling setup</a> section).</li>
</ul>

<div class="org-src-container">
<pre class="src src-css" id="org1d81fc6"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #0000ff;">pre.src </span>{
    <span style="color: #a0522d;">overflow-x</span>: auto;
    <span style="color: #a0522d;">overflow-y</span>: auto;
    <span style="color: #a0522d;">line-height</span>: 2.5ex;
    <span style="color: #a0522d;">max-height</span>: 125ex;
}

<span style="color: #0000ff;">pre.src:before </span>{
    <span style="color: #a0522d;">visibility</span>: hidden;
    <span style="color: #a0522d;">top</span>: 0;
    <span style="color: #a0522d;">left</span>: 0;
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">max-width: 50px; </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">opacity: 0.5; </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">border: none; </span><span style="color: #b22222;">*/</span>
    <span style="color: #b22222;">/* </span><span style="color: #b22222;">background-color: transparent; </span><span style="color: #b22222;">*/</span>
}

<span style="color: #b22222;">/* </span><span style="color: #b22222;">Source block color based on file type </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">pre.src.src.src-lua </span>{
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--lua-bg</span>);
}

<span style="color: #b22222;">/* </span><span style="color: #b22222;">Source block label </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">.src-label </span>{
    <span style="color: #a0522d;">color</span>: <span style="color: #000000; background-color: #A9A9A9;">darkgray</span>;
}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgfbaf943" class="outline-3">
<h3 id="orgfbaf943">Tables</h3>
<div class="outline-text-3" id="text-orgfbaf943">
<p>
The following defines the style of HTML tables:
</p>

<div class="org-src-container">
<pre class="src src-css" id="org298887a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #b22222;">/* </span><span style="color: #b22222;">HTML tables </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">table, th, td </span>{
    <span style="color: #a0522d;">border-color</span>: var(<span style="color: #a0522d;">--tbl-border-color</span>);
    <span style="color: #a0522d;">border</span>: solid var(<span style="color: #a0522d;">--tbl-border-size</span>);
}
</pre>
</div>
</div>
</div>


<div id="outline-container-orga47088d" class="outline-3">
<h3 id="orga47088d">Org-js</h3>
<div class="outline-text-3" id="text-orga47088d">
<p>
The org-infojs tool inserts a search box in the rendered html.  It is used for
search operations.  The following sets the default location for the search box.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org5966dea"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #0000ff;">#org-info-js_console-container </span>{
    <span style="color: #a0522d;">bottom</span>: 0;
    <span style="color: #a0522d;">margin-top</span>: 0;
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org2fc99b4" class="outline-3">
<h3 id="org2fc99b4">Body</h3>
<div class="outline-text-3" id="text-org2fc99b4">
<p>
The following CSS controls the size of the body, which adapts to the client
size.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org0298f34"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #b22222;">/* </span><span style="color: #b22222;">Body </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">body </span>{
    <span style="color: #a0522d;">width</span>: var(<span style="color: #a0522d;">--body-width</span>);
    <span style="color: #a0522d;">overflow-x</span>: hidden;
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--body-bg</span>);
}

<span style="color: #483d8b;">@media</span> (min-width: 600px) {
    <span style="color: #0000ff;">body </span>{
        <span style="color: #a0522d;">margin-left</span>: calc(var(<span style="color: #a0522d;">--side-width</span>) + var(<span style="color: #a0522d;">--body-margin</span>));
        <span style="color: #a0522d;">margin-right</span>: var(<span style="color: #a0522d;">--body-margin</span>);
    }
}

<span style="color: #483d8b;">@media</span> (max-width: 600px) {
    <span style="color: #0000ff;">body </span>{
        <span style="color: #a0522d;">margin-left</span>: 0;
        <span style="color: #a0522d;">margin-right</span>: 0;
    }
}
</pre>
</div>
</div>


<div id="outline-container-org0b6a264" class="outline-4">
<h4 id="org0b6a264">Preamble</h4>
<div class="outline-text-4" id="text-org0b6a264">
<p>
The preamble is a text added to the top of the page.  The actual content is
defined in the <a href="#html_preamble">HTML preamble section</a>.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org699782e"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #b22222;">/* </span><span style="color: #b22222;">Text before post (date and help) </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">.foreword </span>{
    <span style="color: #a0522d;">color</span>: <span style="color: #000000; background-color: #808080;">gray</span>;
    <span style="color: #a0522d;">font-size</span>: 80%;
}
</pre>
</div>

<p>
The <code>home=/=up</code> buttons are hidden for small clients.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org376b6fc"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #483d8b;">@media</span> screen and (max-width: 600px) {
    <span style="color: #0000ff;">#org-div-home-and-up </span>{
        <span style="color: #a0522d;">display</span>: none;
    }
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org960fb9b" class="outline-4">
<h4 id="org960fb9b">Content</h4>
<div class="outline-text-4" id="text-org960fb9b">
<p>
The following block is used to limit the width of the main content and add a
background color.
</p>

<div class="org-src-container">
<pre class="src src-css" id="orga458c58"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #b22222;">/* </span><span style="color: #b22222;">Main content </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">#content </span>{
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--content-bg</span>);
    <span style="color: #a0522d;">box-shadow</span>: var(<span style="color: #a0522d;">--content-box-shadow</span>);
    <span style="color: #a0522d;">padding-left</span>: var(<span style="color: #a0522d;">--content-padding</span>);
    <span style="color: #a0522d;">padding-right</span>: var(<span style="color: #a0522d;">--content-padding</span>);
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org1417f0b" class="outline-4">
<h4 id="org1417f0b">Postamble</h4>
<div class="outline-text-4" id="text-org1417f0b">
<p>
This section defines the layout of the <a href="#html_postamble">HTML postamble</a> used on all pages.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org6bb394f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #0000ff;">#postamble </span>{
    <span style="color: #a0522d;">padding</span>: var(<span style="color: #a0522d;">--footer-padding</span>);
    <span style="color: #a0522d;">border</span>: var(<span style="color: #a0522d;">--footer-border</span>);
}
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org814ba01" class="outline-3">
<h3 id="org814ba01">Fonts</h3>
<div class="outline-text-3" id="text-org814ba01">
<p>
Here, the fonts for text, links and code are selected.
</p>

<div class="org-src-container">
<pre class="src src-css" id="org9e737cb"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #b22222;">/* </span><span style="color: #b22222;">Fonts </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">body </span>{
    <span style="color: #a0522d;">font-family</span>: var(<span style="color: #a0522d;">--font-body-family</span>);
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--font-body-size</span>);
}

<span style="color: #0000ff;">code </span>{
    <span style="color: #a0522d;">font-family</span>: var(<span style="color: #a0522d;">--font-code-family</span>);
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--font-code-size</span>);
    <span style="color: #a0522d;">color</span>: var(<span style="color: #a0522d;">--font-code-color</span>);
}

<span style="color: #0000ff;">pre.src </span>{
    <span style="color: #a0522d;">font-family</span>: var(<span style="color: #a0522d;">--font-src-family</span>);
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--font-src-size</span>);
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--src-bg</span>);
}

<span style="color: #0000ff;">pre.example </span>{
    <span style="color: #a0522d;">font-family</span>: var(<span style="color: #a0522d;">--font-example-family</span>);
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--font-example-size</span>);
}

<span style="color: #b22222;">/* </span><span style="color: #b22222;">Links </span><span style="color: #b22222;">*/</span>
<span style="color: #0000ff;">a </span>{
    <span style="color: #a0522d;">text-decoration</span>: none;
    <span style="color: #a0522d;">color</span>: var(<span style="color: #a0522d;">--font-a-color</span>);
}

<span style="color: #0000ff;">a.coderef </span>{
    <span style="color: #a0522d;">color</span>: var(<span style="color: #a0522d;">--font-a-coderef-color</span>);
}
</pre>
</div>
</div>
</div>


<div id="outline-container-org803e2e6" class="outline-3">
<h3 id="org803e2e6">HTML tags</h3>
<div class="outline-text-3" id="text-org803e2e6">
</div>

<div id="outline-container-org874bf2a" class="outline-4">
<h4 id="org874bf2a">Buttons</h4>
<div class="outline-text-4" id="text-org874bf2a">
<p>
The <a href="#html_postamble">HTML postamble</a> uses buttons to view the page org source; their appearance is
defined here:
</p>

<div class="org-src-container">
<pre class="src src-css" id="org9684c4f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div><span style="color: #0000ff;">.footer-button </span>{
    <span style="color: #a0522d;">border</span>: none;
    <span style="color: #a0522d;">text-align</span>: center;
    <span style="color: #a0522d;">text-decoration</span>: none;
    <span style="color: #a0522d;">display</span>: inline-block;
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--footer-buttons-bg</span>);
    <span style="color: #a0522d;">color</span>: var(<span style="color: #a0522d;">--footer-buttons-color</span>);
    <span style="color: #a0522d;">padding</span>: var(<span style="color: #a0522d;">--footer-buttons-padding</span>);
    <span style="color: #a0522d;">font-size</span>: var(<span style="color: #a0522d;">--footer-buttons-font-size</span>);
    <span style="color: #a0522d;">border</span>: var(<span style="color: #a0522d;">--footer-buttons-border</span>);
    <span style="color: #a0522d;">min-width</span>: var(<span style="color: #a0522d;">--footer-buttons-min-width</span>);
}
<span style="color: #0000ff;">.footer-button:hover </span>{
    <span style="color: #a0522d;">background-color</span>: var(<span style="color: #a0522d;">--footer-buttons-bg-hover</span>);
}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgeab3653" class="outline-4">
<h4 id="orgeab3653">Keyboard shortcut (<code>&lt;kbd&gt;</code>)</h4>
<div class="outline-text-4" id="text-orgeab3653">
<p>
Define a simple css style for the html <code>&lt;kbd&gt;</code> tag.
</p>

<div class="org-src-container">
<pre class="src src-css" id="orgb3db6d2"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/css/site.css]</div>
<span style="color: #0000ff;">kbd </span>{
    <span style="color: #a0522d;">font-family</span>: DejaVu, Lucida Console, monospace;
    <span style="color: #a0522d;">font-size</span>: 85%;
    <span style="color: #a0522d;">display</span>: inline-block;
    <span style="color: #a0522d;">padding</span>: 0.5px 5px;
    <span style="color: #a0522d;">color</span>: <span style="color: #ffffff; background-color: #616161;">#616161</span>;
    <span style="color: #a0522d;">vertical-align</span>: middle;
    <span style="color: #a0522d;">background-color</span>: <span style="color: #000000; background-color: #fefefe;">#fefefe</span>;
    <span style="color: #a0522d;">border</span>: solid 1px <span style="color: #ffffff; background-color: #616161;">#616161</span>;
    <span style="color: #a0522d;">border-radius</span>: 4px;
    <span style="color: #a0522d;">box-shadow</span>: 0 0 12px 2px <span style="color: #000000; background-color: #dbdbdb;">#dbdbdb</span> inset, 0 4px 1px -2px <span style="color: #000000; background-color: #dbdbdb;">#dbdbdb</span>;
}
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgd080c73" class="outline-2">
<h2 id="orgd080c73">Common HTML</h2>
<div class="outline-text-2" id="text-orgd080c73">
<p>
The org publishing mechanism supports inclusion of common HTML at the beginning
and the end of each published page, as described <a href="http://orgmode.org/manual/HTML-preamble-and-postamble.html">here</a>.
</p>
</div>

<div id="outline-container-orgc42234e" class="outline-3">
<h3 id="html_head">Head</h3>
<div class="outline-text-3" id="text-html_head">
<p>
In each page's <code>&lt;head&gt;</code> section, a few items are added:
</p>
<ul class="org-ul">
<li>the <a href="#css">CSS file</a> controlling the website appearance,</li>
<li>some <a href="#coderef-html-head-js-src" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-html-head-js-src');" onmouseout="CodeHighlightOff(this, 'coderef-html-head-js-src');">javascript code</a> used by the <a href="#html_postamble">HTML postamble</a> buttons to link to the org
file source (and a htmlized version of it).</li>
</ul>

<div class="org-src-container">
<pre class="src src-html" id="org075dd00"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/html/html_head.html]</div>&lt;<span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>='stylesheet' <span style="color: #a0522d;">href</span>='/blog/css/site.css' <span style="color: #a0522d;">type</span>='text/css'/&gt;
&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text/javascript"</span>&gt;
    function rpl(expr, a, b) {
      var i = 0;
      while (i != -1) {
         i = expr.indexOf(a, i);
         if (i &gt;= 0) {
            expr = expr.substring(0, i) + b + expr.substring(i + a.length);
            i += b.length;
         }
      }
      return expr
    }

<span id="coderef-html-head-js-src" class="coderef-off">    function show_org_source(flag_html = false){</span>
        //document.location.href = rpl(document.location.href, <span style="color: #8b2252;">"html"</span>, <span style="color: #8b2252;">"org"</span>);
        var re = /[\/]$/g;
        var html_url = document.location.href.replace(re, '/index.html');
        var out_ext = flag_html? "org.html": "org";
        window.open(rpl(html_url, <span style="color: #8b2252;">"html"</span>, out_ext), '_blank');
    }
&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>
</div>
</div>
</div>


<div id="outline-container-org7c73b9b" class="outline-3">
<h3 id="html_preamble">Preamble</h3>
<div class="outline-text-3" id="text-html_preamble">
<p>
The preamble contains the navigation bar with links to the website home, posts
and RSS.  It also adds a <a href="#coderef-html-foreword" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-html-foreword');" onmouseout="CodeHighlightOff(this, 'coderef-html-foreword');">short text</a> before the webpage's content with the file
date and a pointer to access the help menu of the org-infojs script.
</p>

<div class="org-src-container">
<pre class="src src-html" id="org248b469"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/html/html_preamble.html]</div>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>='topnav'&gt;
  &lt;<span style="color: #0000ff;">ul</span>&gt;
    &lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>='/blog/index.html'&gt;Home&lt;/<span style="color: #0000ff;">a</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
    &lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>='/blog/blog.html'&gt;Blog&lt;/<span style="color: #0000ff;">a</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
    &lt;<span style="color: #0000ff;">li</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"right feed"</span>&gt;&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>='/blog/rss.xml'&gt;RSS&lt;/<span style="color: #0000ff;">a</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
  &lt;/<span style="color: #0000ff;">ul</span>&gt;
&lt;/<span style="color: #0000ff;">div</span>&gt;

<span id="coderef-html-foreword" class="coderef-off">&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"foreword"</span>&gt;</span>
  [<span style="color: #a0522d;">%d</span> (last updated: <span style="color: #a0522d;">%C</span>) Press &lt;<span style="color: #0000ff;">kbd</span>&gt;?&lt;/<span style="color: #0000ff;">kbd</span>&gt; for navigation help]
&lt;/<span style="color: #0000ff;">div</span>&gt;
</pre>
</div>
</div>
</div>


<div id="outline-container-org75e1be8" class="outline-3">
<h3 id="html_postamble">Postamble</h3>
<div class="outline-text-3" id="text-html_postamble">
<p>
The postamble is composed of a simple block showing the emacs and org-mode
versions used to build the page, along with buttons to access the source org
file, and an htmlized version.  The raw version should allow to reproduce the
output published on the website.
</p>

<div class="org-src-container">
<pre class="src src-html" id="org2d172d2"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/html/html_postamble.html]</div>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"show_source"</span>&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"button"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"footer-button"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"Show Org source (html)"</span>
         <span style="color: #a0522d;">onClick</span>='show_org_source(true)' /&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"button"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"footer-button"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"Show Org source (raw)"</span>
         <span style="color: #a0522d;">onClick</span>='show_org_source()' /&gt;
&lt;/<span style="color: #0000ff;">div</span>&gt;
&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>='footer'&gt;
  Last updated <span style="color: #a0522d;">%C.</span> &lt;<span style="color: #0000ff;">br</span>&gt;
  Built with <span style="color: #a0522d;">%c.</span>
&lt;/<span style="color: #0000ff;">div</span>&gt;
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org53b1aee" class="outline-2">
<h2 id="index_org">Main page</h2>
<div class="outline-text-2" id="text-index_org">
<p>
The main page of the website is minimalist, it lists the most recent blog posts
by <a href="#coderef-main-inc-sitemap" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-main-inc-sitemap');" onmouseout="CodeHighlightOff(this, 'coderef-main-inc-sitemap');">including</a> the top of the <a href="#sitemap">sitemap</a> and links to the <a href="#page-blog-posts">full list of blog posts</a> and
the <a href="#sitemap">sitemap</a> itself.
</p>

<div class="org-src-container">
<pre class="src src-org" id="orgb1600a9"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/index.org]</div><span style="color: #7f7f7f;">#+TITLE:</span> <span style="color: #191970; font-weight: bold;">misc/</span>
<span style="color: #7f7f7f;">#+DATE:</span> <span style="color: #191970;">&lt;2016-10-02 Sun&gt;</span>

Random articles about linux, emacs, data processing, etc.  This site and the
articles are built with <span style="color: #3a5fcd; text-decoration: underline;"><a href="https://gnu.org/s/emacs">emacs</a></span> and
<span style="color: #3a5fcd; text-decoration: underline;"><a href="http://orgmode.org">org-mode</a></span> (using
<span style="color: #3a5fcd; text-decoration: underline;"><a href="http://orgmode.org/worg/code/org-info-js">org-js</a></span>).

<span style="color: #0000ff;">* Blog</span>

<span id="coderef-main-inc-sitemap" class="coderef-off"><span style="color: #b22222;">#+INCLUDE: sitemap.org::*posts :lines "-5" :only-contents t</span></span>

<span style="color: #3a5fcd; text-decoration: underline;"><a href="file:blog.org">Older posts</a></span>

<span style="color: #0000ff;">* </span><span style="color: #3a5fcd; text-decoration: underline;"><a href="file:sitemap.org">Sitemap</a></span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgdd9242e" class="outline-2">
<h2 id="page-blog-posts">Blog page</h2>
<div class="outline-text-2" id="text-page-blog-posts">
<p>
The blog page simply lists all the posts using the <a href="#sitemap">sitemap</a>.
</p>

<div class="org-src-container">
<pre class="src src-org" id="org7baa68f"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/blog.org]</div>
<span style="color: #7f7f7f;">#+TITLE:</span> <span style="color: #191970; font-weight: bold;">Blog posts</span>

All the blog posts:

<span style="color: #b22222;">#+INCLUDE: sitemap.org::*posts :only-contents t</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org0ef4b55" class="outline-2">
<h2 id="sec-org-setup">Org header</h2>
<div class="outline-text-2" id="text-sec-org-setup">
<p>
The <code>setup.org</code> file contains default headers added to the top of each org file
pushed as a blog post using the <a href="#el-push-to-blog">push-to-blog</a> function.  The additional header
performs the following:
</p>
<ul class="org-ul">
<li>setup the path to the org-infojs source (local) and the table of contents
defaults,</li>
<li>add the <code>:comments link</code> header argument to allow for edits in the tangled
file and use of <code>org-detangle</code>,</li>
<li>prevents evaluation of source blocks by default,</li>
<li>define common macros</li>
</ul>

<div class="org-src-container">
<pre class="src src-org" id="orgfd71a5d"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/setup.org]</div><span style="color: #b22222;">#+INFOJS_OPT: toc:t tdepth:2 view:showall ftoc:t path:/blog/js/org-info.js</span>
<span style="color: #b22222;">#+PROPERTY: header-args :eval never</span>
<span style="color: #b22222;">#+PROPERTY: header-args+ :comments link</span>
<span style="color: #b22222;">#+STARTUP: nohideblocks</span>
<span style="color: #b22222;">#+MACRO: tt \nbsp{}</span>
<span style="color: #b22222;">#+MACRO: kbd call_el-common-kbd[:eval yes :results value raw :exports results]($1)</span>
</pre>
</div>

<p>
Along with header specifications, common source blocks are also included in each
file via the <code>source-blocks.org</code> file.
</p>

<div class="org-src-container">
<pre class="src src-org" id="org0c8e279"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[org/source-blocks.org]</div><span style="color: #b22222;">#+NAME: el-common-kbd</span>
<span style="color: #b22222;">#+BEGIN_SRC emacs-lisp :var x="" :exports none</span>
<span style="color: #7f7f7f;">(format </span><span style="color: #8b2252;">"@@html:%s@@"</span>
<span style="color: #7f7f7f;">        (mapconcat</span>
<span style="color: #7f7f7f;">         (</span><span style="color: #a020f0;">lambda</span><span style="color: #7f7f7f;"> (el)</span>
<span style="color: #7f7f7f;">           (format </span><span style="color: #8b2252;">"&lt;kbd&gt;%s&lt;/kbd&gt;"</span><span style="color: #7f7f7f;"> el))</span>
<span style="color: #7f7f7f;">         (split-string x </span><span style="color: #8b2252;">" "</span><span style="color: #7f7f7f;">) </span><span style="color: #8b2252;">"&amp;nbsp;"</span><span style="color: #7f7f7f;">))</span>
<span style="color: #b22222;">#+END_SRC</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org8d0bdcc" class="outline-2">
<h2 id="org8d0bdcc">Emacs setup</h2>
<div class="outline-text-2" id="text-org8d0bdcc">
<p>
This section contains the emacs-lisp backend code used to produce the website
from the set of source org files.  While the org-publish mechanism handles most
of this, some specific items are handled manually.
</p>

<p>
When tangled, this section creates the <code>my-website.el</code> file which can then be
loaded from the emacs setup file (using <code>(require 'my-website)</code>).
</p>
</div>

<div id="outline-container-org4e9bfc0" class="outline-3">
<h3 id="org4e9bfc0">Header</h3>
<div class="outline-text-3" id="text-org4e9bfc0">
<p>
This first section creates the header for the <code>my-website.el</code> file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orge0a1ad8"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">my-website.el --- Personal website configuration</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Defines functions for publishing a static website.  This file was produced</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">automatically from website.org.  See the website.org file for a full</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">description.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orge566106" class="outline-3">
<h3 id="sitemap">Sitemap</h3>
<div class="outline-text-3" id="text-sitemap">
<p>
The sitemap is used here to provide an automatically updated list of blog posts.
</p>

<p>
The idea is to generate a <code>sitemap.org</code> file which contains a subtree for blog
posts, sorted by date (most recent first).  Then, the org-mode <code>#+INCLUDE</code>
directive is used to display the blog posts (see the <a href="http://orgmode.org/manual/Include-files.html">documentation</a>) on any page.
A list of the 5 most recent posts is shown on the <a href="#index_org">main page</a> and a full list is
included in the <a href="#page-blog-posts">blog page</a>.  This keeps lists of posts up-to-date.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org09219c3"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/org-publish-org-sitemap</span> (title list)
  <span style="color: #8b2252;">"Sitemap generation function."</span>
  (concat <span style="color: #8b2252;">"#+TITLE: Sitemap\n\n"</span>
          (org-list-to-subtree list)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/org-publish-org-sitemap-format</span> (entry style project)
  <span style="color: #8b2252;">"Custom sitemap entry formatting: add date"</span>
  (<span style="color: #a020f0;">cond</span> ((not (directory-name-p entry))
         (format <span style="color: #8b2252;">"[[file:%s][(%s) %s]]"</span>
                 entry
                 (format-time-string <span style="color: #8b2252;">"%Y-%m-%d"</span>
                                     (org-publish-find-date entry project))
                 (org-publish-find-title entry project)))
        ((eq style 'tree)
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">Return only last subdir.</span>
         (file-name-nondirectory (directory-file-name entry)))
        (t entry)))
</pre>
</div>
</div>
</div>


<div id="outline-container-orge816ee3" class="outline-3">
<h3 id="rss">RSS</h3>
<div class="outline-text-3" id="text-rss">
<p>
A simple RSS feed is also created using <code>ox-rss</code>.  It includes the first section
of the document as feed content (extracted using the
 <a href="#coderef-func-get-paragraph" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-func-get-paragraph');" onmouseout="CodeHighlightOff(this, 'coderef-func-get-paragraph');"><code>™/org-get-first-paragraph</code> function</a>).
The RSS feed is also limited to the latest 30 entries.
</p>

<p>
There are currently issues with the styling and images in the feed, but it is
sufficient for my simple use.  A few tricks are worth explaining:
</p>

<ul class="org-ul">
<li><a href="#coderef-rss-permalink" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rss-permalink');" onmouseout="CodeHighlightOff(this, 'coderef-rss-permalink');">Set the PERMALINK field</a> to link to articles.  Since <code>ox-rss</code> prefixes the
permalink with the URL of <code>index.html</code>, the constructed permalink starts with
<code>../</code> to move up one level in the folder structure.</li>
<li><a href="#coderef-rss-pubdate" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rss-pubdate');" onmouseout="CodeHighlightOff(this, 'coderef-rss-pubdate');">Set the publication date</a> to the post date.</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7e3a803"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div><span id="coderef-func-get-paragraph" class="coderef-off">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/org-get-first-paragraph</span> (file)</span>
  <span style="color: #8b2252;">"Get string content of first paragraph of file."</span>
  (<span style="color: #a020f0;">with-temp-buffer</span>
    (insert-file-contents file)
    (goto-char (point-min))
    (show-all)
    (<span style="color: #a020f0;">let</span> ((first-begin (<span style="color: #a020f0;">progn</span>
                         (org-forward-heading-same-level 1)
                         (point)))
          (first-end (<span style="color: #a020f0;">progn</span>
                       (org-next-visible-heading 1)
                       (point))))
      (buffer-substring first-begin first-end))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/org-rss-publish-to-rss</span> (plist filename pub-dir)
  <span style="color: #8b2252;">"Prepare rss.org file before exporting."</span>
  (<span style="color: #a020f0;">let*</span> ((basedir (plist-get plist <span style="color: #483d8b;">:base-directory</span>))
         (postsdir (concat (file-name-as-directory basedir) <span style="color: #8b2252;">"posts"</span>)))
    (<span style="color: #a020f0;">with-current-buffer</span> (find-file filename)
      (erase-buffer)
      (insert <span style="color: #8b2252;">"#+TITLE: misc/ blog RSS\n"</span>)
      (insert <span style="color: #8b2252;">"#+SETUPFILE: setup.org\n"</span>)
      (insert <span style="color: #8b2252;">"#+INCLUDE: source-blocks.org\n"</span>)
      (insert <span style="color: #8b2252;">"#+OPTIONS: toc:nil\n"</span>)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">The following does not seem to work</span>
      (insert (concat
               <span style="color: #8b2252;">"#+HTML_HEAD: &lt;link rel=\"stylesheet\" type=\"text/css\""</span>
               <span style="color: #8b2252;">" href=\"/blog/css/site.css\" /&gt;\n\n"</span>))
      (<span style="color: #a020f0;">let*</span> ((files-all
              (reverse (directory-files postsdir nil
                                        <span style="color: #8b2252;">"[0-9-]+.*\\.org$"</span>)))
             (files (subseq files-all 0 (min (length files-all) 30))))
        (<span style="color: #a020f0;">dolist</span> (post files)
          (<span style="color: #a020f0;">let*</span> ((post-file (concat (file-name-as-directory postsdir) post))
                 (post-title (org-publish-find-title post-file plist))
                 (preview-str (&#8482;/org-get-first-paragraph post-file))
                 (date (replace-regexp-in-string
                        <span style="color: #8b2252;">"</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[0-9]\\{4\\}-[0-9]\\{2\\}-[0-9]\\{2\\}</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">-.*"</span>
                        <span style="color: #8b2252;">"\\1"</span> post)))
            (insert (concat <span style="color: #8b2252;">"* [[file:posts/"</span> post <span style="color: #8b2252;">"]["</span> post-title <span style="color: #8b2252;">"]]\n\n"</span>))
            (org-set-property <span style="color: #8b2252;">"ID"</span> post)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">ox-rss prepends html-link-home to permalink</span>
<span id="coderef-rss-permalink" class="coderef-off">            (org-set-property <span style="color: #8b2252;">"RSS_PERMALINK"</span></span>
                              (concat <span style="color: #8b2252;">"../posts/"</span>
                                      (file-name-sans-extension post)
                                      <span style="color: #8b2252;">".html"</span>))
            (org-set-property
<span id="coderef-rss-pubdate" class="coderef-off">             <span style="color: #8b2252;">"PUBDATE"</span></span>
             (format-time-string
              <span style="color: #8b2252;">"&lt;%Y-%m-%d %a %H:%M&gt;"</span>
              (org-time-string-to-time
               (replace-regexp-in-string
                <span style="color: #8b2252;">"</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">[0-9]\\{4\\}-[0-9]\\{2\\}-[0-9]\\{2\\}</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">-.*"</span>
                <span style="color: #8b2252;">"\\1"</span> post))))
            (insert <span style="color: #8b2252;">"*"</span>)
            (insert preview-str)
            (newline 1)
            (insert (concat <span style="color: #8b2252;">"[[file:posts/"</span> post <span style="color: #8b2252;">"][(Read more)]]\n\n"</span>))))
        (save-buffer))))
  (<span style="color: #a020f0;">let</span> ((user-mail-address <span style="color: #8b2252;">"t"</span>)
        (org-export-with-broken-links t)
        (org-rss-use-entry-url-as-guid nil))
    (org-rss-publish-to-rss plist filename pub-dir)))
</pre>
</div>
</div>
</div>


<div id="outline-container-orgb002cb8" class="outline-3">
<h3 id="orgb002cb8">Mathjax path</h3>
<div class="outline-text-3" id="text-orgb002cb8">
<p>
In order to use the website on secured connections (<code>https</code>), the <code>https</code>
version of the mathjax library is loaded.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org63cc91e"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div><span style="color: #b22222;">;; </span><span style="color: #b22222;">Use https for mathjax</span>
(setcdr
 (assq 'path org-html-mathjax-options)
 '(<span style="color: #8b2252;">"https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"</span>))
</pre>
</div>
</div>
</div>


<div id="outline-container-orgdce6e33" class="outline-3">
<h3 id="orgdce6e33">Custom backend</h3>
<div class="outline-text-3" id="text-orgdce6e33">
<p>
The backend used for exporting org files to HTML is derived from the builtin
<code>html</code> backend, adding one functionality: the name of the tangle file for each
source block is shown in the block, as an overlay.
</p>

<p>
To achieve this, the tangle process must be first initiated, i.e. tangled blocks
must be collected using the <code>org-babel-tangle-collect-blocks</code> storing the
tangled filename for each block in a cache (the <code>™/org-tangle-list-cache</code>
variable).  Then, during export, the source blocks are filtered and the filename
is added to the source block <code>&lt;pre&gt;</code> tag.  Note that this is not valid CSS, but
it seems to work on most browsers, so it will do for now.
</p>
</div>


<div id="outline-container-org4d2d334" class="outline-4">
<h4 id="org4d2d334">Preprocess buffer</h4>
<div class="outline-text-4" id="text-org4d2d334">
<p>
The <code>™/org-export-collect-tangle</code> function is responsible for collecting source
blocks for tangling and saving the output filename in the cache.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org00715c1"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div>(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">&#8482;/org-tangle-list-cache</span> nil)
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/org-export-collect-tangle</span> (backend)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Remove hook to ensure it does not get called recursively</span>
  (remove-hook 'org-export-before-processing-hook
               '&#8482;/org-export-collect-tangle)
  (<span style="color: #a020f0;">when</span> (equal backend '&#8482;/html)
    (<span style="color: #a020f0;">setq</span> &#8482;/org-tangle-list-cache nil)
    (<span style="color: #a020f0;">save-excursion</span>
      (<span style="color: #a020f0;">save-restriction</span>
        (widen)
        (show-all)
        (<span style="color: #a020f0;">let</span> ((src-blocks (org-babel-tangle-collect-blocks)))
          (<span style="color: #a020f0;">dolist</span> (src-lang src-blocks)
            (<span style="color: #a020f0;">dolist</span> (src-block (cdr src-lang))
              (<span style="color: #a020f0;">let</span> ((src-block-name (nth 3 src-block))
                    (src-block-tangle (cdr (assoc <span style="color: #483d8b;">:tangle</span> (nth 4 src-block)))))
                (add-to-list '&#8482;/org-tangle-list-cache
                             `(,src-block-name . ,src-block-tangle))))))))))
</pre>
</div>
</div>
</div>


<div id="outline-container-org6c71bcb" class="outline-4">
<h4 id="src-block-tangle">Source block processing</h4>
<div class="outline-text-4" id="text-src-block-tangle">
<p>
The derived backend modifies the source block handling function by inserting the
name of the tangled file.  The regular <code>html</code> exporter is first used to <a href="#coderef-proc-src-html" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-proc-src-html');" onmouseout="CodeHighlightOff(this, 'coderef-proc-src-html');">produce
the html code for the source block</a> (including syntax highlighting).  The html
output is then modified by inserting a <code>&lt;div&gt;</code> block, fixed at the top right
corner of the source block.  The CSS class <code>src-label</code> is added to the div block
to allow for customization of the appearance.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org3f5a9ab"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/html-src-block</span> (src-block contents info)
  <span style="color: #8b2252;">"Transcode a SRC-BLOCK element from Org to HTML.</span>
<span style="color: #8b2252;">CONTENTS is nil.  INFO is a plist used as a communication</span>
<span style="color: #8b2252;">  channel.  Add name of tangle file to source block (this</span>
<span style="color: #8b2252;">  requires a preprocessing hook to be added with</span>
<span style="color: #8b2252;">  `</span><span style="color: #008b8b;">&#8482;/org-export-collect-tangle</span><span style="color: #8b2252;">')."</span>
  (<span style="color: #a020f0;">let*</span> ((src-block-name (org-element-property <span style="color: #483d8b;">:name</span> src-block))
         (src-block-tangle
          (<span style="color: #a020f0;">when</span> &#8482;/org-tangle-list-cache
            (cdr (assoc src-block-name &#8482;/org-tangle-list-cache))))
<span id="coderef-proc-src-html" class="coderef-off">         (export-out (org-export-with-backend</span>
                      'html src-block contents info)))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> src-block-tangle (&gt; (length src-block-tangle) 0)
               (not (string= src-block-tangle <span style="color: #8b2252;">"no"</span>)))
      (<span style="color: #a020f0;">let</span> ((src-start-pat <span style="color: #8b2252;">"</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(</span><span style="color: #8b2252;">&lt;pre class=\"src src-[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">&gt;]+&gt;</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">"</span>))
        (<span style="color: #a020f0;">setq</span> export-out
              (replace-regexp-in-string
               src-start-pat
               (concat <span style="color: #8b2252;">"\\1&lt;div style=\"position: absolute; top: 0;"</span>
                       <span style="color: #8b2252;">" right: 0; text-align:right;\" class=\"src-label\"&gt;["</span>
                       src-block-tangle <span style="color: #8b2252;">"]&lt;/div&gt;"</span>)
               export-out))))
      export-out))
</pre>
</div>

<p>
Finally, the derived backend is defined, using the custom translation function
for source blocks.  Everything else is handled by the regular <code>html</code> backend.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org3292174"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div>(org-export-define-derived-backend '&#8482;/html 'html
  <span style="color: #483d8b;">:translate-alist</span> '((src-block . &#8482;/html-src-block)))
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orge1e2fec" class="outline-3">
<h3 id="orge1e2fec">Publishing function</h3>
<div class="outline-text-3" id="text-orge1e2fec">
<p>
A simple wrapper function is created to export to the custom backend.  It is
almost identical to <code>org-html-publish-to-html</code> with the exception of the actual
backend used.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org36ffd02"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div>(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/org-html-publish-to-&#8482;-html</span> (plist filename pub-dir)
  <span style="color: #8b2252;">"Publish an org file to HTML.</span>

<span style="color: #8b2252;">FILENAME is the filename of the Org file to be published.  PLIST</span>
<span style="color: #8b2252;">is the property list for the given project.  PUB-DIR is the</span>
<span style="color: #8b2252;">publishing directory.</span>

<span style="color: #8b2252;">Return output file name."</span>
  (add-hook 'org-export-before-processing-hook
            '&#8482;/org-export-collect-tangle)
  (<span style="color: #a020f0;">let</span> ((res
         (org-publish-org-to '&#8482;/html filename
                             (concat <span style="color: #8b2252;">"."</span> (<span style="color: #a020f0;">or</span> (plist-get plist <span style="color: #483d8b;">:html-extension</span>)
                                             org-html-extension
                                             <span style="color: #8b2252;">"html"</span>))
                             plist pub-dir)))
    (remove-hook 'org-export-before-processing-hook
                 '&#8482;/org-export-collect-tangle)
    res))
</pre>
</div>
</div>
</div>


<div id="outline-container-org3ae0edc" class="outline-3">
<h3 id="org3ae0edc">Org-publishing setup</h3>
<div class="outline-text-3" id="text-org3ae0edc">
<p>
The publishing configuration is set via the <code>org-publish-project-alist</code>
variable.  The following function returns a list of project properties to use
with <code>org-publish-project-alist</code>.
</p>

<p>
It relies on the <code>™/get-perso</code> utility to get the root folder
(line&nbsp;<a href="#coderef-root-perso" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-root-perso');" onmouseout="CodeHighlightOff(this, 'coderef-root-perso');">5</a>).  This can be replaced by a full path to the website
root folder.
</p>

<p>
The function defines the paths to the org source, the destination, the
attachment folders, etc. and loads the content of the custom HTML <a href="#html_head">head</a>, <a href="#html_preamble">preamble</a>
and <a href="#html_postamble">postamble</a>.  It creates multiple projects to control the publishing of the
website:
</p>
<ul class="org-ul">
<li><code>w-org</code> is the main publishing of org files to html.  It uses two
<code>publishing-function</code> entries: one to generate the html file and one to export
a complete org file (which can be accessed on the output webpage by clicking
on the buttons defined in the <a href="#html_postamble">footer</a>).  The <a href="#sitemap">sitemap</a> generation is also
configured in this project.  Additional features include the insertion of a
RSS link to the header, and the suppression of TODO items and statistics
cookies.</li>
<li><code>w-images</code> simply publishes images in the <code>images/</code> folder using the
<code>org-publish-attachment</code> function.</li>
<li><code>w-js</code> publishes the javascript files in the <code>js/</code> folder.</li>
<li><code>w-css</code> publishes the <a href="#css">CSS file</a> in the <code>css/</code> folder.</li>
<li><code>w-rss</code> generates the <a href="#rss">RSS</a> feed using the <code>ox-rss</code> package.</li>
<li>Finally, <code>website</code> is a meta project which simply encapsulates all the other
projects.</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org86851fb"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div><span style="color: #b22222;">;; </span><span style="color: #b22222;">Get project settings</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/get-publish-project-spec</span> ()
  <span style="color: #8b2252;">"Return project settings for use with `</span><span style="color: #008b8b;">org-publish-project-alist</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">let*</span> ((website-root (file-name-as-directory
<span id="coderef-root-perso" class="coderef-off">                        (&#8482;/get-perso <span style="color: #8b2252;">"website-root"</span>)))</span>
         (website-org (file-name-as-directory
                       (concat website-root <span style="color: #8b2252;">"org"</span>)))
         (website-www (file-name-as-directory
                       (concat website-root <span style="color: #8b2252;">"www"</span>)))
         (website-org-img (file-name-as-directory
                           (concat website-org <span style="color: #8b2252;">"images"</span>)))
         (website-www-img (file-name-as-directory
                           (concat website-www <span style="color: #8b2252;">"images"</span>)))
         (website-org-js (file-name-as-directory
                          (concat website-org <span style="color: #8b2252;">"js"</span>)))
         (website-www-js (file-name-as-directory
                          (concat website-www <span style="color: #8b2252;">"js"</span>)))
         (website-org-css (file-name-as-directory
                           (concat website-org <span style="color: #8b2252;">"css"</span>)))
         (website-www-css (file-name-as-directory
                           (concat website-www <span style="color: #8b2252;">"css"</span>)))
         (website-org-html (file-name-as-directory
                            (concat website-org <span style="color: #8b2252;">"html"</span>)))
         (website-org-posts (file-name-as-directory
                             (concat website-org <span style="color: #8b2252;">"posts"</span>)))
         (get-content (<span style="color: #a020f0;">lambda</span> (x)
                        (<span style="color: #a020f0;">with-temp-buffer</span>
                          (insert-file-contents (concat website-org-html
                                                        x))
                          (buffer-string))))
         (website-html-head (funcall get-content <span style="color: #8b2252;">"html_head.html"</span>))
         (website-html-preamble (funcall get-content <span style="color: #8b2252;">"html_preamble.html"</span>))
         (website-html-postamble (funcall get-content <span style="color: #8b2252;">"html_postamble.html"</span>)))
    `(
      (<span style="color: #8b2252;">"w-org"</span>
       <span style="color: #483d8b;">:base-directory</span> ,website-org
       <span style="color: #483d8b;">:base-extension</span> <span style="color: #8b2252;">"org"</span>
       <span style="color: #483d8b;">:recursive</span> t
       <span style="color: #483d8b;">:exclude</span> <span style="color: #8b2252;">"setup\\.org</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">website\\.org</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">rss\\.org</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">source-blocks\\.org"</span>
       <span style="color: #483d8b;">:publishing-directory</span> ,website-www
       <span style="color: #483d8b;">:publishing-function</span> (&#8482;/org-html-publish-to-&#8482;-html
                             org-org-publish-to-org)
       <span style="color: #483d8b;">:html-extension</span> <span style="color: #8b2252;">"html"</span>
       <span style="color: #483d8b;">:htmlized-source</span> t
       <span style="color: #483d8b;">:html-doctype</span> <span style="color: #8b2252;">"html5"</span>
       <span style="color: #b22222;">;;</span><span style="color: #b22222;">:html-html5-fancy t</span>
       <span style="color: #483d8b;">:language</span> <span style="color: #8b2252;">"en"</span>
       <span style="color: #483d8b;">:section-numbers</span> nil
       <span style="color: #483d8b;">:auto-sitemap</span> t
       <span style="color: #483d8b;">:sitemap-date-format</span> <span style="color: #8b2252;">"Published: %a %b %d %Y"</span>
       <span style="color: #483d8b;">:sitemap-sort-files</span> anti-chronologically
       <span style="color: #483d8b;">:sitemap-function</span> &#8482;/org-publish-org-sitemap
       <span style="color: #483d8b;">:sitemap-format-entry</span> &#8482;/org-publish-org-sitemap-format
       <span style="color: #483d8b;">:with-toc</span> nil <span style="color: #b22222;">;; </span><span style="color: #b22222;">except when otherwise stated</span>
       <span style="color: #483d8b;">:with-date</span> t
       <span style="color: #483d8b;">:headline-levels</span> 4
       <span style="color: #483d8b;">:with-sub-superscript</span> t
       <span style="color: #483d8b;">:with-todo-keywords</span> nil
       <span style="color: #483d8b;">:with-statistics-cookies</span> nil
       <span style="color: #483d8b;">:with-email</span> nil
       <span style="color: #483d8b;">:html-link-home</span> <span style="color: #8b2252;">"/blog/index.html"</span>
       <span style="color: #483d8b;">:html-link-up</span> <span style="color: #8b2252;">"/blog/index.html"</span>
       <span style="color: #483d8b;">:html-head-extra</span>
       <span style="color: #8b2252;">"&lt;link rel=\"alternate\" type=\"application/rss+xml\"</span>
<span style="color: #8b2252;">                href=\"/blog/rss.xml\"</span>
<span style="color: #8b2252;">                title=\"RSS feed\"&gt;"</span>
       <span style="color: #483d8b;">:html-head</span> ,website-html-head
       <span style="color: #483d8b;">:html-preamble</span> ,website-html-preamble
       <span style="color: #483d8b;">:html-postamble</span> ,website-html-postamble)

      (<span style="color: #8b2252;">"w-images"</span>
       <span style="color: #483d8b;">:base-directory</span> ,website-org-img
       <span style="color: #483d8b;">:base-extension</span> <span style="color: #8b2252;">"jpg</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">gif</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">png"</span>
       <span style="color: #483d8b;">:recursive</span> t
       <span style="color: #483d8b;">:publishing-directory</span> ,website-www-img
       <span style="color: #483d8b;">:publishing-function</span> org-publish-attachment)

      (<span style="color: #8b2252;">"w-js"</span>
       <span style="color: #483d8b;">:base-directory</span> ,website-org-js
       <span style="color: #483d8b;">:base-extension</span> <span style="color: #8b2252;">"js"</span>
       <span style="color: #483d8b;">:publishing-directory</span> ,website-www-js
       <span style="color: #483d8b;">:publishing-function</span> org-publish-attachment)

      (<span style="color: #8b2252;">"w-css"</span>
       <span style="color: #483d8b;">:base-directory</span> ,website-org-css
       <span style="color: #483d8b;">:base-extension</span> <span style="color: #8b2252;">"css"</span>
       <span style="color: #483d8b;">:publishing-directory</span> ,website-www-css
       <span style="color: #483d8b;">:publishing-function</span> org-publish-attachment)

      (<span style="color: #8b2252;">"w-rss"</span>
       <span style="color: #483d8b;">:base-directory</span> ,website-org
       <span style="color: #483d8b;">:base-extension</span> <span style="color: #8b2252;">"org"</span>
       <span style="color: #483d8b;">:include</span> (<span style="color: #8b2252;">"rss.org"</span>)
       <span style="color: #483d8b;">:exclude</span> <span style="color: #8b2252;">".*"</span>
       <span style="color: #483d8b;">:with-author</span> nil
       <span style="color: #483d8b;">:with-todo-keywords</span> nil
       <span style="color: #483d8b;">:with-statistics-cookies</span> nil
       <span style="color: #483d8b;">:with-broken-link</span> t
       <span style="color: #483d8b;">:with-email</span> nil
       <span style="color: #483d8b;">:html-link-home</span> <span style="color: #8b2252;">"/blog/index.html"</span>
       <span style="color: #483d8b;">:publishing-directory</span> ,website-www
       <span style="color: #483d8b;">:publishing-function</span> &#8482;/org-rss-publish-to-rss
       <span style="color: #483d8b;">:section-numbers</span> nil
       <span style="color: #483d8b;">:html-link-use-abs-url</span> t)

      (<span style="color: #8b2252;">"website"</span> <span style="color: #483d8b;">:components</span>
       (<span style="color: #8b2252;">"w-org"</span> <span style="color: #8b2252;">"w-images"</span> <span style="color: #8b2252;">"w-js"</span> <span style="color: #8b2252;">"w-css"</span> <span style="color: #8b2252;">"w-rss"</span>)))))
</pre>
</div>
</div>
</div>


<div id="outline-container-org7ccb03d" class="outline-3">
<h3 id="el-publish-wrapper">Publishing wrapper function</h3>
<div class="outline-text-3" id="text-el-publish-wrapper">
<p>
The <code>™/publish-website</code> function is the entry point to generate the website
from the source org files.  It sets up the configuration lists, defines some
simple options and calls the publishing function.
</p>

<p>
The website is updated when calling <code>(™/publish-website)</code>, which only publishes
newly modified files.  When used with additional arguments, a full update can be
forced: <code>(™/publish-website "website" t)</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org11e82b9"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div><span style="color: #b22222;">;; </span><span style="color: #b22222;">org-publish for website</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/publish-website</span> (<span style="color: #228b22;">&amp;optional</span> project force)
  <span style="color: #8b2252;">"Publish personal website."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">unless</span> project (<span style="color: #a020f0;">setq</span> project <span style="color: #8b2252;">"website"</span>))
  (<span style="color: #a020f0;">let</span> ((org-publish-project-alist (&#8482;/get-publish-project-spec))
        (org-export-date-timestamp-format <span style="color: #8b2252;">"%Y-%m-%d"</span>)
        (org-todo-keywords '((sequence <span style="color: #8b2252;">"TODO"</span> <span style="color: #8b2252;">"REVIEW"</span> <span style="color: #8b2252;">"|"</span>
                                       <span style="color: #8b2252;">"DONE"</span> <span style="color: #8b2252;">"DEFERRED"</span> <span style="color: #8b2252;">"ABANDONED"</span>))))
    (org-publish-project project force)))
</pre>
</div>
</div>
</div>



<div id="outline-container-orge8d0f17" class="outline-3">
<h3 id="el-push-to-blog">Push org-file to blog</h3>
<div class="outline-text-3" id="text-el-push-to-blog">
<p>
The mechanism to publish new posts uses the <code>™/push-to-blog</code> function to convert
a standalone org file into a post.  The function performs the following:
</p>
<ul class="org-ul">
<li>add a <code>#+SETUPFILE</code> line to the header (the content of the setup file is
described <a href="#sec-org-setup">here</a>),</li>
<li>format the output filename with the post date preceding the title
(e.g. <code>YYYY-MM-DD-Post_title.org</code>),</li>
<li>search for TODO items, exit if any is found,</li>
<li>move file links (images) to a subfolder of the <code>org/images/</code> folder named
after the formatted output filename (e.g. <code>YYYY-MM-DD-Post_title/</code>),</li>
<li>modify links to files to point to the copy location,</li>
<li>finally, save the modified org file to the <code>org/posts/</code> folder.</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org295a417"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div><span style="color: #b22222;">;; </span><span style="color: #b22222;">Push to blog</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">&#8482;/push-to-blog</span> (org-file)
  <span style="color: #8b2252;">"Add ORG-FILE to personal blog."</span>
  (<span style="color: #a020f0;">let*</span> ((blog-dir (concat
                    (file-name-as-directory (&#8482;/get-perso <span style="color: #8b2252;">"website-root"</span>))
                    (file-name-as-directory <span style="color: #8b2252;">"org"</span>)))
         (post-dir (concat
                    (file-name-as-directory blog-dir)
                    (file-name-as-directory <span style="color: #8b2252;">"posts"</span>)))
         (img-dir-base (concat
                        (file-name-as-directory blog-dir)
                        (file-name-as-directory <span style="color: #8b2252;">"images"</span>)))
         (file-base (file-name-base org-file))
         post-date
         (has-date nil)
         out-file
         (org-inhibit-startup t)
         (visiting (find-buffer-visiting org-file))
         (buffer (<span style="color: #a020f0;">or</span> visiting (find-file-noselect org-file)))
         (org-tree (<span style="color: #a020f0;">with-current-buffer</span> buffer
                     (org-element-parse-buffer))))
    (<span style="color: #a020f0;">let</span> (setupfile-added-p)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Add SETUPFILE entry to tree, parse TITLE and DATE</span>
      (org-element-map
          org-tree 'keyword
        (<span style="color: #a020f0;">lambda</span> (r)
          (<span style="color: #a020f0;">let</span> ((key (org-element-property <span style="color: #483d8b;">:key</span> r))
                (value (org-element-property <span style="color: #483d8b;">:value</span> r)))
            (<span style="color: #a020f0;">unless</span> setupfile-added-p
              (<span style="color: #a020f0;">let</span> ((elt-setup (org-element-copy r))
                    (elt-src-block (org-element-copy r)))
                (org-element-put-property elt-src-block <span style="color: #483d8b;">:key</span> <span style="color: #8b2252;">"INCLUDE"</span>)
                (org-element-put-property elt-src-block <span style="color: #483d8b;">:value</span> <span style="color: #8b2252;">"../source-blocks.org"</span>)
                (org-element-insert-before elt-src-block r)
                (org-element-put-property elt-setup <span style="color: #483d8b;">:key</span> <span style="color: #8b2252;">"SETUPFILE"</span>)
                (org-element-put-property elt-setup <span style="color: #483d8b;">:value</span> <span style="color: #8b2252;">"../setup.org"</span>)
                (org-element-insert-before elt-setup r))
              (<span style="color: #a020f0;">setq</span> setupfile-added-p t))
            (<span style="color: #a020f0;">cond</span> ((string= key <span style="color: #8b2252;">"TITLE"</span>)
                   (<span style="color: #a020f0;">setq</span> out-file
                         (replace-regexp-in-string <span style="color: #8b2252;">"[[:space:]]+"</span> <span style="color: #8b2252;">"_"</span> value)))
                  ((string= key <span style="color: #8b2252;">"DATE"</span>)
                   (<span style="color: #a020f0;">setq</span> post-date
                         (format-time-string
                          <span style="color: #8b2252;">"%Y-%m-%d"</span>
                          (org-time-string-to-time value))))))
          (<span style="color: #a020f0;">and</span> out-file post-date setupfile-added-p))
        nil t)
      (<span style="color: #a020f0;">when</span> (not (<span style="color: #a020f0;">and</span> post-date out-file setupfile-added-p))
        (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"TITLE and DATE must be defined"</span>)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Look for remaining TODO</span>
    (<span style="color: #a020f0;">let</span> ((has-todo nil))
      (org-element-map org-tree 'headline
        (<span style="color: #a020f0;">lambda</span> (r)
          (<span style="color: #a020f0;">setq</span>
           has-todo (<span style="color: #a020f0;">or</span> has-todo
                        (equal 'todo
                               (org-element-property <span style="color: #483d8b;">:todo-type</span> r))))
          has-todo)
        nil t)
      (<span style="color: #a020f0;">when</span> has-todo
        (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"Remaining TODO items in file"</span>)))
    (<span style="color: #a020f0;">let*</span> ((base-fname (concat post-date <span style="color: #8b2252;">"-"</span> out-file))
           (out-file-full (concat post-dir base-fname <span style="color: #8b2252;">".org"</span>))
           (img-dir (concat img-dir-base base-fname)))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Copy images and update links</span>
      (org-element-map org-tree 'link
        (<span style="color: #a020f0;">lambda</span> (r)
          (<span style="color: #a020f0;">when</span> (string= (org-element-property <span style="color: #483d8b;">:type</span> r) <span style="color: #8b2252;">"file"</span>)
            (<span style="color: #a020f0;">let*</span> ((link-file (org-element-property <span style="color: #483d8b;">:path</span> r))
                   (link-file-base (file-name-base link-file))
                   (link-file-ext (file-name-extension link-file t))
                   (out-link (concat (file-name-as-directory img-dir)
                                     link-file-base link-file-ext))
                   (img-path (concat <span style="color: #8b2252;">"../images/"</span>
                                     (file-name-as-directory base-fname)
                                     link-file-base link-file-ext)))
              (<span style="color: #a020f0;">when</span> (member link-file-ext '(<span style="color: #8b2252;">".png"</span> <span style="color: #8b2252;">".jpg"</span> <span style="color: #8b2252;">".tif"</span>))
                <span style="color: #b22222;">;; </span><span style="color: #b22222;">Copy file</span>
                (mkdir img-dir t)
                (copy-file link-file out-link t)
                <span style="color: #b22222;">;; </span><span style="color: #b22222;">Update link target</span>
                (org-element-put-property r <span style="color: #483d8b;">:path</span> img-path)
                (setcar (org-element-contents r) (concat <span style="color: #8b2252;">"file:"</span> img-path)))))))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Write output</span>
      (<span style="color: #a020f0;">with-current-buffer</span> (find-file out-file-full)
        (erase-buffer)
        (insert (org-element-interpret-data org-tree))
        (save-buffer)))))
</pre>
</div>
</div>
</div>


<div id="outline-container-orgafc3ac9" class="outline-3">
<h3 id="orgafc3ac9">Footer</h3>
<div class="outline-text-3" id="text-orgafc3ac9">
<p>
This block closes the <code>my-website.el</code> file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org13f728a"><div style="position: absolute; top: 0; right: 0; text-align:right;" class="src-label">[my-website.el]</div>
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">my-website</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">my-website.el ends here</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<!-- [[file:~/dotfiles/emacs/website/website.org::html-postamble][html-postamble]] -->
<div id="show_source">
  <input type="button" class="footer-button" value="Show Org source (html)"
         onClick='show_org_source(true)' />
  <input type="button" class="footer-button" value="Show Org source (raw)"
         onClick='show_org_source()' />
</div>
<div class='footer'>
  Last updated 2017-12-04 Mon 21:30. <br>
  Built with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 25.2.2 (<a href="http://orgmode.org">Org</a> mode 9.1.3).
</div>
<!-- html-postamble ends here -->
</div>
</body>
</html>
